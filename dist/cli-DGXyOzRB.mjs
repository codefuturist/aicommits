var eD=Object.defineProperty;var i=(e,t)=>eD(e,"name",{value:t,configurable:!0});var oo,so,io,ao,lo,uo,Er,co,po,fo,mo,ho,go,yo,vo,Vn,_o,bo,Cr,$r,wo,Do,Eo,Co,$o,xr,xo,So,ko,Io,Ao,To,Fo,Oo,Ro,Po,Mo,No,Bo,jo,Lo,Uo,zo,qo,Vo,Go,Zo,Wo,Ho,Jo,Ko,Yo,Xo,Qo,es,ts,ns;import{createRequire as tD}from"node:module";const nD=tD(import.meta.url);import rD from"tty";import{fileURLToPath as vf}from"node:url";import{ChildProcess as _f,execFile as oD,spawnSync as sD,spawn as iD}from"node:child_process";import{StringDecoder as bf}from"node:string_decoder";import{debuglog as aD,stripVTControlCharacters as lD,inspect as wf,promisify as Df,callbackify as Ir,aborted as uD}from"node:util";import Se,{platform as cD,hrtime as Ef,execPath as dD,execArgv as pD,stdin as Cf,stdout as Rl}from"node:process";import $f,{ReadStream as xf}from"node:tty";import At from"node:path";import fD,{execSync as bt,exec as mD}from"child_process";import Xe,{dirname as on,join as je,resolve as sn}from"path";import dt,{existsSync as Le,mkdirSync as Si,readFileSync as Gn,accessSync as hD,constants as gD,realpathSync as Sf,writeFileSync as Pl,chmodSync as kf,statSync as If,unlinkSync as ki,renameSync as yD}from"fs";import{setTimeout as Af,scheduler as Tf,setImmediate as vD}from"node:timers/promises";import{constants as Zn}from"node:os";import{once as wt,addAbortListener as Ff,EventEmitter as _D,on as Ii,setMaxListeners as bD}from"node:events";import{serialize as wD}from"node:v8";import{statSync as DD,readFileSync as Ml,appendFileSync as ED,writeFileSync as CD,createWriteStream as Of,createReadStream as Rf}from"node:fs";import{Transform as $D,getDefaultHighWaterMark as Ai,Duplex as Nl,Writable as Bl,Readable as Wn,PassThrough as Pf}from"node:stream";import{Buffer as jl}from"node:buffer";import{finished as kn}from"node:stream/promises";import*as Ti from"node:readline";import xD from"node:readline";import et from"fs/promises";import Ll,{platform as Hn,tmpdir as Mf,arch as SD}from"os";import kD from"crypto";import{fileURLToPath as Fi,pathToFileURL as ID}from"url";import{promisify as AD}from"util";var TD=Object.defineProperty,tt=i((e,t)=>TD(e,"name",{value:t,configurable:!0}),"a$1");const FD="known-flag",OD="unknown-flag",RD="argument",PD=/\B([A-Z])/g,MD=tt(e=>e.replaceAll(PD,"-$1").toLowerCase(),"camelToKebab"),{hasOwnProperty:ND}=Object.prototype,gs=tt((e,t)=>ND.call(e,t),"hasOwn"),Ul=tt(e=>typeof e=="function"?[e,!1]:Array.isArray(e)?[e[0],!0]:Ul(e.type),"parseFlagType"),Nf=tt((e,t)=>e===Boolean?t!=="false":t,"normalizeBoolean"),Bf=tt((e,t)=>typeof t=="boolean"?t:e===Number&&t===""?Number.NaN:e(t),"applyParser"),BD=/[\s.:=]/,jD=tt(e=>{const t=`Flag name "${e}"`;if(e.length===0)throw new Error(`${t} cannot be empty`);if(e.length===1)throw new Error(`${t} must be longer than a character`);const n=e.match(BD);if(n)throw new Error(`${t} cannot contain "${n?.[0]}"`)},"validateFlagName"),zl=tt((e,t,n)=>{if(gs(e,t))throw new Error(`Duplicate flags named "${t}"`);e[t]=n},"setFlag"),LD=tt(e=>{const t={};for(const n in e){if(!gs(e,n))continue;jD(n);const r=e[n],o=[[],...Ul(r),r];zl(t,n,o);const s=MD(n);if(n!==s&&zl(t,s,o),"alias"in r&&typeof r.alias=="string"){const{alias:a}=r,l=`Flag alias "${a}" for flag "${n}"`;if(a.length===0)throw new Error(`${l} cannot be empty`);if(a.length>1)throw new Error(`${l} must be a single character`);zl(t,a,o)}}return t},"createRegistry"),UD=tt((e,t)=>{const n={};for(const r in e){if(!gs(e,r))continue;const[o,,s,a]=t[r];if(o.length===0&&"default"in a){let{default:l}=a;typeof l=="function"&&(l=l()),n[r]=l}else n[r]=s?o:o.pop()}return n},"finalizeFlags"),Oi="--",zD=3,qD=/^-{1,2}\w/,jf=tt(e=>{if(!qD.test(e))return;const t=!e.startsWith(Oi);let n=e.slice(t?1:2),r,o=-1;for(const s of["=",":","."]){const a=n.indexOf(s);a!==-1&&(o===-1||a<o)&&(o=a)}return o!==-1&&(r=n.slice(o+1),n=n.slice(0,o)),[n,r,t]},"parseFlagArgv"),Lf=tt((e,{onFlag:t,onArgument:n})=>{let r;const o=tt((s,a)=>{if(typeof r!="function")return!0;r(s,a),r=void 0},"triggerValueCallback");for(let s=0;s<e.length;s+=1){const a=e[s];if(a===Oi){o();const u=e.slice(s+1);n?.(u,[s],!0);break}const l=jf(a);if(l){if(o(),!t)continue;const[u,c,d]=l;if(d)for(let p=0;p<u.length;p+=1){o();const h=p===u.length-1;r=t(u[p],h?c:void 0,[s,p+1,h])}else r=t(u,c,[s])}else o(a,[s])&&n?.([a],[s])}o()},"argvIterator"),Uf=tt((e,t)=>{for(let n=t.length-1;n>=0;n-=1){const[r,o,s]=t[n];if(o){const a=e[r];let l=a.slice(0,o);if(s||(l+=a.slice(o+1)),l!=="-"){e[r]=l;continue}}e.splice(r,1)}},"spliceFromArgv"),VD=tt((e,t=process.argv.slice(2),{ignore:n}={})=>{const r=[],o=LD(e),s={},a=[];return a[Oi]=[],Lf(t,{onFlag(l,u,c){const d=(c.length===zD||l.length>1)&&gs(o,l);if(!n?.(d?FD:OD,l,u)){if(d){const[p,h]=o[l],g=Nf(h,u),f=tt((y,v)=>{r.push(c),v&&r.push(v),p.push(Bf(h,y||""))},"getFollowingValue");return g===void 0?f:f(g)}gs(s,l)||(s[l]=[]),s[l].push(u===void 0?!0:u),r.push(c)}},onArgument:tt((l,u,c)=>{n?.(RD,t[u[0]])||(a.push(...l),c?(a[Oi]=l,t.splice(u[0])):r.push(u))},"onArgument")}),Uf(t,r),{flags:UD(e,o),unknownFlags:s,_:a}},"typeFlag");tt((e,t,n=process.argv.slice(2))=>{const r=new Set(e.split(",").map(u=>jf(u)?.[0])),[o,s]=Ul(t),a=[],l=[];return Lf(n,{onFlag:tt((u,c,d)=>{if(!r.has(u)||!s&&a.length>0)return;const p=Nf(o,c),h=tt((g,f)=>{l.push(d),f&&l.push(f),a.push(Bf(o,g||""))},"getFollowingValue");return p===void 0?h:h(p)},"onFlag")}),Uf(n,l),s?a:a[0]},"getFlag");var GD=Object.defineProperty,ce=i((e,t)=>GD(e,"name",{value:t,configurable:!0}),"n$1");const ZD=ce(e=>{const t=process.stdout.columns??Number.POSITIVE_INFINITY;return typeof e=="function"&&(e=e(t)),e||(e={}),Array.isArray(e)?{columns:e,stdoutColumns:t}:{columns:e.columns??[],stdoutColumns:e.stdoutColumns??t}},"getOptions");function zf({onlyFirst:e=!1}={}){const t=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?(?:\\u0007|\\u001B\\u005C|\\u009C))","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|");return new RegExp(t,e?void 0:"g")}i(zf,"j$1"),ce(zf,"ansiRegex");const WD=zf();function ql(e){if(typeof e!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);return e.replace(WD,"")}i(ql,"w"),ce(ql,"stripAnsi");function qf(e){return e===161||e===164||e===167||e===168||e===170||e===173||e===174||e>=176&&e<=180||e>=182&&e<=186||e>=188&&e<=191||e===198||e===208||e===215||e===216||e>=222&&e<=225||e===230||e>=232&&e<=234||e===236||e===237||e===240||e===242||e===243||e>=247&&e<=250||e===252||e===254||e===257||e===273||e===275||e===283||e===294||e===295||e===299||e>=305&&e<=307||e===312||e>=319&&e<=322||e===324||e>=328&&e<=331||e===333||e===338||e===339||e===358||e===359||e===363||e===462||e===464||e===466||e===468||e===470||e===472||e===474||e===476||e===593||e===609||e===708||e===711||e>=713&&e<=715||e===717||e===720||e>=728&&e<=731||e===733||e===735||e>=768&&e<=879||e>=913&&e<=929||e>=931&&e<=937||e>=945&&e<=961||e>=963&&e<=969||e===1025||e>=1040&&e<=1103||e===1105||e===8208||e>=8211&&e<=8214||e===8216||e===8217||e===8220||e===8221||e>=8224&&e<=8226||e>=8228&&e<=8231||e===8240||e===8242||e===8243||e===8245||e===8251||e===8254||e===8308||e===8319||e>=8321&&e<=8324||e===8364||e===8451||e===8453||e===8457||e===8467||e===8470||e===8481||e===8482||e===8486||e===8491||e===8531||e===8532||e>=8539&&e<=8542||e>=8544&&e<=8555||e>=8560&&e<=8569||e===8585||e>=8592&&e<=8601||e===8632||e===8633||e===8658||e===8660||e===8679||e===8704||e===8706||e===8707||e===8711||e===8712||e===8715||e===8719||e===8721||e===8725||e===8730||e>=8733&&e<=8736||e===8739||e===8741||e>=8743&&e<=8748||e===8750||e>=8756&&e<=8759||e===8764||e===8765||e===8776||e===8780||e===8786||e===8800||e===8801||e>=8804&&e<=8807||e===8810||e===8811||e===8814||e===8815||e===8834||e===8835||e===8838||e===8839||e===8853||e===8857||e===8869||e===8895||e===8978||e>=9312&&e<=9449||e>=9451&&e<=9547||e>=9552&&e<=9587||e>=9600&&e<=9615||e>=9618&&e<=9621||e===9632||e===9633||e>=9635&&e<=9641||e===9650||e===9651||e===9654||e===9655||e===9660||e===9661||e===9664||e===9665||e>=9670&&e<=9672||e===9675||e>=9678&&e<=9681||e>=9698&&e<=9701||e===9711||e===9733||e===9734||e===9737||e===9742||e===9743||e===9756||e===9758||e===9792||e===9794||e===9824||e===9825||e>=9827&&e<=9829||e>=9831&&e<=9834||e===9836||e===9837||e===9839||e===9886||e===9887||e===9919||e>=9926&&e<=9933||e>=9935&&e<=9939||e>=9941&&e<=9953||e===9955||e===9960||e===9961||e>=9963&&e<=9969||e===9972||e>=9974&&e<=9977||e===9979||e===9980||e===9982||e===9983||e===10045||e>=10102&&e<=10111||e>=11094&&e<=11097||e>=12872&&e<=12879||e>=57344&&e<=63743||e>=65024&&e<=65039||e===65533||e>=127232&&e<=127242||e>=127248&&e<=127277||e>=127280&&e<=127337||e>=127344&&e<=127373||e===127375||e===127376||e>=127387&&e<=127404||e>=917760&&e<=917999||e>=983040&&e<=1048573||e>=1048576&&e<=1114109}i(qf,"P$2"),ce(qf,"isAmbiguous");function Vf(e){return e===12288||e>=65281&&e<=65376||e>=65504&&e<=65510}i(Vf,"z$2"),ce(Vf,"isFullWidth");function Gf(e){return e>=4352&&e<=4447||e===8986||e===8987||e===9001||e===9002||e>=9193&&e<=9196||e===9200||e===9203||e===9725||e===9726||e===9748||e===9749||e>=9776&&e<=9783||e>=9800&&e<=9811||e===9855||e>=9866&&e<=9871||e===9875||e===9889||e===9898||e===9899||e===9917||e===9918||e===9924||e===9925||e===9934||e===9940||e===9962||e===9970||e===9971||e===9973||e===9978||e===9981||e===9989||e===9994||e===9995||e===10024||e===10060||e===10062||e>=10067&&e<=10069||e===10071||e>=10133&&e<=10135||e===10160||e===10175||e===11035||e===11036||e===11088||e===11093||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12773||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||e===94192||e===94193||e>=94208&&e<=100343||e>=100352&&e<=101589||e>=101631&&e<=101640||e>=110576&&e<=110579||e>=110581&&e<=110587||e===110589||e===110590||e>=110592&&e<=110882||e===110898||e>=110928&&e<=110930||e===110933||e>=110948&&e<=110951||e>=110960&&e<=111355||e>=119552&&e<=119638||e>=119648&&e<=119670||e===126980||e===127183||e===127374||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||e===127568||e===127569||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||e===127988||e>=127992&&e<=128062||e===128064||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||e===128378||e===128405||e===128406||e===128420||e>=128507&&e<=128591||e>=128640&&e<=128709||e===128716||e>=128720&&e<=128722||e>=128725&&e<=128727||e>=128732&&e<=128735||e===128747||e===128748||e>=128756&&e<=128764||e>=128992&&e<=129003||e===129008||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129673||e>=129679&&e<=129734||e>=129742&&e<=129756||e>=129759&&e<=129769||e>=129776&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141}i(Gf,"G$2"),ce(Gf,"isWide");function Zf(e){if(!Number.isSafeInteger(e))throw new TypeError(`Expected a code point, got \`${typeof e}\`.`)}i(Zf,"Z$3"),ce(Zf,"validate");function Wf(e,{ambiguousAsWide:t=!1}={}){return Zf(e),Vf(e)||Gf(e)||t&&qf(e)?2:1}i(Wf,"V$2"),ce(Wf,"eastAsianWidth");var HD=ce(()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26D3\uFE0F?(?:\u200D\uD83D\uDCA5)?|\u26F9(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF43\uDF45-\uDF4A\uDF4C-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDF44(?:\u200D\uD83D\uDFEB)?|\uDF4B(?:\u200D\uD83D\uDFE9)?|\uDFC3(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE41\uDE43\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC26(?:\u200D(?:\u2B1B|\uD83D\uDD25))?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F)?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?|\uDE42(?:\u200D[\u2194\u2195]\uFE0F?)?|\uDEB6(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE89\uDE8F-\uDEC2\uDEC6\uDECE-\uDEDC\uDEDF-\uDEE9]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDCE(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1|\uDDD1\u200D\uD83E\uDDD2(?:\u200D\uD83E\uDDD2)?|\uDDD2(?:\u200D\uD83E\uDDD2)?))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g,"emojiRegex");const JD=new Intl.Segmenter,KD=new RegExp("^\\p{Default_Ignorable_Code_Point}$","u");function In(e,t={}){if(typeof e!="string"||e.length===0)return 0;const{ambiguousIsNarrow:n=!0,countAnsiEscapeCodes:r=!1}=t;if(r||(e=ql(e)),e.length===0)return 0;let o=0;const s={ambiguousAsWide:!n};for(const{segment:a}of JD.segment(e)){const l=a.codePointAt(0);if(!(l<=31||l>=127&&l<=159)&&!(l>=8203&&l<=8207||l===65279)&&!(l>=768&&l<=879||l>=6832&&l<=6911||l>=7616&&l<=7679||l>=8400&&l<=8447||l>=65056&&l<=65071)&&!(l>=55296&&l<=57343)&&!(l>=65024&&l<=65039)&&!KD.test(a)){if(HD().test(a)){o+=2;continue}o+=Wf(l,s)}}return o}i(In,"d$1"),ce(In,"stringWidth");const Hf=ce(e=>Math.max(...e.split(`
`).map(t=>In(t))),"getLongestLineWidth"),YD=ce(e=>{const t=[];for(const n of e){const{length:r}=n,o=r-t.length;for(let s=0;s<o;s+=1)t.push(0);for(let s=0;s<r;s+=1){const a=Hf(n[s]);a>t[s]&&(t[s]=a)}}return t},"getColumnContentWidths"),Jf=/^\d+%$/,Kf={width:"auto",align:"left",contentWidth:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,horizontalPadding:0,paddingLeftString:"",paddingRightString:""},XD=ce((e,t)=>{const n=[];for(let r=0;r<e.length;r+=1){const o=t[r]??"auto";if(typeof o=="number"||o==="auto"||o==="content-width"||typeof o=="string"&&Jf.test(o)){n.push({...Kf,width:o,contentWidth:e[r]});continue}if(o&&typeof o=="object"){const s={...Kf,...o,contentWidth:e[r]};s.horizontalPadding=s.paddingLeft+s.paddingRight,n.push(s);continue}throw new Error(`Invalid column width: ${JSON.stringify(o)}`)}return n},"initColumns"),QD=ce((e,t)=>{for(const n of e){const{width:r}=n;if(r==="content-width"&&(n.width=n.contentWidth),r==="auto"){const u=Math.min(20,n.contentWidth);n.width=u,n.autoOverflow=n.contentWidth-u}if(typeof r=="string"&&Jf.test(r)){const u=Number.parseFloat(r.slice(0,-1))/100;n.width=Math.floor(t*u)-(n.paddingLeft+n.paddingRight)}const{horizontalPadding:o}=n,s=1,a=s+o;if(a>=t){const u=a-t,c=Math.ceil(n.paddingLeft/o*u),d=u-c;n.paddingLeft-=c,n.paddingRight-=d,n.horizontalPadding=n.paddingLeft+n.paddingRight}n.paddingLeftString=n.paddingLeft?" ".repeat(n.paddingLeft):"",n.paddingRightString=n.paddingRight?" ".repeat(n.paddingRight):"";const l=t-n.horizontalPadding;n.width=Math.max(Math.min(n.width,l),s)}},"resolveColumnWidths"),Yf=ce(()=>Object.assign([],{columns:0}),"makeRow"),e2=ce((e,t)=>{const n=[Yf()];let[r]=n;for(const o of e){const s=o.width+o.horizontalPadding;r.columns+s>t&&(r=Yf(),n.push(r)),r.push(o),r.columns+=s}for(const o of n){const s=o.reduce((h,g)=>h+g.width+g.horizontalPadding,0);let a=t-s;if(a===0)continue;const l=o.filter(h=>"autoOverflow"in h),u=l.filter(h=>h.autoOverflow>0),c=u.reduce((h,g)=>h+g.autoOverflow,0),d=Math.min(c,a);for(const h of u){const g=Math.floor(h.autoOverflow/c*d);h.width+=g,a-=g}const p=Math.floor(a/l.length);for(let h=0;h<l.length;h+=1){const g=l[h];h===l.length-1?g.width+=a:g.width+=p,a-=p}}return n},"balanceAuto"),t2=ce((e,t,n)=>{const r=XD(n,t);return QD(r,e),e2(r,e)},"computeColumnWidths"),Vl=10,Xf=ce((e=0)=>t=>`\x1B[${t+e}m`,"wrapAnsi16"),Qf=ce((e=0)=>t=>`\x1B[${38+e};5;${t}m`,"wrapAnsi256"),em=ce((e=0)=>(t,n,r)=>`\x1B[${38+e};2;${t};${n};${r}m`,"wrapAnsi16m"),Ne={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(Ne.modifier);const n2=Object.keys(Ne.color),r2=Object.keys(Ne.bgColor);[...n2,...r2];function tm(){const e=new Map;for(const[t,n]of Object.entries(Ne)){for(const[r,o]of Object.entries(n))Ne[r]={open:`\x1B[${o[0]}m`,close:`\x1B[${o[1]}m`},n[r]=Ne[r],e.set(o[0],o[1]);Object.defineProperty(Ne,t,{value:n,enumerable:!1})}return Object.defineProperty(Ne,"codes",{value:e,enumerable:!1}),Ne.color.close="\x1B[39m",Ne.bgColor.close="\x1B[49m",Ne.color.ansi=Xf(),Ne.color.ansi256=Qf(),Ne.color.ansi16m=em(),Ne.bgColor.ansi=Xf(Vl),Ne.bgColor.ansi256=Qf(Vl),Ne.bgColor.ansi16m=em(Vl),Object.defineProperties(Ne,{rgbToAnsi256:{value:ce((t,n,r)=>t===n&&n===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5),"value"),enumerable:!1},hexToRgb:{value:ce(t=>{const n=/[a-f\d]{6}|[a-f\d]{3}/i.exec(t.toString(16));if(!n)return[0,0,0];let[r]=n;r.length===3&&(r=[...r].map(s=>s+s).join(""));const o=Number.parseInt(r,16);return[o>>16&255,o>>8&255,o&255]},"value"),enumerable:!1},hexToAnsi256:{value:ce(t=>Ne.rgbToAnsi256(...Ne.hexToRgb(t)),"value"),enumerable:!1},ansi256ToAnsi:{value:ce(t=>{if(t<8)return 30+t;if(t<16)return 90+(t-8);let n,r,o;if(t>=232)n=((t-232)*10+8)/255,r=n,o=n;else{t-=16;const l=t%36;n=Math.floor(t/36)/5,r=Math.floor(l/6)/5,o=l%6/5}const s=Math.max(n,r,o)*2;if(s===0)return 30;let a=30+(Math.round(o)<<2|Math.round(r)<<1|Math.round(n));return s===2&&(a+=60),a},"value"),enumerable:!1},rgbToAnsi:{value:ce((t,n,r)=>Ne.ansi256ToAnsi(Ne.rgbToAnsi256(t,n,r)),"value"),enumerable:!1},hexToAnsi:{value:ce(t=>Ne.ansi256ToAnsi(Ne.hexToAnsi256(t)),"value"),enumerable:!1}}),Ne}i(tm,"FD"),ce(tm,"assembleStyles");const o2=tm(),Ri=new Set(["\x1B","\x9B"]),s2=39,Gl="\x07",nm="[",i2="]",rm="m",Pi=`${i2}8;;`,om=ce(e=>`${Ri.values().next().value}${nm}${e}${rm}`,"wrapAnsiCode"),sm=ce(e=>`${Ri.values().next().value}${Pi}${e}${Gl}`,"wrapAnsiHyperlink"),a2=ce(e=>e.split(" ").map(t=>In(t)),"wordLengths"),Zl=ce((e,t,n)=>{const r=[...t];let o=!1,s=!1,a=In(ql(e.at(-1)));for(const[l,u]of r.entries()){const c=In(u);if(a+c<=n?e[e.length-1]+=u:(e.push(u),a=0),Ri.has(u)&&(o=!0,s=r.slice(l+1,l+1+Pi.length).join("")===Pi),o){s?u===Gl&&(o=!1,s=!1):u===rm&&(o=!1);continue}a+=c,a===n&&l<r.length-1&&(e.push(""),a=0)}!a&&e.at(-1).length>0&&e.length>1&&(e[e.length-2]+=e.pop())},"wrapWord"),l2=ce(e=>{const t=e.split(" ");let n=t.length;for(;n>0&&!(In(t[n-1])>0);)n--;return n===t.length?e:t.slice(0,n).join(" ")+t.slice(n).join("")},"stringVisibleTrimSpacesRight"),u2=ce((e,t,n={})=>{if(n.trim!==!1&&e.trim()==="")return"";let r="",o,s;const a=a2(e);let l=[""];for(const[p,h]of e.split(" ").entries()){n.trim!==!1&&(l[l.length-1]=l.at(-1).trimStart());let g=In(l.at(-1));if(p!==0&&(g>=t&&(n.wordWrap===!1||n.trim===!1)&&(l.push(""),g=0),(g>0||n.trim===!1)&&(l[l.length-1]+=" ",g++)),n.hard&&a[p]>t){const f=t-g,y=1+Math.floor((a[p]-f-1)/t);Math.floor((a[p]-1)/t)<y&&l.push(""),Zl(l,h,t);continue}if(g+a[p]>t&&g>0&&a[p]>0){if(n.wordWrap===!1&&g<t){Zl(l,h,t);continue}l.push("")}if(g+a[p]>t&&n.wordWrap===!1){Zl(l,h,t);continue}l[l.length-1]+=h}n.trim!==!1&&(l=l.map(p=>l2(p)));const u=l.join(`
`),c=[...u];let d=0;for(const[p,h]of c.entries()){if(r+=h,Ri.has(h)){const{groups:f}=new RegExp(`(?:\\${nm}(?<code>\\d+)m|\\${Pi}(?<uri>.*)${Gl})`).exec(u.slice(d))||{groups:{}};if(f.code!==void 0){const y=Number.parseFloat(f.code);o=y===s2?void 0:y}else f.uri!==void 0&&(s=f.uri.length===0?void 0:f.uri)}const g=o2.codes.get(Number(o));c[p+1]===`
`?(s&&(r+=sm("")),o&&g&&(r+=om(g))):h===`
`&&(o&&g&&(r+=om(o)),s&&(r+=sm(s))),d+=h.length}return r},"exec");function im(e,t,n){return String(e).normalize().replaceAll(`\r
`,`
`).split(`
`).map(r=>u2(r,t,n)).join(`
`)}i(im,"BD"),ce(im,"wrapAnsi");const am=ce(e=>Array.from({length:e}).fill(""),"emptyLines"),c2=ce((e,t)=>{const n=[];let r=0;for(const o of e){let s=0;const a=o.map(u=>{let c=t[r]??"";r+=1,u.preprocess&&(c=u.preprocess(c)),Hf(c)>u.width&&(c=im(c,u.width,{hard:!0}));let d=c.split(`
`);if(u.postprocess){const{postprocess:p}=u;d=d.map((h,g)=>p.call(u,h,g))}return u.paddingTop&&d.unshift(...am(u.paddingTop)),u.paddingBottom&&d.push(...am(u.paddingBottom)),d.length>s&&(s=d.length),{...u,lines:d}}),l=[];for(let u=0;u<s;u+=1){const c=a.map(d=>{const p=d.lines[u]??"",h=Number.isFinite(d.width)?" ".repeat(d.width-In(p)):"";let g=d.paddingLeftString;return d.align==="right"&&(g+=h),g+=p,d.align==="left"&&(g+=h),g+d.paddingRightString}).join("");l.push(c)}n.push(l.join(`
`))}return n.join(`
`)},"renderRow"),d2=ce((e,t)=>{if(!e||e.length===0)return"";const n=YD(e),r=n.length;if(r===0)return"";const{stdoutColumns:o,columns:s}=ZD(t);if(s.length>r)throw new Error(`${s.length} columns defined, but only ${r} columns found`);const a=t2(o,s,n);return e.map(l=>c2(a,l)).join(`
`)},"terminalColumns"),p2=["<",">","=",">=","<="],f2=ce(e=>{if(!p2.includes(e))throw new TypeError(`Invalid breakpoint operator: ${e}`)},"assertOperator"),m2=ce(e=>{const t=Object.keys(e).map(n=>{const[r,o]=n.split(" ");f2(r);const s=Number.parseInt(o,10);if(Number.isNaN(s))throw new TypeError(`Invalid breakpoint value: ${o}`);const a=e[n];return{operator:r,breakpoint:s,value:a}}).sort((n,r)=>r.breakpoint-n.breakpoint);return n=>t.find(({operator:r,breakpoint:o})=>r==="="&&n===o||r===">"&&n>o||r==="<"&&n<o||r===">="&&n>=o||r==="<="&&n<=o)?.value},"breakpoints");var h2=Object.defineProperty,be=i((e,t)=>h2(e,"name",{value:t,configurable:!0}),"o$1");const bn=new Uint32Array(65536),g2=be((e,t)=>{const n=e.length,r=t.length,o=1<<n-1;let s=-1,a=0,l=n,u=n;for(;u--;)bn[e.charCodeAt(u)]|=1<<u;for(u=0;u<r;u++){let c=bn[t.charCodeAt(u)];const d=c|a;c|=(c&s)+s^s,a|=~(c|s),s&=c,a&o&&l++,s&o&&l--,a=a<<1|1,s=s<<1|~(d|a),a&=d}for(u=n;u--;)bn[e.charCodeAt(u)]=0;return l},"myers_32"),y2=be((e,t)=>{const n=t.length,r=e.length,o=[],s=[],a=Math.ceil(n/32),l=Math.ceil(r/32);for(let f=0;f<a;f++)s[f]=-1,o[f]=0;let u=0;for(;u<l-1;u++){let f=0,y=-1;const v=u*32,_=Math.min(32,r)+v;for(let w=v;w<_;w++)bn[e.charCodeAt(w)]|=1<<w;for(let w=0;w<n;w++){const D=bn[t.charCodeAt(w)],E=s[w/32|0]>>>w&1,I=o[w/32|0]>>>w&1,T=D|f,$=((D|I)&y)+y^y|D|I;let x=f|~($|y),j=y&$;x>>>31^E&&(s[w/32|0]^=1<<w),j>>>31^I&&(o[w/32|0]^=1<<w),x=x<<1|E,j=j<<1|I,y=j|~(T|x),f=x&T}for(let w=v;w<_;w++)bn[e.charCodeAt(w)]=0}let c=0,d=-1;const p=u*32,h=Math.min(32,r-p)+p;for(let f=p;f<h;f++)bn[e.charCodeAt(f)]|=1<<f;let g=r;for(let f=0;f<n;f++){const y=bn[t.charCodeAt(f)],v=s[f/32|0]>>>f&1,_=o[f/32|0]>>>f&1,w=y|c,D=((y|_)&d)+d^d|y|_;let E=c|~(D|d),I=d&D;g+=E>>>r-1&1,g-=I>>>r-1&1,E>>>31^v&&(s[f/32|0]^=1<<f),I>>>31^_&&(o[f/32|0]^=1<<f),E=E<<1|v,I=I<<1|_,d=I|~(w|E),c=E&w}for(let f=p;f<h;f++)bn[e.charCodeAt(f)]=0;return g},"myers_x"),lm=be((e,t)=>{if(e.length<t.length){const n=t;t=e,e=n}return t.length===0?e.length:e.length<=32?g2(e,t):y2(e,t)},"distance"),v2=be((e,t)=>{let n=1/0,r=0;for(let o=0;o<t.length;o++){const s=lm(e,t[o]);s<n&&(n=s,r=o)}return t[r]},"closest"),_2=be(e=>e.replaceAll(/[\W_]([a-z\d])?/gi,(t,n)=>n?n.toUpperCase():""),"camelCase"),b2=be(e=>e.replaceAll(/\B([A-Z])/g,"-$1").toLowerCase(),"kebabCase"),w2={"> 80":[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"auto"}],"> 40":[{width:"auto",paddingLeft:2,paddingRight:8,preprocess:be(e=>e.trim(),"preprocess")},{width:"100%",paddingLeft:2,paddingBottom:1}],"> 0":{stdoutColumns:1e3,columns:[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"content-width"}]}};function um(e){let t=!1;return{type:"table",data:{tableData:Object.keys(e).sort((n,r)=>n.localeCompare(r)).map(n=>{const r=e[n],o="alias"in r;return o&&(t=!0),{name:n,flag:r,flagFormatted:`--${b2(n)}`,aliasesEnabled:t,aliasFormatted:o?`-${r.alias}`:void 0}}).map(n=>(n.aliasesEnabled=t,[{type:"flagName",data:n},{type:"flagDescription",data:n}])),tableBreakpoints:w2}}}i(um,"z$1"),be(um,"renderFlags");const cm=be(e=>!e||(e.version??(e.help?e.help.version:void 0)),"getVersion"),dm=be(e=>{const t="parent"in e&&e.parent?.name;return(t?`${t} `:"")+e.name},"getName");function pm(e){const t=[];e.name&&t.push(dm(e));const n=cm(e)??("parent"in e&&cm(e.parent));if(n&&t.push(`v${n}`),t.length!==0)return{id:"name",type:"text",data:`${t.join(" ")}
`}}i(pm,"K$1"),be(pm,"getNameAndVersion");function fm(e){const{help:t}=e;if(!(!t||!t.description))return{id:"description",type:"text",data:`${t.description}
`}}i(fm,"Z$2"),be(fm,"getDescription");function mm(e){const t=e.help||{};if("usage"in t)return t.usage?{id:"usage",type:"section",data:{title:"Usage:",body:Array.isArray(t.usage)?t.usage.join(`
`):t.usage}}:void 0;if(e.name){const n=[],r=[dm(e)];if(e.flags&&Object.keys(e.flags).length>0&&r.push("[flags...]"),e.parameters&&e.parameters.length>0){const{parameters:o}=e,s=o.indexOf("--"),a=s!==-1&&o.slice(s+1).some(l=>l.startsWith("<"));r.push(o.map(l=>l!=="--"?l:a?"--":"[--]").join(" "))}if(r.length>1&&n.push(r.join(" ")),"commands"in e&&e.commands?.length&&n.push(`${e.name} <command>`),n.length>0)return{id:"usage",type:"section",data:{title:"Usage:",body:n.join(`
`)}}}}i(mm,"G$1"),be(mm,"getUsage");function hm(e){return!("commands"in e)||!e.commands?.length?void 0:{id:"commands",type:"section",data:{title:"Commands:",body:{type:"table",data:{tableData:e.commands.map(t=>{const{help:n}=t.options;return[t.options.name,typeof n=="object"&&n.description||""]}),tableOptions:[{width:"content-width",paddingLeft:2,paddingRight:8}]}},indentBody:0}}}i(hm,"Q$2"),be(hm,"getCommands");function gm(e){if(!(!e.flags||Object.keys(e.flags).length===0))return{id:"flags",type:"section",data:{title:"Flags:",body:um(e.flags),indentBody:0}}}i(gm,"X$2"),be(gm,"getFlags");function ym(e){const{help:t}=e;if(!t||!t.examples||t.examples.length===0)return;let{examples:n}=t;if(Array.isArray(n)&&(n=n.join(`
`)),n)return{id:"examples",type:"section",data:{title:"Examples:",body:n}}}i(ym,"Y"),be(ym,"getExamples");function vm(e){if(!("alias"in e)||!e.alias)return;const{alias:t}=e;return{id:"aliases",type:"section",data:{title:"Aliases:",body:Array.isArray(t)?t.join(", "):t}}}i(vm,"ee"),be(vm,"getAliases");const D2=be(e=>[pm,fm,mm,hm,gm,ym,vm].map(t=>t(e)).filter(Boolean),"generateHelp"),E2=rD.WriteStream.prototype.hasColors(),_m=(oo=class{text(t){return t}bold(t){return E2?`\x1B[1m${t}\x1B[22m`:t.toLocaleUpperCase()}indentText({text:t,spaces:n}){return t.replaceAll(/^/gm," ".repeat(n))}heading(t){return this.bold(t)}section({title:t,body:n,indentBody:r=2}){return`${(t?`${this.heading(t)}
`:"")+(n?this.indentText({text:this.render(n),spaces:r}):"")}
`}table({tableData:t,tableOptions:n,tableBreakpoints:r}){return d2(t.map(o=>o.map(s=>this.render(s))),r?m2(r):n)}flagParameter(t){return t===Boolean?"":t===String?"<string>":t===Number?"<number>":Array.isArray(t)?this.flagParameter(t[0]):"<value>"}flagOperator(t){return" "}flagName(t){const{flag:n,flagFormatted:r,aliasesEnabled:o,aliasFormatted:s}=t;let a="";if(s?a+=`${s}, `:o&&(a+="    "),a+=r,"placeholder"in n&&typeof n.placeholder=="string")a+=`${this.flagOperator(t)}${n.placeholder}`;else{const l=this.flagParameter("type"in n?n.type:n);l&&(a+=`${this.flagOperator(t)}${l}`)}return a}flagDefault(t){return JSON.stringify(t)}flagDescription({flag:t}){let n="description"in t?t.description??"":"";if("default"in t){let{default:r}=t;typeof r=="function"&&(r=r()),r&&(n+=` (default: ${this.flagDefault(r)})`)}return n}render(t){if(typeof t=="string")return t;if(Array.isArray(t))return t.map(n=>this.render(n)).join(`
`);if("type"in t&&this[t.type]){const n=this[t.type];if(typeof n=="function")return n.call(this,t.data)}throw new Error(`Invalid node type: ${JSON.stringify(t)}`)}},i(oo,"_ne"),oo);be(_m,"Renderers");let C2=_m;const Wl=be(e=>e.length>0&&!e.includes(" "),"isValidScriptName"),{stringify:an}=JSON,$2=/[|\\{}()[\]^$+*?.]/;function Hl(e){const t=[];let n,r;for(const o of e){if(r)throw new Error(`Invalid parameter: Spread parameter ${an(r)} must be last`);const s=o[0],a=o.at(-1);let l;if(s==="<"&&a===">"&&(l=!0,n))throw new Error(`Invalid parameter: Required parameter ${an(o)} cannot come after optional parameter ${an(n)}`);if(s==="["&&a==="]"&&(l=!1,n=o),l===void 0)throw new Error(`Invalid parameter: ${an(o)}. Must be wrapped in <> (required parameter) or [] (optional parameter)`);let u=o.slice(1,-1);const c=u.slice(-3)==="...";c&&(r=o,u=u.slice(0,-3));const d=u.match($2);if(d)throw new Error(`Invalid parameter: ${an(o)}. Invalid character found ${an(d[0])}`);t.push({name:u,required:l,spread:c})}return t}i(Hl,"P$1"),be(Hl,"parseParameters");function Jl(e,t,n,r){for(let o=0;o<t.length;o+=1){const{name:s,required:a,spread:l}=t[o],u=_2(s);if(u in e)throw new Error(`Invalid parameter: ${an(s)} is used more than once.`);const c=l?n.slice(o):n[o];if(l&&(o=t.length),a&&(!c||l&&c.length===0))return console.error(`Error: Missing required parameter ${an(s)}
`),r(),process.exit(1);e[u]=c}}i(Jl,"S$1"),be(Jl,"mapParametersToArguments");function bm(e){return e!==!1}i(bm,"se"),be(bm,"helpEnabled");const x2=be(e=>{const t=[];for(const[n,r]of Object.entries(e))if(t.push(n),r&&typeof r=="object"&&"alias"in r){const{alias:o}=r;typeof o=="string"&&o?t.push(o):Array.isArray(o)&&t.push(...o.filter(Boolean))}return t},"getKnownFlagNames"),S2=be((e,t)=>{if(e.length<3||t.length===0)return;const n=v2(e,t);return lm(e,n)<=2?n:void 0},"findClosestFlag"),k2=be((e,t)=>{const n=Object.keys(e);if(n.length!==0){for(const r of n){const o=S2(r,t),s=o?` (Did you mean --${o}?)`:"";console.error(`Error: Unknown flag: --${r}.${s}`)}process.exit(1)}},"handleUnknownFlags");function Kl(e,t,n,r){const o={...t.flags},s=t.version&&!("version"in o);s&&(o.version={type:Boolean,description:"Show version"});const{help:a}=t,l=bm(a);l&&!("help"in o)&&(o.help={type:Boolean,alias:"h",description:"Show help"});const u=VD(o,r,{ignore:t.ignoreArgv}),c=be(()=>{console.log(t.version)},"showVersion");if(s&&u.flags.version===!0)return c(),process.exit(0);const d=new C2,p=l&&a?.render?a.render:y=>d.render(y),h=be(y=>{const v=D2({...t,...y?{help:y}:{},flags:o});console.log(p(v,d))},"showHelp");if(l&&u.flags.help===!0)return h(),process.exit(0);if((t.strictFlags??t.parent?.strictFlags)&&k2(u.unknownFlags,x2(o)),t.parameters){let{parameters:y}=t,v=u._;const _=y.indexOf("--"),w=y.slice(_+1),D=Object.create(null);let E=[];_>-1&&w.length>0&&(y=y.slice(0,_),E=u._["--"],v=v.slice(0,-E.length||void 0)),Jl(D,Hl(y),v,h),_>-1&&w.length>0&&Jl(D,Hl(w),E,h),Object.assign(u._,D)}const g={...u,showVersion:c,showHelp:h},f={command:e,...g};if(typeof n=="function"){const y=n(g);if(y&&"then"in y)return Object.assign(Promise.resolve(y),f)}return f}i(Kl,"I"),be(Kl,"cliBase");function wm(e,t){const n=new Map;for(const r of t){const o=[r.options.name],{alias:s}=r.options;s&&(Array.isArray(s)?o.push(...s):o.push(s));for(const a of o){if(n.has(a))throw new Error(`Duplicate command name found: ${an(a)}`);n.set(a,r)}}return n.get(e)}i(wm,"ce"),be(wm,"getCommand");function Dm(e,t,n=process.argv.slice(2)){if(!e)throw new Error("Options is required");if("name"in e&&(!e.name||!Wl(e.name)))throw new Error(`Invalid script name: ${an(e.name)}`);const r=n[0];if(e.commands&&r&&Wl(r)){const o=wm(r,e.commands);if(o)return Kl(o.options.name,{...o.options,parent:e},o.callback,n.slice(1))}return Kl(void 0,e,t,n)}i(Dm,"fe$1"),be(Dm,"cli");function Bt(e,t){if(!e)throw new Error("Command options are required");const{name:n}=e;if(n===void 0)throw new Error("Command name is required");if(!Wl(n))throw new Error(`Invalid command name ${JSON.stringify(n)}. Command names must be one word.`);return{options:e,callback:t}}i(Bt,"de"),be(Bt,"command");var I2="0.0.0-semantic-release",A2="Writes your git commit messages for you with AI",Em={version:I2,description:A2};function jt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}i(jt,"isPlainObject$1");const Yl=i((e,t)=>{const n=$m(T2(e));if(typeof n!="string")throw new TypeError(`${t} must be a string or a file URL: ${n}.`);return n},"safeNormalizeFileUrl"),T2=i(e=>Cm(e)?e.toString():e,"normalizeDenoExecPath"),Cm=i(e=>typeof e!="string"&&e&&Object.getPrototypeOf(e)===String.prototype,"isDenoExecPath"),$m=i(e=>e instanceof URL?vf(e):e,"normalizeFileUrl"),xm=i((e,t=[],n={})=>{const r=Yl(e,"First argument"),[o,s]=jt(t)?[[],t]:[t,n];if(!Array.isArray(o))throw new TypeError(`Second argument must be either an array of arguments or an options object: ${o}`);if(o.some(u=>typeof u=="object"&&u!==null))throw new TypeError(`Second argument must be an array of strings: ${o}`);const a=o.map(String),l=a.find(u=>u.includes("\0"));if(l!==void 0)throw new TypeError(`Arguments cannot contain null bytes ("\\0"): ${l}`);if(!jt(s))throw new TypeError(`Last argument must be an options object: ${s}`);return[r,a,s]},"normalizeParameters"),{toString:Sm}=Object.prototype,F2=i(e=>Sm.call(e)==="[object ArrayBuffer]","isArrayBuffer"),Gt=i(e=>Sm.call(e)==="[object Uint8Array]","isUint8Array"),ys=i(e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),"bufferToUint8Array"),O2=new TextEncoder,km=i(e=>O2.encode(e),"stringToUint8Array"),R2=new TextDecoder,Im=i(e=>R2.decode(e),"uint8ArrayToString"),P2=i((e,t)=>M2(e,t).join(""),"joinToString"),M2=i((e,t)=>{if(t==="utf8"&&e.every(s=>typeof s=="string"))return e;const n=new bf(t),r=e.map(s=>typeof s=="string"?km(s):s).map(s=>n.write(s)),o=n.end();return o===""?r:[...r,o]},"uint8ArraysToStrings"),Xl=i(e=>e.length===1&&Gt(e[0])?e[0]:Am(N2(e)),"joinToUint8Array"),N2=i(e=>e.map(t=>typeof t=="string"?km(t):t),"stringsToUint8Arrays"),Am=i(e=>{const t=new Uint8Array(B2(e));let n=0;for(const r of e)t.set(r,n),n+=r.length;return t},"concatUint8Arrays"),B2=i(e=>{let t=0;for(const n of e)t+=n.length;return t},"getJoinLength"),j2=i(e=>Array.isArray(e)&&Array.isArray(e.raw),"isTemplateString"),L2=i((e,t)=>{let n=[];for(const[s,a]of e.entries())n=U2({templates:e,expressions:t,tokens:n,index:s,template:a});if(n.length===0)throw new TypeError("Template script must not be empty");const[r,...o]=n;return[r,o,{}]},"parseTemplates"),U2=i(({templates:e,expressions:t,tokens:n,index:r,template:o})=>{if(o===void 0)throw new TypeError(`Invalid backslash sequence: ${e.raw[r]}`);const{nextTokens:s,leadingWhitespaces:a,trailingWhitespaces:l}=z2(o,e.raw[r]),u=Fm(n,s,a);if(r===t.length)return u;const c=t[r],d=Array.isArray(c)?c.map(p=>Om(p)):[Om(c)];return Fm(u,d,l)},"parseTemplate"),z2=i((e,t)=>{if(t.length===0)return{nextTokens:[],leadingWhitespaces:!1,trailingWhitespaces:!1};const n=[];let r=0;const o=Tm.has(t[0]);for(let a=0,l=0;a<e.length;a+=1,l+=1){const u=t[l];if(Tm.has(u))r!==a&&n.push(e.slice(r,a)),r=a+1;else if(u==="\\"){const c=t[l+1];c===`
`?(a-=1,l+=1):c==="u"&&t[l+2]==="{"?l=t.indexOf("}",l+3):l+=q2[c]??1}}const s=r===e.length;return s||n.push(e.slice(r)),{nextTokens:n,leadingWhitespaces:o,trailingWhitespaces:s}},"splitByWhitespaces"),Tm=new Set([" ","	","\r",`
`]),q2={x:3,u:5},Fm=i((e,t,n)=>n||e.length===0||t.length===0?[...e,...t]:[...e.slice(0,-1),`${e.at(-1)}${t[0]}`,...t.slice(1)],"concatTokens"),Om=i(e=>{const t=typeof e;if(t==="string")return e;if(t==="number")return String(e);if(jt(e)&&("stdout"in e||"isMaxBuffer"in e))return V2(e);throw e instanceof _f||Object.prototype.toString.call(e)==="[object Promise]"?new TypeError("Unexpected subprocess in template expression. Please use ${await subprocess} instead of ${subprocess}."):new TypeError(`Unexpected "${t}" in template expression`)},"parseExpression"),V2=i(({stdout:e})=>{if(typeof e=="string")return e;if(Gt(e))return Im(e);throw e===void 0?new TypeError(`Missing result.stdout in template expression. This is probably due to the previous subprocess' "stdout" option.`):new TypeError(`Unexpected "${typeof e}" stdout in template expression`)},"getSubprocessResult"),Jn=i(e=>Ql.includes(e),"isStandardStream"),Ql=[Se.stdin,Se.stdout,Se.stderr],ln=["stdin","stdout","stderr"],Rm=i(e=>ln[e]??`stdio[${e}]`,"getStreamName"),G2=i(e=>{const t={...e};for(const n of Bm)t[n]=Pm(e,n);return t},"normalizeFdSpecificOptions"),Pm=i((e,t)=>{const n=Array.from({length:Z2(e)+1}),r=W2(e[t],n,t);return X2(r,t)},"normalizeFdSpecificOption"),Z2=i(({stdio:e})=>Array.isArray(e)?Math.max(e.length,ln.length):ln.length,"getStdioLength"),W2=i((e,t,n)=>jt(e)?H2(e,t,n):t.fill(e),"normalizeFdSpecificValue"),H2=i((e,t,n)=>{for(const r of Object.keys(e).sort(J2))for(const o of K2(r,n,t))t[o]=e[r];return t},"normalizeOptionObject"),J2=i((e,t)=>Mm(e)<Mm(t)?1:-1,"compareFdName"),Mm=i(e=>e==="stdout"||e==="stderr"?0:e==="all"?2:1,"getFdNameOrder"),K2=i((e,t,n)=>{if(e==="ipc")return[n.length-1];const r=Nm(e);if(r===void 0||r===0)throw new TypeError(`"${t}.${e}" is invalid.
It must be "${t}.stdout", "${t}.stderr", "${t}.all", "${t}.ipc", or "${t}.fd3", "${t}.fd4" (and so on).`);if(r>=n.length)throw new TypeError(`"${t}.${e}" is invalid: that file descriptor does not exist.
Please set the "stdio" option to ensure that file descriptor exists.`);return r==="all"?[1,2]:[r]},"parseFdName"),Nm=i(e=>{if(e==="all")return e;if(ln.includes(e))return ln.indexOf(e);const t=Y2.exec(e);if(t!==null)return Number(t[1])},"parseFd"),Y2=/^fd(\d+)$/,X2=i((e,t)=>e.map(n=>n===void 0?eE[t]:n),"addDefaultValue$1"),Q2=aD("execa").enabled?"full":"none",eE={lines:!1,buffer:!0,maxBuffer:1e3*1e3*100,verbose:Q2,stripFinalNewline:!0},Bm=["lines","buffer","maxBuffer","verbose","stripFinalNewline"],vs=i((e,t)=>t==="ipc"?e.at(-1):e[t],"getFdSpecificValue"),eu=i(({verbose:e},t)=>nu(e,t)!=="none","isVerbose"),tu=i(({verbose:e},t)=>!["none","short"].includes(nu(e,t)),"isFullVerbose"),tE=i(({verbose:e},t)=>{const n=nu(e,t);return ru(n)?n:void 0},"getVerboseFunction"),nu=i((e,t)=>t===void 0?nE(e):vs(e,t),"getFdVerbose"),nE=i(e=>e.find(t=>ru(t))??ou.findLast(t=>e.includes(t)),"getFdGenericVerbose"),ru=i(e=>typeof e=="function","isVerboseFunction"),ou=["none","short","full"],rE=i((e,t)=>{const n=[e,...t],r=n.join(" "),o=n.map(s=>uE(jm(s))).join(" ");return{command:r,escapedCommand:o}},"joinCommand"),su=i(e=>lD(e).split(`
`).map(t=>jm(t)).join(`
`),"escapeLines"),jm=i(e=>e.replaceAll(iE,t=>oE(t)),"escapeControlCharacters"),oE=i(e=>{const t=aE[e];if(t!==void 0)return t;const n=e.codePointAt(0),r=n.toString(16);return n<=lE?`\\u${r.padStart(4,"0")}`:`\\U${r}`},"escapeControlCharacter"),sE=i(()=>{try{return new RegExp("\\p{Separator}|\\p{Other}","gu")}catch{return/[\s\u0000-\u001F\u007F-\u009F\u00AD]/g}},"getSpecialCharRegExp"),iE=sE(),aE={" ":" ","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},lE=65535,uE=i(e=>cE.test(e)?e:cD==="win32"?`"${e.replaceAll('"','""')}"`:`'${e.replaceAll("'","'\\''")}'`,"quoteString"),cE=/^[\w./-]+$/;function dE(){const{env:e}=Se,{TERM:t,TERM_PROGRAM:n}=e;return Se.platform!=="win32"?t!=="linux":!!e.WT_SESSION||!!e.TERMINUS_SUBLIME||e.ConEmuTask==="{cmd::Cmder}"||n==="Terminus-Sublime"||n==="vscode"||t==="xterm-256color"||t==="alacritty"||t==="rxvt-unicode"||t==="rxvt-unicode-256color"||e.TERMINAL_EMULATOR==="JetBrains-JediTerm"}i(dE,"isUnicodeSupported");const Lm={circleQuestionMark:"(?)",questionMarkPrefix:"(?)",square:"\u2588",squareDarkShade:"\u2593",squareMediumShade:"\u2592",squareLightShade:"\u2591",squareTop:"\u2580",squareBottom:"\u2584",squareLeft:"\u258C",squareRight:"\u2590",squareCenter:"\u25A0",bullet:"\u25CF",dot:"\u2024",ellipsis:"\u2026",pointerSmall:"\u203A",triangleUp:"\u25B2",triangleUpSmall:"\u25B4",triangleDown:"\u25BC",triangleDownSmall:"\u25BE",triangleLeftSmall:"\u25C2",triangleRightSmall:"\u25B8",home:"\u2302",heart:"\u2665",musicNote:"\u266A",musicNoteBeamed:"\u266B",arrowUp:"\u2191",arrowDown:"\u2193",arrowLeft:"\u2190",arrowRight:"\u2192",arrowLeftRight:"\u2194",arrowUpDown:"\u2195",almostEqual:"\u2248",notEqual:"\u2260",lessOrEqual:"\u2264",greaterOrEqual:"\u2265",identical:"\u2261",infinity:"\u221E",subscriptZero:"\u2080",subscriptOne:"\u2081",subscriptTwo:"\u2082",subscriptThree:"\u2083",subscriptFour:"\u2084",subscriptFive:"\u2085",subscriptSix:"\u2086",subscriptSeven:"\u2087",subscriptEight:"\u2088",subscriptNine:"\u2089",oneHalf:"\xBD",oneThird:"\u2153",oneQuarter:"\xBC",oneFifth:"\u2155",oneSixth:"\u2159",oneEighth:"\u215B",twoThirds:"\u2154",twoFifths:"\u2156",threeQuarters:"\xBE",threeFifths:"\u2157",threeEighths:"\u215C",fourFifths:"\u2158",fiveSixths:"\u215A",fiveEighths:"\u215D",sevenEighths:"\u215E",line:"\u2500",lineBold:"\u2501",lineDouble:"\u2550",lineDashed0:"\u2504",lineDashed1:"\u2505",lineDashed2:"\u2508",lineDashed3:"\u2509",lineDashed4:"\u254C",lineDashed5:"\u254D",lineDashed6:"\u2574",lineDashed7:"\u2576",lineDashed8:"\u2578",lineDashed9:"\u257A",lineDashed10:"\u257C",lineDashed11:"\u257E",lineDashed12:"\u2212",lineDashed13:"\u2013",lineDashed14:"\u2010",lineDashed15:"\u2043",lineVertical:"\u2502",lineVerticalBold:"\u2503",lineVerticalDouble:"\u2551",lineVerticalDashed0:"\u2506",lineVerticalDashed1:"\u2507",lineVerticalDashed2:"\u250A",lineVerticalDashed3:"\u250B",lineVerticalDashed4:"\u254E",lineVerticalDashed5:"\u254F",lineVerticalDashed6:"\u2575",lineVerticalDashed7:"\u2577",lineVerticalDashed8:"\u2579",lineVerticalDashed9:"\u257B",lineVerticalDashed10:"\u257D",lineVerticalDashed11:"\u257F",lineDownLeft:"\u2510",lineDownLeftArc:"\u256E",lineDownBoldLeftBold:"\u2513",lineDownBoldLeft:"\u2512",lineDownLeftBold:"\u2511",lineDownDoubleLeftDouble:"\u2557",lineDownDoubleLeft:"\u2556",lineDownLeftDouble:"\u2555",lineDownRight:"\u250C",lineDownRightArc:"\u256D",lineDownBoldRightBold:"\u250F",lineDownBoldRight:"\u250E",lineDownRightBold:"\u250D",lineDownDoubleRightDouble:"\u2554",lineDownDoubleRight:"\u2553",lineDownRightDouble:"\u2552",lineUpLeft:"\u2518",lineUpLeftArc:"\u256F",lineUpBoldLeftBold:"\u251B",lineUpBoldLeft:"\u251A",lineUpLeftBold:"\u2519",lineUpDoubleLeftDouble:"\u255D",lineUpDoubleLeft:"\u255C",lineUpLeftDouble:"\u255B",lineUpRight:"\u2514",lineUpRightArc:"\u2570",lineUpBoldRightBold:"\u2517",lineUpBoldRight:"\u2516",lineUpRightBold:"\u2515",lineUpDoubleRightDouble:"\u255A",lineUpDoubleRight:"\u2559",lineUpRightDouble:"\u2558",lineUpDownLeft:"\u2524",lineUpBoldDownBoldLeftBold:"\u252B",lineUpBoldDownBoldLeft:"\u2528",lineUpDownLeftBold:"\u2525",lineUpBoldDownLeftBold:"\u2529",lineUpDownBoldLeftBold:"\u252A",lineUpDownBoldLeft:"\u2527",lineUpBoldDownLeft:"\u2526",lineUpDoubleDownDoubleLeftDouble:"\u2563",lineUpDoubleDownDoubleLeft:"\u2562",lineUpDownLeftDouble:"\u2561",lineUpDownRight:"\u251C",lineUpBoldDownBoldRightBold:"\u2523",lineUpBoldDownBoldRight:"\u2520",lineUpDownRightBold:"\u251D",lineUpBoldDownRightBold:"\u2521",lineUpDownBoldRightBold:"\u2522",lineUpDownBoldRight:"\u251F",lineUpBoldDownRight:"\u251E",lineUpDoubleDownDoubleRightDouble:"\u2560",lineUpDoubleDownDoubleRight:"\u255F",lineUpDownRightDouble:"\u255E",lineDownLeftRight:"\u252C",lineDownBoldLeftBoldRightBold:"\u2533",lineDownLeftBoldRightBold:"\u252F",lineDownBoldLeftRight:"\u2530",lineDownBoldLeftBoldRight:"\u2531",lineDownBoldLeftRightBold:"\u2532",lineDownLeftRightBold:"\u252E",lineDownLeftBoldRight:"\u252D",lineDownDoubleLeftDoubleRightDouble:"\u2566",lineDownDoubleLeftRight:"\u2565",lineDownLeftDoubleRightDouble:"\u2564",lineUpLeftRight:"\u2534",lineUpBoldLeftBoldRightBold:"\u253B",lineUpLeftBoldRightBold:"\u2537",lineUpBoldLeftRight:"\u2538",lineUpBoldLeftBoldRight:"\u2539",lineUpBoldLeftRightBold:"\u253A",lineUpLeftRightBold:"\u2536",lineUpLeftBoldRight:"\u2535",lineUpDoubleLeftDoubleRightDouble:"\u2569",lineUpDoubleLeftRight:"\u2568",lineUpLeftDoubleRightDouble:"\u2567",lineUpDownLeftRight:"\u253C",lineUpBoldDownBoldLeftBoldRightBold:"\u254B",lineUpDownBoldLeftBoldRightBold:"\u2548",lineUpBoldDownLeftBoldRightBold:"\u2547",lineUpBoldDownBoldLeftRightBold:"\u254A",lineUpBoldDownBoldLeftBoldRight:"\u2549",lineUpBoldDownLeftRight:"\u2540",lineUpDownBoldLeftRight:"\u2541",lineUpDownLeftBoldRight:"\u253D",lineUpDownLeftRightBold:"\u253E",lineUpBoldDownBoldLeftRight:"\u2542",lineUpDownLeftBoldRightBold:"\u253F",lineUpBoldDownLeftBoldRight:"\u2543",lineUpBoldDownLeftRightBold:"\u2544",lineUpDownBoldLeftBoldRight:"\u2545",lineUpDownBoldLeftRightBold:"\u2546",lineUpDoubleDownDoubleLeftDoubleRightDouble:"\u256C",lineUpDoubleDownDoubleLeftRight:"\u256B",lineUpDownLeftDoubleRightDouble:"\u256A",lineCross:"\u2573",lineBackslash:"\u2572",lineSlash:"\u2571"},pE={tick:"\u2714",info:"\u2139",warning:"\u26A0",cross:"\u2718",squareSmall:"\u25FB",squareSmallFilled:"\u25FC",circle:"\u25EF",circleFilled:"\u25C9",circleDotted:"\u25CC",circleDouble:"\u25CE",circleCircle:"\u24DE",circleCross:"\u24E7",circlePipe:"\u24BE",radioOn:"\u25C9",radioOff:"\u25EF",checkboxOn:"\u2612",checkboxOff:"\u2610",checkboxCircleOn:"\u24E7",checkboxCircleOff:"\u24BE",pointer:"\u276F",triangleUpOutline:"\u25B3",triangleLeft:"\u25C0",triangleRight:"\u25B6",lozenge:"\u25C6",lozengeOutline:"\u25C7",hamburger:"\u2630",smiley:"\u32E1",mustache:"\u0DF4",star:"\u2605",play:"\u25B6",nodejs:"\u2B22",oneSeventh:"\u2150",oneNinth:"\u2151",oneTenth:"\u2152"},fE={tick:"\u221A",info:"i",warning:"\u203C",cross:"\xD7",squareSmall:"\u25A1",squareSmallFilled:"\u25A0",circle:"( )",circleFilled:"(*)",circleDotted:"( )",circleDouble:"( )",circleCircle:"(\u25CB)",circleCross:"(\xD7)",circlePipe:"(\u2502)",radioOn:"(*)",radioOff:"( )",checkboxOn:"[\xD7]",checkboxOff:"[ ]",checkboxCircleOn:"(\xD7)",checkboxCircleOff:"( )",pointer:">",triangleUpOutline:"\u2206",triangleLeft:"\u25C4",triangleRight:"\u25BA",lozenge:"\u2666",lozengeOutline:"\u25CA",hamburger:"\u2261",smiley:"\u263A",mustache:"\u250C\u2500\u2510",star:"\u2736",play:"\u25BA",nodejs:"\u2666",oneSeventh:"1/7",oneNinth:"1/9",oneTenth:"1/10"},mE={...Lm,...pE},hE={...Lm,...fE},gE=dE(),iu=gE?mE:hE,yE=$f?.WriteStream?.prototype?.hasColors?.()??!1,Mi=i((e,t)=>{if(!yE)return o=>o;const n=`\x1B[${e}m`,r=`\x1B[${t}m`;return o=>{const s=o+"";let a=s.indexOf(r);if(a===-1)return n+s+r;let l=n,u=0;const d=(t===22?r:"")+n;for(;a!==-1;)l+=s.slice(u,a)+d,u=a+r.length,a=s.indexOf(r,u);return l+=s.slice(u)+r,l}},"format"),vE=Mi(1,22),au=Mi(90,39),_E=Mi(91,39),bE=Mi(93,39),wE=i(({type:e,message:t,timestamp:n,piped:r,commandId:o,result:{failed:s=!1}={},options:{reject:a=!0}})=>{const l=DE(n),u=EE[e]({failed:s,reject:a,piped:r}),c=CE[e]({reject:a});return`${au(`[${l}]`)} ${au(`[${o}]`)} ${c(u)} ${c(t)}`},"defaultVerboseFunction"),DE=i(e=>`${Ni(e.getHours(),2)}:${Ni(e.getMinutes(),2)}:${Ni(e.getSeconds(),2)}.${Ni(e.getMilliseconds(),3)}`,"serializeTimestamp"),Ni=i((e,t)=>String(e).padStart(t,"0"),"padField"),Um=i(({failed:e,reject:t})=>e?t?iu.cross:iu.warning:iu.tick,"getFinalIcon"),EE={command:i(({piped:e})=>e?"|":"$","command"),output:i(()=>" ","output"),ipc:i(()=>"*","ipc"),error:Um,duration:Um},zm=i(e=>e,"identity$1"),CE={command:i(()=>vE,"command"),output:i(()=>zm,"output"),ipc:i(()=>zm,"ipc"),error:i(({reject:e})=>e?_E:bE,"error"),duration:i(()=>au,"duration")},$E=i((e,t,n)=>{const r=tE(t,n);return e.map(({verboseLine:o,verboseObject:s})=>xE(o,s,r)).filter(o=>o!==void 0).map(o=>SE(o)).join("")},"applyVerboseOnLines"),xE=i((e,t,n)=>{if(n===void 0)return e;const r=n(e,t);if(typeof r=="string")return r},"applyVerboseFunction"),SE=i(e=>e.endsWith(`
`)?e:`${e}
`,"appendNewline"),_s=i(({type:e,verboseMessage:t,fdNumber:n,verboseInfo:r,result:o})=>{const s=kE({type:e,result:o,verboseInfo:r}),a=IE(t,s),l=$E(a,r,n);l!==""&&console.warn(l.slice(0,-1))},"verboseLog"),kE=i(({type:e,result:t,verboseInfo:{escapedCommand:n,commandId:r,rawOptions:{piped:o=!1,...s}}})=>({type:e,escapedCommand:n,commandId:`${r}`,timestamp:new Date,piped:o,result:t,options:s}),"getVerboseObject"),IE=i((e,t)=>e.split(`
`).map(n=>AE({...t,message:n})),"getPrintedLines"),AE=i(e=>({verboseLine:wE(e),verboseObject:e}),"getPrintedLine"),qm=i(e=>{const t=typeof e=="string"?e:wf(e);return su(t).replaceAll("	"," ".repeat(TE))},"serializeVerboseMessage"),TE=2,FE=i((e,t)=>{eu(t)&&_s({type:"command",verboseMessage:e,verboseInfo:t})},"logCommand"),OE=i((e,t,n)=>{ME(e);const r=RE(e);return{verbose:e,escapedCommand:t,commandId:r,rawOptions:n}},"getVerboseInfo"),RE=i(e=>eu({verbose:e})?PE++:void 0,"getCommandId");let PE=0n;const ME=i(e=>{for(const t of e){if(t===!1)throw new TypeError(`The "verbose: false" option was renamed to "verbose: 'none'".`);if(t===!0)throw new TypeError(`The "verbose: true" option was renamed to "verbose: 'short'".`);if(!ou.includes(t)&&!ru(t)){const n=ou.map(r=>`'${r}'`).join(", ");throw new TypeError(`The "verbose" option must not be ${t}. Allowed values are: ${n} or a function.`)}}},"validateVerbose"),Vm=i(()=>Ef.bigint(),"getStartTime"),Gm=i(e=>Number(Ef.bigint()-e)/1e6,"getDurationMs"),Zm=i((e,t,n)=>{const r=Vm(),{command:o,escapedCommand:s}=rE(e,t),a=Pm(n,"verbose"),l=OE(a,s,{...n});return FE(s,l),{command:o,escapedCommand:s,startTime:r,verboseInfo:l}},"handleCommand");var NE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}i(Bi,"getDefaultExportFromCjs");var Kn={exports:{}},lu,Wm;function BE(){if(Wm)return lu;Wm=1,lu=r,r.sync=o;var e=dt;function t(s,a){var l=a.pathExt!==void 0?a.pathExt:process.env.PATHEXT;if(!l||(l=l.split(";"),l.indexOf("")!==-1))return!0;for(var u=0;u<l.length;u++){var c=l[u].toLowerCase();if(c&&s.substr(-c.length).toLowerCase()===c)return!0}return!1}i(t,"checkPathExt");function n(s,a,l){return!s.isSymbolicLink()&&!s.isFile()?!1:t(a,l)}i(n,"checkStat");function r(s,a,l){e.stat(s,function(u,c){l(u,u?!1:n(c,s,a))})}i(r,"isexe");function o(s,a){return n(e.statSync(s),s,a)}return i(o,"sync"),lu}i(BE,"requireWindows");var uu,Hm;function jE(){if(Hm)return uu;Hm=1,uu=t,t.sync=n;var e=dt;function t(s,a,l){e.stat(s,function(u,c){l(u,u?!1:r(c,a))})}i(t,"isexe");function n(s,a){return r(e.statSync(s),a)}i(n,"sync");function r(s,a){return s.isFile()&&o(s,a)}i(r,"checkStat");function o(s,a){var l=s.mode,u=s.uid,c=s.gid,d=a.uid!==void 0?a.uid:process.getuid&&process.getuid(),p=a.gid!==void 0?a.gid:process.getgid&&process.getgid(),h=parseInt("100",8),g=parseInt("010",8),f=parseInt("001",8),y=h|g,v=l&f||l&g&&c===p||l&h&&u===d||l&y&&d===0;return v}return i(o,"checkMode"),uu}i(jE,"requireMode");var cu,Jm;function LE(){if(Jm)return cu;Jm=1;var e;process.platform==="win32"||NE.TESTING_WINDOWS?e=BE():e=jE(),cu=t,t.sync=n;function t(r,o,s){if(typeof o=="function"&&(s=o,o={}),!s){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(a,l){t(r,o||{},function(u,c){u?l(u):a(c)})})}e(r,o||{},function(a,l){a&&(a.code==="EACCES"||o&&o.ignoreErrors)&&(a=null,l=!1),s(a,l)})}i(t,"isexe");function n(r,o){try{return e.sync(r,o||{})}catch(s){if(o&&o.ignoreErrors||s.code==="EACCES")return!1;throw s}}return i(n,"sync"),cu}i(LE,"requireIsexe");var du,Km;function UE(){if(Km)return du;Km=1;const e=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",t=Xe,n=e?";":":",r=LE(),o=i(u=>Object.assign(new Error(`not found: ${u}`),{code:"ENOENT"}),"getNotFoundError"),s=i((u,c)=>{const d=c.colon||n,p=u.match(/\//)||e&&u.match(/\\/)?[""]:[...e?[process.cwd()]:[],...(c.path||process.env.PATH||"").split(d)],h=e?c.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",g=e?h.split(d):[""];return e&&u.indexOf(".")!==-1&&g[0]!==""&&g.unshift(""),{pathEnv:p,pathExt:g,pathExtExe:h}},"getPathInfo"),a=i((u,c,d)=>{typeof c=="function"&&(d=c,c={}),c||(c={});const{pathEnv:p,pathExt:h,pathExtExe:g}=s(u,c),f=[],y=i(_=>new Promise((w,D)=>{if(_===p.length)return c.all&&f.length?w(f):D(o(u));const E=p[_],I=/^".*"$/.test(E)?E.slice(1,-1):E,T=t.join(I,u),$=!I&&/^\.[\\\/]/.test(u)?u.slice(0,2)+T:T;w(v($,_,0))}),"step"),v=i((_,w,D)=>new Promise((E,I)=>{if(D===h.length)return E(y(w+1));const T=h[D];r(_+T,{pathExt:g},($,x)=>{if(!$&&x)if(c.all)f.push(_+T);else return E(_+T);return E(v(_,w,D+1))})}),"subStep");return d?y(0).then(_=>d(null,_),d):y(0)},"which"),l=i((u,c)=>{c=c||{};const{pathEnv:d,pathExt:p,pathExtExe:h}=s(u,c),g=[];for(let f=0;f<d.length;f++){const y=d[f],v=/^".*"$/.test(y)?y.slice(1,-1):y,_=t.join(v,u),w=!v&&/^\.[\\\/]/.test(u)?u.slice(0,2)+_:_;for(let D=0;D<p.length;D++){const E=w+p[D];try{if(r.sync(E,{pathExt:h}))if(c.all)g.push(E);else return E}catch{}}}if(c.all&&g.length)return g;if(c.nothrow)return null;throw o(u)},"whichSync");return du=a,a.sync=l,du}i(UE,"requireWhich");var ji={exports:{}},Ym;function zE(){if(Ym)return ji.exports;Ym=1;const e=i((t={})=>{const n=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(n).reverse().find(o=>o.toUpperCase()==="PATH")||"Path"},"pathKey");return ji.exports=e,ji.exports.default=e,ji.exports}i(zE,"requirePathKey");var pu,Xm;function qE(){if(Xm)return pu;Xm=1;const e=Xe,t=UE(),n=zE();function r(s,a){const l=s.options.env||process.env,u=process.cwd(),c=s.options.cwd!=null,d=c&&process.chdir!==void 0&&!process.chdir.disabled;if(d)try{process.chdir(s.options.cwd)}catch{}let p;try{p=t.sync(s.command,{path:l[n({env:l})],pathExt:a?e.delimiter:void 0})}catch{}finally{d&&process.chdir(u)}return p&&(p=e.resolve(c?s.options.cwd:"",p)),p}i(r,"resolveCommandAttempt");function o(s){return r(s)||r(s,!0)}return i(o,"resolveCommand"),pu=o,pu}i(qE,"requireResolveCommand");var Li={},Qm;function VE(){if(Qm)return Li;Qm=1;const e=/([()\][%!^"`<>&|;, *?])/g;function t(r){return r=r.replace(e,"^$1"),r}i(t,"escapeCommand");function n(r,o){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(e,"^$1"),o&&(r=r.replace(e,"^$1")),r}return i(n,"escapeArgument"),Li.command=t,Li.argument=n,Li}i(VE,"require_escape");var fu,eh;function GE(){return eh||(eh=1,fu=/^#!(.*)/),fu}i(GE,"requireShebangRegex");var mu,th;function ZE(){if(th)return mu;th=1;const e=GE();return mu=i((t="")=>{const n=t.match(e);if(!n)return null;const[r,o]=n[0].replace(/#! ?/,"").split(" "),s=r.split("/").pop();return s==="env"?o:o?`${s} ${o}`:s},"shebangCommand"),mu}i(ZE,"requireShebangCommand");var hu,nh;function WE(){if(nh)return hu;nh=1;const e=dt,t=ZE();function n(r){const s=Buffer.alloc(150);let a;try{a=e.openSync(r,"r"),e.readSync(a,s,0,150,0),e.closeSync(a)}catch{}return t(s.toString())}return i(n,"readShebang"),hu=n,hu}i(WE,"requireReadShebang");var gu,rh;function HE(){if(rh)return gu;rh=1;const e=Xe,t=qE(),n=VE(),r=WE(),o=process.platform==="win32",s=/\.(?:com|exe)$/i,a=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function l(d){d.file=t(d);const p=d.file&&r(d.file);return p?(d.args.unshift(d.file),d.command=p,t(d)):d.file}i(l,"detectShebang");function u(d){if(!o)return d;const p=l(d),h=!s.test(p);if(d.options.forceShell||h){const g=a.test(p);d.command=e.normalize(d.command),d.command=n.command(d.command),d.args=d.args.map(y=>n.argument(y,g));const f=[d.command].concat(d.args).join(" ");d.args=["/d","/s","/c",`"${f}"`],d.command=process.env.comspec||"cmd.exe",d.options.windowsVerbatimArguments=!0}return d}i(u,"parseNonShell");function c(d,p,h){p&&!Array.isArray(p)&&(h=p,p=null),p=p?p.slice(0):[],h=Object.assign({},h);const g={command:d,args:p,options:h,file:void 0,original:{command:d,args:p}};return h.shell?g:u(g)}return i(c,"parse"),gu=c,gu}i(HE,"requireParse");var yu,oh;function JE(){if(oh)return yu;oh=1;const e=process.platform==="win32";function t(s,a){return Object.assign(new Error(`${a} ${s.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${a} ${s.command}`,path:s.command,spawnargs:s.args})}i(t,"notFoundError");function n(s,a){if(!e)return;const l=s.emit;s.emit=function(u,c){if(u==="exit"){const d=r(c,a);if(d)return l.call(s,"error",d)}return l.apply(s,arguments)}}i(n,"hookChildProcess");function r(s,a){return e&&s===1&&!a.file?t(a.original,"spawn"):null}i(r,"verifyENOENT");function o(s,a){return e&&s===1&&!a.file?t(a.original,"spawnSync"):null}return i(o,"verifyENOENTSync"),yu={hookChildProcess:n,verifyENOENT:r,verifyENOENTSync:o,notFoundError:t},yu}i(JE,"requireEnoent");var sh;function KE(){if(sh)return Kn.exports;sh=1;const e=fD,t=HE(),n=JE();function r(s,a,l){const u=t(s,a,l),c=e.spawn(u.command,u.args,u.options);return n.hookChildProcess(c,u),c}i(r,"spawn");function o(s,a,l){const u=t(s,a,l),c=e.spawnSync(u.command,u.args,u.options);return c.error=c.error||n.verifyENOENTSync(c.status,u),c}return i(o,"spawnSync"),Kn.exports=r,Kn.exports.spawn=r,Kn.exports.sync=o,Kn.exports._parse=t,Kn.exports._enoent=n,Kn.exports}i(KE,"requireCrossSpawn");var YE=KE(),XE=Bi(YE);function ih(e={}){const{env:t=process.env,platform:n=process.platform}=e;return n!=="win32"?"PATH":Object.keys(t).reverse().find(r=>r.toUpperCase()==="PATH")||"Path"}i(ih,"pathKey"),Df(oD);function vu(e){return e instanceof URL?vf(e):e}i(vu,"toPath");function QE(e){return{*[Symbol.iterator](){let t=At.resolve(vu(e)),n;for(;n!==t;)yield t,n=t,t=At.resolve(t,"..")}}}i(QE,"traversePathUp");const eC=i(({cwd:e=Se.cwd(),path:t=Se.env[ih()],preferLocal:n=!0,execPath:r=Se.execPath,addExecPath:o=!0}={})=>{const s=At.resolve(vu(e)),a=[],l=t.split(At.delimiter);return n&&tC(a,l,s),o&&nC(a,l,r,s),t===""||t===At.delimiter?`${a.join(At.delimiter)}${t}`:[...a,t].join(At.delimiter)},"npmRunPath"),tC=i((e,t,n)=>{for(const r of QE(n)){const o=At.join(r,"node_modules/.bin");t.includes(o)||e.push(o)}},"applyPreferLocal"),nC=i((e,t,n,r)=>{const o=At.resolve(r,vu(n),"..");t.includes(o)||e.push(o)},"applyExecPath"),rC=i(({env:e=Se.env,...t}={})=>{e={...e};const n=ih({env:e});return t.path=e[n],e[n]=eC(t),e},"npmRunPathEnv"),oC=i((e,t,n)=>{const r=n?ws:bs,o=e instanceof Yn?{}:{cause:e};return new r(t,o)},"getFinalError"),cp=class cp extends Error{};i(cp,"DiscardedError");let Yn=cp;const ah=i((e,t)=>{Object.defineProperty(e.prototype,"name",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,lh,{value:!0,writable:!1,enumerable:!1,configurable:!1})},"setErrorName"),sC=i(e=>_u(e)&&lh in e,"isExecaError"),lh=Symbol("isExecaError"),_u=i(e=>Object.prototype.toString.call(e)==="[object Error]","isErrorInstance"),dp=class dp extends Error{};i(dp,"ExecaError");let bs=dp;ah(bs,bs.name);const pp=class pp extends Error{};i(pp,"ExecaSyncError");let ws=pp;ah(ws,ws.name);const iC=i(()=>{const e=ch-uh+1;return Array.from({length:e},aC)},"getRealtimeSignals"),aC=i((e,t)=>({name:`SIGRT${t+1}`,number:uh+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}),"getRealtimeSignal"),uh=34,ch=64,lC=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}],dh=i(()=>{const e=iC();return[...lC,...e].map(uC)},"getSignals"),uC=i(({name:e,number:t,description:n,action:r,forced:o=!1,standard:s})=>{const{signals:{[e]:a}}=Zn,l=a!==void 0;return{name:e,number:l?a:t,description:n,supported:l,action:r,forced:o,standard:s}},"normalizeSignal$1"),cC=i(()=>{const e=dh();return Object.fromEntries(e.map(dC))},"getSignalsByName"),dC=i(({name:e,number:t,description:n,supported:r,action:o,forced:s,standard:a})=>[e,{name:e,number:t,description:n,supported:r,action:o,forced:s,standard:a}],"getSignalByName"),pC=cC(),fC=i(()=>{const e=dh(),t=ch+1,n=Array.from({length:t},(r,o)=>mC(o,e));return Object.assign({},...n)},"getSignalsByNumber"),mC=i((e,t)=>{const n=hC(e,t);if(n===void 0)return{};const{name:r,description:o,supported:s,action:a,forced:l,standard:u}=n;return{[e]:{name:r,number:e,description:o,supported:s,action:a,forced:l,standard:u}}},"getSignalByNumber"),hC=i((e,t)=>{const n=t.find(({name:r})=>Zn.signals[r]===e);return n!==void 0?n:t.find(r=>r.number===e)},"findSignalByNumber");fC();const gC=i(e=>{const t="option `killSignal`";if(e===0)throw new TypeError(`Invalid ${t}: 0 cannot be used.`);return ph(e,t)},"normalizeKillSignal"),yC=i(e=>e===0?e:ph(e,"`subprocess.kill()`'s argument"),"normalizeSignalArgument"),ph=i((e,t)=>{if(Number.isInteger(e))return vC(e,t);if(typeof e=="string")return bC(e,t);throw new TypeError(`Invalid ${t} ${String(e)}: it must be a string or an integer.
${bu()}`)},"normalizeSignal"),vC=i((e,t)=>{if(fh.has(e))return fh.get(e);throw new TypeError(`Invalid ${t} ${e}: this signal integer does not exist.
${bu()}`)},"normalizeSignalInteger"),_C=i(()=>new Map(Object.entries(Zn.signals).reverse().map(([e,t])=>[t,e])),"getSignalsIntegerToName"),fh=_C(),bC=i((e,t)=>{if(e in Zn.signals)return e;throw e.toUpperCase()in Zn.signals?new TypeError(`Invalid ${t} '${e}': please rename it to '${e.toUpperCase()}'.`):new TypeError(`Invalid ${t} '${e}': this signal name does not exist.
${bu()}`)},"normalizeSignalName"),bu=i(()=>`Available signal names: ${wC()}.
Available signal numbers: ${DC()}.`,"getAvailableSignals"),wC=i(()=>Object.keys(Zn.signals).sort().map(e=>`'${e}'`).join(", "),"getAvailableSignalNames"),DC=i(()=>[...new Set(Object.values(Zn.signals).sort((e,t)=>e-t))].join(", "),"getAvailableSignalIntegers"),mh=i(e=>pC[e].description,"getSignalDescription"),EC=i(e=>{if(e===!1)return e;if(e===!0)return CC;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterDelay\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},"normalizeForceKillAfterDelay"),CC=1e3*5,$C=i(({kill:e,options:{forceKillAfterDelay:t,killSignal:n},onInternalError:r,context:o,controller:s},a,l)=>{const{signal:u,error:c}=xC(a,l,n);SC(c,r);const d=e(u);return kC({kill:e,signal:u,forceKillAfterDelay:t,killSignal:n,killResult:d,context:o,controller:s}),d},"subprocessKill"),xC=i((e,t,n)=>{const[r=n,o]=_u(e)?[void 0,e]:[e,t];if(typeof r!="string"&&!Number.isInteger(r))throw new TypeError(`The first argument must be an error instance or a signal name string/integer: ${String(r)}`);if(o!==void 0&&!_u(o))throw new TypeError(`The second argument is optional. If specified, it must be an error instance: ${o}`);return{signal:yC(r),error:o}},"parseKillArguments"),SC=i((e,t)=>{e!==void 0&&t.reject(e)},"emitKillError"),kC=i(async({kill:e,signal:t,forceKillAfterDelay:n,killSignal:r,killResult:o,context:s,controller:a})=>{t===r&&o&&hh({kill:e,forceKillAfterDelay:n,context:s,controllerSignal:a.signal})},"setKillTimeout"),hh=i(async({kill:e,forceKillAfterDelay:t,context:n,controllerSignal:r})=>{if(t!==!1)try{await Af(t,void 0,{signal:r}),e("SIGKILL")&&(n.isForcefullyTerminated??(n.isForcefullyTerminated=!0))}catch{}},"killOnTimeout"),gh=i(async(e,t)=>{e.aborted||await wt(e,"abort",{signal:t})},"onAbortedSignal"),IC=i(({cancelSignal:e})=>{if(e!==void 0&&Object.prototype.toString.call(e)!=="[object AbortSignal]")throw new Error(`The \`cancelSignal\` option must be an AbortSignal: ${String(e)}`)},"validateCancelSignal"),AC=i(({subprocess:e,cancelSignal:t,gracefulCancel:n,context:r,controller:o})=>t===void 0||n?[]:[TC(e,t,r,o)],"throwOnCancel"),TC=i(async(e,t,n,{signal:r})=>{throw await gh(t,r),n.terminationReason??(n.terminationReason="cancel"),e.kill(),t.reason},"terminateOnCancel"),wu=i(({methodName:e,isSubprocess:t,ipc:n,isConnected:r})=>{FC(e,t,n),yh(e,t,r)},"validateIpcMethod"),FC=i((e,t,n)=>{if(!n)throw new Error(`${Zt(e,t)} can only be used if the \`ipc\` option is \`true\`.`)},"validateIpcOption"),yh=i((e,t,n)=>{if(!n)throw new Error(`${Zt(e,t)} cannot be used: the ${An(t)} has already exited or disconnected.`)},"validateConnection"),OC=i(e=>{throw new Error(`${Zt("getOneMessage",e)} could not complete: the ${An(e)} exited or disconnected.`)},"throwOnEarlyDisconnect"),RC=i(e=>{throw new Error(`${Zt("sendMessage",e)} failed: the ${An(e)} is sending a message too, instead of listening to incoming messages.
This can be fixed by both sending a message and listening to incoming messages at the same time:

const [receivedMessage] = await Promise.all([
	${Zt("getOneMessage",e)},
	${Zt("sendMessage",e,"message, {strict: true}")},
]);`)},"throwOnStrictDeadlockError"),vh=i((e,t)=>new Error(`${Zt("sendMessage",t)} failed when sending an acknowledgment response to the ${An(t)}.`,{cause:e}),"getStrictResponseError"),PC=i(e=>{throw new Error(`${Zt("sendMessage",e)} failed: the ${An(e)} is not listening to incoming messages.`)},"throwOnMissingStrict"),MC=i(e=>{throw new Error(`${Zt("sendMessage",e)} failed: the ${An(e)} exited without listening to incoming messages.`)},"throwOnStrictDisconnect"),NC=i(()=>new Error(`\`cancelSignal\` aborted: the ${An(!0)} disconnected.`),"getAbortDisconnectError"),BC=i(()=>{throw new Error("`getCancelSignal()` cannot be used without setting the `cancelSignal` subprocess option.")},"throwOnMissingParent"),jC=i(({error:e,methodName:t,isSubprocess:n})=>{if(e.code==="EPIPE")throw new Error(`${Zt(t,n)} cannot be used: the ${An(n)} is disconnecting.`,{cause:e})},"handleEpipeError"),LC=i(({error:e,methodName:t,isSubprocess:n,message:r})=>{if(UC(e))throw new Error(`${Zt(t,n)}'s argument type is invalid: the message cannot be serialized: ${String(r)}.`,{cause:e})},"handleSerializationError"),UC=i(({code:e,message:t})=>zC.has(e)||qC.some(n=>t.includes(n)),"isSerializationError"),zC=new Set(["ERR_MISSING_ARGS","ERR_INVALID_ARG_TYPE"]),qC=["could not be cloned","circular structure","call stack size exceeded"],Zt=i((e,t,n="")=>e==="cancelSignal"?"`cancelSignal`'s `controller.abort()`":`${VC(t)}${e}(${n})`,"getMethodName"),VC=i(e=>e?"":"subprocess.","getNamespaceName"),An=i(e=>e?"parent process":"subprocess","getOtherProcessName"),Du=i(e=>{e.connected&&e.disconnect()},"disconnect"),Ds=i(()=>{const e={},t=new Promise((n,r)=>{Object.assign(e,{resolve:n,reject:r})});return Object.assign(t,e)},"createDeferred"),_h=i((e,t="stdin")=>{const{options:r,fileDescriptors:o}=Xn.get(e),s=bh(o,t,!0),a=e.stdio[s];if(a===null)throw new TypeError(wh(s,t,r,!0));return a},"getToStream"),Eu=i((e,t="stdout")=>{const{options:r,fileDescriptors:o}=Xn.get(e),s=bh(o,t,!1),a=s==="all"?e.all:e.stdio[s];if(a==null)throw new TypeError(wh(s,t,r,!1));return a},"getFromStream"),Xn=new WeakMap,bh=i((e,t,n)=>{const r=GC(t,n);return ZC(r,t,n,e),r},"getFdNumber"),GC=i((e,t)=>{const n=Nm(e);if(n!==void 0)return n;const{validOptions:r,defaultValue:o}=t?{validOptions:'"stdin"',defaultValue:"stdin"}:{validOptions:'"stdout", "stderr", "all"',defaultValue:"stdout"};throw new TypeError(`"${Es(t)}" must not be "${e}".
It must be ${r} or "fd3", "fd4" (and so on).
It is optional and defaults to "${o}".`)},"parseFdNumber"),ZC=i((e,t,n,r)=>{const o=r[Dh(e)];if(o===void 0)throw new TypeError(`"${Es(n)}" must not be ${t}. That file descriptor does not exist.
Please set the "stdio" option to ensure that file descriptor exists.`);if(o.direction==="input"&&!n)throw new TypeError(`"${Es(n)}" must not be ${t}. It must be a readable stream, not writable.`);if(o.direction!=="input"&&n)throw new TypeError(`"${Es(n)}" must not be ${t}. It must be a writable stream, not readable.`)},"validateFdNumber"),wh=i((e,t,n,r)=>{if(e==="all"&&!n.all)return`The "all" option must be true to use "from: 'all'".`;const{optionName:o,optionValue:s}=WC(e,n);return`The "${o}: ${Cu(s)}" option is incompatible with using "${Es(r)}: ${Cu(t)}".
Please set this option with "pipe" instead.`},"getInvalidStdioOptionMessage"),WC=i((e,{stdin:t,stdout:n,stderr:r,stdio:o})=>{const s=Dh(e);return s===0&&t!==void 0?{optionName:"stdin",optionValue:t}:s===1&&n!==void 0?{optionName:"stdout",optionValue:n}:s===2&&r!==void 0?{optionName:"stderr",optionValue:r}:{optionName:`stdio[${s}]`,optionValue:o[s]}},"getInvalidStdioOption"),Dh=i(e=>e==="all"?1:e,"getUsedDescriptor"),Es=i(e=>e?"to":"from","getOptionName"),Cu=i(e=>typeof e=="string"?`'${e}'`:typeof e=="number"?`${e}`:"Stream","serializeOptionValue"),Ui=i((e,t,n)=>{const r=e.getMaxListeners();r===0||r===Number.POSITIVE_INFINITY||(e.setMaxListeners(r+t),Ff(n,()=>{e.setMaxListeners(e.getMaxListeners()-t)}))},"incrementMaxListeners"),Eh=i((e,t)=>{t&&$u(e)},"addReference"),$u=i(e=>{e.refCounted()},"addReferenceCount"),Ch=i((e,t)=>{t&&xu(e)},"removeReference"),xu=i(e=>{e.unrefCounted()},"removeReferenceCount"),HC=i((e,t)=>{t&&(xu(e),xu(e))},"undoAddedReferences"),JC=i((e,t)=>{t&&($u(e),$u(e))},"redoAddedReferences"),KC=i(async({anyProcess:e,channel:t,isSubprocess:n,ipcEmitter:r},o)=>{if(r$(o)||h$(o))return;zi.has(e)||zi.set(e,[]);const s=zi.get(e);if(s.push(o),!(s.length>1))for(;s.length>0;){await l$(e,r,o),await Tf.yield();const a=await n$({wrappedMessage:s[0],anyProcess:e,channel:t,isSubprocess:n,ipcEmitter:r});s.shift(),r.emit("message",a),r.emit("message:done")}},"onMessage"),YC=i(async({anyProcess:e,channel:t,isSubprocess:n,ipcEmitter:r,boundOnMessage:o})=>{Th();const s=zi.get(e);for(;s?.length>0;)await wt(r,"message:done");e.removeListener("message",o),JC(t,n),r.connected=!1,r.emit("disconnect")},"onDisconnect"),zi=new WeakMap,qi=i((e,t,n)=>{if(Vi.has(e))return Vi.get(e);const r=new _D;return r.connected=!0,Vi.set(e,r),XC({ipcEmitter:r,anyProcess:e,channel:t,isSubprocess:n}),r},"getIpcEmitter"),Vi=new WeakMap,XC=i(({ipcEmitter:e,anyProcess:t,channel:n,isSubprocess:r})=>{const o=KC.bind(void 0,{anyProcess:t,channel:n,isSubprocess:r,ipcEmitter:e});t.on("message",o),t.once("disconnect",YC.bind(void 0,{anyProcess:t,channel:n,isSubprocess:r,ipcEmitter:e,boundOnMessage:o})),HC(n,r)},"forwardEvents"),$h=i(e=>{const t=Vi.get(e);return t===void 0?e.channel!==null:t.connected},"isConnected"),QC=i(({anyProcess:e,channel:t,isSubprocess:n,message:r,strict:o})=>{if(!o)return r;const s=qi(e,t,n),a=Su(e,s);return{id:e$++,type:Zi,message:r,hasListeners:a}},"handleSendStrict");let e$=0n;const t$=i((e,t)=>{if(!(t?.type!==Zi||t.hasListeners))for(const{id:n}of e)n!==void 0&&Gi[n].resolve({isDeadlock:!0,hasListeners:!1})},"validateStrictDeadlock"),n$=i(async({wrappedMessage:e,anyProcess:t,channel:n,isSubprocess:r,ipcEmitter:o})=>{if(e?.type!==Zi||!t.connected)return e;const{id:s,message:a}=e,l={id:s,type:xh,message:Su(t,o)};try{await Sh({anyProcess:t,channel:n,isSubprocess:r,ipc:!0},l)}catch(u){o.emit("strict:error",u)}return a},"handleStrictRequest"),r$=i(e=>{if(e?.type!==xh)return!1;const{id:t,message:n}=e;return Gi[t]?.resolve({isDeadlock:!1,hasListeners:n}),!0},"handleStrictResponse"),o$=i(async(e,t,n)=>{if(e?.type!==Zi)return;const r=Ds();Gi[e.id]=r;const o=new AbortController;try{const{isDeadlock:s,hasListeners:a}=await Promise.race([r,s$(t,n,o)]);s&&RC(n),a||PC(n)}finally{o.abort(),delete Gi[e.id]}},"waitForStrictResponse"),Gi={},s$=i(async(e,t,{signal:n})=>{Ui(e,1,n),await wt(e,"disconnect",{signal:n}),MC(t)},"throwOnDisconnect$1"),Zi="execa:ipc:request",xh="execa:ipc:response",i$=i((e,t,n)=>{Cs.has(e)||Cs.set(e,new Set);const r=Cs.get(e),o=Ds(),s=n?t.id:void 0,a={onMessageSent:o,id:s};return r.add(a),{outgoingMessages:r,outgoingMessage:a}},"startSendMessage"),a$=i(({outgoingMessages:e,outgoingMessage:t})=>{e.delete(t),t.onMessageSent.resolve()},"endSendMessage"),l$=i(async(e,t,n)=>{for(;!Su(e,t)&&Cs.get(e)?.size>0;){const r=[...Cs.get(e)];t$(r,n),await Promise.all(r.map(({onMessageSent:o})=>o))}},"waitForOutgoingMessages"),Cs=new WeakMap,Su=i((e,t)=>t.listenerCount("message")>u$(e),"hasMessageListeners"),u$=i(e=>Xn.has(e)&&!vs(Xn.get(e).options.buffer,"ipc")?1:0,"getMinListenerCount"),Sh=i(({anyProcess:e,channel:t,isSubprocess:n,ipc:r},o,{strict:s=!1}={})=>{const a="sendMessage";return wu({methodName:a,isSubprocess:n,ipc:r,isConnected:e.connected}),c$({anyProcess:e,channel:t,methodName:a,isSubprocess:n,message:o,strict:s})},"sendMessage"),c$=i(async({anyProcess:e,channel:t,methodName:n,isSubprocess:r,message:o,strict:s})=>{const a=QC({anyProcess:e,channel:t,isSubprocess:r,message:o,strict:s}),l=i$(e,a,s);try{await kh({anyProcess:e,methodName:n,isSubprocess:r,wrappedMessage:a,message:o})}catch(u){throw Du(e),u}finally{a$(l)}},"sendMessageAsync"),kh=i(async({anyProcess:e,methodName:t,isSubprocess:n,wrappedMessage:r,message:o})=>{const s=d$(e);try{await Promise.all([o$(r,e,n),s(r)])}catch(a){throw jC({error:a,methodName:t,isSubprocess:n}),LC({error:a,methodName:t,isSubprocess:n,message:o}),a}},"sendOneMessage"),d$=i(e=>{if(ku.has(e))return ku.get(e);const t=Df(e.send.bind(e));return ku.set(e,t),t},"getSendMethod"),ku=new WeakMap,p$=i((e,t)=>{const n="cancelSignal";return yh(n,!1,e.connected),kh({anyProcess:e,methodName:n,isSubprocess:!1,wrappedMessage:{type:Ah,message:t},message:t})},"sendAbort"),f$=i(async({anyProcess:e,channel:t,isSubprocess:n,ipc:r})=>(await m$({anyProcess:e,channel:t,isSubprocess:n,ipc:r}),Iu.signal),"getCancelSignal"),m$=i(async({anyProcess:e,channel:t,isSubprocess:n,ipc:r})=>{if(!Ih){if(Ih=!0,!r){BC();return}if(t===null){Th();return}qi(e,t,n),await Tf.yield()}},"startIpc");let Ih=!1;const h$=i(e=>e?.type!==Ah?!1:(Iu.abort(e.message),!0),"handleAbort"),Ah="execa:ipc:cancel",Th=i(()=>{Iu.abort(NC())},"abortOnDisconnect"),Iu=new AbortController,g$=i(({gracefulCancel:e,cancelSignal:t,ipc:n,serialization:r})=>{if(e){if(t===void 0)throw new Error("The `cancelSignal` option must be defined when setting the `gracefulCancel` option.");if(!n)throw new Error("The `ipc` option cannot be false when setting the `gracefulCancel` option.");if(r==="json")throw new Error("The `serialization` option cannot be 'json' when setting the `gracefulCancel` option.")}},"validateGracefulCancel"),y$=i(({subprocess:e,cancelSignal:t,gracefulCancel:n,forceKillAfterDelay:r,context:o,controller:s})=>n?[v$({subprocess:e,cancelSignal:t,forceKillAfterDelay:r,context:o,controller:s})]:[],"throwOnGracefulCancel"),v$=i(async({subprocess:e,cancelSignal:t,forceKillAfterDelay:n,context:r,controller:{signal:o}})=>{await gh(t,o);const s=_$(t);throw await p$(e,s),hh({kill:e.kill,forceKillAfterDelay:n,context:r,controllerSignal:o}),r.terminationReason??(r.terminationReason="gracefulCancel"),t.reason},"sendOnAbort"),_$=i(({reason:e})=>{if(!(e instanceof DOMException))return e;const t=new Error(e.message);return Object.defineProperty(t,"stack",{value:e.stack,enumerable:!1,configurable:!0,writable:!0}),t},"getReason"),b$=i(({timeout:e})=>{if(e!==void 0&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)},"validateTimeout"),w$=i((e,t,n,r)=>t===0||t===void 0?[]:[D$(e,t,n,r)],"throwOnTimeout"),D$=i(async(e,t,n,{signal:r})=>{throw await Af(t,void 0,{signal:r}),n.terminationReason??(n.terminationReason="timeout"),e.kill(),new Yn},"killAfterTimeout"),E$=i(({options:e})=>{if(e.node===!1)throw new TypeError('The "node" option cannot be false with `execaNode()`.');return{options:{...e,node:!0}}},"mapNode"),C$=i((e,t,{node:n=!1,nodePath:r=dD,nodeOptions:o=pD.filter(u=>!u.startsWith("--inspect")),cwd:s,execPath:a,...l})=>{if(a!==void 0)throw new TypeError('The "execPath" option has been removed. Please use the "nodePath" option instead.');const u=Yl(r,'The "nodePath" option'),c=At.resolve(s,u),d={...l,nodePath:c,node:n,cwd:s};if(!n)return[e,t,d];if(At.basename(e,".exe")==="node")throw new TypeError('When the "node" option is true, the first argument does not need to be "node".');return[c,[...o,e,...t],{ipc:!0,...d,shell:!1}]},"handleNodeOption"),$$=i(({ipcInput:e,ipc:t,serialization:n})=>{if(e!==void 0){if(!t)throw new Error("The `ipcInput` option cannot be set unless the `ipc` option is `true`.");k$[n](e)}},"validateIpcInputOption"),x$=i(e=>{try{wD(e)}catch(t){throw new Error("The `ipcInput` option is not serializable with a structured clone.",{cause:t})}},"validateAdvancedInput"),S$=i(e=>{try{JSON.stringify(e)}catch(t){throw new Error("The `ipcInput` option is not serializable with JSON.",{cause:t})}},"validateJsonInput"),k$={advanced:x$,json:S$},I$=i(async(e,t)=>{t!==void 0&&await e.sendMessage(t)},"sendIpcInput"),A$=i(({encoding:e})=>{if(Au.has(e))return;const t=F$(e);if(t!==void 0)throw new TypeError(`Invalid option \`encoding: ${Wi(e)}\`.
Please rename it to ${Wi(t)}.`);const n=[...Au].map(r=>Wi(r)).join(", ");throw new TypeError(`Invalid option \`encoding: ${Wi(e)}\`.
Please rename it to one of: ${n}.`)},"validateEncoding"),T$=new Set(["utf8","utf16le"]),Qn=new Set(["buffer","hex","base64","base64url","latin1","ascii"]),Au=new Set([...T$,...Qn]),F$=i(e=>{if(e===null)return"buffer";if(typeof e!="string")return;const t=e.toLowerCase();if(t in Fh)return Fh[t];if(Au.has(t))return t},"getCorrectEncoding"),Fh={"utf-8":"utf8","utf-16le":"utf16le","ucs-2":"utf16le",ucs2:"utf16le",binary:"latin1"},Wi=i(e=>typeof e=="string"?`"${e}"`:String(e),"serializeEncoding"),O$=i((e=Oh())=>{const t=Yl(e,'The "cwd" option');return At.resolve(t)},"normalizeCwd"),Oh=i(()=>{try{return Se.cwd()}catch(e){throw e.message=`The current directory does not exist.
${e.message}`,e}},"getDefaultCwd"),R$=i((e,t)=>{if(t===Oh())return e;let n;try{n=DD(t)}catch(r){return`The "cwd" option is invalid: ${t}.
${r.message}
${e}`}return n.isDirectory()?e:`The "cwd" option is not a directory: ${t}.
${e}`},"fixCwdError"),Rh=i((e,t,n)=>{n.cwd=O$(n.cwd);const[r,o,s]=C$(e,t,n),{command:a,args:l,options:u}=XE._parse(r,o,s),c=G2(u),d=P$(c);return b$(d),A$(d),$$(d),IC(d),g$(d),d.shell=$m(d.shell),d.env=M$(d),d.killSignal=gC(d.killSignal),d.forceKillAfterDelay=EC(d.forceKillAfterDelay),d.lines=d.lines.map((p,h)=>p&&!Qn.has(d.encoding)&&d.buffer[h]),Se.platform==="win32"&&At.basename(a,".exe")==="cmd"&&l.unshift("/q"),{file:a,commandArguments:l,options:d}},"normalizeOptions"),P$=i(({extendEnv:e=!0,preferLocal:t=!1,cwd:n,localDir:r=n,encoding:o="utf8",reject:s=!0,cleanup:a=!0,all:l=!1,windowsHide:u=!0,killSignal:c="SIGTERM",forceKillAfterDelay:d=!0,gracefulCancel:p=!1,ipcInput:h,ipc:g=h!==void 0||p,serialization:f="advanced",...y})=>({...y,extendEnv:e,preferLocal:t,cwd:n,localDirectory:r,encoding:o,reject:s,cleanup:a,all:l,windowsHide:u,killSignal:c,forceKillAfterDelay:d,gracefulCancel:p,ipcInput:h,ipc:g,serialization:f}),"addDefaultOptions"),M$=i(({env:e,extendEnv:t,preferLocal:n,node:r,localDirectory:o,nodePath:s})=>{const a=t?{...Se.env,...e}:e;return n||r?rC({env:a,cwd:o,execPath:s,preferLocal:n,addExecPath:r}):a},"getEnv"),Ph=i((e,t,n)=>n.shell&&t.length>0?[[e,...t].join(" "),[],n]:[e,t,n],"concatenateShell");function Tu(e){if(typeof e=="string")return N$(e);if(!(ArrayBuffer.isView(e)&&e.BYTES_PER_ELEMENT===1))throw new Error("Input must be a string or a Uint8Array");return B$(e)}i(Tu,"stripFinalNewline");const N$=i(e=>e.at(-1)===Mh?e.slice(0,e.at(-2)===Nh?-2:-1):e,"stripFinalNewlineString"),B$=i(e=>e.at(-1)===j$?e.subarray(0,e.at(-2)===L$?-2:-1):e,"stripFinalNewlineBinary"),Mh=`
`,j$=Mh.codePointAt(0),Nh="\r",L$=Nh.codePointAt(0);function er(e,{checkOpen:t=!0}={}){return e!==null&&typeof e=="object"&&(e.writable||e.readable||!t||e.writable===void 0&&e.readable===void 0)&&typeof e.pipe=="function"}i(er,"isStream");function Bh(e,{checkOpen:t=!0}={}){return er(e,{checkOpen:t})&&(e.writable||!t)&&typeof e.write=="function"&&typeof e.end=="function"&&typeof e.writable=="boolean"&&typeof e.writableObjectMode=="boolean"&&typeof e.destroy=="function"&&typeof e.destroyed=="boolean"}i(Bh,"isWritableStream$1");function Hi(e,{checkOpen:t=!0}={}){return er(e,{checkOpen:t})&&(e.readable||!t)&&typeof e.read=="function"&&typeof e.readable=="boolean"&&typeof e.readableObjectMode=="boolean"&&typeof e.destroy=="function"&&typeof e.destroyed=="boolean"}i(Hi,"isReadableStream$1");function jh(e,t){return Bh(e,t)&&Hi(e,t)}i(jh,"isDuplexStream");var Lh=i(e=>{throw TypeError(e)},"__typeError$2"),Fu=i((e,t,n)=>t.has(e)||Lh("Cannot "+n),"__accessCheck$2"),Dt=i((e,t,n)=>(Fu(e,t,"read from private field"),n?n.call(e):t.get(e)),"__privateGet$2"),$s=i((e,t,n)=>t.has(e)?Lh("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),"__privateAdd$2"),Tn=i((e,t,n,r)=>(Fu(e,t,"write to private field"),t.set(e,n),n),"__privateSet$2"),Uh=i((e,t,n)=>(Fu(e,t,"access private method"),n),"__privateMethod$1"),wn,Ji,tr,un,Ki,zh,qh;const U$=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype),fp=class fp{constructor(t,n){$s(this,Ki),$s(this,wn),$s(this,Ji),$s(this,tr,!1),$s(this,un),Tn(this,wn,t),Tn(this,Ji,n)}next(){const t=i(()=>Uh(this,Ki,zh).call(this),"e");return Tn(this,un,Dt(this,un)?Dt(this,un).then(t,t):t()),Dt(this,un)}return(t){const n=i(()=>Uh(this,Ki,qh).call(this,t),"t");return Dt(this,un)?Dt(this,un).then(n,n):n()}};i(fp,"c");let Ou=fp;wn=new WeakMap,Ji=new WeakMap,tr=new WeakMap,un=new WeakMap,Ki=new WeakSet,zh=i(async function(){if(Dt(this,tr))return{done:!0,value:void 0};let e;try{e=await Dt(this,wn).read()}catch(t){throw Tn(this,un,void 0),Tn(this,tr,!0),Dt(this,wn).releaseLock(),t}return e.done&&(Tn(this,un,void 0),Tn(this,tr,!0),Dt(this,wn).releaseLock()),e},"s_fn"),qh=i(async function(e){if(Dt(this,tr))return{done:!0,value:e};if(Tn(this,tr,!0),!Dt(this,Ji)){const t=Dt(this,wn).cancel(e);return Dt(this,wn).releaseLock(),await t,{done:!0,value:e}}return Dt(this,wn).releaseLock(),{done:!0,value:e}},"i_fn");const Ru=Symbol();function Vh(){return this[Ru].next()}i(Vh,"i"),Object.defineProperty(Vh,"name",{value:"next"});function Gh(e){return this[Ru].return(e)}i(Gh,"o"),Object.defineProperty(Gh,"name",{value:"return"});const z$=Object.create(U$,{next:{enumerable:!0,configurable:!0,writable:!0,value:Vh},return:{enumerable:!0,configurable:!0,writable:!0,value:Gh}});function q$({preventCancel:e=!1}={}){const t=this.getReader(),n=new Ou(t,e),r=Object.create(z$);return r[Ru]=n,r}i(q$,"h");const V$=i(e=>{if(Hi(e,{checkOpen:!1})&&Pu.on!==void 0)return Z$(e);if(typeof e?.[Symbol.asyncIterator]=="function")return e;if(G$.call(e)==="[object ReadableStream]")return q$.call(e);throw new TypeError("The first argument must be a Readable, a ReadableStream, or an async iterable.")},"getAsyncIterable"),{toString:G$}=Object.prototype,Z$=i(async function*(e){const t=new AbortController,n={};W$(e,t,n);try{for await(const[r]of Pu.on(e,"data",{signal:t.signal}))yield r}catch(r){if(n.error!==void 0)throw n.error;if(!t.signal.aborted)throw r}finally{e.destroy()}},"getStreamIterable"),W$=i(async(e,t,n)=>{try{await Pu.finished(e,{cleanup:!0,readable:!0,writable:!1,error:!1})}catch(r){n.error=r}finally{t.abort()}},"handleStreamEnd"),Pu={};var H$=Object.defineProperty,J$=i((e,t,n)=>t in e?H$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,"__defNormalProp$2"),K$=i((e,t,n)=>J$(e,t+"",n),"__publicField$2");const Mu=i(async(e,{init:t,convertChunk:n,getSize:r,truncateChunk:o,addChunk:s,getFinalChunk:a,finalize:l},{maxBuffer:u=Number.POSITIVE_INFINITY}={})=>{const c=V$(e),d=t();d.length=0;try{for await(const p of c){const h=X$(p),g=n[h](p,d);Zh({convertedChunk:g,state:d,getSize:r,truncateChunk:o,addChunk:s,maxBuffer:u})}return Y$({state:d,convertChunk:n,getSize:r,truncateChunk:o,addChunk:s,getFinalChunk:a,maxBuffer:u}),l(d)}catch(p){const h=typeof p=="object"&&p!==null?p:new Error(p);throw h.bufferedData=l(d),h}},"getStreamContents$1"),Y$=i(({state:e,getSize:t,truncateChunk:n,addChunk:r,getFinalChunk:o,maxBuffer:s})=>{const a=o(e);a!==void 0&&Zh({convertedChunk:a,state:e,getSize:t,truncateChunk:n,addChunk:r,maxBuffer:s})},"appendFinalChunk"),Zh=i(({convertedChunk:e,state:t,getSize:n,truncateChunk:r,addChunk:o,maxBuffer:s})=>{const a=n(e),l=t.length+a;if(l<=s){Wh(e,t,o,l);return}const u=r(e,s-t.length);throw u!==void 0&&Wh(u,t,o,s),new Ar},"appendChunk"),Wh=i((e,t,n,r)=>{t.contents=n(e,t,r),t.length=r},"addNewChunk"),X$=i(e=>{const t=typeof e;if(t==="string")return"string";if(t!=="object"||e===null)return"others";if(globalThis.Buffer?.isBuffer(e))return"buffer";const n=Hh.call(e);return n==="[object ArrayBuffer]"?"arrayBuffer":n==="[object DataView]"?"dataView":Number.isInteger(e.byteLength)&&Number.isInteger(e.byteOffset)&&Hh.call(e.buffer)==="[object ArrayBuffer]"?"typedArray":"others"},"getChunkType"),{toString:Hh}=Object.prototype,mp=class mp extends Error{constructor(){super("maxBuffer exceeded"),K$(this,"name","MaxBufferError")}};i(mp,"MaxBufferError");let Ar=mp;const nr=i(e=>e,"identity"),Nu=i(()=>{},"noop$2"),Jh=i(({contents:e})=>e,"getContentsProperty"),Kh=i(e=>{throw new Error(`Streams in object mode are not supported: ${String(e)}`)},"throwObjectStream"),Yh=i(e=>e.length,"getLengthProperty");async function Q$(e,t){return Mu(e,rx,t)}i(Q$,"getStreamAsArray");const ex=i(()=>({contents:[]}),"initArray"),tx=i(()=>1,"increment"),nx=i((e,{contents:t})=>(t.push(e),t),"addArrayChunk"),rx={init:ex,convertChunk:{string:nr,buffer:nr,arrayBuffer:nr,dataView:nr,typedArray:nr,others:nr},getSize:tx,truncateChunk:Nu,addChunk:nx,getFinalChunk:Nu,finalize:Jh};async function ox(e,t){return Mu(e,fx,t)}i(ox,"getStreamAsArrayBuffer");const sx=i(()=>({contents:new ArrayBuffer(0)}),"initArrayBuffer"),ix=i(e=>ax.encode(e),"useTextEncoder"),ax=new TextEncoder,Xh=i(e=>new Uint8Array(e),"useUint8Array"),Qh=i(e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),"useUint8ArrayWithOffset"),lx=i((e,t)=>e.slice(0,t),"truncateArrayBufferChunk"),ux=i((e,{contents:t,length:n},r)=>{const o=ng()?dx(t,r):cx(t,r);return new Uint8Array(o).set(e,n),o},"addArrayBufferChunk"),cx=i((e,t)=>{if(t<=e.byteLength)return e;const n=new ArrayBuffer(eg(t));return new Uint8Array(n).set(new Uint8Array(e),0),n},"resizeArrayBufferSlow"),dx=i((e,t)=>{if(t<=e.maxByteLength)return e.resize(t),e;const n=new ArrayBuffer(t,{maxByteLength:eg(t)});return new Uint8Array(n).set(new Uint8Array(e),0),n},"resizeArrayBuffer"),eg=i(e=>tg**Math.ceil(Math.log(e)/Math.log(tg)),"getNewContentsLength"),tg=2,px=i(({contents:e,length:t})=>ng()?e:e.slice(0,t),"finalizeArrayBuffer"),ng=i(()=>"resize"in ArrayBuffer.prototype,"hasArrayBufferResize"),fx={init:sx,convertChunk:{string:ix,buffer:Xh,arrayBuffer:Xh,dataView:Qh,typedArray:Qh,others:Kh},getSize:Yh,truncateChunk:lx,addChunk:ux,getFinalChunk:Nu,finalize:px};async function mx(e,t){return Mu(e,_x,t)}i(mx,"getStreamAsString");const hx=i(()=>({contents:"",textDecoder:new TextDecoder}),"initString"),Yi=i((e,{textDecoder:t})=>t.decode(e,{stream:!0}),"useTextDecoder"),gx=i((e,{contents:t})=>t+e,"addStringChunk"),yx=i((e,t)=>e.slice(0,t),"truncateStringChunk"),vx=i(({textDecoder:e})=>{const t=e.decode();return t===""?void 0:t},"getFinalStringChunk"),_x={init:hx,convertChunk:{string:nr,buffer:Yi,arrayBuffer:Yi,dataView:Yi,typedArray:Yi,others:Kh},getSize:Yh,truncateChunk:yx,addChunk:gx,getFinalChunk:vx,finalize:Jh},bx=i(({error:e,stream:t,readableObjectMode:n,lines:r,encoding:o,fdNumber:s})=>{if(!(e instanceof Ar))throw e;if(s==="all")return e;const a=wx(n,r,o);throw e.maxBufferInfo={fdNumber:s,unit:a},t.destroy(),e},"handleMaxBuffer"),wx=i((e,t,n)=>e?"objects":t?"lines":n==="buffer"?"bytes":"characters","getMaxBufferUnit"),Dx=i((e,t,n)=>{if(t.length!==n)return;const r=new Ar;throw r.maxBufferInfo={fdNumber:"ipc"},r},"checkIpcMaxBuffer"),Ex=i((e,t)=>{const{streamName:n,threshold:r,unit:o}=Cx(e,t);return`Command's ${n} was larger than ${r} ${o}`},"getMaxBufferMessage"),Cx=i((e,t)=>{if(e?.maxBufferInfo===void 0)return{streamName:"output",threshold:t[1],unit:"bytes"};const{maxBufferInfo:{fdNumber:n,unit:r}}=e;delete e.maxBufferInfo;const o=vs(t,n);return n==="ipc"?{streamName:"IPC output",threshold:o,unit:"messages"}:{streamName:Rm(n),threshold:o,unit:r}},"getMaxBufferInfo"),$x=i((e,t,n)=>e?.code==="ENOBUFS"&&t!==null&&t.some(r=>r!==null&&r.length>Bu(n)),"isMaxBufferSync"),xx=i((e,t,n)=>{if(!t)return e;const r=Bu(n);return e.length>r?e.slice(0,r):e},"truncateMaxBufferSync"),Bu=i(([,e])=>e,"getMaxBufferSync"),Sx=i(({stdio:e,all:t,ipcOutput:n,originalError:r,signal:o,signalDescription:s,exitCode:a,escapedCommand:l,timedOut:u,isCanceled:c,isGracefullyCanceled:d,isMaxBuffer:p,isForcefullyTerminated:h,forceKillAfterDelay:g,killSignal:f,maxBuffer:y,timeout:v,cwd:_})=>{const w=r?.code,D=kx({originalError:r,timedOut:u,timeout:v,isMaxBuffer:p,maxBuffer:y,errorCode:w,signal:o,signalDescription:s,exitCode:a,isCanceled:c,isGracefullyCanceled:d,isForcefullyTerminated:h,forceKillAfterDelay:g,killSignal:f}),E=Ax(r,_),I=E===void 0?"":`
${E}`,T=`${D}: ${l}${I}`,$=t===void 0?[e[2],e[1]]:[t],x=[T,...$,...e.slice(3),n.map(j=>Tx(j)).join(`
`)].map(j=>su(Tu(Fx(j)))).filter(Boolean).join(`

`);return{originalMessage:E,shortMessage:T,message:x}},"createMessages"),kx=i(({originalError:e,timedOut:t,timeout:n,isMaxBuffer:r,maxBuffer:o,errorCode:s,signal:a,signalDescription:l,exitCode:u,isCanceled:c,isGracefullyCanceled:d,isForcefullyTerminated:p,forceKillAfterDelay:h,killSignal:g})=>{const f=Ix(p,h);return t?`Command timed out after ${n} milliseconds${f}`:d?a===void 0?`Command was gracefully canceled with exit code ${u}`:p?`Command was gracefully canceled${f}`:`Command was gracefully canceled with ${a} (${l})`:c?`Command was canceled${f}`:r?`${Ex(e,o)}${f}`:s!==void 0?`Command failed with ${s}${f}`:p?`Command was killed with ${g} (${mh(g)})${f}`:a!==void 0?`Command was killed with ${a} (${l})`:u!==void 0?`Command failed with exit code ${u}`:"Command failed"},"getErrorPrefix"),Ix=i((e,t)=>e?` and was forcefully terminated after ${t} milliseconds`:"","getForcefulSuffix"),Ax=i((e,t)=>{if(e instanceof Yn)return;const n=sC(e)?e.originalMessage:String(e?.message??e),r=su(R$(n,t));return r===""?void 0:r},"getOriginalMessage"),Tx=i(e=>typeof e=="string"?e:wf(e),"serializeIpcMessage"),Fx=i(e=>Array.isArray(e)?e.map(t=>Tu(rg(t))).filter(Boolean).join(`
`):rg(e),"serializeMessagePart"),rg=i(e=>typeof e=="string"?e:Gt(e)?Im(e):"","serializeMessageItem"),og=i(({command:e,escapedCommand:t,stdio:n,all:r,ipcOutput:o,options:{cwd:s},startTime:a})=>sg({command:e,escapedCommand:t,cwd:s,durationMs:Gm(a),failed:!1,timedOut:!1,isCanceled:!1,isGracefullyCanceled:!1,isTerminated:!1,isMaxBuffer:!1,isForcefullyTerminated:!1,exitCode:0,stdout:n[1],stderr:n[2],all:r,stdio:n,ipcOutput:o,pipedFrom:[]}),"makeSuccessResult"),ju=i(({error:e,command:t,escapedCommand:n,fileDescriptors:r,options:o,startTime:s,isSync:a})=>Lu({error:e,command:t,escapedCommand:n,startTime:s,timedOut:!1,isCanceled:!1,isGracefullyCanceled:!1,isMaxBuffer:!1,isForcefullyTerminated:!1,stdio:Array.from({length:r.length}),ipcOutput:[],options:o,isSync:a}),"makeEarlyError"),Lu=i(({error:e,command:t,escapedCommand:n,startTime:r,timedOut:o,isCanceled:s,isGracefullyCanceled:a,isMaxBuffer:l,isForcefullyTerminated:u,exitCode:c,signal:d,stdio:p,all:h,ipcOutput:g,options:{timeoutDuration:f,timeout:y=f,forceKillAfterDelay:v,killSignal:_,cwd:w,maxBuffer:D},isSync:E})=>{const{exitCode:I,signal:T,signalDescription:$}=Rx(c,d),{originalMessage:x,shortMessage:j,message:S}=Sx({stdio:p,all:h,ipcOutput:g,originalError:e,signal:T,signalDescription:$,exitCode:I,escapedCommand:n,timedOut:o,isCanceled:s,isGracefullyCanceled:a,isMaxBuffer:l,isForcefullyTerminated:u,forceKillAfterDelay:v,killSignal:_,maxBuffer:D,timeout:y,cwd:w}),Z=oC(e,S,E);return Object.assign(Z,Ox({error:Z,command:t,escapedCommand:n,startTime:r,timedOut:o,isCanceled:s,isGracefullyCanceled:a,isMaxBuffer:l,isForcefullyTerminated:u,exitCode:I,signal:T,signalDescription:$,stdio:p,all:h,ipcOutput:g,cwd:w,originalMessage:x,shortMessage:j})),Z},"makeError"),Ox=i(({error:e,command:t,escapedCommand:n,startTime:r,timedOut:o,isCanceled:s,isGracefullyCanceled:a,isMaxBuffer:l,isForcefullyTerminated:u,exitCode:c,signal:d,signalDescription:p,stdio:h,all:g,ipcOutput:f,cwd:y,originalMessage:v,shortMessage:_})=>sg({shortMessage:_,originalMessage:v,command:t,escapedCommand:n,cwd:y,durationMs:Gm(r),failed:!0,timedOut:o,isCanceled:s,isGracefullyCanceled:a,isTerminated:d!==void 0,isMaxBuffer:l,isForcefullyTerminated:u,exitCode:c,signal:d,signalDescription:p,code:e.cause?.code,stdout:h[1],stderr:h[2],all:g,stdio:h,ipcOutput:f,pipedFrom:[]}),"getErrorProperties"),sg=i(e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),"omitUndefinedProperties"),Rx=i((e,t)=>{const n=e===null?void 0:e,r=t===null?void 0:t,o=r===void 0?void 0:mh(t);return{exitCode:n,signal:r,signalDescription:o}},"normalizeExitPayload"),ig=i(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function Px(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(ig(e*1e3)%1e3),nanoseconds:Math.trunc(ig(e*1e6)%1e3)}}i(Px,"parseNumber");function Mx(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}i(Mx,"parseBigint");function Nx(e){switch(typeof e){case"number":{if(Number.isFinite(e))return Px(e);break}case"bigint":return Mx(e)}throw new TypeError("Expected a finite number or bigint")}i(Nx,"parseMilliseconds");const Bx=i(e=>e===0||e===0n,"isZero"),jx=i((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),Lx=1e-7,Ux=24n*60n*60n*1000n;function zx(e,t){const n=typeof e=="bigint";if(!n&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const r=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let o=[];const s=i((d,p)=>{const h=Math.floor(d*10**p+Lx);return(Math.round(h)/10**p).toFixed(p)},"floorDecimals"),a=i((d,p,h,g)=>{if(!((o.length===0||!t.colonNotation)&&Bx(d)&&!(t.colonNotation&&h==="m"))){if(g??(g=String(d)),t.colonNotation){const f=g.includes(".")?g.split(".")[0].length:g.length,y=o.length>0?2:1;g="0".repeat(Math.max(0,y-f))+g}else g+=t.verbose?" "+jx(p,d):h;o.push(g)}},"add"),l=Nx(e),u=BigInt(l.days);if(t.hideYearAndDays?a(BigInt(u)*24n+BigInt(l.hours),"hour","h"):(t.hideYear?a(u,"day","d"):(a(u/365n,"year","y"),a(u%365n,"day","d")),a(Number(l.hours),"hour","h")),a(Number(l.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const d=Number(l.seconds),p=Number(l.milliseconds),h=Number(l.microseconds),g=Number(l.nanoseconds);if(a(d,"second","s"),t.formatSubMilliseconds)a(p,"millisecond","ms"),a(h,"microsecond","\xB5s"),a(g,"nanosecond","ns");else{const f=p+h/1e3+g/1e6,y=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,v=f>=1?Math.round(f):Math.ceil(f),_=y?f.toFixed(y):v;a(Number.parseFloat(_),"millisecond","ms",_)}}else{const d=(n?Number(e%Ux):e)/1e3%60,p=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=s(d,p),g=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");a(Number.parseFloat(g),"second","s",g)}if(o.length===0)return r+"0"+(t.verbose?" milliseconds":"ms");const c=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(o=o.slice(0,Math.max(t.unitCount,1))),r+o.join(c)}i(zx,"prettyMilliseconds");const qx=i((e,t)=>{e.failed&&_s({type:"error",verboseMessage:e.shortMessage,verboseInfo:t,result:e})},"logError"),Vx=i((e,t)=>{eu(t)&&(qx(e,t),Gx(e,t))},"logResult"),Gx=i((e,t)=>{const n=`(done in ${zx(e.durationMs)})`;_s({type:"duration",verboseMessage:n,verboseInfo:t,result:e})},"logDuration"),Uu=i((e,t,{reject:n})=>{if(Vx(e,t),e.failed&&n)throw e;return e},"handleResult$1"),Zx=i((e,t)=>Tr(e)?"asyncGenerator":dg(e)?"generator":qu(e)?"fileUrl":Xx(e)?"filePath":nS(e)?"webStream":er(e,{checkOpen:!1})?"native":Gt(e)?"uint8Array":rS(e)?"asyncIterable":oS(e)?"iterable":Gu(e)?ag({},t):Kx(e)?Wx(e,t):"native","getStdioItemType"),Wx=i((e,t)=>jh(e.transform,{checkOpen:!1})?Hx(e,t):Gu(e.transform)?ag(e,t):Jx(e,t),"getTransformObjectType"),Hx=i((e,t)=>(lg(e,t,"Duplex stream"),"duplex"),"getDuplexType"),ag=i((e,t)=>(lg(e,t,"web TransformStream"),"webTransform"),"getTransformStreamType"),lg=i(({final:e,binary:t,objectMode:n},r,o)=>{ug(e,`${r}.final`,o),ug(t,`${r}.binary`,o),zu(n,`${r}.objectMode`)},"validateNonGeneratorType"),ug=i((e,t,n)=>{if(e!==void 0)throw new TypeError(`The \`${t}\` option can only be defined when using a generator, not a ${n}.`)},"checkUndefinedOption"),Jx=i(({transform:e,final:t,binary:n,objectMode:r},o)=>{if(e!==void 0&&!cg(e))throw new TypeError(`The \`${o}.transform\` option must be a generator, a Duplex stream or a web TransformStream.`);if(jh(t,{checkOpen:!1}))throw new TypeError(`The \`${o}.final\` option must not be a Duplex stream.`);if(Gu(t))throw new TypeError(`The \`${o}.final\` option must not be a web TransformStream.`);if(t!==void 0&&!cg(t))throw new TypeError(`The \`${o}.final\` option must be a generator.`);return zu(n,`${o}.binary`),zu(r,`${o}.objectMode`),Tr(e)||Tr(t)?"asyncGenerator":"generator"},"getGeneratorObjectType"),zu=i((e,t)=>{if(e!==void 0&&typeof e!="boolean")throw new TypeError(`The \`${t}\` option must use a boolean.`)},"checkBooleanOption"),cg=i(e=>Tr(e)||dg(e),"isGenerator"),Tr=i(e=>Object.prototype.toString.call(e)==="[object AsyncGeneratorFunction]","isAsyncGenerator"),dg=i(e=>Object.prototype.toString.call(e)==="[object GeneratorFunction]","isSyncGenerator"),Kx=i(e=>jt(e)&&(e.transform!==void 0||e.final!==void 0),"isTransformOptions"),qu=i(e=>Object.prototype.toString.call(e)==="[object URL]","isUrl"),Yx=i(e=>qu(e)&&e.protocol!=="file:","isRegularUrl"),Xx=i(e=>jt(e)&&Object.keys(e).length>0&&Object.keys(e).every(t=>Qx.has(t))&&pg(e.file),"isFilePathObject"),Qx=new Set(["file","append"]),pg=i(e=>typeof e=="string","isFilePathString"),eS=i((e,t)=>e==="native"&&typeof t=="string"&&!tS.has(t),"isUnknownStdioString"),tS=new Set(["ipc","ignore","inherit","overlapped","pipe"]),fg=i(e=>Object.prototype.toString.call(e)==="[object ReadableStream]","isReadableStream"),Vu=i(e=>Object.prototype.toString.call(e)==="[object WritableStream]","isWritableStream"),nS=i(e=>fg(e)||Vu(e),"isWebStream"),Gu=i(e=>fg(e?.readable)&&Vu(e?.writable),"isTransformStream"),rS=i(e=>mg(e)&&typeof e[Symbol.asyncIterator]=="function","isAsyncIterableObject"),oS=i(e=>mg(e)&&typeof e[Symbol.iterator]=="function","isIterableObject"),mg=i(e=>typeof e=="object"&&e!==null,"isObject$1"),rr=new Set(["generator","asyncGenerator","duplex","webTransform"]),hg=new Set(["fileUrl","filePath","fileNumber"]),gg=new Set(["fileUrl","filePath"]),sS=new Set([...gg,"webStream","nodeStream"]),iS=new Set(["webTransform","duplex"]),Xi={generator:"a generator",asyncGenerator:"an async generator",fileUrl:"a file URL",filePath:"a file path string",fileNumber:"a file descriptor number",webStream:"a web stream",nodeStream:"a Node.js stream",webTransform:"a web TransformStream",duplex:"a Duplex stream",native:"any value",iterable:"an iterable",asyncIterable:"an async iterable",string:"a string",uint8Array:"a Uint8Array"},yg=i((e,t,n,r)=>r==="output"?aS(e,t,n):lS(e,t,n),"getTransformObjectModes"),aS=i((e,t,n)=>{const r=t!==0&&n[t-1].value.readableObjectMode;return{writableObjectMode:r,readableObjectMode:e??r}},"getOutputObjectModes"),lS=i((e,t,n)=>{const r=t===0?e===!0:n[t-1].value.readableObjectMode,o=t!==n.length-1&&(e??r);return{writableObjectMode:r,readableObjectMode:o}},"getInputObjectModes"),uS=i((e,t)=>{const n=e.findLast(({type:r})=>rr.has(r));return n===void 0?!1:t==="input"?n.value.writableObjectMode:n.value.readableObjectMode},"getFdObjectMode"),cS=i((e,t,n,r)=>[...e.filter(({type:o})=>!rr.has(o)),...dS(e,t,n,r)],"normalizeTransforms"),dS=i((e,t,n,{encoding:r})=>{const o=e.filter(({type:a})=>rr.has(a)),s=Array.from({length:o.length});for(const[a,l]of Object.entries(o))s[a]=pS({stdioItem:l,index:Number(a),newTransforms:s,optionName:t,direction:n,encoding:r});return gS(s,n)},"getTransforms"),pS=i(({stdioItem:e,stdioItem:{type:t},index:n,newTransforms:r,optionName:o,direction:s,encoding:a})=>t==="duplex"?fS({stdioItem:e,optionName:o}):t==="webTransform"?mS({stdioItem:e,index:n,newTransforms:r,direction:s}):hS({stdioItem:e,index:n,newTransforms:r,direction:s,encoding:a}),"normalizeTransform"),fS=i(({stdioItem:e,stdioItem:{value:{transform:t,transform:{writableObjectMode:n,readableObjectMode:r},objectMode:o=r}},optionName:s})=>{if(o&&!r)throw new TypeError(`The \`${s}.objectMode\` option can only be \`true\` if \`new Duplex({objectMode: true})\` is used.`);if(!o&&r)throw new TypeError(`The \`${s}.objectMode\` option cannot be \`false\` if \`new Duplex({objectMode: true})\` is used.`);return{...e,value:{transform:t,writableObjectMode:n,readableObjectMode:r}}},"normalizeDuplex"),mS=i(({stdioItem:e,stdioItem:{value:t},index:n,newTransforms:r,direction:o})=>{const{transform:s,objectMode:a}=jt(t)?t:{transform:t},{writableObjectMode:l,readableObjectMode:u}=yg(a,n,r,o);return{...e,value:{transform:s,writableObjectMode:l,readableObjectMode:u}}},"normalizeTransformStream"),hS=i(({stdioItem:e,stdioItem:{value:t},index:n,newTransforms:r,direction:o,encoding:s})=>{const{transform:a,final:l,binary:u=!1,preserveNewlines:c=!1,objectMode:d}=jt(t)?t:{transform:t},p=u||Qn.has(s),{writableObjectMode:h,readableObjectMode:g}=yg(d,n,r,o);return{...e,value:{transform:a,final:l,binary:p,preserveNewlines:c,writableObjectMode:h,readableObjectMode:g}}},"normalizeGenerator"),gS=i((e,t)=>t==="input"?e.reverse():e,"sortTransforms"),yS=i((e,t,n)=>{const r=e.map(o=>vS(o,t));if(r.includes("input")&&r.includes("output"))throw new TypeError(`The \`${n}\` option must not be an array of both readable and writable values.`);return r.find(Boolean)??wS},"getStreamDirection"),vS=i(({type:e,value:t},n)=>_S[n]??vg[e](t),"getStdioItemDirection"),_S=["input","output","output"],Fr=i(()=>{},"anyDirection"),Zu=i(()=>"input","alwaysInput"),vg={generator:Fr,asyncGenerator:Fr,fileUrl:Fr,filePath:Fr,iterable:Zu,asyncIterable:Zu,uint8Array:Zu,webStream:i(e=>Vu(e)?"output":"input","webStream"),nodeStream(e){return Hi(e,{checkOpen:!1})?Bh(e,{checkOpen:!1})?void 0:"input":"output"},webTransform:Fr,duplex:Fr,native(e){const t=bS(e);if(t!==void 0)return t;if(er(e,{checkOpen:!1}))return vg.nodeStream(e)}},bS=i(e=>{if([0,Se.stdin].includes(e))return"input";if([1,2,Se.stdout,Se.stderr].includes(e))return"output"},"getStandardStreamDirection"),wS="output",DS=i((e,t)=>t&&!e.includes("ipc")?[...e,"ipc"]:e,"normalizeIpcStdioArray"),ES=i(({stdio:e,ipc:t,buffer:n,...r},o,s)=>{const a=CS(e,r).map((l,u)=>_g(l,u));return s?xS(a,n,o):DS(a,t)},"normalizeStdioOption"),CS=i((e,t)=>{if(e===void 0)return ln.map(r=>t[r]);if($S(t))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${ln.map(r=>`\`${r}\``).join(", ")}`);if(typeof e=="string")return[e,e,e];if(!Array.isArray(e))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof e}\``);const n=Math.max(e.length,ln.length);return Array.from({length:n},(r,o)=>e[o])},"getStdioArray"),$S=i(e=>ln.some(t=>e[t]!==void 0),"hasAlias"),_g=i((e,t)=>Array.isArray(e)?e.map(n=>_g(n,t)):e??(t>=ln.length?"ignore":"pipe"),"addDefaultValue"),xS=i((e,t,n)=>e.map((r,o)=>!t[o]&&o!==0&&!tu(n,o)&&SS(r)?"ignore":r),"normalizeStdioSync"),SS=i(e=>e==="pipe"||Array.isArray(e)&&e.every(t=>t==="pipe"),"isOutputPipeOnly"),kS=i(({stdioItem:e,stdioItem:{type:t},isStdioArray:n,fdNumber:r,direction:o,isSync:s})=>!n||t!=="native"?e:s?IS({stdioItem:e,fdNumber:r,direction:o}):FS({stdioItem:e,fdNumber:r}),"handleNativeStream"),IS=i(({stdioItem:e,stdioItem:{value:t,optionName:n},fdNumber:r,direction:o})=>{const s=AS({value:t,optionName:n,fdNumber:r,direction:o});if(s!==void 0)return s;if(er(t,{checkOpen:!1}))throw new TypeError(`The \`${n}: Stream\` option cannot both be an array and include a stream with synchronous methods.`);return e},"handleNativeStreamSync"),AS=i(({value:e,optionName:t,fdNumber:n,direction:r})=>{const o=TS(e,n);if(o!==void 0){if(r==="output")return{type:"fileNumber",value:o,optionName:t};if($f.isatty(o))throw new TypeError(`The \`${t}: ${Cu(e)}\` option is invalid: it cannot be a TTY with synchronous methods.`);return{type:"uint8Array",value:ys(Ml(o)),optionName:t}}},"getTargetFd"),TS=i((e,t)=>{if(e==="inherit")return t;if(typeof e=="number")return e;const n=Ql.indexOf(e);if(n!==-1)return n},"getTargetFdNumber"),FS=i(({stdioItem:e,stdioItem:{value:t,optionName:n},fdNumber:r})=>t==="inherit"?{type:"nodeStream",value:bg(r,t,n),optionName:n}:typeof t=="number"?{type:"nodeStream",value:bg(t,t,n),optionName:n}:er(t,{checkOpen:!1})?{type:"nodeStream",value:t,optionName:n}:e,"handleNativeStreamAsync"),bg=i((e,t,n)=>{const r=Ql[e];if(r===void 0)throw new TypeError(`The \`${n}: ${t}\` option is invalid: no such standard stream.`);return r},"getStandardStream"),OS=i(({input:e,inputFile:t},n)=>n===0?[...RS(e),...MS(t)]:[],"handleInputOptions"),RS=i(e=>e===void 0?[]:[{type:PS(e),value:e,optionName:"input"}],"handleInputOption"),PS=i(e=>{if(Hi(e,{checkOpen:!1}))return"nodeStream";if(typeof e=="string")return"string";if(Gt(e))return"uint8Array";throw new Error("The `input` option must be a string, a Uint8Array or a Node.js Readable stream.")},"getInputType"),MS=i(e=>e===void 0?[]:[{...NS(e),optionName:"inputFile"}],"handleInputFileOption"),NS=i(e=>{if(qu(e))return{type:"fileUrl",value:e};if(pg(e))return{type:"filePath",value:{file:e}};throw new Error("The `inputFile` option must be a file path string or a file URL.")},"getInputFileType"),BS=i(e=>e.filter((t,n)=>e.every((r,o)=>t.value!==r.value||n>=o||t.type==="generator"||t.type==="asyncGenerator")),"filterDuplicates"),jS=i(({stdioItem:{type:e,value:t,optionName:n},direction:r,fileDescriptors:o,isSync:s})=>{const a=LS(o,e);if(a.length!==0){if(s){US({otherStdioItems:a,type:e,value:t,optionName:n,direction:r});return}if(sS.has(e))return wg({otherStdioItems:a,type:e,value:t,optionName:n,direction:r});iS.has(e)&&qS({otherStdioItems:a,type:e,value:t,optionName:n})}},"getDuplicateStream"),LS=i((e,t)=>e.flatMap(({direction:n,stdioItems:r})=>r.filter(o=>o.type===t).map((o=>({...o,direction:n})))),"getOtherStdioItems"),US=i(({otherStdioItems:e,type:t,value:n,optionName:r,direction:o})=>{gg.has(t)&&wg({otherStdioItems:e,type:t,value:n,optionName:r,direction:o})},"validateDuplicateStreamSync"),wg=i(({otherStdioItems:e,type:t,value:n,optionName:r,direction:o})=>{const s=e.filter(l=>zS(l,n));if(s.length===0)return;const a=s.find(l=>l.direction!==o);return Dg(a,r,t),o==="output"?s[0].stream:void 0},"getDuplicateStreamInstance"),zS=i(({type:e,value:t},n)=>e==="filePath"?t.file===n.file:e==="fileUrl"?t.href===n.href:t===n,"hasSameValue"),qS=i(({otherStdioItems:e,type:t,value:n,optionName:r})=>{const o=e.find(({value:{transform:s}})=>s===n.transform);Dg(o,r,t)},"validateDuplicateTransform"),Dg=i((e,t,n)=>{if(e!==void 0)throw new TypeError(`The \`${e.optionName}\` and \`${t}\` options must not target ${Xi[n]} that is the same.`)},"throwOnDuplicateStream"),Eg=i((e,t,n,r)=>{const s=ES(t,n,r).map((l,u)=>VS({stdioOption:l,fdNumber:u,options:t,isSync:r})),a=XS({initialFileDescriptors:s,addProperties:e,options:t,isSync:r});return t.stdio=a.map(({stdioItems:l})=>tk(l)),a},"handleStdio"),VS=i(({stdioOption:e,fdNumber:t,options:n,isSync:r})=>{const o=Rm(t),{stdioItems:s,isStdioArray:a}=GS({stdioOption:e,fdNumber:t,options:n,optionName:o}),l=yS(s,t,o),u=s.map(p=>kS({stdioItem:p,isStdioArray:a,fdNumber:t,direction:l,isSync:r})),c=cS(u,o,l,n),d=uS(c,l);return YS(c,d),{direction:l,objectMode:d,stdioItems:c}},"getFileDescriptor"),GS=i(({stdioOption:e,fdNumber:t,options:n,optionName:r})=>{const s=[...(Array.isArray(e)?e:[e]).map(u=>ZS(u,r)),...OS(n,t)],a=BS(s),l=a.length>1;return WS(a,l,r),JS(a),{stdioItems:a,isStdioArray:l}},"initializeStdioItems"),ZS=i((e,t)=>({type:Zx(e,t),value:e,optionName:t}),"initializeStdioItem"),WS=i((e,t,n)=>{if(e.length===0)throw new TypeError(`The \`${n}\` option must not be an empty array.`);if(t){for(const{value:r,optionName:o}of e)if(HS.has(r))throw new Error(`The \`${o}\` option must not include \`${r}\`.`)}},"validateStdioArray"),HS=new Set(["ignore","ipc"]),JS=i(e=>{for(const t of e)KS(t)},"validateStreams"),KS=i(({type:e,value:t,optionName:n})=>{if(Yx(t))throw new TypeError(`The \`${n}: URL\` option must use the \`file:\` scheme.
For example, you can use the \`pathToFileURL()\` method of the \`url\` core module.`);if(eS(e,t))throw new TypeError(`The \`${n}: { file: '...' }\` option must be used instead of \`${n}: '...'\`.`)},"validateFileStdio"),YS=i((e,t)=>{if(!t)return;const n=e.find(({type:r})=>hg.has(r));if(n!==void 0)throw new TypeError(`The \`${n.optionName}\` option cannot use both files and transforms in objectMode.`)},"validateFileObjectMode"),XS=i(({initialFileDescriptors:e,addProperties:t,options:n,isSync:r})=>{const o=[];try{for(const s of e)o.push(QS({fileDescriptor:s,fileDescriptors:o,addProperties:t,options:n,isSync:r}));return o}catch(s){throw Cg(o),s}},"getFinalFileDescriptors"),QS=i(({fileDescriptor:{direction:e,objectMode:t,stdioItems:n},fileDescriptors:r,addProperties:o,options:s,isSync:a})=>{const l=n.map(u=>ek({stdioItem:u,addProperties:o,direction:e,options:s,fileDescriptors:r,isSync:a}));return{direction:e,objectMode:t,stdioItems:l}},"getFinalFileDescriptor"),ek=i(({stdioItem:e,addProperties:t,direction:n,options:r,fileDescriptors:o,isSync:s})=>{const a=jS({stdioItem:e,direction:n,fileDescriptors:o,isSync:s});return a!==void 0?{...e,stream:a}:{...e,...t[n][e.type](e,r)}},"addStreamProperties"),Cg=i(e=>{for(const{stdioItems:t}of e)for(const{stream:n}of t)n!==void 0&&!Jn(n)&&n.destroy()},"cleanupCustomStreams"),tk=i(e=>{if(e.length>1)return e.some(({value:r})=>r==="overlapped")?"overlapped":"pipe";const[{type:t,value:n}]=e;return t==="native"?n:"pipe"},"forwardStdio"),nk=i((e,t)=>Eg(ok,e,t,!0),"handleStdioSync"),cn=i(({type:e,optionName:t})=>{$g(t,Xi[e])},"forbiddenIfSync"),rk=i(({optionName:e,value:t})=>((t==="ipc"||t==="overlapped")&&$g(e,`"${t}"`),{}),"forbiddenNativeIfSync"),$g=i((e,t)=>{throw new TypeError(`The \`${e}\` option cannot be ${t} with synchronous methods.`)},"throwInvalidSyncValue"),xg={generator(){},asyncGenerator:cn,webStream:cn,nodeStream:cn,webTransform:cn,duplex:cn,asyncIterable:cn,native:rk},ok={input:{...xg,fileUrl:i(({value:e})=>({contents:[ys(Ml(e))]}),"fileUrl"),filePath:i(({value:{file:e}})=>({contents:[ys(Ml(e))]}),"filePath"),fileNumber:cn,iterable:i(({value:e})=>({contents:[...e]}),"iterable"),string:i(({value:e})=>({contents:[e]}),"string"),uint8Array:i(({value:e})=>({contents:[e]}),"uint8Array")},output:{...xg,fileUrl:i(({value:e})=>({path:e}),"fileUrl"),filePath:i(({value:{file:e,append:t}})=>({path:e,append:t}),"filePath"),fileNumber:i(({value:e})=>({path:e}),"fileNumber"),iterable:cn,string:cn,uint8Array:cn}},Or=i((e,{stripFinalNewline:t},n)=>Sg(t,n)&&e!==void 0&&!Array.isArray(e)?Tu(e):e,"stripNewline"),Sg=i((e,t)=>t==="all"?e[1]||e[2]:e[t],"getStripFinalNewline"),kg=i((e,t,n,r)=>e||n?void 0:Tg(t,r),"getSplitLinesGenerator"),Ig=i((e,t,n)=>n?e.flatMap(r=>Ag(r,t)):Ag(e,t),"splitLinesSync"),Ag=i((e,t)=>{const{transform:n,final:r}=Tg(t,{});return[...n(e),...r()]},"splitLinesItemSync"),Tg=i((e,t)=>(t.previousChunks="",{transform:sk.bind(void 0,t,e),final:ak.bind(void 0,t)}),"initializeSplitLines"),sk=i(function*(e,t,n){if(typeof n!="string"){yield n;return}let{previousChunks:r}=e,o=-1;for(let s=0;s<n.length;s+=1)if(n[s]===`
`){const a=ik(n,s,t,e);let l=n.slice(o+1,s+1-a);r.length>0&&(l=Wu(r,l),r=""),yield l,o=s}o!==n.length-1&&(r=Wu(r,n.slice(o+1))),e.previousChunks=r},"splitGenerator"),ik=i((e,t,n,r)=>n?0:(r.isWindowsNewline=t!==0&&e[t-1]==="\r",r.isWindowsNewline?2:1),"getNewlineLength"),ak=i(function*({previousChunks:e}){e.length>0&&(yield e)},"linesFinal"),lk=i(({binary:e,preserveNewlines:t,readableObjectMode:n,state:r})=>e||t||n?void 0:{transform:uk.bind(void 0,r)},"getAppendNewlineGenerator"),uk=i(function*({isWindowsNewline:e=!1},t){const{unixNewline:n,windowsNewline:r,LF:o,concatBytes:s}=typeof t=="string"?ck:pk;if(t.at(-1)===o){yield t;return}yield s(t,e?r:n)},"appendNewlineGenerator"),Wu=i((e,t)=>`${e}${t}`,"concatString"),ck={windowsNewline:`\r
`,unixNewline:`
`,LF:`
`,concatBytes:Wu},dk=i((e,t)=>{const n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},"concatUint8Array"),pk={windowsNewline:new Uint8Array([13,10]),unixNewline:new Uint8Array([10]),LF:10,concatBytes:dk},fk=i((e,t)=>e?void 0:mk.bind(void 0,t),"getValidateTransformInput"),mk=i(function*(e,t){if(typeof t!="string"&&!Gt(t)&&!jl.isBuffer(t))throw new TypeError(`The \`${e}\` option's transform must use "objectMode: true" to receive as input: ${typeof t}.`);yield t},"validateStringTransformInput"),hk=i((e,t)=>e?gk.bind(void 0,t):yk.bind(void 0,t),"getValidateTransformReturn"),gk=i(function*(e,t){Fg(e,t),yield t},"validateObjectTransformReturn"),yk=i(function*(e,t){if(Fg(e,t),typeof t!="string"&&!Gt(t))throw new TypeError(`The \`${e}\` option's function must yield a string or an Uint8Array, not ${typeof t}.`);yield t},"validateStringTransformReturn"),Fg=i((e,t)=>{if(t==null)throw new TypeError(`The \`${e}\` option's function must not call \`yield ${t}\`.
Instead, \`yield\` should either be called with a value, or not be called at all. For example:
  if (condition) { yield value; }`)},"validateEmptyReturn"),Og=i((e,t,n)=>{if(n)return;if(e)return{transform:vk.bind(void 0,new TextEncoder)};const r=new bf(t);return{transform:_k.bind(void 0,r),final:bk.bind(void 0,r)}},"getEncodingTransformGenerator"),vk=i(function*(e,t){jl.isBuffer(t)?yield ys(t):typeof t=="string"?yield e.encode(t):yield t},"encodingUint8ArrayGenerator"),_k=i(function*(e,t){yield Gt(t)?e.write(t):t},"encodingStringGenerator"),bk=i(function*(e){const t=e.end();t!==""&&(yield t)},"encodingStringFinal"),Rg=Ir(async(e,t,n,r)=>{t.currentIterable=e(...n);try{for await(const o of t.currentIterable)r.push(o)}finally{delete t.currentIterable}}),Hu=i(async function*(e,t,n){if(n===t.length){yield e;return}const{transform:r=Ck}=t[n];for await(const o of r(e))yield*Hu(o,t,n+1)},"transformChunk"),wk=i(async function*(e){for(const[t,{final:n}]of Object.entries(e))yield*Dk(n,Number(t),e)},"finalChunks"),Dk=i(async function*(e,t,n){if(e!==void 0)for await(const r of e())yield*Hu(r,n,t+1)},"generatorFinalChunks"),Ek=Ir(async({currentIterable:e},t)=>{if(e!==void 0){await(t?e.throw(t):e.return());return}if(t)throw t}),Ck=i(function*(e){yield e},"identityGenerator$1"),Pg=i((e,t,n,r)=>{try{for(const o of e(...t))n.push(o);r()}catch(o){r(o)}},"pushChunksSync"),$k=i((e,t)=>[...t.flatMap(n=>[...xs(n,e,0)]),...Ju(e)],"runTransformSync"),xs=i(function*(e,t,n){if(n===t.length){yield e;return}const{transform:r=Sk}=t[n];for(const o of r(e))yield*xs(o,t,n+1)},"transformChunkSync"),Ju=i(function*(e){for(const[t,{final:n}]of Object.entries(e))yield*xk(n,Number(t),e)},"finalChunksSync"),xk=i(function*(e,t,n){if(e!==void 0)for(const r of e())yield*xs(r,n,t+1)},"generatorFinalChunksSync"),Sk=i(function*(e){yield e},"identityGenerator"),Mg=i(({value:e,value:{transform:t,final:n,writableObjectMode:r,readableObjectMode:o},optionName:s},{encoding:a})=>{const l={},u=Bg(e,a,s),c=Tr(t),d=Tr(n),p=c?Rg.bind(void 0,Hu,l):Pg.bind(void 0,xs),h=c||d?Rg.bind(void 0,wk,l):Pg.bind(void 0,Ju),g=c||d?Ek.bind(void 0,l):void 0;return{stream:new $D({writableObjectMode:r,writableHighWaterMark:Ai(r),readableObjectMode:o,readableHighWaterMark:Ai(o),transform(y,v,_){p([y,u,0],this,_)},flush(y){h([u],this,y)},destroy:g})}},"generatorToStream"),Ng=i((e,t,n,r)=>{const o=t.filter(({type:a})=>a==="generator"),s=r?o.reverse():o;for(const{value:a,optionName:l}of s){const u=Bg(a,n,l);e=$k(u,e)}return e},"runGeneratorsSync"),Bg=i(({transform:e,final:t,binary:n,writableObjectMode:r,readableObjectMode:o,preserveNewlines:s},a,l)=>{const u={};return[{transform:fk(r,l)},Og(n,a,r),kg(n,s,r,u),{transform:e,final:t},{transform:hk(o,l)},lk({binary:n,preserveNewlines:s,readableObjectMode:o,state:u})].filter(Boolean)},"addInternalGenerators"),kk=i((e,t)=>{for(const n of Ik(e))Ak(e,n,t)},"addInputOptionsSync"),Ik=i(e=>new Set(Object.entries(e).filter(([,{direction:t}])=>t==="input").map(([t])=>Number(t))),"getInputFdNumbers"),Ak=i((e,t,n)=>{const{stdioItems:r}=e[t],o=r.filter(({contents:l})=>l!==void 0);if(o.length===0)return;if(t!==0){const[{type:l,optionName:u}]=o;throw new TypeError(`Only the \`stdin\` option, not \`${u}\`, can be ${Xi[l]} with synchronous methods.`)}const a=o.map(({contents:l})=>l).map(l=>Tk(l,r));n.input=Xl(a)},"addInputOptionSync"),Tk=i((e,t)=>{const n=Ng(e,t,"utf8",!0);return Fk(n),Xl(n)},"applySingleInputGeneratorsSync"),Fk=i(e=>{const t=e.find(n=>typeof n!="string"&&!Gt(n));if(t!==void 0)throw new TypeError(`The \`stdin\` option is invalid: when passing objects as input, a transform must be used to serialize them to strings or Uint8Arrays: ${t}.`)},"validateSerializable"),jg=i(({stdioItems:e,encoding:t,verboseInfo:n,fdNumber:r})=>r!=="all"&&tu(n,r)&&!Qn.has(t)&&Ok(r)&&(e.some(({type:o,value:s})=>o==="native"&&Rk.has(s))||e.every(({type:o})=>rr.has(o))),"shouldLogOutput"),Ok=i(e=>e===1||e===2,"fdUsesVerbose"),Rk=new Set(["pipe","overlapped"]),Pk=i(async(e,t,n,r)=>{for await(const o of e)Nk(t)||Lg(o,n,r)},"logLines"),Mk=i((e,t,n)=>{for(const r of e)Lg(r,t,n)},"logLinesSync"),Nk=i(e=>e._readableState.pipes.length>0,"isPipingStream"),Lg=i((e,t,n)=>{const r=qm(e);_s({type:"output",verboseMessage:r,fdNumber:t,verboseInfo:n})},"logLine"),Bk=i(({fileDescriptors:e,syncResult:{output:t},options:n,isMaxBuffer:r,verboseInfo:o})=>{if(t===null)return{output:Array.from({length:3})};const s={},a=new Set([]);return{output:t.map((u,c)=>jk({result:u,fileDescriptors:e,fdNumber:c,state:s,outputFiles:a,isMaxBuffer:r,verboseInfo:o},n)),...s}},"transformOutputSync"),jk=i(({result:e,fileDescriptors:t,fdNumber:n,state:r,outputFiles:o,isMaxBuffer:s,verboseInfo:a},{buffer:l,encoding:u,lines:c,stripFinalNewline:d,maxBuffer:p})=>{if(e===null)return;const h=xx(e,s,p),g=ys(h),{stdioItems:f,objectMode:y}=t[n],v=Lk([g],f,u,r),{serializedResult:_,finalResult:w=_}=Uk({chunks:v,objectMode:y,encoding:u,lines:c,stripFinalNewline:d,fdNumber:n});zk({serializedResult:_,fdNumber:n,state:r,verboseInfo:a,encoding:u,stdioItems:f,objectMode:y});const D=l[n]?w:void 0;try{return r.error===void 0&&qk(_,f,o),D}catch(E){return r.error=E,D}},"transformOutputResultSync"),Lk=i((e,t,n,r)=>{try{return Ng(e,t,n,!1)}catch(o){return r.error=o,e}},"runOutputGeneratorsSync"),Uk=i(({chunks:e,objectMode:t,encoding:n,lines:r,stripFinalNewline:o,fdNumber:s})=>{if(t)return{serializedResult:e};if(n==="buffer")return{serializedResult:Xl(e)};const a=P2(e,n);return r[s]?{serializedResult:a,finalResult:Ig(a,!o[s],t)}:{serializedResult:a}},"serializeChunks"),zk=i(({serializedResult:e,fdNumber:t,state:n,verboseInfo:r,encoding:o,stdioItems:s,objectMode:a})=>{if(!jg({stdioItems:s,encoding:o,verboseInfo:r,fdNumber:t}))return;const l=Ig(e,!1,a);try{Mk(l,t,r)}catch(u){n.error??(n.error=u)}},"logOutputSync"),qk=i((e,t,n)=>{for(const{path:r,append:o}of t.filter(({type:s})=>hg.has(s))){const s=typeof r=="string"?r:r.toString();o||n.has(s)?ED(r,e):(n.add(s),CD(r,e))}},"writeToFiles"),Vk=i(([,e,t],n)=>{if(n.all)return e===void 0?t:t===void 0?e:Array.isArray(e)?Array.isArray(t)?[...e,...t]:[...e,Or(t,n,"all")]:Array.isArray(t)?[Or(e,n,"all"),...t]:Gt(e)&&Gt(t)?Am([e,t]):`${e}${t}`},"getAllSync"),Gk=i(async(e,t)=>{const[n,r]=await Zk(e);return t.isForcefullyTerminated??(t.isForcefullyTerminated=!1),[n,r]},"waitForExit"),Zk=i(async e=>{const[t,n]=await Promise.allSettled([wt(e,"spawn"),wt(e,"exit")]);return t.status==="rejected"?[]:n.status==="rejected"?Ug(e):n.value},"waitForExitOrError"),Ug=i(async e=>{try{return await wt(e,"exit")}catch{return Ug(e)}},"waitForSubprocessExit"),Wk=i(async e=>{const[t,n]=await e;if(!Hk(t,n)&&zg(t,n))throw new Yn;return[t,n]},"waitForSuccessfulExit"),Hk=i((e,t)=>e===void 0&&t===void 0,"isSubprocessErrorExit"),zg=i((e,t)=>e!==0||t!==null,"isFailedExit"),Jk=i(({error:e,status:t,signal:n,output:r},{maxBuffer:o})=>{const s=Kk(e,t,n),a=s?.code==="ETIMEDOUT",l=$x(s,r,o);return{resultError:s,exitCode:t,signal:n,timedOut:a,isMaxBuffer:l}},"getExitResultSync"),Kk=i((e,t,n)=>e!==void 0?e:zg(t,n)?new Yn:void 0,"getResultError"),Yk=i((e,t,n)=>{const{file:r,commandArguments:o,command:s,escapedCommand:a,startTime:l,verboseInfo:u,options:c,fileDescriptors:d}=Xk(e,t,n),p=tI({file:r,commandArguments:o,options:c,command:s,escapedCommand:a,verboseInfo:u,fileDescriptors:d,startTime:l});return Uu(p,u,c)},"execaCoreSync"),Xk=i((e,t,n)=>{const{command:r,escapedCommand:o,startTime:s,verboseInfo:a}=Zm(e,t,n),l=Qk(n),{file:u,commandArguments:c,options:d}=Rh(e,t,l);eI(d);const p=nk(d,a);return{file:u,commandArguments:c,command:r,escapedCommand:o,startTime:s,verboseInfo:a,options:d,fileDescriptors:p}},"handleSyncArguments"),Qk=i(e=>e.node&&!e.ipc?{...e,ipc:!1}:e,"normalizeSyncOptions"),eI=i(({ipc:e,ipcInput:t,detached:n,cancelSignal:r})=>{t&&Qi("ipcInput"),e&&Qi("ipc: true"),n&&Qi("detached: true"),r&&Qi("cancelSignal")},"validateSyncOptions"),Qi=i(e=>{throw new TypeError(`The "${e}" option cannot be used with synchronous methods.`)},"throwInvalidSyncOption"),tI=i(({file:e,commandArguments:t,options:n,command:r,escapedCommand:o,verboseInfo:s,fileDescriptors:a,startTime:l})=>{const u=nI({file:e,commandArguments:t,options:n,command:r,escapedCommand:o,fileDescriptors:a,startTime:l});if(u.failed)return u;const{resultError:c,exitCode:d,signal:p,timedOut:h,isMaxBuffer:g}=Jk(u,n),{output:f,error:y=c}=Bk({fileDescriptors:a,syncResult:u,options:n,isMaxBuffer:g,verboseInfo:s}),v=f.map((w,D)=>Or(w,n,D)),_=Or(Vk(f,n),n,"all");return oI({error:y,exitCode:d,signal:p,timedOut:h,isMaxBuffer:g,stdio:v,all:_,options:n,command:r,escapedCommand:o,startTime:l})},"spawnSubprocessSync"),nI=i(({file:e,commandArguments:t,options:n,command:r,escapedCommand:o,fileDescriptors:s,startTime:a})=>{try{kk(s,n);const l=rI(n);return sD(...Ph(e,t,l))}catch(l){return ju({error:l,command:r,escapedCommand:o,fileDescriptors:s,options:n,startTime:a,isSync:!0})}},"runSubprocessSync"),rI=i(({encoding:e,maxBuffer:t,...n})=>({...n,encoding:"buffer",maxBuffer:Bu(t)}),"normalizeSpawnSyncOptions"),oI=i(({error:e,exitCode:t,signal:n,timedOut:r,isMaxBuffer:o,stdio:s,all:a,options:l,command:u,escapedCommand:c,startTime:d})=>e===void 0?og({command:u,escapedCommand:c,stdio:s,all:a,ipcOutput:[],options:l,startTime:d}):Lu({error:e,command:u,escapedCommand:c,timedOut:r,isCanceled:!1,isGracefullyCanceled:!1,isMaxBuffer:o,isForcefullyTerminated:!1,exitCode:t,signal:n,stdio:s,all:a,ipcOutput:[],options:l,startTime:d,isSync:!0}),"getSyncResult"),sI=i(({anyProcess:e,channel:t,isSubprocess:n,ipc:r},{reference:o=!0,filter:s}={})=>(wu({methodName:"getOneMessage",isSubprocess:n,ipc:r,isConnected:$h(e)}),iI({anyProcess:e,channel:t,isSubprocess:n,filter:s,reference:o})),"getOneMessage"),iI=i(async({anyProcess:e,channel:t,isSubprocess:n,filter:r,reference:o})=>{Eh(t,o);const s=qi(e,t,n),a=new AbortController;try{return await Promise.race([aI(s,r,a),lI(s,n,a),uI(s,n,a)])}catch(l){throw Du(e),l}finally{a.abort(),Ch(t,o)}},"getOneMessageAsync"),aI=i(async(e,t,{signal:n})=>{if(t===void 0){const[r]=await wt(e,"message",{signal:n});return r}for await(const[r]of Ii(e,"message",{signal:n}))if(t(r))return r},"getMessage"),lI=i(async(e,t,{signal:n})=>{await wt(e,"disconnect",{signal:n}),OC(t)},"throwOnDisconnect"),uI=i(async(e,t,{signal:n})=>{const[r]=await wt(e,"strict:error",{signal:n});throw vh(r,t)},"throwOnStrictError"),cI=i(({anyProcess:e,channel:t,isSubprocess:n,ipc:r},{reference:o=!0}={})=>qg({anyProcess:e,channel:t,isSubprocess:n,ipc:r,shouldAwait:!n,reference:o}),"getEachMessage"),qg=i(({anyProcess:e,channel:t,isSubprocess:n,ipc:r,shouldAwait:o,reference:s})=>{wu({methodName:"getEachMessage",isSubprocess:n,ipc:r,isConnected:$h(e)}),Eh(t,s);const a=qi(e,t,n),l=new AbortController,u={};return dI(e,a,l),pI({ipcEmitter:a,isSubprocess:n,controller:l,state:u}),fI({anyProcess:e,channel:t,ipcEmitter:a,isSubprocess:n,shouldAwait:o,controller:l,state:u,reference:s})},"loopOnMessages"),dI=i(async(e,t,n)=>{try{await wt(t,"disconnect",{signal:n.signal}),n.abort()}catch{}},"stopOnDisconnect"),pI=i(async({ipcEmitter:e,isSubprocess:t,controller:n,state:r})=>{try{const[o]=await wt(e,"strict:error",{signal:n.signal});r.error=vh(o,t),n.abort()}catch{}},"abortOnStrictError"),fI=i(async function*({anyProcess:e,channel:t,ipcEmitter:n,isSubprocess:r,shouldAwait:o,controller:s,state:a,reference:l}){try{for await(const[u]of Ii(n,"message",{signal:s.signal}))Vg(a),yield u}catch{Vg(a)}finally{s.abort(),Ch(t,l),r||Du(e),o&&await e}},"iterateOnMessages"),Vg=i(({error:e})=>{if(e)throw e},"throwIfStrictError"),mI=i((e,{ipc:t})=>{Object.assign(e,Gg(e,!1,t))},"addIpcMethods"),hI=i(()=>{const e=Se,t=!0,n=Se.channel!==void 0;return{...Gg(e,t,n),getCancelSignal:f$.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:n})}},"getIpcExport"),Gg=i((e,t,n)=>({sendMessage:Sh.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:n}),getOneMessage:sI.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:n}),getEachMessage:cI.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:n})}),"getIpcMethods"),gI=i(({error:e,command:t,escapedCommand:n,fileDescriptors:r,options:o,startTime:s,verboseInfo:a})=>{Cg(r);const l=new _f;yI(l,r),Object.assign(l,{readable:vI,writable:_I,duplex:bI});const u=ju({error:e,command:t,escapedCommand:n,fileDescriptors:r,options:o,startTime:s,isSync:!1}),c=wI(u,a,o);return{subprocess:l,promise:c}},"handleEarlyError"),yI=i((e,t)=>{const n=Ss(),r=Ss(),o=Ss(),s=Array.from({length:t.length-3},Ss),a=Ss(),l=[n,r,o,...s];Object.assign(e,{stdin:n,stdout:r,stderr:o,all:a,stdio:l})},"createDummyStreams"),Ss=i(()=>{const e=new Pf;return e.end(),e},"createDummyStream"),vI=i(()=>new Wn({read(){}}),"readable"),_I=i(()=>new Bl({write(){}}),"writable"),bI=i(()=>new Nl({read(){},write(){}}),"duplex"),wI=i(async(e,t,n)=>Uu(e,t,n),"handleDummyPromise"),DI=i((e,t)=>Eg(EI,e,t,!1),"handleStdioAsync"),ks=i(({type:e,optionName:t})=>{throw new TypeError(`The \`${t}\` option cannot be ${Xi[e]}.`)},"forbiddenIfAsync"),Zg={fileNumber:ks,generator:Mg,asyncGenerator:Mg,nodeStream:i(({value:e})=>({stream:e}),"nodeStream"),webTransform({value:{transform:e,writableObjectMode:t,readableObjectMode:n}}){const r=t||n;return{stream:Nl.fromWeb(e,{objectMode:r})}},duplex:i(({value:{transform:e}})=>({stream:e}),"duplex"),native(){}},EI={input:{...Zg,fileUrl:i(({value:e})=>({stream:Rf(e)}),"fileUrl"),filePath:i(({value:{file:e}})=>({stream:Rf(e)}),"filePath"),webStream:i(({value:e})=>({stream:Wn.fromWeb(e)}),"webStream"),iterable:i(({value:e})=>({stream:Wn.from(e)}),"iterable"),asyncIterable:i(({value:e})=>({stream:Wn.from(e)}),"asyncIterable"),string:i(({value:e})=>({stream:Wn.from(e)}),"string"),uint8Array:i(({value:e})=>({stream:Wn.from(jl.from(e))}),"uint8Array")},output:{...Zg,fileUrl:i(({value:e})=>({stream:Of(e)}),"fileUrl"),filePath:i(({value:{file:e,append:t}})=>({stream:Of(e,t?{flags:"a"}:{})}),"filePath"),webStream:i(({value:e})=>({stream:Bl.fromWeb(e)}),"webStream"),iterable:ks,asyncIterable:ks,string:ks,uint8Array:ks}};var Wg=i(e=>{throw TypeError(e)},"__typeError$1"),Hg=i((e,t,n)=>t.has(e)||Wg("Cannot "+n),"__accessCheck$1"),Et=i((e,t,n)=>(Hg(e,t,"read from private field"),n?n.call(e):t.get(e)),"__privateGet$1"),Rr=i((e,t,n)=>t.has(e)?Wg("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),"__privateAdd$1"),CI=i((e,t,n,r)=>(Hg(e,t,"write to private field"),t.set(e,n),n),"__privateSet$1"),or,Ku,Yu,Is,ea,As;function Xu(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got \`${typeof e}\`.`);for(const o of e)ec(o);const t=e.some(({readableObjectMode:o})=>o),n=$I(e,t),r=new Qu({objectMode:t,writableHighWaterMark:n,readableHighWaterMark:n});for(const o of e)r.add(o);return r}i(Xu,"mergeStreams");const $I=i((e,t)=>{if(e.length===0)return Ai(t);const n=e.filter(({readableObjectMode:r})=>r===t).map(({readableHighWaterMark:r})=>r);return Math.max(...n)},"getHighWaterMark"),hp=class hp extends Pf{constructor(){super(...arguments),Rr(this,or,new Set([])),Rr(this,Ku,new Set([])),Rr(this,Yu,new Set([])),Rr(this,Is),Rr(this,ea,Symbol("unpipe")),Rr(this,As,new WeakMap)}add(t){if(ec(t),Et(this,or).has(t))return;Et(this,or).add(t),Et(this,Is)??CI(this,Is,xI(this,Et(this,or),Et(this,ea)));const n=II({passThroughStream:this,stream:t,streams:Et(this,or),ended:Et(this,Ku),aborted:Et(this,Yu),onFinished:Et(this,Is),unpipeEvent:Et(this,ea)});Et(this,As).set(t,n),t.pipe(this,{end:!1})}async remove(t){if(ec(t),!Et(this,or).has(t))return!1;const n=Et(this,As).get(t);return n===void 0?!1:(Et(this,As).delete(t),t.unpipe(this),await n,!0)}};i(hp,"MergedStream");let Qu=hp;or=new WeakMap,Ku=new WeakMap,Yu=new WeakMap,Is=new WeakMap,ea=new WeakMap,As=new WeakMap;const xI=i(async(e,t,n)=>{ta(e,Xg);const r=new AbortController;try{await Promise.race([SI(e,r),kI(e,t,n,r)])}finally{r.abort(),ta(e,-Xg)}},"onMergedStreamFinished"),SI=i(async(e,{signal:t})=>{try{await kn(e,{signal:t,cleanup:!0})}catch(n){throw Jg(e,n),n}},"onMergedStreamEnd"),kI=i(async(e,t,n,{signal:r})=>{for await(const[o]of Ii(e,"unpipe",{signal:r}))t.has(o)&&o.emit(n)},"onInputStreamsUnpipe"),ec=i(e=>{if(typeof e?.pipe!="function")throw new TypeError(`Expected a readable stream, got: \`${typeof e}\`.`)},"validateStream"),II=i(async({passThroughStream:e,stream:t,streams:n,ended:r,aborted:o,onFinished:s,unpipeEvent:a})=>{ta(e,Qg);const l=new AbortController;try{await Promise.race([AI(s,t,l),TI({passThroughStream:e,stream:t,streams:n,ended:r,aborted:o,controller:l}),FI({stream:t,streams:n,ended:r,aborted:o,unpipeEvent:a,controller:l})])}finally{l.abort(),ta(e,-Qg)}n.size>0&&n.size===r.size+o.size&&(r.size===0&&o.size>0?tc(e):OI(e))},"endWhenStreamsDone"),AI=i(async(e,t,{signal:n})=>{try{await e,n.aborted||tc(t)}catch(r){n.aborted||Jg(t,r)}},"afterMergedStreamFinished"),TI=i(async({passThroughStream:e,stream:t,streams:n,ended:r,aborted:o,controller:{signal:s}})=>{try{await kn(t,{signal:s,cleanup:!0,readable:!0,writable:!1}),n.has(t)&&r.add(t)}catch(a){if(s.aborted||!n.has(t))return;Kg(a)?o.add(t):Yg(e,a)}},"onInputStreamEnd"),FI=i(async({stream:e,streams:t,ended:n,aborted:r,unpipeEvent:o,controller:{signal:s}})=>{if(await wt(e,o,{signal:s}),!e.readable)return wt(s,"abort",{signal:s});t.delete(e),n.delete(e),r.delete(e)},"onInputStreamUnpipe"),OI=i(e=>{e.writable&&e.end()},"endStream"),Jg=i((e,t)=>{Kg(t)?tc(e):Yg(e,t)},"errorOrAbortStream"),Kg=i(e=>e?.code==="ERR_STREAM_PREMATURE_CLOSE","isAbortError$1"),tc=i(e=>{(e.readable||e.writable)&&e.destroy()},"abortStream"),Yg=i((e,t)=>{e.destroyed||(e.once("error",RI),e.destroy(t))},"errorStream"),RI=i(()=>{},"noop$1"),ta=i((e,t)=>{const n=e.getMaxListeners();n!==0&&n!==Number.POSITIVE_INFINITY&&e.setMaxListeners(n+t)},"updateMaxListeners"),Xg=2,Qg=1,na=i((e,t)=>{e.pipe(t),PI(e,t),MI(e,t)},"pipeStreams"),PI=i(async(e,t)=>{if(!(Jn(e)||Jn(t))){try{await kn(e,{cleanup:!0,readable:!0,writable:!1})}catch{}ey(t)}},"onSourceFinish"),ey=i(e=>{e.writable&&e.end()},"endDestinationStream"),MI=i(async(e,t)=>{if(!(Jn(e)||Jn(t))){try{await kn(t,{cleanup:!0,readable:!1,writable:!0})}catch{}ty(e)}},"onDestinationFinish"),ty=i(e=>{e.readable&&e.destroy()},"abortSourceStream"),NI=i((e,t,n)=>{const r=new Map;for(const[o,{stdioItems:s,direction:a}]of Object.entries(t)){for(const{stream:l}of s.filter(({type:u})=>rr.has(u)))BI(e,l,a,o);for(const{stream:l}of s.filter(({type:u})=>!rr.has(u)))LI({subprocess:e,stream:l,direction:a,fdNumber:o,pipeGroups:r,controller:n})}for(const[o,s]of r.entries()){const a=s.length===1?s[0]:Xu(s);na(a,o)}},"pipeOutputAsync"),BI=i((e,t,n,r)=>{n==="output"?na(e.stdio[r],t):na(t,e.stdio[r]);const o=jI[r];o!==void 0&&(e[o]=t),e.stdio[r]=t},"pipeTransform"),jI=["stdin","stdout","stderr"],LI=i(({subprocess:e,stream:t,direction:n,fdNumber:r,pipeGroups:o,controller:s})=>{if(t===void 0)return;UI(t,s);const[a,l]=n==="output"?[t,e.stdio[r]]:[e.stdio[r],t],u=o.get(a)??[];o.set(a,[...u,l])},"pipeStdioItem"),UI=i((e,{signal:t})=>{Jn(e)&&Ui(e,zI,t)},"setStandardStreamMaxListeners"),zI=2,Pr=[];Pr.push("SIGHUP","SIGINT","SIGTERM"),process.platform!=="win32"&&Pr.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),process.platform==="linux"&&Pr.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var qI=Object.defineProperty,ny=i(e=>{throw TypeError(e)},"__typeError"),VI=i((e,t,n)=>t in e?qI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,"__defNormalProp$1"),ra=i((e,t,n)=>VI(e,typeof t!="symbol"?t+"":t,n),"__publicField$1"),nc=i((e,t,n)=>t.has(e)||ny("Cannot "+n),"__accessCheck"),de=i((e,t,n)=>(nc(e,t,"read from private field"),n?n.call(e):t.get(e)),"__privateGet"),Fn=i((e,t,n)=>t.has(e)?ny("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),"__privateAdd"),Mr=i((e,t,n,r)=>(nc(e,t,"write to private field"),t.set(e,n),n),"__privateSet"),ry=i((e,t,n)=>(nc(e,t,"access private method"),n),"__privateMethod"),rc,Lt,Ye,Ts,Fs,Nr,sr,oa,oy,sy;const sa=i(e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function","processOk"),oc=Symbol.for("signal-exit emitter"),sc=globalThis,GI=Object.defineProperty.bind(Object),gp=class gp{constructor(){if(ra(this,"emitted",{afterExit:!1,exit:!1}),ra(this,"listeners",{afterExit:[],exit:[]}),ra(this,"count",0),ra(this,"id",Math.random()),sc[oc])return sc[oc];GI(sc,oc,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,n){this.listeners[t].push(n)}removeListener(t,n){const r=this.listeners[t],o=r.indexOf(n);o!==-1&&(o===0&&r.length===1?r.length=0:r.splice(o,1))}emit(t,n,r){if(this.emitted[t])return!1;this.emitted[t]=!0;let o=!1;for(const s of this.listeners[t])o=s(n,r)===!0||o;return t==="exit"&&(o=this.emit("afterExit",n,r)||o),o}};i(gp,"Emitter");let ic=gp;const yp=class yp{};i(yp,"SignalExitBase");let ia=yp;const ZI=i(e=>({onExit(t,n){return e.onExit(t,n)},load(){return e.load()},unload(){return e.unload()}}),"signalExitWrap"),vp=class vp extends ia{onExit(){return()=>{}}load(){}unload(){}};i(vp,"SignalExitFallback");let ac=vp;const _p=class _p extends ia{constructor(t){super(),Fn(this,oa),Fn(this,rc,uc.platform==="win32"?"SIGINT":"SIGHUP"),Fn(this,Lt,new ic),Fn(this,Ye),Fn(this,Ts),Fn(this,Fs),Fn(this,Nr,{}),Fn(this,sr,!1),Mr(this,Ye,t),Mr(this,Nr,{});for(const n of Pr)de(this,Nr)[n]=()=>{const r=de(this,Ye).listeners(n);let{count:o}=de(this,Lt);const s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(o+=s.__signal_exit_emitter__.count),r.length===o){this.unload();const a=de(this,Lt).emit("exit",null,n),l=n==="SIGHUP"?de(this,rc):n;a||t.kill(t.pid,l)}};Mr(this,Fs,t.reallyExit),Mr(this,Ts,t.emit)}onExit(t,n){if(!sa(de(this,Ye)))return()=>{};de(this,sr)===!1&&this.load();const r=n?.alwaysLast?"afterExit":"exit";return de(this,Lt).on(r,t),()=>{de(this,Lt).removeListener(r,t),de(this,Lt).listeners.exit.length===0&&de(this,Lt).listeners.afterExit.length===0&&this.unload()}}load(){if(!de(this,sr)){Mr(this,sr,!0),de(this,Lt).count+=1;for(const t of Pr)try{const n=de(this,Nr)[t];n&&de(this,Ye).on(t,n)}catch{}de(this,Ye).emit=(t,...n)=>ry(this,oa,sy).call(this,t,...n),de(this,Ye).reallyExit=t=>ry(this,oa,oy).call(this,t)}}unload(){de(this,sr)&&(Mr(this,sr,!1),Pr.forEach(t=>{const n=de(this,Nr)[t];if(!n)throw new Error("Listener not defined for signal: "+t);try{de(this,Ye).removeListener(t,n)}catch{}}),de(this,Ye).emit=de(this,Ts),de(this,Ye).reallyExit=de(this,Fs),de(this,Lt).count-=1)}};i(_p,"SignalExit");let lc=_p;rc=new WeakMap,Lt=new WeakMap,Ye=new WeakMap,Ts=new WeakMap,Fs=new WeakMap,Nr=new WeakMap,sr=new WeakMap,oa=new WeakSet,oy=i(function(e){return sa(de(this,Ye))?(de(this,Ye).exitCode=e||0,de(this,Lt).emit("exit",de(this,Ye).exitCode,null),de(this,Fs).call(de(this,Ye),de(this,Ye).exitCode)):0},"processReallyExit_fn"),sy=i(function(e,...t){const n=de(this,Ts);if(e==="exit"&&sa(de(this,Ye))){typeof t[0]=="number"&&(de(this,Ye).exitCode=t[0]);const r=n.call(de(this,Ye),e,...t);return de(this,Lt).emit("exit",de(this,Ye).exitCode,null),r}else return n.call(de(this,Ye),e,...t)},"processEmit_fn");const uc=globalThis.process,{onExit:WI}=ZI(sa(uc)?new lc(uc):new ac),HI=i((e,{cleanup:t,detached:n},{signal:r})=>{if(!t||n)return;const o=WI(()=>{e.kill()});Ff(r,()=>{o()})},"cleanupOnExit"),JI=i(({source:e,sourcePromise:t,boundOptions:n,createNested:r},...o)=>{const s=Vm(),{destination:a,destinationStream:l,destinationError:u,from:c,unpipeSignal:d}=KI(n,r,o),{sourceStream:p,sourceError:h}=XI(e,c),{options:g,fileDescriptors:f}=Xn.get(e);return{sourcePromise:t,sourceStream:p,sourceOptions:g,sourceError:h,destination:a,destinationStream:l,destinationError:u,unpipeSignal:d,fileDescriptors:f,startTime:s}},"normalizePipeArguments"),KI=i((e,t,n)=>{try{const{destination:r,pipeOptions:{from:o,to:s,unpipeSignal:a}={}}=YI(e,t,...n),l=_h(r,s);return{destination:r,destinationStream:l,from:o,unpipeSignal:a}}catch(r){return{destinationError:r}}},"getDestinationStream"),YI=i((e,t,n,...r)=>{if(Array.isArray(n))return{destination:t(iy,e)(n,...r),pipeOptions:e};if(typeof n=="string"||n instanceof URL||Cm(n)){if(Object.keys(e).length>0)throw new TypeError('Please use .pipe("file", ..., options) or .pipe(execa("file", ..., options)) instead of .pipe(options)("file", ...).');const[o,s,a]=xm(n,...r);return{destination:t(iy)(o,s,a),pipeOptions:a}}if(Xn.has(n)){if(Object.keys(e).length>0)throw new TypeError("Please use .pipe(options)`command` or .pipe($(options)`command`) instead of .pipe(options)($`command`).");return{destination:n,pipeOptions:r[0]}}throw new TypeError(`The first argument must be a template string, an options object, or an Execa subprocess: ${n}`)},"getDestination"),iy=i(({options:e})=>({options:{...e,stdin:"pipe",piped:!0}}),"mapDestinationArguments"),XI=i((e,t)=>{try{return{sourceStream:Eu(e,t)}}catch(n){return{sourceError:n}}},"getSourceStream"),QI=i(({sourceStream:e,sourceError:t,destinationStream:n,destinationError:r,fileDescriptors:o,sourceOptions:s,startTime:a})=>{const l=eA({sourceStream:e,sourceError:t,destinationStream:n,destinationError:r});if(l!==void 0)throw ay({error:l,fileDescriptors:o,sourceOptions:s,startTime:a})},"handlePipeArgumentsError"),eA=i(({sourceStream:e,sourceError:t,destinationStream:n,destinationError:r})=>{if(t!==void 0&&r!==void 0)return r;if(r!==void 0)return ty(e),r;if(t!==void 0)return ey(n),t},"getPipeArgumentsError"),ay=i(({error:e,fileDescriptors:t,sourceOptions:n,startTime:r})=>ju({error:e,command:ly,escapedCommand:ly,fileDescriptors:t,options:n,startTime:r,isSync:!1}),"createNonCommandError"),ly="source.pipe(destination)",tA=i(async e=>{const[{status:t,reason:n,value:r=n},{status:o,reason:s,value:a=s}]=await e;if(a.pipedFrom.includes(r)||a.pipedFrom.push(r),o==="rejected")throw a;if(t==="rejected")throw r;return a},"waitForBothSubprocesses"),nA=i((e,t,n)=>{const r=aa.has(t)?oA(e,t):rA(e,t);return Ui(e,iA,n.signal),Ui(t,aA,n.signal),sA(t),r},"pipeSubprocessStream"),rA=i((e,t)=>{const n=Xu([e]);return na(n,t),aa.set(t,n),n},"pipeFirstSubprocessStream"),oA=i((e,t)=>{const n=aa.get(t);return n.add(e),n},"pipeMoreSubprocessStream"),sA=i(async e=>{try{await kn(e,{cleanup:!0,readable:!1,writable:!0})}catch{}aa.delete(e)},"cleanupMergedStreamsMap"),aa=new WeakMap,iA=2,aA=1,lA=i((e,t)=>e===void 0?[]:[uA(e,t)],"unpipeOnAbort"),uA=i(async(e,{sourceStream:t,mergedStream:n,fileDescriptors:r,sourceOptions:o,startTime:s})=>{await uD(e,t),await n.remove(t);const a=new Error("Pipe canceled by `unpipeSignal` option.");throw ay({error:a,fileDescriptors:r,sourceOptions:o,startTime:s})},"unpipeOnSignalAbort"),cc=i((e,...t)=>{if(jt(t[0]))return cc.bind(void 0,{...e,boundOptions:{...e.boundOptions,...t[0]}});const{destination:n,...r}=JI(e,...t),o=cA({...r,destination:n});return o.pipe=cc.bind(void 0,{...e,source:n,sourcePromise:o,boundOptions:{}}),o},"pipeToSubprocess"),cA=i(async({sourcePromise:e,sourceStream:t,sourceOptions:n,sourceError:r,destination:o,destinationStream:s,destinationError:a,unpipeSignal:l,fileDescriptors:u,startTime:c})=>{const d=dA(e,o);QI({sourceStream:t,sourceError:r,destinationStream:s,destinationError:a,fileDescriptors:u,sourceOptions:n,startTime:c});const p=new AbortController;try{const h=nA(t,s,p);return await Promise.race([tA(d),...lA(l,{sourceStream:t,mergedStream:h,sourceOptions:n,fileDescriptors:u,startTime:c})])}finally{p.abort()}},"handlePipePromise"),dA=i((e,t)=>Promise.allSettled([e,t]),"getSubprocessPromises"),uy=i(({subprocessStdout:e,subprocess:t,binary:n,shouldEncode:r,encoding:o,preserveNewlines:s})=>{const a=new AbortController;return pA(t,a),dy({stream:e,controller:a,binary:n,shouldEncode:!e.readableObjectMode&&r,encoding:o,shouldSplit:!e.readableObjectMode,preserveNewlines:s})},"iterateOnSubprocessStream"),pA=i(async(e,t)=>{try{await e}catch{}finally{t.abort()}},"stopReadingOnExit"),cy=i(({stream:e,onStreamEnd:t,lines:n,encoding:r,stripFinalNewline:o,allMixed:s})=>{const a=new AbortController;fA(t,a,e);const l=e.readableObjectMode&&!s;return dy({stream:e,controller:a,binary:r==="buffer",shouldEncode:!l,encoding:r,shouldSplit:!l&&n,preserveNewlines:!o})},"iterateForResult"),fA=i(async(e,t,n)=>{try{await e}catch{n.destroy()}finally{t.abort()}},"stopReadingOnStreamEnd"),dy=i(({stream:e,controller:t,binary:n,shouldEncode:r,encoding:o,shouldSplit:s,preserveNewlines:a})=>{const l=Ii(e,"data",{signal:t.signal,highWaterMark:fy,highWatermark:fy});return mA({onStdoutChunk:l,controller:t,binary:n,shouldEncode:r,encoding:o,shouldSplit:s,preserveNewlines:a})},"iterateOnStream"),py=Ai(!0),fy=py,mA=i(async function*({onStdoutChunk:e,controller:t,binary:n,shouldEncode:r,encoding:o,shouldSplit:s,preserveNewlines:a}){const l=hA({binary:n,shouldEncode:r,encoding:o,shouldSplit:s,preserveNewlines:a});try{for await(const[u]of e)yield*xs(u,l,0)}catch(u){if(!t.signal.aborted)throw u}finally{yield*Ju(l)}},"iterateOnData"),hA=i(({binary:e,shouldEncode:t,encoding:n,shouldSplit:r,preserveNewlines:o})=>[Og(e,n,!t),kg(e,o,!r,{})].filter(Boolean),"getGenerators"),gA=i(async({stream:e,onStreamEnd:t,fdNumber:n,encoding:r,buffer:o,maxBuffer:s,lines:a,allMixed:l,stripFinalNewline:u,verboseInfo:c,streamInfo:d})=>{const p=yA({stream:e,onStreamEnd:t,fdNumber:n,encoding:r,allMixed:l,verboseInfo:c,streamInfo:d});if(!o){await Promise.all([vA(e),p]);return}const h=Sg(u,n),g=cy({stream:e,onStreamEnd:t,lines:a,encoding:r,stripFinalNewline:h,allMixed:l}),[f]=await Promise.all([_A({stream:e,iterable:g,fdNumber:n,encoding:r,maxBuffer:s,lines:a}),p]);return f},"getStreamOutput"),yA=i(async({stream:e,onStreamEnd:t,fdNumber:n,encoding:r,allMixed:o,verboseInfo:s,streamInfo:{fileDescriptors:a}})=>{if(!jg({stdioItems:a[n]?.stdioItems,encoding:r,verboseInfo:s,fdNumber:n}))return;const l=cy({stream:e,onStreamEnd:t,lines:!0,encoding:r,stripFinalNewline:!0,allMixed:o});await Pk(l,e,n,s)},"logOutputAsync"),vA=i(async e=>{await vD(),e.readableFlowing===null&&e.resume()},"resumeStream"),_A=i(async({stream:e,stream:{readableObjectMode:t},iterable:n,fdNumber:r,encoding:o,maxBuffer:s,lines:a})=>{try{return t||a?await Q$(n,{maxBuffer:s}):o==="buffer"?new Uint8Array(await ox(n,{maxBuffer:s})):await mx(n,{maxBuffer:s})}catch(l){return hy(bx({error:l,stream:e,readableObjectMode:t,lines:a,encoding:o,fdNumber:r}))}},"getStreamContents"),my=i(async e=>{try{return await e}catch(t){return hy(t)}},"getBufferedData"),hy=i(({bufferedData:e})=>F2(e)?new Uint8Array(e):e,"handleBufferedData"),dc=i(async(e,t,n,{isSameDirection:r,stopOnExit:o=!1}={})=>{const s=bA(e,n),a=new AbortController;try{await Promise.race([...o?[n.exitPromise]:[],kn(e,{cleanup:!0,signal:a.signal})])}catch(l){s.stdinCleanedUp||EA(l,t,n,r)}finally{a.abort()}},"waitForStream"),bA=i((e,{originalStreams:[t],subprocess:n})=>{const r={stdinCleanedUp:!1};return e===t&&wA(e,n,r),r},"handleStdinDestroy"),wA=i((e,t,n)=>{const{_destroy:r}=e;e._destroy=(...o)=>{DA(t,n),r.call(e,...o)}},"spyOnStdinDestroy"),DA=i(({exitCode:e,signalCode:t},n)=>{(e!==null||t!==null)&&(n.stdinCleanedUp=!0)},"setStdinCleanedUp"),EA=i((e,t,n,r)=>{if(!CA(e,t,n,r))throw e},"handleStreamError"),CA=i((e,t,n,r=!0)=>n.propagating?yy(e)||pc(e):(n.propagating=!0,gy(n,t)===r?yy(e):pc(e)),"shouldIgnoreStreamError"),gy=i(({fileDescriptors:e},t)=>t!=="all"&&e[t].direction==="input","isInputFileDescriptor"),pc=i(e=>e?.code==="ERR_STREAM_PREMATURE_CLOSE","isStreamAbort"),yy=i(e=>e?.code==="EPIPE","isStreamEpipe"),$A=i(({subprocess:e,encoding:t,buffer:n,maxBuffer:r,lines:o,stripFinalNewline:s,verboseInfo:a,streamInfo:l})=>e.stdio.map((u,c)=>vy({stream:u,fdNumber:c,encoding:t,buffer:n[c],maxBuffer:r[c],lines:o[c],allMixed:!1,stripFinalNewline:s,verboseInfo:a,streamInfo:l})),"waitForStdioStreams"),vy=i(async({stream:e,fdNumber:t,encoding:n,buffer:r,maxBuffer:o,lines:s,allMixed:a,stripFinalNewline:l,verboseInfo:u,streamInfo:c})=>{if(!e)return;const d=dc(e,t,c);if(gy(c,t)){await d;return}const[p]=await Promise.all([gA({stream:e,onStreamEnd:d,fdNumber:t,encoding:n,buffer:r,maxBuffer:o,lines:s,allMixed:a,stripFinalNewline:l,verboseInfo:u,streamInfo:c}),d]);return p},"waitForSubprocessStream"),xA=i(({stdout:e,stderr:t},{all:n})=>n&&(e||t)?Xu([e,t].filter(Boolean)):void 0,"makeAllStream"),SA=i(({subprocess:e,encoding:t,buffer:n,maxBuffer:r,lines:o,stripFinalNewline:s,verboseInfo:a,streamInfo:l})=>vy({...kA(e,n),fdNumber:"all",encoding:t,maxBuffer:r[1]+r[2],lines:o[1]||o[2],allMixed:IA(e),stripFinalNewline:s,verboseInfo:a,streamInfo:l}),"waitForAllStream"),kA=i(({stdout:e,stderr:t,all:n},[,r,o])=>{const s=r||o;return s?r?o?{stream:n,buffer:s}:{stream:e,buffer:s}:{stream:t,buffer:s}:{stream:n,buffer:s}},"getAllStream"),IA=i(({all:e,stdout:t,stderr:n})=>e&&t&&n&&t.readableObjectMode!==n.readableObjectMode,"getAllMixed"),AA=i(e=>tu(e,"ipc"),"shouldLogIpc"),TA=i((e,t)=>{const n=qm(e);_s({type:"ipc",verboseMessage:n,fdNumber:"ipc",verboseInfo:t})},"logIpcOutput"),FA=i(async({subprocess:e,buffer:t,maxBuffer:n,ipc:r,ipcOutput:o,verboseInfo:s})=>{if(!r)return o;const a=AA(s),l=vs(t,"ipc"),u=vs(n,"ipc");for await(const c of qg({anyProcess:e,channel:e.channel,isSubprocess:!1,ipc:r,shouldAwait:!1,reference:!0}))l&&(Dx(e,o,u),o.push(c)),a&&TA(c,s);return o},"waitForIpcOutput"),OA=i(async(e,t)=>(await Promise.allSettled([e]),t),"getBufferedIpcOutput"),RA=i(async({subprocess:e,options:{encoding:t,buffer:n,maxBuffer:r,lines:o,timeoutDuration:s,cancelSignal:a,gracefulCancel:l,forceKillAfterDelay:u,stripFinalNewline:c,ipc:d,ipcInput:p},context:h,verboseInfo:g,fileDescriptors:f,originalStreams:y,onInternalError:v,controller:_})=>{const w=Gk(e,h),D={originalStreams:y,fileDescriptors:f,subprocess:e,exitPromise:w,propagating:!1},E=$A({subprocess:e,encoding:t,buffer:n,maxBuffer:r,lines:o,stripFinalNewline:c,verboseInfo:g,streamInfo:D}),I=SA({subprocess:e,encoding:t,buffer:n,maxBuffer:r,lines:o,stripFinalNewline:c,verboseInfo:g,streamInfo:D}),T=[],$=FA({subprocess:e,buffer:n,maxBuffer:r,ipc:d,ipcOutput:T,verboseInfo:g}),x=PA(y,e,D),j=MA(f,D);try{return await Promise.race([Promise.all([{},Wk(w),Promise.all(E),I,$,I$(e,p),...x,...j]),v,NA(e,_),...w$(e,s,h,_),...AC({subprocess:e,cancelSignal:a,gracefulCancel:l,context:h,controller:_}),...y$({subprocess:e,cancelSignal:a,gracefulCancel:l,forceKillAfterDelay:u,context:h,controller:_})])}catch(S){return h.terminationReason??(h.terminationReason="other"),Promise.all([{error:S},w,Promise.all(E.map(Z=>my(Z))),my(I),OA($,T),Promise.allSettled(x),Promise.allSettled(j)])}},"waitForSubprocessResult"),PA=i((e,t,n)=>e.map((r,o)=>r===t.stdio[o]?void 0:dc(r,o,n)),"waitForOriginalStreams"),MA=i((e,t)=>e.flatMap(({stdioItems:n},r)=>n.filter(({value:o,stream:s=o})=>er(s,{checkOpen:!1})&&!Jn(s)).map(({type:o,value:s,stream:a=s})=>dc(a,r,t,{isSameDirection:rr.has(o),stopOnExit:o==="native"}))),"waitForCustomStreamsEnd"),NA=i(async(e,{signal:t})=>{const[n]=await wt(e,"error",{signal:t});throw n},"throwOnSubprocessError"),BA=i(()=>({readableDestroy:new WeakMap,writableFinal:new WeakMap,writableDestroy:new WeakMap}),"initializeConcurrentStreams"),fc=i((e,t,n)=>{const r=e[n];r.has(t)||r.set(t,[]);const o=r.get(t),s=Ds();return o.push(s),{resolve:s.resolve.bind(s),promises:o}},"addConcurrentStream"),la=i(async({resolve:e,promises:t},n)=>{e();const[r]=await Promise.race([Promise.allSettled([!0,n]),Promise.all([!1,...t])]);return!r},"waitForConcurrentStreams"),_y=i(async e=>{if(e!==void 0)try{await by(e)}catch{}},"safeWaitForSubprocessStdin"),jA=i(async e=>{if(e!==void 0)try{await wy(e)}catch{}},"safeWaitForSubprocessStdout"),by=i(async e=>{await kn(e,{cleanup:!0,readable:!1,writable:!0})},"waitForSubprocessStdin"),wy=i(async e=>{await kn(e,{cleanup:!0,readable:!0,writable:!1})},"waitForSubprocessStdout"),Dy=i(async(e,t)=>{if(await e,t)throw t},"waitForSubprocess"),Ey=i((e,t,n)=>{n&&!pc(n)?e.destroy(n):t&&e.destroy()},"destroyOtherStream"),LA=i(({subprocess:e,concurrentStreams:t,encoding:n},{from:r,binary:o=!0,preserveNewlines:s=!0}={})=>{const a=o||Qn.has(n),{subprocessStdout:l,waitReadableDestroy:u}=Cy(e,r,t),{readableEncoding:c,readableObjectMode:d,readableHighWaterMark:p}=$y(l,a),{read:h,onStdoutDataDone:g}=xy({subprocessStdout:l,subprocess:e,binary:a,encoding:n,preserveNewlines:s}),f=new Wn({read:h,destroy:Ir(ky.bind(void 0,{subprocessStdout:l,subprocess:e,waitReadableDestroy:u})),highWaterMark:p,objectMode:d,encoding:c});return Sy({subprocessStdout:l,onStdoutDataDone:g,readable:f,subprocess:e}),f},"createReadable"),Cy=i((e,t,n)=>{const r=Eu(e,t),o=fc(n,r,"readableDestroy");return{subprocessStdout:r,waitReadableDestroy:o}},"getSubprocessStdout"),$y=i(({readableEncoding:e,readableObjectMode:t,readableHighWaterMark:n},r)=>r?{readableEncoding:e,readableObjectMode:t,readableHighWaterMark:n}:{readableEncoding:e,readableObjectMode:!0,readableHighWaterMark:py},"getReadableOptions"),xy=i(({subprocessStdout:e,subprocess:t,binary:n,encoding:r,preserveNewlines:o})=>{const s=Ds(),a=uy({subprocessStdout:e,subprocess:t,binary:n,shouldEncode:!n,encoding:r,preserveNewlines:o});return{read(){UA(this,a,s)},onStdoutDataDone:s}},"getReadableMethods"),UA=i(async(e,t,n)=>{try{const{value:r,done:o}=await t.next();o?n.resolve():e.push(r)}catch{}},"onRead"),Sy=i(async({subprocessStdout:e,onStdoutDataDone:t,readable:n,subprocess:r,subprocessStdin:o})=>{try{await wy(e),await r,await _y(o),await t,n.readable&&n.push(null)}catch(s){await _y(o),Iy(n,s)}},"onStdoutFinished"),ky=i(async({subprocessStdout:e,subprocess:t,waitReadableDestroy:n},r)=>{await la(n,t)&&(Iy(e,r),await Dy(t,r))},"onReadableDestroy"),Iy=i((e,t)=>{Ey(e,e.readable,t)},"destroyOtherReadable"),zA=i(({subprocess:e,concurrentStreams:t},{to:n}={})=>{const{subprocessStdin:r,waitWritableFinal:o,waitWritableDestroy:s}=Ay(e,n,t),a=new Bl({...Ty(r,e,o),destroy:Ir(Oy.bind(void 0,{subprocessStdin:r,subprocess:e,waitWritableFinal:o,waitWritableDestroy:s})),highWaterMark:r.writableHighWaterMark,objectMode:r.writableObjectMode});return Fy(r,a),a},"createWritable"),Ay=i((e,t,n)=>{const r=_h(e,t),o=fc(n,r,"writableFinal"),s=fc(n,r,"writableDestroy");return{subprocessStdin:r,waitWritableFinal:o,waitWritableDestroy:s}},"getSubprocessStdin"),Ty=i((e,t,n)=>({write:qA.bind(void 0,e),final:Ir(VA.bind(void 0,e,t,n))}),"getWritableMethods"),qA=i((e,t,n,r)=>{e.write(t,n)?r():e.once("drain",r)},"onWrite"),VA=i(async(e,t,n)=>{await la(n,t)&&(e.writable&&e.end(),await t)},"onWritableFinal"),Fy=i(async(e,t,n)=>{try{await by(e),t.writable&&t.end()}catch(r){await jA(n),Ry(t,r)}},"onStdinFinished"),Oy=i(async({subprocessStdin:e,subprocess:t,waitWritableFinal:n,waitWritableDestroy:r},o)=>{await la(n,t),await la(r,t)&&(Ry(e,o),await Dy(t,o))},"onWritableDestroy"),Ry=i((e,t)=>{Ey(e,e.writable,t)},"destroyOtherWritable"),GA=i(({subprocess:e,concurrentStreams:t,encoding:n},{from:r,to:o,binary:s=!0,preserveNewlines:a=!0}={})=>{const l=s||Qn.has(n),{subprocessStdout:u,waitReadableDestroy:c}=Cy(e,r,t),{subprocessStdin:d,waitWritableFinal:p,waitWritableDestroy:h}=Ay(e,o,t),{readableEncoding:g,readableObjectMode:f,readableHighWaterMark:y}=$y(u,l),{read:v,onStdoutDataDone:_}=xy({subprocessStdout:u,subprocess:e,binary:l,encoding:n,preserveNewlines:a}),w=new Nl({read:v,...Ty(d,e,p),destroy:Ir(ZA.bind(void 0,{subprocessStdout:u,subprocessStdin:d,subprocess:e,waitReadableDestroy:c,waitWritableFinal:p,waitWritableDestroy:h})),readableHighWaterMark:y,writableHighWaterMark:d.writableHighWaterMark,readableObjectMode:f,writableObjectMode:d.writableObjectMode,encoding:g});return Sy({subprocessStdout:u,onStdoutDataDone:_,readable:w,subprocess:e,subprocessStdin:d}),Fy(d,w,u),w},"createDuplex"),ZA=i(async({subprocessStdout:e,subprocessStdin:t,subprocess:n,waitReadableDestroy:r,waitWritableFinal:o,waitWritableDestroy:s},a)=>{await Promise.all([ky({subprocessStdout:e,subprocess:n,waitReadableDestroy:r},a),Oy({subprocessStdin:t,subprocess:n,waitWritableFinal:o,waitWritableDestroy:s},a)])},"onDuplexDestroy"),Py=i((e,t,{from:n,binary:r=!1,preserveNewlines:o=!1}={})=>{const s=r||Qn.has(t),a=Eu(e,n),l=uy({subprocessStdout:a,subprocess:e,binary:s,shouldEncode:!0,encoding:t,preserveNewlines:o});return WA(l,a,e)},"createIterable"),WA=i(async function*(e,t,n){try{yield*e}finally{t.readable&&t.destroy(),await n}},"iterateOnStdoutData"),HA=i((e,{encoding:t})=>{const n=BA();e.readable=LA.bind(void 0,{subprocess:e,concurrentStreams:n,encoding:t}),e.writable=zA.bind(void 0,{subprocess:e,concurrentStreams:n}),e.duplex=GA.bind(void 0,{subprocess:e,concurrentStreams:n,encoding:t}),e.iterable=Py.bind(void 0,e,t),e[Symbol.asyncIterator]=Py.bind(void 0,e,t,{})},"addConvertedStreams"),JA=i((e,t)=>{for(const[n,r]of YA){const o=r.value.bind(t);Reflect.defineProperty(e,n,{...r,value:o})}},"mergePromise"),KA=(async()=>{})().constructor.prototype,YA=["then","catch","finally"].map(e=>[e,Reflect.getOwnPropertyDescriptor(KA,e)]),XA=i((e,t,n,r)=>{const{file:o,commandArguments:s,command:a,escapedCommand:l,startTime:u,verboseInfo:c,options:d,fileDescriptors:p}=QA(e,t,n),{subprocess:h,promise:g}=tT({file:o,commandArguments:s,options:d,startTime:u,verboseInfo:c,command:a,escapedCommand:l,fileDescriptors:p});return h.pipe=cc.bind(void 0,{source:h,sourcePromise:g,boundOptions:{},createNested:r}),JA(h,g),Xn.set(h,{options:d,fileDescriptors:p}),h},"execaCoreAsync"),QA=i((e,t,n)=>{const{command:r,escapedCommand:o,startTime:s,verboseInfo:a}=Zm(e,t,n),{file:l,commandArguments:u,options:c}=Rh(e,t,n),d=eT(c),p=DI(d,a);return{file:l,commandArguments:u,command:r,escapedCommand:o,startTime:s,verboseInfo:a,options:d,fileDescriptors:p}},"handleAsyncArguments"),eT=i(({timeout:e,signal:t,...n})=>{if(t!==void 0)throw new TypeError('The "signal" option has been renamed to "cancelSignal" instead.');return{...n,timeoutDuration:e}},"handleAsyncOptions"),tT=i(({file:e,commandArguments:t,options:n,startTime:r,verboseInfo:o,command:s,escapedCommand:a,fileDescriptors:l})=>{let u;try{u=iD(...Ph(e,t,n))}catch(f){return gI({error:f,command:s,escapedCommand:a,fileDescriptors:l,options:n,startTime:r,verboseInfo:o})}const c=new AbortController;bD(Number.POSITIVE_INFINITY,c.signal);const d=[...u.stdio];NI(u,l,c),HI(u,n,c);const p={},h=Ds();u.kill=$C.bind(void 0,{kill:u.kill.bind(u),options:n,onInternalError:h,context:p,controller:c}),u.all=xA(u,n),HA(u,n),mI(u,n);const g=nT({subprocess:u,options:n,startTime:r,verboseInfo:o,fileDescriptors:l,originalStreams:d,command:s,escapedCommand:a,context:p,onInternalError:h,controller:c});return{subprocess:u,promise:g}},"spawnSubprocessAsync"),nT=i(async({subprocess:e,options:t,startTime:n,verboseInfo:r,fileDescriptors:o,originalStreams:s,command:a,escapedCommand:l,context:u,onInternalError:c,controller:d})=>{const[p,[h,g],f,y,v]=await RA({subprocess:e,options:t,context:u,verboseInfo:r,fileDescriptors:o,originalStreams:s,onInternalError:c,controller:d});d.abort(),c.resolve();const _=f.map((E,I)=>Or(E,t,I)),w=Or(y,t,"all"),D=rT({errorInfo:p,exitCode:h,signal:g,stdio:_,all:w,ipcOutput:v,context:u,options:t,command:a,escapedCommand:l,startTime:n});return Uu(D,r,t)},"handlePromise"),rT=i(({errorInfo:e,exitCode:t,signal:n,stdio:r,all:o,ipcOutput:s,context:a,options:l,command:u,escapedCommand:c,startTime:d})=>"error"in e?Lu({error:e.error,command:u,escapedCommand:c,timedOut:a.terminationReason==="timeout",isCanceled:a.terminationReason==="cancel"||a.terminationReason==="gracefulCancel",isGracefullyCanceled:a.terminationReason==="gracefulCancel",isMaxBuffer:e.error instanceof Ar,isForcefullyTerminated:a.isForcefullyTerminated,exitCode:t,signal:n,stdio:r,all:o,ipcOutput:s,options:l,startTime:d,isSync:!1}):og({command:u,escapedCommand:c,stdio:r,all:o,ipcOutput:s,options:l,startTime:d}),"getAsyncResult"),mc=i((e,t)=>{const n=Object.fromEntries(Object.entries(t).map(([r,o])=>[r,oT(r,e[r],o)]));return{...e,...n}},"mergeOptions"),oT=i((e,t,n)=>sT.has(e)&&jt(t)&&jt(n)?{...t,...n}:n,"mergeOption"),sT=new Set(["env",...Bm]),ir=i((e,t,n,r)=>{const o=i((a,l,u)=>ir(a,l,n,u),"createNested"),s=i((...a)=>iT({mapArguments:e,deepOptions:n,boundOptions:t,setBoundExeca:r,createNested:o},...a),"boundExeca");return r!==void 0&&r(s,o,t),s},"createExeca"),iT=i(({mapArguments:e,deepOptions:t={},boundOptions:n={},setBoundExeca:r,createNested:o},s,...a)=>{if(jt(s))return o(e,mc(n,s),r);const{file:l,commandArguments:u,options:c,isSync:d}=aT({mapArguments:e,firstArgument:s,nextArguments:a,deepOptions:t,boundOptions:n});return d?Yk(l,u,c):XA(l,u,c,o)},"callBoundExeca"),aT=i(({mapArguments:e,firstArgument:t,nextArguments:n,deepOptions:r,boundOptions:o})=>{const s=j2(t)?L2(t,n):[t,...n],[a,l,u]=xm(...s),c=mc(mc(r,o),u),{file:d=a,commandArguments:p=l,options:h=c,isSync:g=!1}=e({file:a,commandArguments:l,options:c});return{file:d,commandArguments:p,options:h,isSync:g}},"parseArguments"),lT=i(({file:e,commandArguments:t})=>My(e,t),"mapCommandAsync"),uT=i(({file:e,commandArguments:t})=>({...My(e,t),isSync:!0}),"mapCommandSync"),My=i((e,t)=>{if(t.length>0)throw new TypeError(`The command and its arguments must be passed as a single string: ${e} ${t}.`);const[n,...r]=cT(e);return{file:n,commandArguments:r}},"parseCommand"),cT=i(e=>{if(typeof e!="string")throw new TypeError(`The command must be a string: ${String(e)}.`);const t=e.trim();if(t==="")return[];const n=[];for(const r of t.split(dT)){const o=n.at(-1);o&&o.endsWith("\\")?n[n.length-1]=`${o.slice(0,-1)} ${r}`:n.push(r)}return n},"parseCommandString"),dT=/ +/g,pT=i((e,t,n)=>{e.sync=t(mT,n),e.s=e.sync},"setScriptSync"),fT=i(({options:e})=>Ny(e),"mapScriptAsync"),mT=i(({options:e})=>({...Ny(e),isSync:!0}),"mapScriptSync"),Ny=i(e=>({options:{...hT(e),...e}}),"getScriptOptions"),hT=i(({input:e,inputFile:t,stdio:n})=>e===void 0&&t===void 0&&n===void 0?{stdin:"inherit"}:{},"getScriptStdinOption"),gT={preferLocal:!0},we=ir(()=>({}));ir(()=>({isSync:!0})),ir(lT),ir(uT),ir(E$),ir(fT,{},gT,pT),hI();let ar=!0;const Br=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let Os=0;if(Br.process&&Br.process.env&&Br.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:n,TERM:r,COLORTERM:o}=Br.process.env;t||n||e==="0"?ar=!1:e==="1"||e==="2"||e==="3"?ar=!0:r==="dumb"?ar=!1:"CI"in Br.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(s=>s in Br.process.env)?ar=!0:ar=process.stdout.isTTY,ar&&(process.platform==="win32"||o&&(o==="truecolor"||o==="24bit")?Os=3:r&&(r.endsWith("-256color")||r.endsWith("256"))?Os=2:Os=1)}let hc={enabled:ar,supportLevel:Os};function On(e,t,n=1){const r=`\x1B[${e}m`,o=`\x1B[${t}m`,s=new RegExp(`\\x1b\\[${t}m`,"g");return a=>hc.enabled&&hc.supportLevel>=n?r+(""+a).replace(s,r)+o:""+a}i(On,"kolorist");const Ie=On(1,22),V=On(2,22),Rs=On(30,39),dn=On(31,39),Q=On(32,39),Oe=On(33,39),lr=On(36,39),Ps=On(46,49);var yT=Object.freeze({__proto__:null,bgCyan:Ps,black:Rs,bold:Ie,cyan:lr,dim:V,green:Q,options:hc,red:dn,yellow:Oe});async function By(e){try{return process.platform==="darwin"?await we("pbcopy",{input:e}):process.platform==="win32"?await we("clip",{input:e}):await we("xclip",["-selection","clipboard"],{input:e}).catch(()=>we("xsel",["--clipboard","--input"],{input:e})),!0}catch{return!1}}i(By,"copyToClipboard");var ua={exports:{}},jy;function vT(){if(jy)return ua.exports;jy=1;let e=process||{},t=e.argv||[],n=e.env||{},r=!(n.NO_COLOR||t.includes("--no-color"))&&(!!n.FORCE_COLOR||t.includes("--color")||e.platform==="win32"||(e.stdout||{}).isTTY&&n.TERM!=="dumb"||!!n.CI),o=i((l,u,c=l)=>d=>{let p=""+d,h=p.indexOf(u,l.length);return~h?l+s(p,u,c,h)+u:l+p+u},"formatter"),s=i((l,u,c,d)=>{let p="",h=0;do p+=l.substring(h,d)+c,h=d+u.length,d=l.indexOf(u,h);while(~d);return p+l.substring(h)},"replaceClose"),a=i((l=r)=>{let u=l?o:()=>String;return{isColorSupported:l,reset:u("\x1B[0m","\x1B[0m"),bold:u("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:u("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:u("\x1B[3m","\x1B[23m"),underline:u("\x1B[4m","\x1B[24m"),inverse:u("\x1B[7m","\x1B[27m"),hidden:u("\x1B[8m","\x1B[28m"),strikethrough:u("\x1B[9m","\x1B[29m"),black:u("\x1B[30m","\x1B[39m"),red:u("\x1B[31m","\x1B[39m"),green:u("\x1B[32m","\x1B[39m"),yellow:u("\x1B[33m","\x1B[39m"),blue:u("\x1B[34m","\x1B[39m"),magenta:u("\x1B[35m","\x1B[39m"),cyan:u("\x1B[36m","\x1B[39m"),white:u("\x1B[37m","\x1B[39m"),gray:u("\x1B[90m","\x1B[39m"),bgBlack:u("\x1B[40m","\x1B[49m"),bgRed:u("\x1B[41m","\x1B[49m"),bgGreen:u("\x1B[42m","\x1B[49m"),bgYellow:u("\x1B[43m","\x1B[49m"),bgBlue:u("\x1B[44m","\x1B[49m"),bgMagenta:u("\x1B[45m","\x1B[49m"),bgCyan:u("\x1B[46m","\x1B[49m"),bgWhite:u("\x1B[47m","\x1B[49m"),blackBright:u("\x1B[90m","\x1B[39m"),redBright:u("\x1B[91m","\x1B[39m"),greenBright:u("\x1B[92m","\x1B[39m"),yellowBright:u("\x1B[93m","\x1B[39m"),blueBright:u("\x1B[94m","\x1B[39m"),magentaBright:u("\x1B[95m","\x1B[39m"),cyanBright:u("\x1B[96m","\x1B[39m"),whiteBright:u("\x1B[97m","\x1B[39m"),bgBlackBright:u("\x1B[100m","\x1B[49m"),bgRedBright:u("\x1B[101m","\x1B[49m"),bgGreenBright:u("\x1B[102m","\x1B[49m"),bgYellowBright:u("\x1B[103m","\x1B[49m"),bgBlueBright:u("\x1B[104m","\x1B[49m"),bgMagentaBright:u("\x1B[105m","\x1B[49m"),bgCyanBright:u("\x1B[106m","\x1B[49m"),bgWhiteBright:u("\x1B[107m","\x1B[49m")}},"createColors");return ua.exports=a(),ua.exports.createColors=a,ua.exports}i(vT,"requirePicocolors");var _T=vT(),F=Bi(_T),gc,Ly;function bT(){if(Ly)return gc;Ly=1;const e="\x1B",t=`${e}[`,n="\x07",r={to(a,l){return l?`${t}${l+1};${a+1}H`:`${t}${a+1}G`},move(a,l){let u="";return a<0?u+=`${t}${-a}D`:a>0&&(u+=`${t}${a}C`),l<0?u+=`${t}${-l}A`:l>0&&(u+=`${t}${l}B`),u},up:i((a=1)=>`${t}${a}A`,"up"),down:i((a=1)=>`${t}${a}B`,"down"),forward:i((a=1)=>`${t}${a}C`,"forward"),backward:i((a=1)=>`${t}${a}D`,"backward"),nextLine:i((a=1)=>`${t}E`.repeat(a),"nextLine"),prevLine:i((a=1)=>`${t}F`.repeat(a),"prevLine"),left:`${t}G`,hide:`${t}?25l`,show:`${t}?25h`,save:`${e}7`,restore:`${e}8`},o={up:i((a=1)=>`${t}S`.repeat(a),"up"),down:i((a=1)=>`${t}T`.repeat(a),"down")},s={screen:`${t}2J`,up:i((a=1)=>`${t}1J`.repeat(a),"up"),down:i((a=1)=>`${t}J`.repeat(a),"down"),line:`${t}2K`,lineEnd:`${t}K`,lineStart:`${t}1K`,lines(a){let l="";for(let u=0;u<a;u++)l+=this.line+(u<a-1?r.up():"");return a&&(l+=r.left),l}};return gc={cursor:r,scroll:o,erase:s,beep:n},gc}i(bT,"requireSrc");var at=bT(),wT=Object.defineProperty,DT=i((e,t,n)=>t in e?wT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,"__defNormalProp"),nt=i((e,t,n)=>DT(e,typeof t!="symbol"?t+"":t,n),"__publicField");function ur(e,t,n){if(!n.some(a=>!a.disabled))return e;const r=e+t,o=Math.max(n.length-1,0),s=r<0?o:r>o?0:r;return n[s].disabled?ur(s,t<0?-1:1,n):s}i(ur,"B");const ET=i(e=>e===161||e===164||e===167||e===168||e===170||e===173||e===174||e>=176&&e<=180||e>=182&&e<=186||e>=188&&e<=191||e===198||e===208||e===215||e===216||e>=222&&e<=225||e===230||e>=232&&e<=234||e===236||e===237||e===240||e===242||e===243||e>=247&&e<=250||e===252||e===254||e===257||e===273||e===275||e===283||e===294||e===295||e===299||e>=305&&e<=307||e===312||e>=319&&e<=322||e===324||e>=328&&e<=331||e===333||e===338||e===339||e===358||e===359||e===363||e===462||e===464||e===466||e===468||e===470||e===472||e===474||e===476||e===593||e===609||e===708||e===711||e>=713&&e<=715||e===717||e===720||e>=728&&e<=731||e===733||e===735||e>=768&&e<=879||e>=913&&e<=929||e>=931&&e<=937||e>=945&&e<=961||e>=963&&e<=969||e===1025||e>=1040&&e<=1103||e===1105||e===8208||e>=8211&&e<=8214||e===8216||e===8217||e===8220||e===8221||e>=8224&&e<=8226||e>=8228&&e<=8231||e===8240||e===8242||e===8243||e===8245||e===8251||e===8254||e===8308||e===8319||e>=8321&&e<=8324||e===8364||e===8451||e===8453||e===8457||e===8467||e===8470||e===8481||e===8482||e===8486||e===8491||e===8531||e===8532||e>=8539&&e<=8542||e>=8544&&e<=8555||e>=8560&&e<=8569||e===8585||e>=8592&&e<=8601||e===8632||e===8633||e===8658||e===8660||e===8679||e===8704||e===8706||e===8707||e===8711||e===8712||e===8715||e===8719||e===8721||e===8725||e===8730||e>=8733&&e<=8736||e===8739||e===8741||e>=8743&&e<=8748||e===8750||e>=8756&&e<=8759||e===8764||e===8765||e===8776||e===8780||e===8786||e===8800||e===8801||e>=8804&&e<=8807||e===8810||e===8811||e===8814||e===8815||e===8834||e===8835||e===8838||e===8839||e===8853||e===8857||e===8869||e===8895||e===8978||e>=9312&&e<=9449||e>=9451&&e<=9547||e>=9552&&e<=9587||e>=9600&&e<=9615||e>=9618&&e<=9621||e===9632||e===9633||e>=9635&&e<=9641||e===9650||e===9651||e===9654||e===9655||e===9660||e===9661||e===9664||e===9665||e>=9670&&e<=9672||e===9675||e>=9678&&e<=9681||e>=9698&&e<=9701||e===9711||e===9733||e===9734||e===9737||e===9742||e===9743||e===9756||e===9758||e===9792||e===9794||e===9824||e===9825||e>=9827&&e<=9829||e>=9831&&e<=9834||e===9836||e===9837||e===9839||e===9886||e===9887||e===9919||e>=9926&&e<=9933||e>=9935&&e<=9939||e>=9941&&e<=9953||e===9955||e===9960||e===9961||e>=9963&&e<=9969||e===9972||e>=9974&&e<=9977||e===9979||e===9980||e===9982||e===9983||e===10045||e>=10102&&e<=10111||e>=11094&&e<=11097||e>=12872&&e<=12879||e>=57344&&e<=63743||e>=65024&&e<=65039||e===65533||e>=127232&&e<=127242||e>=127248&&e<=127277||e>=127280&&e<=127337||e>=127344&&e<=127373||e===127375||e===127376||e>=127387&&e<=127404||e>=917760&&e<=917999||e>=983040&&e<=1048573||e>=1048576&&e<=1114109,"at$1"),CT=i(e=>e===12288||e>=65281&&e<=65376||e>=65504&&e<=65510,"lt$1"),$T=i(e=>e>=4352&&e<=4447||e===8986||e===8987||e===9001||e===9002||e>=9193&&e<=9196||e===9200||e===9203||e===9725||e===9726||e===9748||e===9749||e>=9800&&e<=9811||e===9855||e===9875||e===9889||e===9898||e===9899||e===9917||e===9918||e===9924||e===9925||e===9934||e===9940||e===9962||e===9970||e===9971||e===9973||e===9978||e===9981||e===9989||e===9994||e===9995||e===10024||e===10060||e===10062||e>=10067&&e<=10069||e===10071||e>=10133&&e<=10135||e===10160||e===10175||e===11035||e===11036||e===11088||e===11093||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12771||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=19903||e>=19968&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||e===94192||e===94193||e>=94208&&e<=100343||e>=100352&&e<=101589||e>=101632&&e<=101640||e>=110576&&e<=110579||e>=110581&&e<=110587||e===110589||e===110590||e>=110592&&e<=110882||e===110898||e>=110928&&e<=110930||e===110933||e>=110948&&e<=110951||e>=110960&&e<=111355||e===126980||e===127183||e===127374||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||e===127568||e===127569||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||e===127988||e>=127992&&e<=128062||e===128064||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||e===128378||e===128405||e===128406||e===128420||e>=128507&&e<=128591||e>=128640&&e<=128709||e===128716||e>=128720&&e<=128722||e>=128725&&e<=128727||e>=128732&&e<=128735||e===128747||e===128748||e>=128756&&e<=128764||e>=128992&&e<=129003||e===129008||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129672||e>=129680&&e<=129725||e>=129727&&e<=129733||e>=129742&&e<=129755||e>=129760&&e<=129768||e>=129776&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141,"ht$1"),yc=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,ca=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,da=/\t{1,1000}/y,vc=new RegExp("[\\u{1F1E6}-\\u{1F1FF}]{2}|\\u{1F3F4}[\\u{E0061}-\\u{E007A}]{2}[\\u{E0030}-\\u{E0039}\\u{E0061}-\\u{E007A}]{1,3}\\u{E007F}|(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation})(?:\\u200D(?:\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F\\u20E3?))*","yu"),pa=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,xT=new RegExp("\\p{M}+","gu"),ST={limit:1/0,ellipsis:""},Uy=i((e,t={},n={})=>{const r=t.limit??1/0,o=t.ellipsis??"",s=t?.ellipsisWidth??(o?Uy(o,ST,n).width:0),a=n.ansiWidth??0,l=n.controlWidth??0,u=n.tabWidth??8,c=n.ambiguousWidth??1,d=n.emojiWidth??2,p=n.fullWidthWidth??2,h=n.regularWidth??1,g=n.wideWidth??2;let f=0,y=0,v=e.length,_=0,w=!1,D=v,E=Math.max(0,r-s),I=0,T=0,$=0,x=0;e:for(;;){if(T>I||y>=v&&y>f){const j=e.slice(I,T)||e.slice(f,y);_=0;for(const S of j.replaceAll(xT,"")){const Z=S.codePointAt(0)||0;if(CT(Z)?x=p:$T(Z)?x=g:c!==h&&ET(Z)?x=c:x=h,$+x>E&&(D=Math.min(D,Math.max(I,f)+_)),$+x>r){w=!0;break e}_+=S.length,$+=x}I=T=0}if(y>=v)break;if(pa.lastIndex=y,pa.test(e)){if(_=pa.lastIndex-y,x=_*h,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/h))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=pa.lastIndex;continue}if(yc.lastIndex=y,yc.test(e)){if($+a>E&&(D=Math.min(D,y)),$+a>r){w=!0;break}$+=a,I=f,T=y,y=f=yc.lastIndex;continue}if(ca.lastIndex=y,ca.test(e)){if(_=ca.lastIndex-y,x=_*l,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/l))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=ca.lastIndex;continue}if(da.lastIndex=y,da.test(e)){if(_=da.lastIndex-y,x=_*u,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/u))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=da.lastIndex;continue}if(vc.lastIndex=y,vc.test(e)){if($+d>E&&(D=Math.min(D,y)),$+d>r){w=!0;break}$+=d,I=f,T=y,y=f=vc.lastIndex;continue}y+=1}return{width:w?E:$,index:w?D:v,truncated:w,ellipsed:w&&r>=s}},"X$1"),kT={limit:1/0,ellipsis:"",ellipsisWidth:0},Ms=i((e,t={})=>Uy(e,kT,t).width,"S"),fa="\x1B",zy="\x9B",IT=39,_c="\x07",qy="[",AT="]",Vy="m",bc=`${AT}8;;`,Gy=new RegExp(`(?:\\${qy}(?<code>\\d+)m|\\${bc}(?<uri>.*)${_c})`,"y"),TT=i(e=>{if(e>=30&&e<=37||e>=90&&e<=97)return 39;if(e>=40&&e<=47||e>=100&&e<=107)return 49;if(e===1||e===2)return 22;if(e===3)return 23;if(e===4)return 24;if(e===7)return 27;if(e===8)return 28;if(e===9)return 29;if(e===0)return 0},"mt$1"),Zy=i(e=>`${fa}${qy}${e}${Vy}`,"st$1"),Wy=i(e=>`${fa}${bc}${e}${_c}`,"it$1"),FT=i(e=>e.map(t=>Ms(t)),"gt"),wc=i((e,t,n)=>{const r=t[Symbol.iterator]();let o=!1,s=!1,a=e.at(-1),l=a===void 0?0:Ms(a),u=r.next(),c=r.next(),d=0;for(;!u.done;){const p=u.value,h=Ms(p);l+h<=n?e[e.length-1]+=p:(e.push(p),l=0),(p===fa||p===zy)&&(o=!0,s=t.startsWith(bc,d+1)),o?s?p===_c&&(o=!1,s=!1):p===Vy&&(o=!1):(l+=h,l===n&&!c.done&&(e.push(""),l=0)),u=c,c=r.next(),d+=p.length}a=e.at(-1),!l&&a!==void 0&&a.length>0&&e.length>1&&(e[e.length-2]+=e.pop())},"G"),OT=i(e=>{const t=e.split(" ");let n=t.length;for(;n>0&&!(Ms(t[n-1])>0);)n--;return n===t.length?e:t.slice(0,n).join(" ")+t.slice(n).join("")},"vt$1"),RT=i((e,t,n={})=>{if(n.trim!==!1&&e.trim()==="")return"";let r="",o,s;const a=e.split(" "),l=FT(a);let u=[""];for(const[f,y]of a.entries()){n.trim!==!1&&(u[u.length-1]=(u.at(-1)??"").trimStart());let v=Ms(u.at(-1)??"");if(f!==0&&(v>=t&&(n.wordWrap===!1||n.trim===!1)&&(u.push(""),v=0),(v>0||n.trim===!1)&&(u[u.length-1]+=" ",v++)),n.hard&&l[f]>t){const _=t-v,w=1+Math.floor((l[f]-_-1)/t);Math.floor((l[f]-1)/t)<w&&u.push(""),wc(u,y,t);continue}if(v+l[f]>t&&v>0&&l[f]>0){if(n.wordWrap===!1&&v<t){wc(u,y,t);continue}u.push("")}if(v+l[f]>t&&n.wordWrap===!1){wc(u,y,t);continue}u[u.length-1]+=y}n.trim!==!1&&(u=u.map(f=>OT(f)));const c=u.join(`
`),d=c[Symbol.iterator]();let p=d.next(),h=d.next(),g=0;for(;!p.done;){const f=p.value,y=h.value;if(r+=f,f===fa||f===zy){Gy.lastIndex=g+1;const _=Gy.exec(c)?.groups;if(_?.code!==void 0){const w=Number.parseFloat(_.code);o=w===IT?void 0:w}else _?.uri!==void 0&&(s=_.uri.length===0?void 0:_.uri)}const v=o?TT(o):void 0;y===`
`?(s&&(r+=Wy("")),o&&v&&(r+=Zy(v))):f===`
`&&(o&&v&&(r+=Zy(o)),s&&(r+=Wy(s))),g+=f.length,p=h,h=d.next()}return r},"Et$1");function Dc(e,t,n){return String(e).normalize().replaceAll(`\r
`,`
`).split(`
`).map(r=>RT(r,t,n)).join(`
`)}i(Dc,"K");const PT=["up","down","left","right","space","enter","cancel"],Tt={actions:new Set(PT),aliases:new Map([["k","up"],["j","down"],["h","left"],["l","right"],["","cancel"],["escape","cancel"]]),messages:{cancel:"Canceled",error:"Something went wrong"},withGuide:!0};function Ec(e,t){if(typeof e=="string")return Tt.aliases.get(e)===t;for(const n of e)if(n!==void 0&&Ec(n,t))return!0;return!1}i(Ec,"H$1");function MT(e,t){if(e===t)return;const n=e.split(`
`),r=t.split(`
`),o=Math.max(n.length,r.length),s=[];for(let a=0;a<o;a++)n[a]!==r[a]&&s.push(a);return{lines:s,numLinesBefore:n.length,numLinesAfter:r.length,numLines:o}}i(MT,"_t");const NT=globalThis.process.platform.startsWith("win"),Cc=Symbol("clack:cancel");function lt(e){return e===Cc}i(lt,"Ct$1");function ma(e,t){const n=e;n.isTTY&&n.setRawMode(t)}i(ma,"T");function BT({input:e=Cf,output:t=Rl,overwrite:n=!0,hideCursor:r=!0}={}){const o=Ti.createInterface({input:e,output:t,prompt:"",tabSize:1});Ti.emitKeypressEvents(e,o),e instanceof xf&&e.isTTY&&e.setRawMode(!0);const s=i((a,{name:l,sequence:u})=>{const c=String(a);if(Ec([c,l,u],"cancel")){r&&t.write(at.cursor.show),process.exit(0);return}if(!n)return;const d=l==="return"?0:-1,p=l==="return"?-1:0;Ti.moveCursor(t,d,p,()=>{Ti.clearLine(t,1,()=>{e.once("keypress",s)})})},"n");return r&&t.write(at.cursor.hide),e.once("keypress",s),()=>{e.off("keypress",s),r&&t.write(at.cursor.show),e instanceof xf&&e.isTTY&&!NT&&e.setRawMode(!1),o.terminal=!1,o.close()}}i(BT,"Bt");const ha=i(e=>"columns"in e&&typeof e.columns=="number"?e.columns:80,"rt$1"),Hy=i(e=>"rows"in e&&typeof e.rows=="number"?e.rows:20,"nt$1");function jr(e,t,n,r=n){const o=ha(e??Rl);return Dc(t,o-n.length,{hard:!0,trim:!1}).split(`
`).map((s,a)=>`${a===0?r:n}${s}`).join(`
`)}i(jr,"xt");let Ns=(so=class{constructor(t,n=!0){nt(this,"input"),nt(this,"output"),nt(this,"_abortSignal"),nt(this,"rl"),nt(this,"opts"),nt(this,"_render"),nt(this,"_track",!1),nt(this,"_prevFrame",""),nt(this,"_subscribers",new Map),nt(this,"_cursor",0),nt(this,"state","initial"),nt(this,"error",""),nt(this,"value"),nt(this,"userInput","");const{input:r=Cf,output:o=Rl,render:s,signal:a,...l}=t;this.opts=l,this.onKeypress=this.onKeypress.bind(this),this.close=this.close.bind(this),this.render=this.render.bind(this),this._render=s.bind(this),this._track=n,this._abortSignal=a,this.input=r,this.output=o}unsubscribe(){this._subscribers.clear()}setSubscriber(t,n){const r=this._subscribers.get(t)??[];r.push(n),this._subscribers.set(t,r)}on(t,n){this.setSubscriber(t,{cb:n})}once(t,n){this.setSubscriber(t,{cb:n,once:!0})}emit(t,...n){const r=this._subscribers.get(t)??[],o=[];for(const s of r)s.cb(...n),s.once&&o.push(()=>r.splice(r.indexOf(s),1));for(const s of o)s()}prompt(){return new Promise(t=>{if(this._abortSignal){if(this._abortSignal.aborted)return this.state="cancel",this.close(),t(Cc);this._abortSignal.addEventListener("abort",()=>{this.state="cancel",this.close()},{once:!0})}this.rl=xD.createInterface({input:this.input,tabSize:2,prompt:"",escapeCodeTimeout:50,terminal:!0}),this.rl.prompt(),this.opts.initialUserInput!==void 0&&this._setUserInput(this.opts.initialUserInput,!0),this.input.on("keypress",this.onKeypress),ma(this.input,!0),this.output.on("resize",this.render),this.render(),this.once("submit",()=>{this.output.write(at.cursor.show),this.output.off("resize",this.render),ma(this.input,!1),t(this.value)}),this.once("cancel",()=>{this.output.write(at.cursor.show),this.output.off("resize",this.render),ma(this.input,!1),t(Cc)})})}_isActionKey(t,n){return t==="	"}_setValue(t){this.value=t,this.emit("value",this.value)}_setUserInput(t,n){this.userInput=t??"",this.emit("userInput",this.userInput),n&&this._track&&this.rl&&(this.rl.write(this.userInput),this._cursor=this.rl.cursor)}_clearUserInput(){this.rl?.write(null,{ctrl:!0,name:"u"}),this._setUserInput("")}onKeypress(t,n){if(this._track&&n.name!=="return"&&(n.name&&this._isActionKey(t,n)&&this.rl?.write(null,{ctrl:!0,name:"h"}),this._cursor=this.rl?.cursor??0,this._setUserInput(this.rl?.line)),this.state==="error"&&(this.state="active"),n?.name&&(!this._track&&Tt.aliases.has(n.name)&&this.emit("cursor",Tt.aliases.get(n.name)),Tt.actions.has(n.name)&&this.emit("cursor",n.name)),t&&(t.toLowerCase()==="y"||t.toLowerCase()==="n")&&this.emit("confirm",t.toLowerCase()==="y"),this.emit("key",t?.toLowerCase(),n),n?.name==="return"){if(this.opts.validate){const r=this.opts.validate(this.value);r&&(this.error=r instanceof Error?r.message:r,this.state="error",this.rl?.write(this.userInput))}this.state!=="error"&&(this.state="submit")}Ec([t,n?.name,n?.sequence],"cancel")&&(this.state="cancel"),(this.state==="submit"||this.state==="cancel")&&this.emit("finalize"),this.render(),(this.state==="submit"||this.state==="cancel")&&this.close()}close(){this.input.unpipe(),this.input.removeListener("keypress",this.onKeypress),this.output.write(`
`),ma(this.input,!1),this.rl?.close(),this.rl=void 0,this.emit(`${this.state}`,this.value),this.unsubscribe()}restoreCursor(){const t=Dc(this._prevFrame,process.stdout.columns,{hard:!0,trim:!1}).split(`
`).length-1;this.output.write(at.cursor.move(-999,t*-1))}render(){const t=Dc(this._render(this)??"",process.stdout.columns,{hard:!0,trim:!1});if(t!==this._prevFrame){if(this.state==="initial")this.output.write(at.cursor.hide);else{const n=MT(this._prevFrame,t),r=Hy(this.output);if(this.restoreCursor(),n){const o=Math.max(0,n.numLinesAfter-r),s=Math.max(0,n.numLinesBefore-r);let a=n.lines.find(l=>l>=o);if(a===void 0){this._prevFrame=t;return}if(n.lines.length===1){this.output.write(at.cursor.move(0,a-s)),this.output.write(at.erase.lines(1));const l=t.split(`
`);this.output.write(l[a]),this._prevFrame=t,this.output.write(at.cursor.move(0,l.length-a-1));return}else if(n.lines.length>1){if(o<s)a=o;else{const u=a-s;u>0&&this.output.write(at.cursor.move(0,u))}this.output.write(at.erase.down());const l=t.split(`
`).slice(a);this.output.write(l.join(`
`)),this._prevFrame=t;return}}this.output.write(at.erase.down())}this.output.write(t),this.state==="initial"&&(this.state="active"),this._prevFrame=t}}},i(so,"x"),so),jT=(io=class extends Ns{get cursor(){return this.value?0:1}get _value(){return this.cursor===0}constructor(t){super(t,!1),this.value=!!t.initialValue,this.on("userInput",()=>{this.value=this._value}),this.on("confirm",n=>{this.output.write(at.cursor.move(0,-1)),this.value=n,this.state="submit",this.close()}),this.on("cursor",()=>{this.value=!this.value})}},i(io,"kt"),io);const bp=class bp extends Ns{constructor(t){super(t,!1),nt(this,"options"),nt(this,"cursor",0),this.options=t.options,this.value=[...t.initialValues??[]];const n=Math.max(this.options.findIndex(({value:r})=>r===t.cursorAt),0);this.cursor=this.options[n].disabled?ur(n,1,this.options):n,this.on("key",r=>{r==="a"&&this.toggleAll(),r==="i"&&this.toggleInvert()}),this.on("cursor",r=>{switch(r){case"left":case"up":this.cursor=ur(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=ur(this.cursor,1,this.options);break;case"space":this.toggleValue();break}})}get _value(){return this.options[this.cursor].value}get _enabledOptions(){return this.options.filter(t=>t.disabled!==!0)}toggleAll(){const t=this._enabledOptions,n=this.value!==void 0&&this.value.length===t.length;this.value=n?[]:t.map(r=>r.value)}toggleInvert(){const t=this.value;if(!t)return;const n=this._enabledOptions.filter(r=>!t.includes(r.value));this.value=n.map(r=>r.value)}toggleValue(){this.value===void 0&&(this.value=[]);const t=this.value.includes(this._value);this.value=t?this.value.filter(n=>n!==this._value):[...this.value,this._value]}};i(bp,"Lt");let $c=bp,LT=(ao=class extends Ns{constructor({mask:t,...n}){super(n),nt(this,"_mask","\u2022"),this._mask=t??"\u2022",this.on("userInput",r=>{this._setValue(r)})}get cursor(){return this._cursor}get masked(){return this.userInput.replaceAll(/./g,this._mask)}get userInputWithCursor(){if(this.state==="submit"||this.state==="cancel")return this.masked;const t=this.userInput;if(this.cursor>=t.length)return`${this.masked}${F.inverse(F.hidden("_"))}`;const n=this.masked,r=n.slice(0,this.cursor),o=n.slice(this.cursor);return`${r}${F.inverse(o[0])}${o.slice(1)}`}clear(){this._clearUserInput()}},i(ao,"Mt"),ao),UT=(lo=class extends Ns{constructor(t){super(t,!1),nt(this,"options"),nt(this,"cursor",0),this.options=t.options;const n=this.options.findIndex(({value:o})=>o===t.initialValue),r=n===-1?0:n;this.cursor=this.options[r].disabled?ur(r,1,this.options):r,this.changeValue(),this.on("cursor",o=>{switch(o){case"left":case"up":this.cursor=ur(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=ur(this.cursor,1,this.options);break}this.changeValue()})}get _selectedValue(){return this.options[this.cursor]}changeValue(){this.value=this._selectedValue.value}},i(lo,"Wt"),lo),zT=(uo=class extends Ns{get userInputWithCursor(){if(this.state==="submit")return this.userInput;const t=this.userInput;if(this.cursor>=t.length)return`${this.userInput}\u2588`;const n=t.slice(0,this.cursor),[r,...o]=t.slice(this.cursor);return`${n}${F.inverse(r)}${o.join("")}`}get cursor(){return this._cursor}constructor(t){super({...t,initialUserInput:t.initialUserInput??t.initialValue}),this.on("userInput",n=>{this._setValue(n)}),this.on("finalize",()=>{this.value||(this.value=t.defaultValue),this.value===void 0&&(this.value="")})}},i(uo,"$t"),uo);function qT(){return Se.platform!=="win32"?Se.env.TERM!=="linux":!!Se.env.CI||!!Se.env.WT_SESSION||!!Se.env.TERMINUS_SUBLIME||Se.env.ConEmuTask==="{cmd::Cmder}"||Se.env.TERM_PROGRAM==="Terminus-Sublime"||Se.env.TERM_PROGRAM==="vscode"||Se.env.TERM==="xterm-256color"||Se.env.TERM==="alacritty"||Se.env.TERMINAL_EMULATOR==="JetBrains-JediTerm"}i(qT,"me");const ga=qT(),Jy=i(()=>process.env.CI==="true","ct"),We=i((e,t)=>ga?e:t,"C"),Ky=We("\u25C6","*"),xc=We("\u25A0","x"),Sc=We("\u25B2","x"),Bs=We("\u25C7","o"),Yy=We("\u250C","T"),ue=We("\u2502","|"),Wt=We("\u2514","\u2014"),ya=We("\u25CF",">"),js=We("\u25CB"," "),Xy=We("\u25FB","[\u2022]"),kc=We("\u25FC","[+]"),Ic=We("\u25FB","[ ]"),Qy=We("\u25AA","\u2022"),Ac=We("\u2500","-"),ev=We("\u256E","+"),tv=We("\u251C","+"),nv=We("\u256F","+"),rv=We("\u25CF","\u2022"),ov=We("\u25C6","*"),sv=We("\u25B2","!"),iv=We("\u25A0","x"),Lr=i(e=>{switch(e){case"initial":case"active":return F.cyan(Ky);case"cancel":return F.red(xc);case"error":return F.yellow(Sc);case"submit":return F.green(Bs)}},"W"),Tc=i(e=>{switch(e){case"initial":case"active":return F.cyan(ue);case"cancel":return F.red(ue);case"error":return F.yellow(ue);case"submit":return F.green(ue)}},"vt"),VT=i(e=>e===161||e===164||e===167||e===168||e===170||e===173||e===174||e>=176&&e<=180||e>=182&&e<=186||e>=188&&e<=191||e===198||e===208||e===215||e===216||e>=222&&e<=225||e===230||e>=232&&e<=234||e===236||e===237||e===240||e===242||e===243||e>=247&&e<=250||e===252||e===254||e===257||e===273||e===275||e===283||e===294||e===295||e===299||e>=305&&e<=307||e===312||e>=319&&e<=322||e===324||e>=328&&e<=331||e===333||e===338||e===339||e===358||e===359||e===363||e===462||e===464||e===466||e===468||e===470||e===472||e===474||e===476||e===593||e===609||e===708||e===711||e>=713&&e<=715||e===717||e===720||e>=728&&e<=731||e===733||e===735||e>=768&&e<=879||e>=913&&e<=929||e>=931&&e<=937||e>=945&&e<=961||e>=963&&e<=969||e===1025||e>=1040&&e<=1103||e===1105||e===8208||e>=8211&&e<=8214||e===8216||e===8217||e===8220||e===8221||e>=8224&&e<=8226||e>=8228&&e<=8231||e===8240||e===8242||e===8243||e===8245||e===8251||e===8254||e===8308||e===8319||e>=8321&&e<=8324||e===8364||e===8451||e===8453||e===8457||e===8467||e===8470||e===8481||e===8482||e===8486||e===8491||e===8531||e===8532||e>=8539&&e<=8542||e>=8544&&e<=8555||e>=8560&&e<=8569||e===8585||e>=8592&&e<=8601||e===8632||e===8633||e===8658||e===8660||e===8679||e===8704||e===8706||e===8707||e===8711||e===8712||e===8715||e===8719||e===8721||e===8725||e===8730||e>=8733&&e<=8736||e===8739||e===8741||e>=8743&&e<=8748||e===8750||e>=8756&&e<=8759||e===8764||e===8765||e===8776||e===8780||e===8786||e===8800||e===8801||e>=8804&&e<=8807||e===8810||e===8811||e===8814||e===8815||e===8834||e===8835||e===8838||e===8839||e===8853||e===8857||e===8869||e===8895||e===8978||e>=9312&&e<=9449||e>=9451&&e<=9547||e>=9552&&e<=9587||e>=9600&&e<=9615||e>=9618&&e<=9621||e===9632||e===9633||e>=9635&&e<=9641||e===9650||e===9651||e===9654||e===9655||e===9660||e===9661||e===9664||e===9665||e>=9670&&e<=9672||e===9675||e>=9678&&e<=9681||e>=9698&&e<=9701||e===9711||e===9733||e===9734||e===9737||e===9742||e===9743||e===9756||e===9758||e===9792||e===9794||e===9824||e===9825||e>=9827&&e<=9829||e>=9831&&e<=9834||e===9836||e===9837||e===9839||e===9886||e===9887||e===9919||e>=9926&&e<=9933||e>=9935&&e<=9939||e>=9941&&e<=9953||e===9955||e===9960||e===9961||e>=9963&&e<=9969||e===9972||e>=9974&&e<=9977||e===9979||e===9980||e===9982||e===9983||e===10045||e>=10102&&e<=10111||e>=11094&&e<=11097||e>=12872&&e<=12879||e>=57344&&e<=63743||e>=65024&&e<=65039||e===65533||e>=127232&&e<=127242||e>=127248&&e<=127277||e>=127280&&e<=127337||e>=127344&&e<=127373||e===127375||e===127376||e>=127387&&e<=127404||e>=917760&&e<=917999||e>=983040&&e<=1048573||e>=1048576&&e<=1114109,"pe"),GT=i(e=>e===12288||e>=65281&&e<=65376||e>=65504&&e<=65510,"ge"),ZT=i(e=>e>=4352&&e<=4447||e===8986||e===8987||e===9001||e===9002||e>=9193&&e<=9196||e===9200||e===9203||e===9725||e===9726||e===9748||e===9749||e>=9800&&e<=9811||e===9855||e===9875||e===9889||e===9898||e===9899||e===9917||e===9918||e===9924||e===9925||e===9934||e===9940||e===9962||e===9970||e===9971||e===9973||e===9978||e===9981||e===9989||e===9994||e===9995||e===10024||e===10060||e===10062||e>=10067&&e<=10069||e===10071||e>=10133&&e<=10135||e===10160||e===10175||e===11035||e===11036||e===11088||e===11093||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12771||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=19903||e>=19968&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||e===94192||e===94193||e>=94208&&e<=100343||e>=100352&&e<=101589||e>=101632&&e<=101640||e>=110576&&e<=110579||e>=110581&&e<=110587||e===110589||e===110590||e>=110592&&e<=110882||e===110898||e>=110928&&e<=110930||e===110933||e>=110948&&e<=110951||e>=110960&&e<=111355||e===126980||e===127183||e===127374||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||e===127568||e===127569||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||e===127988||e>=127992&&e<=128062||e===128064||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||e===128378||e===128405||e===128406||e===128420||e>=128507&&e<=128591||e>=128640&&e<=128709||e===128716||e>=128720&&e<=128722||e>=128725&&e<=128727||e>=128732&&e<=128735||e===128747||e===128748||e>=128756&&e<=128764||e>=128992&&e<=129003||e===129008||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129672||e>=129680&&e<=129725||e>=129727&&e<=129733||e>=129742&&e<=129755||e>=129760&&e<=129768||e>=129776&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141,"fe"),Fc=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,va=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,_a=/\t{1,1000}/y,Oc=new RegExp("[\\u{1F1E6}-\\u{1F1FF}]{2}|\\u{1F3F4}[\\u{E0061}-\\u{E007A}]{2}[\\u{E0030}-\\u{E0039}\\u{E0061}-\\u{E007A}]{1,3}\\u{E007F}|(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation})(?:\\u200D(?:\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F\\u20E3?))*","yu"),ba=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,WT=new RegExp("\\p{M}+","gu"),HT={limit:1/0,ellipsis:""},av=i((e,t={},n={})=>{const r=t.limit??1/0,o=t.ellipsis??"",s=t?.ellipsisWidth??(o?av(o,HT,n).width:0),a=n.ansiWidth??0,l=n.controlWidth??0,u=n.tabWidth??8,c=n.ambiguousWidth??1,d=n.emojiWidth??2,p=n.fullWidthWidth??2,h=n.regularWidth??1,g=n.wideWidth??2;let f=0,y=0,v=e.length,_=0,w=!1,D=v,E=Math.max(0,r-s),I=0,T=0,$=0,x=0;e:for(;;){if(T>I||y>=v&&y>f){const j=e.slice(I,T)||e.slice(f,y);_=0;for(const S of j.replaceAll(WT,"")){const Z=S.codePointAt(0)||0;if(GT(Z)?x=p:ZT(Z)?x=g:c!==h&&VT(Z)?x=c:x=h,$+x>E&&(D=Math.min(D,Math.max(I,f)+_)),$+x>r){w=!0;break e}_+=S.length,$+=x}I=T=0}if(y>=v)break;if(ba.lastIndex=y,ba.test(e)){if(_=ba.lastIndex-y,x=_*h,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/h))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=ba.lastIndex;continue}if(Fc.lastIndex=y,Fc.test(e)){if($+a>E&&(D=Math.min(D,y)),$+a>r){w=!0;break}$+=a,I=f,T=y,y=f=Fc.lastIndex;continue}if(va.lastIndex=y,va.test(e)){if(_=va.lastIndex-y,x=_*l,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/l))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=va.lastIndex;continue}if(_a.lastIndex=y,_a.test(e)){if(_=_a.lastIndex-y,x=_*u,$+x>E&&(D=Math.min(D,y+Math.floor((E-$)/u))),$+x>r){w=!0;break}$+=x,I=f,T=y,y=f=_a.lastIndex;continue}if(Oc.lastIndex=y,Oc.test(e)){if($+d>E&&(D=Math.min(D,y)),$+d>r){w=!0;break}$+=d,I=f,T=y,y=f=Oc.lastIndex;continue}y+=1}return{width:w?E:$,index:w?D:v,truncated:w,ellipsed:w&&r>=s}},"jt"),JT={limit:1/0,ellipsis:"",ellipsisWidth:0},pn=i((e,t={})=>av(e,JT,t).width,"M"),wa="\x1B",lv="\x9B",KT=39,Rc="\x07",uv="[",YT="]",cv="m",Pc=`${YT}8;;`,dv=new RegExp(`(?:\\${uv}(?<code>\\d+)m|\\${Pc}(?<uri>.*)${Rc})`,"y"),XT=i(e=>{if(e>=30&&e<=37||e>=90&&e<=97)return 39;if(e>=40&&e<=47||e>=100&&e<=107)return 49;if(e===1||e===2)return 22;if(e===3)return 23;if(e===4)return 24;if(e===7)return 27;if(e===8)return 28;if(e===9)return 29;if(e===0)return 0},"we"),pv=i(e=>`${wa}${uv}${e}${cv}`,"Ut"),fv=i(e=>`${wa}${Pc}${e}${Rc}`,"Kt"),QT=i(e=>e.map(t=>pn(t)),"Ce"),Mc=i((e,t,n)=>{const r=t[Symbol.iterator]();let o=!1,s=!1,a=e.at(-1),l=a===void 0?0:pn(a),u=r.next(),c=r.next(),d=0;for(;!u.done;){const p=u.value,h=pn(p);l+h<=n?e[e.length-1]+=p:(e.push(p),l=0),(p===wa||p===lv)&&(o=!0,s=t.startsWith(Pc,d+1)),o?s?p===Rc&&(o=!1,s=!1):p===cv&&(o=!1):(l+=h,l===n&&!c.done&&(e.push(""),l=0)),u=c,c=r.next(),d+=p.length}a=e.at(-1),!l&&a!==void 0&&a.length>0&&e.length>1&&(e[e.length-2]+=e.pop())},"It"),eF=i(e=>{const t=e.split(" ");let n=t.length;for(;n>0&&!(pn(t[n-1])>0);)n--;return n===t.length?e:t.slice(0,n).join(" ")+t.slice(n).join("")},"Se"),tF=i((e,t,n={})=>{if(n.trim!==!1&&e.trim()==="")return"";let r="",o,s;const a=e.split(" "),l=QT(a);let u=[""];for(const[f,y]of a.entries()){n.trim!==!1&&(u[u.length-1]=(u.at(-1)??"").trimStart());let v=pn(u.at(-1)??"");if(f!==0&&(v>=t&&(n.wordWrap===!1||n.trim===!1)&&(u.push(""),v=0),(v>0||n.trim===!1)&&(u[u.length-1]+=" ",v++)),n.hard&&l[f]>t){const _=t-v,w=1+Math.floor((l[f]-_-1)/t);Math.floor((l[f]-1)/t)<w&&u.push(""),Mc(u,y,t);continue}if(v+l[f]>t&&v>0&&l[f]>0){if(n.wordWrap===!1&&v<t){Mc(u,y,t);continue}u.push("")}if(v+l[f]>t&&n.wordWrap===!1){Mc(u,y,t);continue}u[u.length-1]+=y}n.trim!==!1&&(u=u.map(f=>eF(f)));const c=u.join(`
`),d=c[Symbol.iterator]();let p=d.next(),h=d.next(),g=0;for(;!p.done;){const f=p.value,y=h.value;if(r+=f,f===wa||f===lv){dv.lastIndex=g+1;const _=dv.exec(c)?.groups;if(_?.code!==void 0){const w=Number.parseFloat(_.code);o=w===KT?void 0:w}else _?.uri!==void 0&&(s=_.uri.length===0?void 0:_.uri)}const v=o?XT(o):void 0;y===`
`?(s&&(r+=fv("")),o&&v&&(r+=pv(v))):f===`
`&&(o&&v&&(r+=pv(o)),s&&(r+=fv(s))),g+=f.length,p=h,h=d.next()}return r},"Ie");function Ls(e,t,n){return String(e).normalize().replaceAll(`\r
`,`
`).split(`
`).map(r=>tF(r,t,n)).join(`
`)}i(Ls,"J");const nF=i((e,t,n,r,o)=>{let s=t,a=0;for(let l=n;l<r;l++){const u=e[l];if(s=s-u.length,a++,s<=o)break}return{lineCount:s,removals:a}},"be"),Da=i(e=>{const{cursor:t,options:n,style:r}=e,o=e.output??process.stdout,s=ha(o),a=e.columnPadding??0,l=e.rowPadding??4,u=s-a,c=Hy(o),d=F.dim("..."),p=e.maxItems??Number.POSITIVE_INFINITY,h=Math.max(c-l,0),g=Math.max(Math.min(p,h),5);let f=0;t>=g-3&&(f=Math.max(Math.min(t-g+3,n.length-g),0));let y=g<n.length&&f>0,v=g<n.length&&f+g<n.length;const _=Math.min(f+g,n.length),w=[];let D=0;y&&D++,v&&D++;const E=f+(y?1:0),I=_-(v?1:0);for(let $=E;$<I;$++){const x=Ls(r(n[$],$===t),u,{hard:!0,trim:!1}).split(`
`);w.push(x),D+=x.length}if(D>h){let $=0,x=0,j=D;const S=t-E,Z=i((R,B)=>nF(w,j,R,B,h),"T");y?({lineCount:j,removals:$}=Z(0,S),j>h&&({lineCount:j,removals:x}=Z(S+1,w.length))):({lineCount:j,removals:x}=Z(S+1,w.length),j>h&&({lineCount:j,removals:$}=Z(0,S))),$>0&&(y=!0,w.splice(0,$)),x>0&&(v=!0,w.splice(w.length-x,x))}const T=[];y&&T.push(d);for(const $ of w)for(const x of $)T.push(x);return v&&T.push(d),T},"X"),fn=i(e=>{const t=e.active??"Yes",n=e.inactive??"No";return new jT({active:t,inactive:n,signal:e.signal,input:e.input,output:e.output,initialValue:e.initialValue??!0,render(){const r=e.withGuide??Tt.withGuide,o=`${r?`${F.gray(ue)}
`:""}${Lr(this.state)}  ${e.message}
`,s=this.value?t:n;switch(this.state){case"submit":{const a=r?`${F.gray(ue)}  `:"";return`${o}${a}${F.dim(s)}`}case"cancel":{const a=r?`${F.gray(ue)}  `:"";return`${o}${a}${F.strikethrough(F.dim(s))}${r?`
${F.gray(ue)}`:""}`}default:{const a=r?`${F.cyan(ue)}  `:"",l=r?F.cyan(Wt):"";return`${o}${a}${this.value?`${F.green(ya)} ${t}`:`${F.dim(js)} ${F.dim(t)}`}${e.vertical?r?`
${F.cyan(ue)}  `:`
`:` ${F.dim("/")} `}${this.value?`${F.dim(js)} ${F.dim(n)}`:`${F.green(ya)} ${n}`}
${l}
`}}}}).prompt()},"Re"),Ut={message:i((e=[],{symbol:t=F.gray(ue),secondarySymbol:n=F.gray(ue),output:r=process.stdout,spacing:o=1,withGuide:s}={})=>{const a=[],l=s??Tt.withGuide,u=l?n:"",c=l?`${t}  `:"",d=l?`${n}  `:"";for(let h=0;h<o;h++)a.push(u);const p=Array.isArray(e)?e:e.split(`
`);if(p.length>0){const[h,...g]=p;h.length>0?a.push(`${c}${h}`):a.push(l?t:"");for(const f of g)f.length>0?a.push(`${d}${f}`):a.push(l?n:"")}r.write(`${a.join(`
`)}
`)},"message"),info:i((e,t)=>{Ut.message(e,{...t,symbol:F.blue(rv)})},"info"),success:i((e,t)=>{Ut.message(e,{...t,symbol:F.green(ov)})},"success"),step:i((e,t)=>{Ut.message(e,{...t,symbol:F.green(Bs)})},"step"),warn:i((e,t)=>{Ut.message(e,{...t,symbol:F.yellow(sv)})},"warn"),warning:i((e,t)=>{Ut.warn(e,t)},"warning"),error:i((e,t)=>{Ut.message(e,{...t,symbol:F.red(iv)})},"error")},Ft=i((e="",t)=>{process.stdout.write(`${F.gray(Wt)}  ${F.red(e)}

`)},"Ne"),mn=i((e="",t)=>{process.stdout.write(`${F.gray(Yy)}  ${e}
`)},"We"),ee=i((e="",t)=>{process.stdout.write(`${F.gray(ue)}
${F.gray(Wt)}  ${e}

`)},"Le"),Us=i((e,t)=>e.split(`
`).map(n=>t(n)).join(`
`),"Z"),Ea=i(e=>{const t=i((r,o)=>{const s=r.label??String(r.value);return o==="disabled"?`${F.gray(Ic)} ${Us(s,a=>F.strikethrough(F.gray(a)))}${r.hint?` ${F.dim(`(${r.hint??"disabled"})`)}`:""}`:o==="active"?`${F.cyan(Xy)} ${s}${r.hint?` ${F.dim(`(${r.hint})`)}`:""}`:o==="selected"?`${F.green(kc)} ${Us(s,F.dim)}${r.hint?` ${F.dim(`(${r.hint})`)}`:""}`:o==="cancelled"?`${Us(s,a=>F.strikethrough(F.dim(a)))}`:o==="active-selected"?`${F.green(kc)} ${s}${r.hint?` ${F.dim(`(${r.hint})`)}`:""}`:o==="submitted"?`${Us(s,F.dim)}`:`${F.dim(Ic)} ${Us(s,F.dim)}`},"r"),n=e.required??!0;return new $c({options:e.options,signal:e.signal,input:e.input,output:e.output,initialValues:e.initialValues,required:n,cursorAt:e.cursorAt,validate(r){if(n&&(r===void 0||r.length===0))return`Please select at least one option.
${F.reset(F.dim(`Press ${F.gray(F.bgWhite(F.inverse(" space ")))} to select, ${F.gray(F.bgWhite(F.inverse(" enter ")))} to submit`))}`},render(){const r=jr(e.output,e.message,`${Tc(this.state)}  `,`${Lr(this.state)}  `),o=`${F.gray(ue)}
${r}
`,s=this.value??[],a=i((l,u)=>{if(l.disabled)return t(l,"disabled");const c=s.includes(l.value);return u&&c?t(l,"active-selected"):c?t(l,"selected"):t(l,u?"active":"inactive")},"u");switch(this.state){case"submit":{const l=this.options.filter(({value:c})=>s.includes(c)).map(c=>t(c,"submitted")).join(F.dim(", "))||F.dim("none"),u=jr(e.output,l,`${F.gray(ue)}  `);return`${o}${u}`}case"cancel":{const l=this.options.filter(({value:c})=>s.includes(c)).map(c=>t(c,"cancelled")).join(F.dim(", "));if(l.trim()==="")return`${o}${F.gray(ue)}`;const u=jr(e.output,l,`${F.gray(ue)}  `);return`${o}${u}
${F.gray(ue)}`}case"error":{const l=`${F.yellow(ue)}  `,u=this.error.split(`
`).map((p,h)=>h===0?`${F.yellow(Wt)}  ${F.yellow(p)}`:`   ${p}`).join(`
`),c=o.split(`
`).length,d=u.split(`
`).length+1;return`${o}${l}${Da({output:e.output,options:this.options,cursor:this.cursor,maxItems:e.maxItems,columnPadding:l.length,rowPadding:c+d,style:a}).join(`
${l}`)}
${u}
`}default:{const l=`${F.cyan(ue)}  `,u=o.split(`
`).length;return`${o}${l}${Da({output:e.output,options:this.options,cursor:this.cursor,maxItems:e.maxItems,columnPadding:l.length,rowPadding:u+2,style:a}).join(`
${l}`)}
${F.cyan(Wt)}
`}}}}).prompt()},"je"),rF=i(e=>F.dim(e),"Ge"),oF=i((e,t,n)=>{const r={hard:!0,trim:!1},o=Ls(e,t,r).split(`
`),s=o.reduce((u,c)=>Math.max(pn(c),u),0),a=o.map(n).reduce((u,c)=>Math.max(pn(c),u),0),l=t-(a-s);return Ls(e,l,r)},"ke"),Ur=i((e="",t="",n)=>{const r=Se.stdout,o=rF,s=["",...oF(e,ha(r)-6,o).split(`
`).map(o),""],a=pn(t),l=Math.max(s.reduce((p,h)=>{const g=pn(h);return g>p?g:p},0),a)+2,u=s.map(p=>`${F.gray(ue)}  ${p}${" ".repeat(l-pn(p))}${F.gray(ue)}`).join(`
`),c=`${F.gray(ue)}
`,d=tv;r.write(`${c}${F.green(Bs)}  ${F.reset(t)} ${F.gray(Ac.repeat(Math.max(l-a-1,1))+ev)}
${u}
${F.gray(d+Ac.repeat(l+2)+nv)}
`)},"Ve"),sF=i(e=>new LT({validate:e.validate,mask:e.mask??Qy,signal:e.signal,input:e.input,output:e.output,render(){const t=e.withGuide??Tt.withGuide,n=`${t?`${F.gray(ue)}
`:""}${Lr(this.state)}  ${e.message}
`,r=this.userInputWithCursor,o=this.masked;switch(this.state){case"error":{const s=t?`${F.yellow(ue)}  `:"",a=t?`${F.yellow(Wt)}  `:"",l=o??"";return e.clearOnError&&this.clear(),`${n.trim()}
${s}${l}
${a}${F.yellow(this.error)}
`}case"submit":{const s=t?`${F.gray(ue)}  `:"",a=o?F.dim(o):"";return`${n}${s}${a}`}case"cancel":{const s=t?`${F.gray(ue)}  `:"",a=o?F.strikethrough(F.dim(o)):"";return`${n}${s}${a}${o&&t?`
${F.gray(ue)}`:""}`}default:{const s=t?`${F.cyan(ue)}  `:"",a=t?F.cyan(Wt):"";return`${n}${s}${r}
${a}
`}}}}).prompt(),"He"),iF=F.magenta,He=i(({indicator:e="dots",onCancel:t,output:n=process.stdout,cancelMessage:r,errorMessage:o,frames:s=ga?["\u25D2","\u25D0","\u25D3","\u25D1"]:["\u2022","o","O","0"],delay:a=ga?80:120,signal:l,...u}={})=>{const c=Jy();let d,p,h=!1,g=!1,f="",y,v=performance.now();const _=ha(n),w=u?.styleFrame??iF,D=i(P=>{const L=P>1?o??Tt.messages.error:r??Tt.messages.cancel;g=P===1,h&&(B(L,P),g&&typeof t=="function"&&t())},"v"),E=i(()=>D(2),"S"),I=i(()=>D(1),"I"),T=i(()=>{process.on("uncaughtExceptionMonitor",E),process.on("unhandledRejection",E),process.on("SIGINT",I),process.on("SIGTERM",I),process.on("exit",D),l&&l.addEventListener("abort",I)},"B"),$=i(()=>{process.removeListener("uncaughtExceptionMonitor",E),process.removeListener("unhandledRejection",E),process.removeListener("SIGINT",I),process.removeListener("SIGTERM",I),process.removeListener("exit",D),l&&l.removeEventListener("abort",I)},"A"),x=i(()=>{if(y===void 0)return;c&&n.write(`
`);const P=Ls(y,_,{hard:!0,trim:!1}).split(`
`);P.length>1&&n.write(at.cursor.up(P.length-1)),n.write(at.cursor.to(0)),n.write(at.erase.down())},"w"),j=i(P=>P.replace(/\.+$/,""),"_$1"),S=i(P=>{const L=(performance.now()-P)/1e3,N=Math.floor(L/60),J=Math.floor(L%60);return N>0?`[${N}m ${J}s]`:`[${J}s]`},"D"),Z=u.withGuide??Tt.withGuide,R=i((P="")=>{h=!0,d=BT({output:n}),f=j(P),v=performance.now(),Z&&n.write(`${F.gray(ue)}
`);let L=0,N=0;T(),p=setInterval(()=>{if(c&&f===y)return;x(),y=f;const J=w(s[L]);let ve;if(c)ve=`${J}  ${f}...`;else if(e==="timer")ve=`${J}  ${f} ${S(v)}`;else{const le=".".repeat(Math.floor(N)).slice(0,3);ve=`${J}  ${f}${le}`}const re=Ls(ve,_,{hard:!0,trim:!1});n.write(re),L=L+1<s.length?L+1:0,N=N<4?N+.125:0},a)},"Y"),B=i((P="",L=0,N=!1)=>{if(!h)return;h=!1,clearInterval(p),x();const J=L===0?F.green(Bs):L===1?F.red(xc):F.red(Sc);f=P??f,N||(e==="timer"?n.write(`${J}  ${f} ${S(v)}
`):n.write(`${J}  ${f}
`)),$(),d()},"L");return{start:R,stop:i((P="")=>B(P,0),"stop"),message:i((P="")=>{f=j(P??f)},"message"),cancel:i((P="")=>B(P,1),"cancel"),error:i((P="")=>B(P,2),"error"),clear:i(()=>B("",0,!0),"clear"),get isCancelled(){return g}}},"bt"),Ca=i((e,t)=>e.includes(`
`)?e.split(`
`).map(n=>t(n)).join(`
`):t(e),"lt"),Dn=i(e=>{const t=i((n,r)=>{const o=n.label??String(n.value);switch(r){case"disabled":return`${F.gray(js)} ${Ca(o,F.gray)}${n.hint?` ${F.dim(`(${n.hint??"disabled"})`)}`:""}`;case"selected":return`${Ca(o,F.dim)}`;case"active":return`${F.green(ya)} ${o}${n.hint?` ${F.dim(`(${n.hint})`)}`:""}`;case"cancelled":return`${Ca(o,s=>F.strikethrough(F.dim(s)))}`;default:return`${F.dim(js)} ${Ca(o,F.dim)}`}},"r");return new UT({options:e.options,signal:e.signal,input:e.input,output:e.output,initialValue:e.initialValue,render(){const n=e.withGuide??Tt.withGuide,r=`${Lr(this.state)}  `,o=`${Tc(this.state)}  `,s=jr(e.output,e.message,o,r),a=`${n?`${F.gray(ue)}
`:""}${s}
`;switch(this.state){case"submit":{const l=n?`${F.gray(ue)}  `:"",u=jr(e.output,t(this.options[this.cursor],"selected"),l);return`${a}${u}`}case"cancel":{const l=n?`${F.gray(ue)}  `:"",u=jr(e.output,t(this.options[this.cursor],"cancelled"),l);return`${a}${u}${n?`
${F.gray(ue)}`:""}`}default:{const l=n?`${F.cyan(ue)}  `:"",u=n?F.cyan(Wt):"",c=a.split(`
`).length,d=n?2:1;return`${a}${l}${Da({output:e.output,cursor:this.cursor,options:this.options,maxItems:e.maxItems,columnPadding:l.length,rowPadding:c+d,style:i((p,h)=>t(p,p.disabled?"disabled":h?"active":"inactive"),"style")}).join(`
${l}`)}
${u}
`}}}}).prompt()},"Je");`${F.gray(ue)}`;const hn=i(e=>new zT({validate:e.validate,placeholder:e.placeholder,defaultValue:e.defaultValue,initialValue:e.initialValue,output:e.output,signal:e.signal,input:e.input,render(){const t=e?.withGuide??Tt.withGuide,n=`${`${t?`${F.gray(ue)}
`:""}${Lr(this.state)}  `}${e.message}
`,r=e.placeholder?F.inverse(e.placeholder[0])+F.dim(e.placeholder.slice(1)):F.inverse(F.hidden("_")),o=this.userInput?this.userInputWithCursor:r,s=this.value??"";switch(this.state){case"error":{const a=this.error?`  ${F.yellow(this.error)}`:"",l=t?`${F.yellow(ue)}  `:"",u=t?F.yellow(Wt):"";return`${n.trim()}
${l}${o}
${u}${a}
`}case"submit":{const a=s?`  ${F.dim(s)}`:"",l=t?F.gray(ue):"";return`${n}${l}${a}`}case"cancel":{const a=s?`  ${F.strikethrough(F.dim(s))}`:"",l=t?F.gray(ue):"";return`${n}${l}${a}${s.trim()?`
${l}`:""}`}default:{const a=t?`${F.cyan(ue)}  `:"",l=t?F.cyan(Wt):"";return`${n}${a}${o}
${l}
`}}}}).prompt(),"Ze");var zs=Object.freeze({__proto__:null,S_BAR:ue,S_BAR_END:Wt,S_BAR_H:Ac,S_BAR_START:Yy,S_CHECKBOX_ACTIVE:Xy,S_CHECKBOX_INACTIVE:Ic,S_CHECKBOX_SELECTED:kc,S_CONNECT_LEFT:tv,S_CORNER_BOTTOM_RIGHT:nv,S_CORNER_TOP_RIGHT:ev,S_ERROR:iv,S_INFO:rv,S_PASSWORD_MASK:Qy,S_RADIO_ACTIVE:ya,S_RADIO_INACTIVE:js,S_STEP_ACTIVE:Ky,S_STEP_CANCEL:xc,S_STEP_ERROR:Sc,S_STEP_SUBMIT:Bs,S_SUCCESS:ov,S_WARN:sv,cancel:Ft,confirm:fn,intro:mn,isCI:Jy,isCancel:lt,limitOptions:Da,log:Ut,multiselect:Ea,note:Ur,outro:ee,password:sF,select:Dn,settings:Tt,spinner:He,symbol:Lr,symbolBar:Tc,text:hn,unicode:ga,unicodeOr:We});const{version:aF}=Em,wp=class wp extends Error{};i(wp,"KnownError");let pe=wp;const Nc="    ",mv=i(e=>{e instanceof Error&&!(e instanceof pe)&&(e.stack&&console.error(V(e.stack.split(`
`).slice(1).join(`
`))),console.error(`
${Nc}${V(`aicommits v${aF}`)}`),console.error(`
${Nc}Please open a Bug report with the information above:`),console.error(`${Nc}https://github.com/Nutlope/aicommits/issues/new/choose`))},"handleCliError"),zr=i(e=>{process.stderr.write(`${dn("\u2716")} ${e.message}
`),mv(e),process.exit(1)},"handleCommandError"),$a=i(async()=>{const{stdout:e,failed:t}=await we("git",["rev-parse","--show-toplevel"],{reject:!1});if(t)throw new pe("The current directory must be a Git repository!");return e},"assertGitRepo"),xa=i(e=>`:(exclude)${e}`,"excludeFromDiff"),hv=["package-lock.json","pnpm-lock.yaml","*.lock"],gv=i(e=>hv.some(t=>t.includes("*")?e.endsWith(".lock"):e.endsWith("/"+t)||e===t),"isLockFile"),Bc=hv.map(xa),jc=i(async e=>{const t=["diff","--cached","--diff-algorithm=minimal"],{stdout:n}=await we("git",[...t,"--name-only",...e?e.map(xa):[]]);if(!n)return;const o=n.split(`
`).filter(Boolean).some(u=>!gv(u));let s=[];o&&(s=[...Bc]),s=[...s,...e?e.map(xa):[]];const{stdout:a}=await we("git",[...t,"--name-only",...s]);if(!a)return;const{stdout:l}=await we("git",[...t,...s]);return{files:a.split(`
`),diff:l}},"getStagedDiff"),lF=i(async(e,t)=>{const n=["diff","--cached","--diff-algorithm=minimal"],r=[...Bc,...t?t.map(xa):[]],{stdout:o}=await we("git",[...n,"--",...e,...r]);return{files:e,diff:o}},"getStagedDiffForFiles"),yv=i(e=>`Detected ${e.length.toLocaleString()} staged file${e.length>1?"s":""}`,"getDetectedMessage"),uF=i(async e=>{const{stdout:t}=await we("git",["diff","--name-only","--diff-algorithm=minimal"]),n=t.split(`
`).filter(Boolean);let r=[];if(e){const{stdout:a}=await we("git",["ls-files","--others","--exclude-standard"]);r=a.split(`
`).filter(Boolean)}const o=[...n,...r];if(o.length===0)return;let s="";if(n.length>0){const l=n.some(c=>!gv(c))?Bc:[],{stdout:u}=await we("git",["diff","--diff-algorithm=minimal",...l]);s=u}return{files:o,modifiedFiles:n,untrackedFiles:r,diff:s}},"getUnstagedChanges"),Lc=i(async e=>{await we("git",["add","--",...e])},"stageFiles"),vv=i(async e=>{if(e.length===0)return"";const{stdout:t}=await we("git",["diff","--diff-algorithm=minimal","--",...e]);return t},"getUnstagedDiffForFiles"),cF=i(async e=>{if(e.length===0)return"";const{stdout:t}=await we("git",["diff","--stat","--diff-algorithm=minimal","--",...e]);return t},"getUnstagedDiffStat"),dF=i(async()=>{const{stdout:e}=await we("git",["diff","--cached","--name-only"]),{stdout:t}=await we("git",["diff","--name-only"]),n=new Set(e.split(`
`).filter(Boolean));return t.split(`
`).filter(Boolean).filter(r=>n.has(r))},"getPartiallyStaged"),pF=i(async e=>{e.length!==0&&await we("git",["reset","HEAD","--",...e])},"unstageFiles"),_v=i(async e=>{if(e.length===0)return"";const{stdout:t}=await we("git",["diff","--cached","--diff-algorithm=minimal","--",...e]);return t},"getStagedDiffForBoundary"),fF=i(async e=>{if(e.length===0)return"";const{stdout:t}=await we("git",["diff","--cached","--stat","--diff-algorithm=minimal","--",...e]);return t},"getStagedDiffStat");var Uc,bv;function mF(){if(bv)return Uc;bv=1;const{hasOwnProperty:e}=Object.prototype,t=i((l,u={})=>{typeof u=="string"&&(u={section:u}),u.align=u.align===!0,u.newline=u.newline===!0,u.sort=u.sort===!0,u.whitespace=u.whitespace===!0||u.align===!0,u.platform=u.platform||typeof process<"u"&&process.platform,u.bracketedArray=u.bracketedArray!==!1;const c=u.platform==="win32"?`\r
`:`
`,d=u.whitespace?" = ":"=",p=[],h=u.sort?Object.keys(l).sort():Object.keys(l);let g=0;u.align&&(g=s(h.filter(v=>l[v]===null||Array.isArray(l[v])||typeof l[v]!="object").map(v=>Array.isArray(l[v])?`${v}[]`:v).concat([""]).reduce((v,_)=>s(v).length>=s(_).length?v:_)).length);let f="";const y=u.bracketedArray?"[]":"";for(const v of h){const _=l[v];if(_&&Array.isArray(_))for(const w of _)f+=s(`${v}${y}`).padEnd(g," ")+d+s(w)+c;else _&&typeof _=="object"?p.push(v):f+=s(v).padEnd(g," ")+d+s(_)+c}u.section&&f.length&&(f="["+s(u.section)+"]"+(u.newline?c+c:c)+f);for(const v of p){const _=n(v,".").join("\\."),w=(u.section?u.section+".":"")+_,D=t(l[v],{...u,section:w});f.length&&D.length&&(f+=c),f+=D}return f},"encode");function n(l,u){var c=0,d=0,p=0,h=[];do if(p=l.indexOf(u,c),p!==-1){if(c=p+u.length,p>0&&l[p-1]==="\\")continue;h.push(l.slice(d,p)),d=p+u.length}while(p!==-1);return h.push(l.slice(d)),h}i(n,"splitSections");const r=i((l,u={})=>{u.bracketedArray=u.bracketedArray!==!1;const c=Object.create(null);let d=c,p=null;const h=/^\[([^\]]*)\]\s*$|^([^=]+)(=(.*))?$/i,g=l.split(/[\r\n]+/g),f={};for(const v of g){if(!v||v.match(/^\s*[;#]/)||v.match(/^\s*$/))continue;const _=v.match(h);if(!_)continue;if(_[1]!==void 0){if(p=a(_[1]),p==="__proto__"){d=Object.create(null);continue}d=c[p]=c[p]||Object.create(null);continue}const w=a(_[2]);let D;u.bracketedArray?D=w.length>2&&w.slice(-2)==="[]":(f[w]=(f?.[w]||0)+1,D=f[w]>1);const E=D&&w.endsWith("[]")?w.slice(0,-2):w;if(E==="__proto__")continue;const I=_[3]?a(_[4]):!0,T=I==="true"||I==="false"||I==="null"?JSON.parse(I):I;D&&(e.call(d,E)?Array.isArray(d[E])||(d[E]=[d[E]]):d[E]=[]),Array.isArray(d[E])?d[E].push(T):d[E]=T}const y=[];for(const v of Object.keys(c)){if(!e.call(c,v)||typeof c[v]!="object"||Array.isArray(c[v]))continue;const _=n(v,".");d=c;const w=_.pop(),D=w.replace(/\\\./g,".");for(const E of _)E!=="__proto__"&&((!e.call(d,E)||typeof d[E]!="object")&&(d[E]=Object.create(null)),d=d[E]);d===c&&D===w||(d[D]=c[v],y.push(v))}for(const v of y)delete c[v];return c},"decode"),o=i(l=>l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"),"isQuoted"),s=i(l=>typeof l!="string"||l.match(/[=\r\n]/)||l.match(/^\[/)||l.length>1&&o(l)||l!==l.trim()?JSON.stringify(l):l.split(";").join("\\;").split("#").join("\\#"),"safe"),a=i(l=>{if(l=(l||"").trim(),o(l)){l.charAt(0)==="'"&&(l=l.slice(1,-1));try{l=JSON.parse(l)}catch{}}else{let u=!1,c="";for(let d=0,p=l.length;d<p;d++){const h=l.charAt(d);if(u)"\\;#".indexOf(h)!==-1?c+=h:c+="\\"+h,u=!1;else{if(";#".indexOf(h)!==-1)break;h==="\\"?u=!0:c+=h}}return u&&(c+="\\"),c.trim()}return l},"unsafe");return Uc={parse:r,decode:r,stringify:t,encode:t,safe:s,unsafe:a},Uc}i(mF,"requireIni");var hF=mF(),Sa=Bi(hF);const ka=i(e=>et.lstat(e).then(()=>!0,()=>!1),"fileExists"),gF=["plain","conventional","gitmoji"],{hasOwnProperty:yF}=Object.prototype,zc=i((e,t)=>yF.call(e,t),"hasOwn"),zt=i((e,t,n)=>{if(!t)throw new pe(`Invalid config property ${e}: ${n}`)},"parseAssert"),Ia={OPENAI_API_KEY(e){return e},OPENAI_BASE_URL(e){return e},OPENAI_MODEL(e){return e||""},locale(e){return e?(zt("locale",!!e,"Cannot be empty"),zt("locale",/^[a-z-]+$/i.test(e),"Must be a valid locale (letters and dashes/underscores)."),e):"en"},generate(e){if(!e)return 1;zt("generate",/^\d+$/.test(e),"Must be an integer");const t=Number(e);return zt("generate",t>0,"Must be greater than 0"),zt("generate",t<=5,"Must be less or equal to 5"),t},type(e){return e?(zt("type",gF.includes(e),"Invalid commit type"),e):"plain"},proxy(e){if(!(!e||e.length===0))throw new pe('The "proxy" config property is deprecated and no longer supported.')},timeout(e){if(!e)return;zt("timeout",/^\d+$/.test(e),"Must be an integer");const t=Number(e);return zt("timeout",t>=500,"Must be greater than 500ms"),t},"max-length"(e){if(!e)return 72;zt("max-length",/^\d+$/.test(e),"Must be an integer");const t=Number(e);return zt("max-length",t>=20,"Must be greater than 20 characters"),t},"post-commit"(e){if(!(!e||e.trim()===""))return e.trim()},"auto-rebuild"(e){if(!e||e.trim()==="")return"prompt";const t=e.trim().toLowerCase();return zt("auto-rebuild",["prompt","auto","off"].includes(t),"Must be prompt, auto, or off"),t},"rebuild-command"(e){if(!(!e||e.trim()===""))return e.trim()},"rebuild-source-dir"(e){if(!(!e||e.trim()===""))return e.trim()},"post-commit-rebuild"(e){if(!e||e.trim()==="")return"off";const t=e.trim().toLowerCase();return zt("post-commit-rebuild",["smart","always","off"].includes(t),"Must be smart, always, or off"),t},"post-commit-install"(e){if(e==null)return!1;if(typeof e=="boolean")return e;const t=String(e).trim().toLowerCase();return t===""?!1:t==="true"||t==="1"||t==="yes"},"post-commit-branches"(e){if(!(!e||e.trim()===""))return e.trim()},"post-commit-tag-pattern"(e){if(!(!e||e.trim()===""))return e.trim()}},vF={name:"togetherai",displayName:"Together AI (recommended)",baseUrl:"https://api.together.xyz/v1",apiKeyFormat:"tgp_",modelsFilter:i(e=>e.filter(t=>(!t.type||t.type==="chat"||t.type==="language")&&!t.id.toLowerCase().includes("vision")).map(t=>t.id),"modelsFilter"),defaultModels:["moonshotai/Kimi-K2-Instruct-0905","Qwen/Qwen3-Next-80B-A3B-Instruct","zai-org/GLM-4.5-Air-FP8","meta-llama/Llama-3.2-3B-Instruct-Turbo"],requiresApiKey:!0},_F={name:"openai",displayName:"OpenAI",baseUrl:"https://api.openai.com/v1",apiKeyFormat:"sk-",modelsFilter:i(e=>e.filter(t=>t.id&&(t.id.includes("gpt")||t.id.includes("o1")||t.id.includes("o3")||t.id.includes("o4")||t.id.includes("o5")||!t.type||t.type==="chat")).map(t=>t.id),"modelsFilter"),defaultModels:["gpt-5-mini","gpt-4o-mini","gpt-4o","gpt-5-nano"],requiresApiKey:!0},bF={name:"copilot",displayName:"GitHub Copilot",baseUrl:"https://models.github.ai/inference",modelsUrl:"https://models.github.ai/catalog/models",apiKeyHint:"GitHub Personal Access Token (needs models:read scope)",requiresApiKey:!0,defaultModels:["openai/gpt-4.1","openai/gpt-4o","openai/gpt-4o-mini","anthropic/claude-sonnet-4"],modelsFilter:i(e=>e.filter(t=>(t.supported_input_modalities||[]).includes("text")).map(t=>t.id).filter(Boolean),"modelsFilter"),setupHook:i(async()=>{try{const{execSync:e}=await import("child_process"),t=e("gh auth token",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return t}catch{}return null},"setupHook")},wF={name:"mistral",displayName:"Mistral AI",baseUrl:"https://api.mistral.ai/v1",requiresApiKey:!0,apiKeyHint:"Mistral API key from https://console.mistral.ai",defaultModels:["mistral-small-latest","mistral-medium-latest","mistral-large-latest","codestral-latest"]},DF={name:"ollama",displayName:"Ollama (local)",baseUrl:"http://localhost:11434/v1",modelsFilter:i(e=>e.filter(t=>t.name).map(t=>t.name),"modelsFilter"),defaultModels:["gpt-oss:latest","llama3.2:latest"],requiresApiKey:!1},EF={name:"custom",displayName:"Custom (OpenAI-compatible)",baseUrl:"",modelsFilter:i(e=>e.filter(t=>!t.type||t.type==="chat"||t.type==="language").map(t=>t.id),"modelsFilter"),defaultModels:[],requiresApiKey:!0},CF={name:"openrouter",displayName:"OpenRouter",baseUrl:"https://openrouter.ai/api/v1",apiKeyFormat:"sk-or-v1-",modelsFilter:i(e=>e.filter(t=>t.id&&(!t.type||t.type==="chat")).map(t=>t.id),"modelsFilter"),defaultModels:["openai/gpt-oss-20b:free","z-ai/glm-4.5-air:free"],requiresApiKey:!0},$F={name:"lmstudio",displayName:"LM Studio (local)",baseUrl:"http://localhost:1234/v1",modelsFilter:i(e=>e.filter(t=>!t.type||t.type==="chat"||t.type==="language").map(t=>t.id),"modelsFilter"),defaultModels:["qwen/qwen3-4b-2507","qwen/qwen3-8b"],requiresApiKey:!1},qs=[vF,_F,bF,wF,DF,$F,CF,EF],Vs="aicommits";function xF(){const e=process.env.XDG_CONFIG_HOME;return e&&Xe.isAbsolute(e)?e:Xe.join(Ll.homedir(),".config")}i(xF,"xdgConfigHome");function SF(){const e=process.env.XDG_CACHE_HOME;return e&&Xe.isAbsolute(e)?e:Xe.join(Ll.homedir(),".cache")}i(SF,"xdgCacheHome");function kF(){const e=process.env.XDG_CONFIG_DIRS;return e?e.split(":").filter(t=>t&&Xe.isAbsolute(t)):["/etc/xdg"]}i(kF,"xdgConfigDirs");function qc(){return Xe.join(xF(),Vs)}i(qc,"getConfigDir");function Vc(){return Xe.join(qc(),"config")}i(Vc,"getConfigFilePath");function Aa(){return Xe.join(Ll.homedir(),`.${Vs}`)}i(Aa,"getLegacyConfigPath");function wv(){return kF().map(e=>Xe.join(e,Vs,"config"))}i(wv,"getSystemConfigPaths");function Dv(){return Xe.join(SF(),Vs)}i(Dv,"getCacheDir$1");function Ev(e){const t=AF();if(!t)return null;const n=Xe.join(t,`.${Vs}`);return Le(n)?n:null}i(Ev,"getProjectConfigPath");function Ht(){const e=process.env.AICOMMITS_CONFIG;if(e&&Xe.isAbsolute(e))return e;const t=Vc();if(Le(t))return t;const n=Aa();return Le(n)?n:t}i(Ht,"resolveConfigPath");function IF(){return Ht()===Aa()}i(IF,"isUsingLegacyConfig");function AF(){try{const{execSync:e}=nD("child_process");return e("git rev-parse --show-toplevel",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).trim()}catch{return null}}i(AF,"findGitRootSync");const TF=i(()=>qs.find(t=>t.name==="openai")?.baseUrl||"","getDefaultBaseUrl"),FF=i((e,t)=>{if(e){const n=qs.find(r=>r.baseUrl===e||r.name==="ollama"&&e.startsWith(r.baseUrl.slice(0,-3))||r.name==="copilot"&&e.includes("models.github.ai")||r.name==="mistral"&&e.includes("api.mistral.ai"));return n?n.name:"custom"}else if(t)return"openai"},"detectProvider"),Cv=i(()=>Ht(),"getConfigPath"),OF=new Set(["OPENAI_API_KEY","TOGETHER_API_KEY","api-key"]),$v=i(async()=>{const e=Cv();if(!await ka(e))return Object.create(null);const n=await et.readFile(e,"utf8");return Sa.parse(n)},"readConfigFile"),RF=i(async()=>{const e=Ev();if(!e)return Object.create(null);const t=await et.readFile(e,"utf8"),n=Sa.parse(t);for(const r of OF)delete n[r];return n},"readProjectConfig"),PF=i(async()=>{for(const e of wv())if(await ka(e)){const t=await et.readFile(e,"utf8");return Sa.parse(t)}return Object.create(null)},"readSystemConfig"),En=i(async(e,t,n)=>{const r=await PF(),o=await $v(),s=await RF(),a={...r,...o,...s};IF()&&!process.env.AICOMMITS_QUIET&&Ht().includes(".aicommits")&&!process.env._AICOMMITS_LEGACY_HINT_SHOWN&&(process.env._AICOMMITS_LEGACY_HINT_SHOWN="1",console.error("\u2139 Config at ~/.aicommits (legacy). Run 'aicommits config migrate' to move to XDG path.")),zc(a,"proxy")&&console.warn('The "proxy" config property is deprecated and no longer supported');const l={},u=t??{};for(const h of Object.keys(Ia)){const g=Ia[h],f=e?.[h]??u?.[h]??a[h];if(n)try{l[h]=g(f)}catch{}else l[h]=g(f)}let c,d=l.OPENAI_BASE_URL;const p=l.OPENAI_API_KEY;return!d&&p&&(d=TF(),l.OPENAI_BASE_URL=d),c=FF(d,p),{...l,model:l.OPENAI_MODEL,provider:c}},"getConfig"),Ta=i(async e=>{const t=await $v();for(const[o,s]of e){if(!zc(Ia,o))throw new pe(`Invalid config property: ${o}`);if(s==="")delete t[o];else{const a=Ia[o](s);t[o]=a}}const n=Cv(),r=Xe.dirname(n);Le(r)||Si(r,{recursive:!0}),await et.writeFile(n,Sa.stringify(t),"utf8")},"setConfigs"),xv=i(e=>`\u2705 ${e} (current)`,"CURRENT_LABEL_FORMAT"),MF=3600*1e3,Sv=i(()=>Xe.join(Dv(),"models"),"getCacheDir"),NF=i(e=>{const t=kD.createHash("sha256");return t.update(e),t.digest("hex")},"getCacheKey"),kv=i(e=>Xe.join(Sv(),`${e}.json`),"getCachePath"),BF=i(async e=>{const t=kv(e);try{if(!await ka(t))return null;const n=await et.readFile(t,"utf8");return JSON.parse(n)}catch{return null}},"readCache"),jF=i(async(e,t)=>{try{const n=Sv();await et.mkdir(n,{recursive:!0});const r=kv(e);await et.writeFile(r,JSON.stringify(t),"utf8")}catch{}},"writeCache"),Gc=i(async(e,t,n)=>{const r=n||`${e}/models`,o=NF(r),s=Date.now(),a=await BF(o);if(a&&s-a.timestamp<MF)return a.data;try{const l=await fetch(r,{headers:{Authorization:`Bearer ${t}`}});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const u=await l.json(),c=(u.data?u.data:u)||[],d={models:c};return c.length>0&&await jF(o,{data:d,timestamp:s}),d}catch(l){const u=l instanceof Error?l.message:"Request failed";return{models:[],error:u}}},"fetchModels"),LF=i(async(e,t,n)=>{const r=await Gc(e,t,n?.modelsUrl);r.error&&console.error(`Failed to fetch models: ${r.error}`);let o=[];return n?.modelsFilter?o=n.modelsFilter(r.models):o=r.models.map(s=>s.id||s.name).filter(Boolean),o},"fetchAndFilterModels"),UF=i((e,t,n)=>{let r=e.map(o=>({label:o,value:o}));if(n?.defaultModels&&n.defaultModels.length>0){const o=n.defaultModels.filter(s=>r.some(a=>a.value===s));o.forEach(s=>{const a=r.findIndex(l=>l.value===s);a>=0&&r.splice(a,1)}),o.forEach((s,a)=>{const l=s===t,u=a===0;let c;l?c=`\u2705 ${s} (current)`:u?c=`\u{1F451} ${s} (default)`:c=`\u{1F525} ${s}`,r.unshift({label:c,value:s})})}if(t&&t!=="undefined"){const o=n?.defaultModels?.includes(t),s=r.findIndex(a=>a.value===t);if(s>=0&&!o){if(r[s].label=xv(r[s].value),s>0){const[a]=r.splice(s,1),l=n?.defaultModels?.length||0;r.splice(l,0,a)}}else if(s<0&&!o){const a=n?.defaultModels?.length||0;r.splice(a,0,{label:xv(t),value:t})}}return r},"prepareModelOptions"),zF=i(async(e,t,n,r)=>{const o=await n({message:"Enter search term for models:",placeholder:"e.g., gpt, llama"});if(r(o))return null;let s=e;o&&(s=e.filter(u=>u.toLowerCase().includes(o.toLowerCase())));let a=s.slice(0,20).map(u=>({label:u,value:u}));const l=await t({message:`Choose your model (filtered by "${o}"):`,options:[...a,{label:"Custom model name...",value:"custom"}]});return r(l)?null:l},"handleSearch"),qF=i(async e=>{const t=await e({message:"Enter your custom model name:",validate:i(n=>{if(!n)return"Model name is required"},"validate")});return lt(t)?null:t},"handleCustom"),Iv=i(async(e,t,n,r,o)=>{(!n||n==="undefined")&&(n=r?.defaultModels?.[0]);const s=He();s.start("Fetching available models...");const a=await LF(e,t,r);s.stop(`${o||"Provider"}: ${a.length} models available`);let l=null;if(a.length>0){const{select:u,text:c,isCancel:d}=await Promise.resolve().then(function(){return zs});let p=UF(a,n,r);const h=10;p.length>h&&(p=p.slice(0,h));let g=await u({message:"Choose your model:",options:[{label:"\u{1F50D} Search models...",value:"search"},...p,{label:"Custom model name...",value:"custom"}],initialValue:p.length>0?p[0].value:void 0});if(d(g))return null;if(g==="search"){const f=await zF(a,u,c,d);if(f===null)return null;g=f}if(g==="custom"){if(l=await qF(c),l===null)return null}else l=g}else{console.log("Could not fetch available models. Please specify a model name manually.");const{text:u,isCancel:c}=await Promise.resolve().then(function(){return zs});try{const d=await u({message:"Enter your model name:",validate:i(p=>{if(!p)return"Model name is required"},"validate")});if(c(d))return null;l=d}catch{return null}}return l},"selectModel");var VF=Object.freeze({__proto__:null,fetchModels:Gc,selectModel:Iv});const Dp=class Dp{constructor(t,n){this.def=t,this.config=n}get name(){return this.def.name}get displayName(){return this.def.displayName}getDefinition(){return this.def}async setup(){const{text:t,password:n,confirm:r,isCancel:o}=await Promise.resolve().then(function(){return zs}),s=[];if(this.def.requiresApiKey){let a=null;if(this.def.setupHook&&(a=await this.def.setupHook()),a){const d=a.substring(0,6)+"****",p=await r({message:`Found token (${d}). Use this?`});if(o(p))throw new Error("Setup cancelled");if(p)return s.push(["OPENAI_API_KEY",a]),s}const l=this.getApiKey(),u=this.def.apiKeyHint?`Enter your ${this.def.apiKeyHint}:`:l?`Enter your API key (leave empty to keep current: ${l.substring(0,4)}****):`:"Enter your API key:",c=await n({message:u,validate:i(d=>{if(!d&&!l)return"API key is required"},"validate")});if(o(c))throw new Error("Setup cancelled");c&&s.push(["OPENAI_API_KEY",c])}if(this.name==="ollama"){const a=this.getBaseUrl(),l=await t({message:"Enter Ollama endpoint (leave empty for default):",placeholder:a});if(o(l))throw new Error("Setup cancelled");l&&l!=="http://localhost:11434/v1"&&s.push(["OPENAI_BASE_URL",l])}return s}async getModels(){const t=this.getBaseUrl(),n=this.getApiKey()||"",r=await Gc(t,n,this.def.modelsUrl);if(r.error)return{models:[],error:r.error};let o;return this.def.modelsFilter?o=this.def.modelsFilter(r.models):o=r.models.map(s=>s.id||s.name).filter(Boolean),{models:o}}getApiKey(){return this.def.requiresApiKey?this.config.OPENAI_API_KEY:void 0}getBaseUrl(){return this.name==="custom"?this.config.OPENAI_BASE_URL||"":this.def.baseUrl}getDefaultModel(){return this.def.defaultModels[0]||""}getHighlightedModels(){return this.def.defaultModels}validateConfig(){const t=[];return this.def.requiresApiKey&&!this.getApiKey()&&t.push(`${this.displayName} API key is required`),this.name==="custom"&&!this.getBaseUrl()&&t.push("Custom endpoint is required"),{valid:t.length===0,errors:t}}};i(Dp,"Provider");let Zc=Dp;function cr(e){const t=e.provider,n=qs.find(r=>r.name===t);return n?new Zc(n,e):null}i(cr,"getProvider");function GF(){return qs.map(e=>({value:e.name,label:e.displayName}))}i(GF,"getAvailableProviders");function ZF(e){return qs.find(n=>n.name===e)?.baseUrl||""}i(ZF,"getProviderBaseUrl");var Av="vercel.ai.error",WF=Symbol.for(Av),Tv,Fv,oe=(Er=class extends(Fv=Error,Tv=WF,Fv){constructor({name:t,message:n,cause:r}){super(n),this[Tv]=!0,this.name=t,this.cause=r}static isInstance(t){return Er.hasMarker(t,Av)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}},i(Er,"_AISDKError"),Er),Ov="AI_APICallError",Rv=`vercel.ai.error.${Ov}`,HF=Symbol.for(Rv),Pv,Mv,Ue=(co=class extends(Mv=oe,Pv=HF,Mv){constructor({message:t,url:n,requestBodyValues:r,statusCode:o,responseHeaders:s,responseBody:a,cause:l,isRetryable:u=o!=null&&(o===408||o===409||o===429||o>=500),data:c}){super({name:Ov,message:t,cause:l}),this[Pv]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=o,this.responseHeaders=s,this.responseBody=a,this.isRetryable=u,this.data=c}static isInstance(t){return oe.hasMarker(t,Rv)}},i(co,"APICallError"),co),Nv="AI_EmptyResponseBodyError",Bv=`vercel.ai.error.${Nv}`,JF=Symbol.for(Bv),jv,Lv,KF=(po=class extends(Lv=oe,jv=JF,Lv){constructor({message:t="Empty response body"}={}){super({name:Nv,message:t}),this[jv]=!0}static isInstance(t){return oe.hasMarker(t,Bv)}},i(po,"EmptyResponseBodyError"),po);function Gs(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}i(Gs,"getErrorMessage$1");var Uv="AI_InvalidArgumentError",zv=`vercel.ai.error.${Uv}`,YF=Symbol.for(zv),qv,Vv,Gv=(fo=class extends(Vv=oe,qv=YF,Vv){constructor({message:t,cause:n,argument:r}){super({name:Uv,message:t,cause:n}),this[qv]=!0,this.argument=r}static isInstance(t){return oe.hasMarker(t,zv)}},i(fo,"InvalidArgumentError"),fo),Zv="AI_InvalidPromptError",Wv=`vercel.ai.error.${Zv}`,XF=Symbol.for(Wv),Hv,Jv,Rn=(mo=class extends(Jv=oe,Hv=XF,Jv){constructor({prompt:t,message:n,cause:r}){super({name:Zv,message:`Invalid prompt: ${n}`,cause:r}),this[Hv]=!0,this.prompt=t}static isInstance(t){return oe.hasMarker(t,Wv)}},i(mo,"InvalidPromptError"),mo),Kv="AI_InvalidResponseDataError",Yv=`vercel.ai.error.${Kv}`,QF=Symbol.for(Yv),Xv,Qv,Zs=(ho=class extends(Qv=oe,Xv=QF,Qv){constructor({data:t,message:n=`Invalid response data: ${JSON.stringify(t)}.`}){super({name:Kv,message:n}),this[Xv]=!0,this.data=t}static isInstance(t){return oe.hasMarker(t,Yv)}},i(ho,"InvalidResponseDataError"),ho),e0="AI_JSONParseError",t0=`vercel.ai.error.${e0}`,e9=Symbol.for(t0),n0,r0,Fa=(go=class extends(r0=oe,n0=e9,r0){constructor({text:t,cause:n}){super({name:e0,message:`JSON parsing failed: Text: ${t}.
Error message: ${Gs(n)}`,cause:n}),this[n0]=!0,this.text=t}static isInstance(t){return oe.hasMarker(t,t0)}},i(go,"JSONParseError"),go),o0="AI_LoadAPIKeyError",s0=`vercel.ai.error.${o0}`,t9=Symbol.for(s0),i0,a0,Oa=(yo=class extends(a0=oe,i0=t9,a0){constructor({message:t}){super({name:o0,message:t}),this[i0]=!0}static isInstance(t){return oe.hasMarker(t,s0)}},i(yo,"LoadAPIKeyError"),yo),l0="AI_TooManyEmbeddingValuesForCallError",u0=`vercel.ai.error.${l0}`,n9=Symbol.for(u0),c0,d0,p0=(vo=class extends(d0=oe,c0=n9,d0){constructor(t){super({name:l0,message:`Too many values for a single embedding call. The ${t.provider} model "${t.modelId}" can only embed up to ${t.maxEmbeddingsPerCall} values per call, but ${t.values.length} values were provided.`}),this[c0]=!0,this.provider=t.provider,this.modelId=t.modelId,this.maxEmbeddingsPerCall=t.maxEmbeddingsPerCall,this.values=t.values}static isInstance(t){return oe.hasMarker(t,u0)}},i(vo,"TooManyEmbeddingValuesForCallError"),vo),f0="AI_TypeValidationError",m0=`vercel.ai.error.${f0}`,r9=Symbol.for(m0),h0,g0,dr=(Vn=class extends(g0=oe,h0=r9,g0){constructor({value:t,cause:n,context:r}){let o="Type validation failed";if(r?.field&&(o+=` for ${r.field}`),r?.entityName||r?.entityId){o+=" (";const s=[];r.entityName&&s.push(r.entityName),r.entityId&&s.push(`id: "${r.entityId}"`),o+=s.join(", "),o+=")"}super({name:f0,message:`${o}: Value: ${JSON.stringify(t)}.
Error message: ${Gs(n)}`,cause:n}),this[h0]=!0,this.value=t,this.context=r}static isInstance(t){return oe.hasMarker(t,m0)}static wrap({value:t,cause:n,context:r}){var o,s,a;return Vn.isInstance(n)&&n.value===t&&((o=n.context)==null?void 0:o.field)===r?.field&&((s=n.context)==null?void 0:s.entityName)===r?.entityName&&((a=n.context)==null?void 0:a.entityId)===r?.entityId?n:new Vn({value:t,cause:n,context:r})}},i(Vn,"_TypeValidationError"),Vn),y0="AI_UnsupportedFunctionalityError",v0=`vercel.ai.error.${y0}`,o9=Symbol.for(v0),_0,b0,pt=(_o=class extends(b0=oe,_0=o9,b0){constructor({functionality:t,message:n=`'${t}' functionality not supported.`}){super({name:y0,message:n}),this[_0]=!0,this.functionality=t}static isInstance(t){return oe.hasMarker(t,v0)}},i(_o,"UnsupportedFunctionalityError"),_o);function O(e,t,n){function r(u,c){var d;Object.defineProperty(u,"_zod",{value:u._zod??{},enumerable:!1}),(d=u._zod).traits??(d.traits=new Set),u._zod.traits.add(e),t(u,c);for(const p in a.prototype)p in u||Object.defineProperty(u,p,{value:a.prototype[p].bind(u)});u._zod.constr=a,u._zod.def=c}i(r,"init");const o=n?.Parent??Object,l=class l extends o{};i(l,"Definition");let s=l;Object.defineProperty(s,"name",{value:e});function a(u){var c;const d=n?.Parent?new s:this;r(d,u),(c=d._zod).deferred??(c.deferred=[]);for(const p of d._zod.deferred)p();return d}return i(a,"_"),Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:i(u=>n?.Parent&&u instanceof n.Parent?!0:u?._zod?.traits?.has(e),"value")}),Object.defineProperty(a,"name",{value:e}),a}i(O,"$constructor");const Ep=class Ep extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}};i(Ep,"$ZodAsyncError");let pr=Ep;const w0={};function Pn(e){return w0}i(Pn,"config");function D0(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}i(D0,"getEnumValues");function s9(e,t){return typeof t=="bigint"?t.toString():t}i(s9,"jsonStringifyReplacer");function Wc(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}i(Wc,"cached");function Hc(e){return e==null}i(Hc,"nullish");function Jc(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}i(Jc,"cleanRegex");function i9(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}i(i9,"floatSafeRemainder$1");function Ee(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}i(Ee,"defineLazy");function Ra(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}i(Ra,"assignProp");function Ws(e){return JSON.stringify(e)}i(Ws,"esc");const E0=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function Pa(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}i(Pa,"isObject");const a9=Wc(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Ma(e){if(Pa(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Pa(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}i(Ma,"isPlainObject");const l9=new Set(["string","number","symbol"]);function Hs(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}i(Hs,"escapeRegex");function fr(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}i(fr,"clone");function K(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:i(()=>t,"error")};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:i(()=>t.error,"error")}:t}i(K,"normalizeParams");function u9(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}i(u9,"optionalKeys");const c9={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function d9(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return fr(e,{...e._zod.def,shape:n,checks:[]})}i(d9,"pick");function p9(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return fr(e,{...e._zod.def,shape:n,checks:[]})}i(p9,"omit");function f9(e,t){if(!Ma(t))throw new Error("Invalid input to extend: expected a plain object");const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return Ra(this,"shape",r),r},checks:[]};return fr(e,n)}i(f9,"extend");function m9(e,t){return fr(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Ra(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}i(m9,"merge");function h9(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)o[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return fr(t,{...t._zod.def,shape:o,checks:[]})}i(h9,"partial");function g9(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)o[s]=new e({type:"nonoptional",innerType:r[s]});return fr(t,{...t._zod.def,shape:o,checks:[]})}i(g9,"required");function Js(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}i(Js,"aborted");function mr(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}i(mr,"prefixIssues");function Na(e){return typeof e=="string"?e:e?.message}i(Na,"unwrapMessage");function Mn(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const o=Na(e.inst?._zod.def?.error?.(e))??Na(t?.error?.(e))??Na(n.customError?.(e))??Na(n.localeError?.(e))??"Invalid input";r.message=o}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}i(Mn,"finalizeIssue");function Kc(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}i(Kc,"getLengthableOrigin");function Ks(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}i(Ks,"issue");const C0=i((e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,s9,2)},enumerable:!0}),Object.defineProperty(e,"toString",{value:i(()=>e.message,"value"),enumerable:!1})},"initializer$1"),$0=O("$ZodError",C0),x0=O("$ZodError",C0,{Parent:Error});function y9(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}i(y9,"flattenError");function v9(e,t){const n=t||function(s){return s.message},r={_errors:[]},o=i(s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(l=>o({issues:l}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let l=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(n(a))):l[c]=l[c]||{_errors:[]},l=l[c],u++}}},"processError");return o(e),r}i(v9,"formatError");const _9=i(e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new pr;if(a.issues.length){const l=new(o?.Err??e)(a.issues.map(u=>Mn(u,s,Pn())));throw E0(l,o?.callee),l}return a.value},"_parse$1"),b9=i(e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new(o?.Err??e)(a.issues.map(u=>Mn(u,s,Pn())));throw E0(l,o?.callee),l}return a.value},"_parseAsync"),S0=i(e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new pr;return s.issues.length?{success:!1,error:new(e??$0)(s.issues.map(a=>Mn(a,o,Pn())))}:{success:!0,data:s.value}},"_safeParse"),w9=S0(x0),k0=i(e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(a=>Mn(a,o,Pn())))}:{success:!0,data:s.value}},"_safeParseAsync"),D9=k0(x0),E9=/^[cC][^\s-]{8,}$/,C9=/^[0-9a-z]+$/,$9=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,x9=/^[0-9a-vA-V]{20}$/,S9=/^[A-Za-z0-9]{27}$/,k9=/^[a-zA-Z0-9_-]{21}$/,I9=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,A9=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,I0=i(e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,"uuid"),T9=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,F9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function O9(){return new RegExp(F9,"u")}i(O9,"emoji");const R9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,P9=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,M9=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,N9=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,B9=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,A0=/^[A-Za-z0-9_-]*$/,j9=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,L9=/^\+(?:[0-9]){6,14}[0-9]$/,T0="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",U9=new RegExp(`^${T0}$`);function F0(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}i(F0,"timeSource");function z9(e){return new RegExp(`^${F0(e)}$`)}i(z9,"time$1");function q9(e){const t=F0({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-]\\d{2}:\\d{2})");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${T0}T(?:${r})$`)}i(q9,"datetime$1");const V9=i(e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},"string$1"),G9=/^\d+$/,Z9=/^-?\d+(?:\.\d+)?/i,W9=/true|false/i,H9=/null/i,J9=/^[^A-Z]*$/,K9=/^[^a-z]*$/,Ct=O("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),O0={number:"number",bigint:"bigint",object:"date"},R0=O("$ZodCheckLessThan",(e,t)=>{Ct.init(e,t);const n=O0[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),P0=O("$ZodCheckGreaterThan",(e,t)=>{Ct.init(e,t);const n=O0[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Y9=O("$ZodCheckMultipleOf",(e,t)=>{Ct.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):i9(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),X9=O("$ZodCheckNumberFormat",(e,t)=>{Ct.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),r=n?"int":"number",[o,s]=c9[t.format];e._zod.onattach.push(a=>{const l=a._zod.bag;l.format=t.format,l.minimum=o,l.maximum=s,n&&(l.pattern=G9)}),e._zod.check=a=>{const l=a.value;if(n){if(!Number.isInteger(l)){a.issues.push({expected:r,format:t.format,code:"invalid_type",input:l,inst:e});return}if(!Number.isSafeInteger(l)){l>0?a.issues.push({input:l,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):a.issues.push({input:l,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}l<o&&a.issues.push({origin:"number",input:l,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),l>s&&a.issues.push({origin:"number",input:l,code:"too_big",maximum:s,inst:e})}}),Q9=O("$ZodCheckMaxLength",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!Hc(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const o=r.value;if(o.length<=t.maximum)return;const a=Kc(o);r.issues.push({origin:a,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),e8=O("$ZodCheckMinLength",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!Hc(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const o=r.value;if(o.length>=t.minimum)return;const a=Kc(o);r.issues.push({origin:a,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),t8=O("$ZodCheckLengthEquals",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!Hc(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=r=>{const o=r.value,s=o.length;if(s===t.length)return;const a=Kc(o),l=s>t.length;r.issues.push({origin:a,...l?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),Ba=O("$ZodCheckStringFormat",(e,t)=>{var n,r;Ct.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),n8=O("$ZodCheckRegex",(e,t)=>{Ba.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),r8=O("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=J9),Ba.init(e,t)}),o8=O("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=K9),Ba.init(e,t)}),s8=O("$ZodCheckIncludes",(e,t)=>{Ct.init(e,t);const n=Hs(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),i8=O("$ZodCheckStartsWith",(e,t)=>{Ct.init(e,t);const n=new RegExp(`^${Hs(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),a8=O("$ZodCheckEndsWith",(e,t)=>{Ct.init(e,t);const n=new RegExp(`.*${Hs(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),l8=O("$ZodCheckOverwrite",(e,t)=>{Ct.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}}),Cp=class Cp{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),o=Math.min(...r.map(a=>a.length-a.trimStart().length)),s=r.map(a=>a.slice(o)).map(a=>" ".repeat(this.indent*2)+a);for(const a of s)this.content.push(a)}compile(){const t=Function,n=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}};i(Cp,"Doc");let Yc=Cp;const u8={major:4,minor:0,patch:0},Te=O("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=u8;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const o of r)for(const s of o._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=i((s,a,l)=>{let u=Js(s),c;for(const d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;const p=s.issues.length,h=d._zod.check(s);if(h instanceof Promise&&l?.async===!1)throw new pr;if(c||h instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await h,s.issues.length!==p&&(u||(u=Js(s,p)))});else{if(s.issues.length===p)continue;u||(u=Js(s,p))}}return c?c.then(()=>s):s},"runChecks");e._zod.run=(s,a)=>{const l=e._zod.parse(s,a);if(l instanceof Promise){if(a.async===!1)throw new pr;return l.then(u=>o(u,r,a))}return o(l,r,a)}}e["~standard"]={validate:i(o=>{try{const s=w9(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return D9(e,o).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},"validate"),vendor:"zod",version:1}}),Xc=O("$ZodString",(e,t)=>{Te.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??V9(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Be=O("$ZodStringFormat",(e,t)=>{Ba.init(e,t),Xc.init(e,t)}),c8=O("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=A9),Be.init(e,t)}),d8=O("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=I0(r))}else t.pattern??(t.pattern=I0());Be.init(e,t)}),p8=O("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=T9),Be.init(e,t)}),f8=O("$ZodURL",(e,t)=>{Be.init(e,t),e._zod.check=n=>{try{const r=n.value,o=new URL(r),s=o.href;t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:j9.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),!r.endsWith("/")&&s.endsWith("/")?n.value=s.slice(0,-1):n.value=s;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),m8=O("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=O9()),Be.init(e,t)}),h8=O("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=k9),Be.init(e,t)}),g8=O("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=E9),Be.init(e,t)}),y8=O("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=C9),Be.init(e,t)}),v8=O("$ZodULID",(e,t)=>{t.pattern??(t.pattern=$9),Be.init(e,t)}),_8=O("$ZodXID",(e,t)=>{t.pattern??(t.pattern=x9),Be.init(e,t)}),b8=O("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=S9),Be.init(e,t)}),w8=O("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=q9(t)),Be.init(e,t)}),D8=O("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=U9),Be.init(e,t)}),E8=O("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=z9(t)),Be.init(e,t)}),C8=O("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=I9),Be.init(e,t)}),$8=O("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=R9),Be.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),x8=O("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=P9),Be.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),S8=O("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=M9),Be.init(e,t)}),k8=O("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=N9),Be.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function M0(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}i(M0,"isValidBase64");const I8=O("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=B9),Be.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{M0(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function A8(e){if(!A0.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return M0(n)}i(A8,"isValidBase64URL");const T8=O("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=A0),Be.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{A8(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),F8=O("$ZodE164",(e,t)=>{t.pattern??(t.pattern=L9),Be.init(e,t)});function O8(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}i(O8,"isValidJWT$1");const R8=O("$ZodJWT",(e,t)=>{Be.init(e,t),e._zod.check=n=>{O8(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),N0=O("$ZodNumber",(e,t)=>{Te.init(e,t),e._zod.pattern=e._zod.bag.pattern??Z9,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),P8=O("$ZodNumber",(e,t)=>{X9.init(e,t),N0.init(e,t)}),M8=O("$ZodBoolean",(e,t)=>{Te.init(e,t),e._zod.pattern=W9,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),N8=O("$ZodNull",(e,t)=>{Te.init(e,t),e._zod.pattern=H9,e._zod.values=new Set([null]),e._zod.parse=(n,r)=>{const o=n.value;return o===null||n.issues.push({expected:"null",code:"invalid_type",input:o,inst:e}),n}}),B8=O("$ZodAny",(e,t)=>{Te.init(e,t),e._zod.parse=n=>n}),j8=O("$ZodUnknown",(e,t)=>{Te.init(e,t),e._zod.parse=n=>n}),L8=O("$ZodNever",(e,t)=>{Te.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function B0(e,t,n){e.issues.length&&t.issues.push(...mr(n,e.issues)),t.value[n]=e.value}i(B0,"handleArrayResult");const U8=O("$ZodArray",(e,t)=>{Te.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let a=0;a<o.length;a++){const l=o[a],u=t.element._zod.run({value:l,issues:[]},r);u instanceof Promise?s.push(u.then(c=>B0(c,n,a))):B0(u,n,a)}return s.length?Promise.all(s).then(()=>n):n}});function ja(e,t,n){e.issues.length&&t.issues.push(...mr(n,e.issues)),t.value[n]=e.value}i(ja,"handleObjectResult");function j0(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...mr(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}i(j0,"handleOptionalObjectResult");const z8=O("$ZodObject",(e,t)=>{Te.init(e,t);const n=Wc(()=>{const p=Object.keys(t.shape);for(const g of p)if(!(t.shape[g]instanceof Te))throw new Error(`Invalid element at key "${g}": expected a Zod schema`);const h=u9(t.shape);return{shape:t.shape,keys:p,keySet:new Set(p),numKeys:p.length,optionalKeys:new Set(h)}});Ee(e._zod,"propValues",()=>{const p=t.shape,h={};for(const g in p){const f=p[g]._zod;if(f.values){h[g]??(h[g]=new Set);for(const y of f.values)h[g].add(y)}}return h});const r=i(p=>{const h=new Yc(["shape","payload","ctx"]),g=n.value,f=i(w=>{const D=Ws(w);return`shape[${D}]._zod.run({ value: input[${D}], issues: [] }, ctx)`},"parseStr");h.write("const input = payload.value;");const y=Object.create(null);let v=0;for(const w of g.keys)y[w]=`key_${v++}`;h.write("const newResult = {}");for(const w of g.keys)if(g.optionalKeys.has(w)){const D=y[w];h.write(`const ${D} = ${f(w)};`);const E=Ws(w);h.write(`
        if (${D}.issues.length) {
          if (input[${E}] === undefined) {
            if (${E} in input) {
              newResult[${E}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${D}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${E}, ...iss.path] : [${E}],
              }))
            );
          }
        } else if (${D}.value === undefined) {
          if (${E} in input) newResult[${E}] = undefined;
        } else {
          newResult[${E}] = ${D}.value;
        }
        `)}else{const D=y[w];h.write(`const ${D} = ${f(w)};`),h.write(`
          if (${D}.issues.length) payload.issues = payload.issues.concat(${D}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Ws(w)}, ...iss.path] : [${Ws(w)}]
          })));`),h.write(`newResult[${Ws(w)}] = ${D}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const _=h.compile();return(w,D)=>_(p,w,D)},"generateFastpass");let o;const s=Pa,a=!w0.jitless,u=a&&a9.value,c=t.catchall;let d;e._zod.parse=(p,h)=>{d??(d=n.value);const g=p.value;if(!s(g))return p.issues.push({expected:"object",code:"invalid_type",input:g,inst:e}),p;const f=[];if(a&&u&&h?.async===!1&&h.jitless!==!0)o||(o=r(t.shape)),p=o(p,h);else{p.value={};const D=d.shape;for(const E of d.keys){const I=D[E],T=I._zod.run({value:g[E],issues:[]},h),$=I._zod.optin==="optional"&&I._zod.optout==="optional";T instanceof Promise?f.push(T.then(x=>$?j0(x,p,E,g):ja(x,p,E))):$?j0(T,p,E,g):ja(T,p,E)}}if(!c)return f.length?Promise.all(f).then(()=>p):p;const y=[],v=d.keySet,_=c._zod,w=_.def.type;for(const D of Object.keys(g)){if(v.has(D))continue;if(w==="never"){y.push(D);continue}const E=_.run({value:g[D],issues:[]},h);E instanceof Promise?f.push(E.then(I=>ja(I,p,D))):ja(E,p,D)}return y.length&&p.issues.push({code:"unrecognized_keys",keys:y,input:g,inst:e}),f.length?Promise.all(f).then(()=>p):p}});function L0(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(s=>Mn(s,r,Pn())))}),t}i(L0,"handleUnionResults");const U0=O("$ZodUnion",(e,t)=>{Te.init(e,t),Ee(e._zod,"optin",()=>t.options.some(n=>n._zod.optin==="optional")?"optional":void 0),Ee(e._zod,"optout",()=>t.options.some(n=>n._zod.optout==="optional")?"optional":void 0),Ee(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),Ee(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>Jc(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const s=[];for(const a of t.options){const l=a._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)s.push(l),o=!0;else{if(l.issues.length===0)return l;s.push(l)}}return o?Promise.all(s).then(a=>L0(a,n,e,r)):L0(s,n,e,r)}}),q8=O("$ZodDiscriminatedUnion",(e,t)=>{U0.init(e,t);const n=e._zod.parse;Ee(e._zod,"propValues",()=>{const o={};for(const s of t.options){const a=s._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(s)}"`);for(const[l,u]of Object.entries(a)){o[l]||(o[l]=new Set);for(const c of u)o[l].add(c)}}return o});const r=Wc(()=>{const o=t.options,s=new Map;for(const a of o){const l=a._zod.propValues[t.discriminator];if(!l||l.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(a)}"`);for(const u of l){if(s.has(u))throw new Error(`Duplicate discriminator value "${String(u)}"`);s.set(u,a)}}return s});e._zod.parse=(o,s)=>{const a=o.value;if(!Pa(a))return o.issues.push({code:"invalid_type",expected:"object",input:a,inst:e}),o;const l=r.value.get(a?.[t.discriminator]);return l?l._zod.run(o,s):t.unionFallback?n(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:a,path:[t.discriminator],inst:e}),o)}}),V8=O("$ZodIntersection",(e,t)=>{Te.init(e,t),e._zod.parse=(n,r)=>{const o=n.value,s=t.left._zod.run({value:o,issues:[]},r),a=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||a instanceof Promise?Promise.all([s,a]).then(([u,c])=>z0(n,u,c)):z0(n,s,a)}});function Qc(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Ma(e)&&Ma(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const a=Qc(e[s],t[s]);if(!a.valid)return{valid:!1,mergeErrorPath:[s,...a.mergeErrorPath]};o[s]=a.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],a=Qc(o,s);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}i(Qc,"mergeValues$1");function z0(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),Js(e))return e;const r=Qc(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}i(z0,"handleIntersectionResults");const G8=O("$ZodRecord",(e,t)=>{Te.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Ma(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),n;const s=[];if(t.keyType._zod.values){const a=t.keyType._zod.values;n.value={};for(const u of a)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){const c=t.valueType._zod.run({value:o[u],issues:[]},r);c instanceof Promise?s.push(c.then(d=>{d.issues.length&&n.issues.push(...mr(u,d.issues)),n.value[u]=d.value})):(c.issues.length&&n.issues.push(...mr(u,c.issues)),n.value[u]=c.value)}let l;for(const u in o)a.has(u)||(l=l??[],l.push(u));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:l})}else{n.value={};for(const a of Reflect.ownKeys(o)){if(a==="__proto__")continue;const l=t.keyType._zod.run({value:a,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(l.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:l.issues.map(c=>Mn(c,r,Pn())),input:a,path:[a],inst:e}),n.value[l.value]=l.value;continue}const u=t.valueType._zod.run({value:o[a],issues:[]},r);u instanceof Promise?s.push(u.then(c=>{c.issues.length&&n.issues.push(...mr(a,c.issues)),n.value[l.value]=c.value})):(u.issues.length&&n.issues.push(...mr(a,u.issues)),n.value[l.value]=u.value)}}return s.length?Promise.all(s).then(()=>n):n}}),Z8=O("$ZodEnum",(e,t)=>{Te.init(e,t);const n=D0(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>l9.has(typeof r)).map(r=>typeof r=="string"?Hs(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return e._zod.values.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),W8=O("$ZodLiteral",(e,t)=>{Te.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?Hs(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),H8=O("$ZodTransform",(e,t)=>{Te.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(a=>(n.value=a,n));if(o instanceof Promise)throw new pr;return n.value=o,n}}),J8=O("$ZodOptional",(e,t)=>{Te.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Ee(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Ee(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Jc(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>t.innerType._zod.optin==="optional"?t.innerType._zod.run(n,r):n.value===void 0?n:t.innerType._zod.run(n,r)}),K8=O("$ZodNullable",(e,t)=>{Te.init(e,t),Ee(e._zod,"optin",()=>t.innerType._zod.optin),Ee(e._zod,"optout",()=>t.innerType._zod.optout),Ee(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Jc(n.source)}|null)$`):void 0}),Ee(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Y8=O("$ZodDefault",(e,t)=>{Te.init(e,t),e._zod.optin="optional",Ee(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>q0(s,t)):q0(o,t)}});function q0(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}i(q0,"handleDefaultResult");const X8=O("$ZodPrefault",(e,t)=>{Te.init(e,t),e._zod.optin="optional",Ee(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Q8=O("$ZodNonOptional",(e,t)=>{Te.init(e,t),Ee(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>V0(s,e)):V0(o,e)}});function V0(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}i(V0,"handleNonOptionalResult");const e3=O("$ZodCatch",(e,t)=>{Te.init(e,t),e._zod.optin="optional",Ee(e._zod,"optout",()=>t.innerType._zod.optout),Ee(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>Mn(a,r,Pn()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>Mn(s,r,Pn()))},input:n.value}),n.issues=[]),n)}}),t3=O("$ZodPipe",(e,t)=>{Te.init(e,t),Ee(e._zod,"values",()=>t.in._zod.values),Ee(e._zod,"optin",()=>t.in._zod.optin),Ee(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>G0(s,t,r)):G0(o,t,r)}});function G0(e,t,n){return Js(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}i(G0,"handlePipeResult");const n3=O("$ZodReadonly",(e,t)=>{Te.init(e,t),Ee(e._zod,"propValues",()=>t.innerType._zod.propValues),Ee(e._zod,"values",()=>t.innerType._zod.values),Ee(e._zod,"optin",()=>t.innerType._zod.optin),Ee(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Z0):Z0(o)}});function Z0(e){return e.value=Object.freeze(e.value),e}i(Z0,"handleReadonlyResult");const r3=O("$ZodLazy",(e,t)=>{Te.init(e,t),Ee(e._zod,"innerType",()=>t.getter()),Ee(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),Ee(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),Ee(e._zod,"optin",()=>e._zod.innerType._zod.optin),Ee(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(n,r)=>e._zod.innerType._zod.run(n,r)}),o3=O("$ZodCustom",(e,t)=>{Ct.init(e,t),Te.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>W0(s,n,r,e));W0(o,n,r,e)}});function W0(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(Ks(o))}}i(W0,"handleRefineResult");const $p=class $p{constructor(){this._map=new Map,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}};i($p,"$ZodRegistry");let La=$p;function s3(){return new La}i(s3,"registry");const Ys=s3();function i3(e,t){return new e({type:"string",...K(t)})}i(i3,"_string");function a3(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...K(t)})}i(a3,"_email");function H0(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...K(t)})}i(H0,"_guid");function l3(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...K(t)})}i(l3,"_uuid");function u3(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...K(t)})}i(u3,"_uuidv4");function c3(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...K(t)})}i(c3,"_uuidv6");function d3(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...K(t)})}i(d3,"_uuidv7");function p3(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...K(t)})}i(p3,"_url");function f3(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...K(t)})}i(f3,"_emoji");function m3(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...K(t)})}i(m3,"_nanoid");function h3(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...K(t)})}i(h3,"_cuid");function g3(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...K(t)})}i(g3,"_cuid2");function y3(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...K(t)})}i(y3,"_ulid");function v3(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...K(t)})}i(v3,"_xid");function _3(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...K(t)})}i(_3,"_ksuid");function b3(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...K(t)})}i(b3,"_ipv4");function w3(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...K(t)})}i(w3,"_ipv6");function D3(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...K(t)})}i(D3,"_cidrv4");function E3(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...K(t)})}i(E3,"_cidrv6");function C3(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...K(t)})}i(C3,"_base64");function $3(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...K(t)})}i($3,"_base64url");function x3(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...K(t)})}i(x3,"_e164");function S3(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...K(t)})}i(S3,"_jwt");function k3(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...K(t)})}i(k3,"_isoDateTime");function I3(e,t){return new e({type:"string",format:"date",check:"string_format",...K(t)})}i(I3,"_isoDate");function A3(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...K(t)})}i(A3,"_isoTime");function T3(e,t){return new e({type:"string",format:"duration",check:"string_format",...K(t)})}i(T3,"_isoDuration");function F3(e,t){return new e({type:"number",checks:[],...K(t)})}i(F3,"_number");function O3(e,t){return new e({type:"number",coerce:!0,checks:[],...K(t)})}i(O3,"_coercedNumber");function R3(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...K(t)})}i(R3,"_int");function P3(e,t){return new e({type:"boolean",...K(t)})}i(P3,"_boolean");function M3(e,t){return new e({type:"null",...K(t)})}i(M3,"_null$1");function N3(e){return new e({type:"any"})}i(N3,"_any");function B3(e){return new e({type:"unknown"})}i(B3,"_unknown");function j3(e,t){return new e({type:"never",...K(t)})}i(j3,"_never");function J0(e,t){return new R0({check:"less_than",...K(t),value:e,inclusive:!1})}i(J0,"_lt");function ed(e,t){return new R0({check:"less_than",...K(t),value:e,inclusive:!0})}i(ed,"_lte");function K0(e,t){return new P0({check:"greater_than",...K(t),value:e,inclusive:!1})}i(K0,"_gt");function td(e,t){return new P0({check:"greater_than",...K(t),value:e,inclusive:!0})}i(td,"_gte");function Y0(e,t){return new Y9({check:"multiple_of",...K(t),value:e})}i(Y0,"_multipleOf");function X0(e,t){return new Q9({check:"max_length",...K(t),maximum:e})}i(X0,"_maxLength");function Ua(e,t){return new e8({check:"min_length",...K(t),minimum:e})}i(Ua,"_minLength");function Q0(e,t){return new t8({check:"length_equals",...K(t),length:e})}i(Q0,"_length");function L3(e,t){return new n8({check:"string_format",format:"regex",...K(t),pattern:e})}i(L3,"_regex");function U3(e){return new r8({check:"string_format",format:"lowercase",...K(e)})}i(U3,"_lowercase");function z3(e){return new o8({check:"string_format",format:"uppercase",...K(e)})}i(z3,"_uppercase");function q3(e,t){return new s8({check:"string_format",format:"includes",...K(t),includes:e})}i(q3,"_includes");function V3(e,t){return new i8({check:"string_format",format:"starts_with",...K(t),prefix:e})}i(V3,"_startsWith");function G3(e,t){return new a8({check:"string_format",format:"ends_with",...K(t),suffix:e})}i(G3,"_endsWith");function Xs(e){return new l8({check:"overwrite",tx:e})}i(Xs,"_overwrite");function Z3(e){return Xs(t=>t.normalize(e))}i(Z3,"_normalize");function W3(){return Xs(e=>e.trim())}i(W3,"_trim");function H3(){return Xs(e=>e.toLowerCase())}i(H3,"_toLowerCase");function J3(){return Xs(e=>e.toUpperCase())}i(J3,"_toUpperCase");function K3(e,t,n){return new e({type:"array",element:t,...K(n)})}i(K3,"_array");function Y3(e,t,n){const r=K(n);return r.abort??(r.abort=!0),new e({type:"custom",check:"custom",fn:t,...r})}i(Y3,"_custom");function X3(e,t,n){return new e({type:"custom",check:"custom",fn:t,...K(n)})}i(X3,"_refine");const xp=class xp{constructor(t){this.counter=0,this.metadataRegistry=t?.metadata??Ys,this.target=t?.target??"draft-2020-12",this.unrepresentable=t?.unrepresentable??"throw",this.override=t?.override??(()=>{}),this.io=t?.io??"output",this.seen=new Map}process(t,n={path:[],schemaPath:[]}){var r;const o=t._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(t);if(a)return a.count++,n.schemaPath.includes(t)&&(a.cycle=n.path),a.schema;const l={schema:{},count:1,cycle:void 0,path:n.path};this.seen.set(t,l);const u=t._zod.toJSONSchema?.();if(u)l.schema=u;else{const p={...n,schemaPath:[...n.schemaPath,t],path:n.path},h=t._zod.parent;if(h)l.ref=h,this.process(h,p),this.seen.get(h).isParent=!0;else{const g=l.schema;switch(o.type){case"string":{const f=g;f.type="string";const{minimum:y,maximum:v,format:_,patterns:w,contentEncoding:D}=t._zod.bag;if(typeof y=="number"&&(f.minLength=y),typeof v=="number"&&(f.maxLength=v),_&&(f.format=s[_]??_,f.format===""&&delete f.format),D&&(f.contentEncoding=D),w&&w.size>0){const E=[...w];E.length===1?f.pattern=E[0].source:E.length>1&&(l.schema.allOf=[...E.map(I=>({...this.target==="draft-7"?{type:"string"}:{},pattern:I.source}))])}break}case"number":{const f=g,{minimum:y,maximum:v,format:_,multipleOf:w,exclusiveMaximum:D,exclusiveMinimum:E}=t._zod.bag;typeof _=="string"&&_.includes("int")?f.type="integer":f.type="number",typeof E=="number"&&(f.exclusiveMinimum=E),typeof y=="number"&&(f.minimum=y,typeof E=="number"&&(E>=y?delete f.minimum:delete f.exclusiveMinimum)),typeof D=="number"&&(f.exclusiveMaximum=D),typeof v=="number"&&(f.maximum=v,typeof D=="number"&&(D<=v?delete f.maximum:delete f.exclusiveMaximum)),typeof w=="number"&&(f.multipleOf=w);break}case"boolean":{const f=g;f.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{g.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{g.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const f=g,{minimum:y,maximum:v}=t._zod.bag;typeof y=="number"&&(f.minItems=y),typeof v=="number"&&(f.maxItems=v),f.type="array",f.items=this.process(o.element,{...p,path:[...p.path,"items"]});break}case"object":{const f=g;f.type="object",f.properties={};const y=o.shape;for(const w in y)f.properties[w]=this.process(y[w],{...p,path:[...p.path,"properties",w]});const v=new Set(Object.keys(y)),_=new Set([...v].filter(w=>{const D=o.shape[w]._zod;return this.io==="input"?D.optin===void 0:D.optout===void 0}));_.size>0&&(f.required=Array.from(_)),o.catchall?._zod.def.type==="never"?f.additionalProperties=!1:o.catchall?o.catchall&&(f.additionalProperties=this.process(o.catchall,{...p,path:[...p.path,"additionalProperties"]})):this.io==="output"&&(f.additionalProperties=!1);break}case"union":{const f=g;f.anyOf=o.options.map((y,v)=>this.process(y,{...p,path:[...p.path,"anyOf",v]}));break}case"intersection":{const f=g,y=this.process(o.left,{...p,path:[...p.path,"allOf",0]}),v=this.process(o.right,{...p,path:[...p.path,"allOf",1]}),_=i(D=>"allOf"in D&&Object.keys(D).length===1,"isSimpleIntersection"),w=[..._(y)?y.allOf:[y],..._(v)?v.allOf:[v]];f.allOf=w;break}case"tuple":{const f=g;f.type="array";const y=o.items.map((w,D)=>this.process(w,{...p,path:[...p.path,"prefixItems",D]}));if(this.target==="draft-2020-12"?f.prefixItems=y:f.items=y,o.rest){const w=this.process(o.rest,{...p,path:[...p.path,"items"]});this.target==="draft-2020-12"?f.items=w:f.additionalItems=w}o.rest&&(f.items=this.process(o.rest,{...p,path:[...p.path,"items"]}));const{minimum:v,maximum:_}=t._zod.bag;typeof v=="number"&&(f.minItems=v),typeof _=="number"&&(f.maxItems=_);break}case"record":{const f=g;f.type="object",f.propertyNames=this.process(o.keyType,{...p,path:[...p.path,"propertyNames"]}),f.additionalProperties=this.process(o.valueType,{...p,path:[...p.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const f=g,y=D0(o.entries);y.every(v=>typeof v=="number")&&(f.type="number"),y.every(v=>typeof v=="string")&&(f.type="string"),f.enum=y;break}case"literal":{const f=g,y=[];for(const v of o.values)if(v===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof v=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");y.push(Number(v))}else y.push(v);if(y.length!==0)if(y.length===1){const v=y[0];f.type=v===null?"null":typeof v,f.const=v}else y.every(v=>typeof v=="number")&&(f.type="number"),y.every(v=>typeof v=="string")&&(f.type="string"),y.every(v=>typeof v=="boolean")&&(f.type="string"),y.every(v=>v===null)&&(f.type="null"),f.enum=y;break}case"file":{const f=g,y={type:"string",format:"binary",contentEncoding:"binary"},{minimum:v,maximum:_,mime:w}=t._zod.bag;v!==void 0&&(y.minLength=v),_!==void 0&&(y.maxLength=_),w?w.length===1?(y.contentMediaType=w[0],Object.assign(f,y)):f.anyOf=w.map(D=>({...y,contentMediaType:D})):Object.assign(f,y);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const f=this.process(o.innerType,p);g.anyOf=[f,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,p),l.ref=o.innerType;break}case"success":{const f=g;f.type="boolean";break}case"default":{this.process(o.innerType,p),l.ref=o.innerType,g.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,p),l.ref=o.innerType,this.io==="input"&&(g._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,p),l.ref=o.innerType;let f;try{f=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}g.default=f;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const f=g,y=t._zod.pattern;if(!y)throw new Error("Pattern not found in template literal");f.type="string",f.pattern=y.source;break}case"pipe":{const f=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(f,p),l.ref=f;break}case"readonly":{this.process(o.innerType,p),l.ref=o.innerType,g.readOnly=!0;break}case"promise":{this.process(o.innerType,p),l.ref=o.innerType;break}case"optional":{this.process(o.innerType,p),l.ref=o.innerType;break}case"lazy":{const f=t._zod.innerType;this.process(f,p),l.ref=f;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(t);return c&&Object.assign(l.schema,c),this.io==="input"&&rt(t)&&(delete l.schema.examples,delete l.schema.default),this.io==="input"&&l.schema._prefault&&((r=l.schema).default??(r.default=l.schema._prefault)),delete l.schema._prefault,this.seen.get(t).schema}emit(t,n){const r={cycles:n?.cycles??"ref",reused:n?.reused??"inline",external:n?.external??void 0},o=this.seen.get(t);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=i(d=>{const p=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const y=r.external.registry.get(d[0])?.id,v=r.external.uri??(w=>w);if(y)return{ref:v(y)};const _=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=_,{defId:_,ref:`${v("__shared")}#/${p}/${_}`}}if(d[1]===o)return{ref:"#"};const g=`#/${p}/`,f=d[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:g+f}},"makeURI"),a=i(d=>{if(d[1].schema.$ref)return;const p=d[1],{ref:h,defId:g}=s(d);p.def={...p.schema},g&&(p.defId=g);const f=p.schema;for(const y in f)delete f[y];f.$ref=h},"extractToDef");if(r.cycles==="throw")for(const d of this.seen.entries()){const p=d[1];if(p.cycle)throw new Error(`Cycle detected: #/${p.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const d of this.seen.entries()){const p=d[1];if(t===d[0]){a(d);continue}if(r.external){const g=r.external.registry.get(d[0])?.id;if(t!==d[0]&&g){a(d);continue}}if(this.metadataRegistry.get(d[0])?.id){a(d);continue}if(p.cycle){a(d);continue}if(p.count>1&&r.reused==="ref"){a(d);continue}}const l=i((d,p)=>{const h=this.seen.get(d),g=h.def??h.schema,f={...g};if(h.ref===null)return;const y=h.ref;if(h.ref=null,y){l(y,p);const v=this.seen.get(y).schema;v.$ref&&p.target==="draft-7"?(g.allOf=g.allOf??[],g.allOf.push(v)):(Object.assign(g,v),Object.assign(g,f))}h.isParent||this.override({zodSchema:d,jsonSchema:g,path:h.path??[]})},"flattenRef");for(const d of[...this.seen.entries()].reverse())l(d[0],{target:this.target});const u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),r.external?.uri){const d=r.external.registry.get(t)?.id;if(!d)throw new Error("Schema is missing an `id` property");u.$id=r.external.uri(d)}Object.assign(u,o.def);const c=r.external?.defs??{};for(const d of this.seen.entries()){const p=d[1];p.def&&p.defId&&(c[p.defId]=p.def)}r.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}};i(xp,"JSONSchemaGenerator");let za=xp;function Q3(e,t){if(e instanceof La){const r=new za(t),o={};for(const l of e._idmap.entries()){const[u,c]=l;r.process(c)}const s={},a={registry:e,uri:t?.uri,defs:o};for(const l of e._idmap.entries()){const[u,c]=l;s[u]=r.emit(c,{...t,external:a})}if(Object.keys(o).length>0){const l=r.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[l]:o}}return{schemas:s}}const n=new za(t);return n.process(e),n.emit(e,t)}i(Q3,"toJSONSchema");function rt(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const o=e._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return rt(o.element,n);case"object":{for(const s in o.shape)if(rt(o.shape[s],n))return!0;return!1}case"union":{for(const s of o.options)if(rt(s,n))return!0;return!1}case"intersection":return rt(o.left,n)||rt(o.right,n);case"tuple":{for(const s of o.items)if(rt(s,n))return!0;return!!(o.rest&&rt(o.rest,n))}case"record":return rt(o.keyType,n)||rt(o.valueType,n);case"map":return rt(o.keyType,n)||rt(o.valueType,n);case"set":return rt(o.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return rt(o.innerType,n);case"lazy":return rt(o.getter(),n);case"default":return rt(o.innerType,n);case"prefault":return rt(o.innerType,n);case"custom":return!1;case"transform":return!0;case"pipe":return rt(o.in,n)||rt(o.out,n);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${o.type}`)}i(rt,"isTransforming");const eO=O("ZodISODateTime",(e,t)=>{w8.init(e,t),ze.init(e,t)});function tO(e){return k3(eO,e)}i(tO,"datetime");const nO=O("ZodISODate",(e,t)=>{D8.init(e,t),ze.init(e,t)});function rO(e){return I3(nO,e)}i(rO,"date");const oO=O("ZodISOTime",(e,t)=>{E8.init(e,t),ze.init(e,t)});function sO(e){return A3(oO,e)}i(sO,"time");const iO=O("ZodISODuration",(e,t)=>{C8.init(e,t),ze.init(e,t)});function aO(e){return T3(iO,e)}i(aO,"duration");const lO=i((e,t)=>{$0.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:i(n=>v9(e,n),"value")},flatten:{value:i(n=>y9(e,n),"value")},addIssue:{value:i(n=>e.issues.push(n),"value")},addIssues:{value:i(n=>e.issues.push(...n),"value")},isEmpty:{get(){return e.issues.length===0}}})},"initializer"),qa=O("ZodError",lO,{Parent:Error}),uO=_9(qa),cO=b9(qa),dO=S0(qa),e_=k0(qa),Pe=O("ZodType",(e,t)=>(Te.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>fr(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>uO(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>dO(e,n,r),e.parseAsync=async(n,r)=>cO(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>e_(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(sR(n,r)),e.superRefine=n=>e.check(iR(n)),e.overwrite=n=>e.check(Xs(n)),e.optional=()=>l_(e),e.nullable=()=>u_(e),e.nullish=()=>l_(u_(e)),e.nonoptional=n=>KO(e,n),e.array=()=>M(e),e.or=n=>se([e,n]),e.and=n=>LO(e,n),e.transform=n=>d_(e,VO(n)),e.default=n=>WO(e,n),e.prefault=n=>JO(e,n),e.catch=n=>XO(e,n),e.pipe=n=>d_(e,n),e.readonly=()=>tR(e),e.describe=n=>{const r=e.clone();return Ys.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){return Ys.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Ys.get(e);const r=e.clone();return Ys.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),t_=O("_ZodString",(e,t)=>{Xc.init(e,t),Pe.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(L3(...r)),e.includes=(...r)=>e.check(q3(...r)),e.startsWith=(...r)=>e.check(V3(...r)),e.endsWith=(...r)=>e.check(G3(...r)),e.min=(...r)=>e.check(Ua(...r)),e.max=(...r)=>e.check(X0(...r)),e.length=(...r)=>e.check(Q0(...r)),e.nonempty=(...r)=>e.check(Ua(1,...r)),e.lowercase=r=>e.check(U3(r)),e.uppercase=r=>e.check(z3(r)),e.trim=()=>e.check(W3()),e.normalize=(...r)=>e.check(Z3(...r)),e.toLowerCase=()=>e.check(H3()),e.toUpperCase=()=>e.check(J3())}),pO=O("ZodString",(e,t)=>{Xc.init(e,t),t_.init(e,t),e.email=n=>e.check(a3(fO,n)),e.url=n=>e.check(p3(mO,n)),e.jwt=n=>e.check(S3(IO,n)),e.emoji=n=>e.check(f3(hO,n)),e.guid=n=>e.check(H0(n_,n)),e.uuid=n=>e.check(l3(Va,n)),e.uuidv4=n=>e.check(u3(Va,n)),e.uuidv6=n=>e.check(c3(Va,n)),e.uuidv7=n=>e.check(d3(Va,n)),e.nanoid=n=>e.check(m3(gO,n)),e.guid=n=>e.check(H0(n_,n)),e.cuid=n=>e.check(h3(yO,n)),e.cuid2=n=>e.check(g3(vO,n)),e.ulid=n=>e.check(y3(_O,n)),e.base64=n=>e.check(C3(xO,n)),e.base64url=n=>e.check($3(SO,n)),e.xid=n=>e.check(v3(bO,n)),e.ksuid=n=>e.check(_3(wO,n)),e.ipv4=n=>e.check(b3(DO,n)),e.ipv6=n=>e.check(w3(EO,n)),e.cidrv4=n=>e.check(D3(CO,n)),e.cidrv6=n=>e.check(E3($O,n)),e.e164=n=>e.check(x3(kO,n)),e.datetime=n=>e.check(tO(n)),e.date=n=>e.check(rO(n)),e.time=n=>e.check(sO(n)),e.duration=n=>e.check(aO(n))});function m(e){return i3(pO,e)}i(m,"string");const ze=O("ZodStringFormat",(e,t)=>{Be.init(e,t),t_.init(e,t)}),fO=O("ZodEmail",(e,t)=>{p8.init(e,t),ze.init(e,t)}),n_=O("ZodGUID",(e,t)=>{c8.init(e,t),ze.init(e,t)}),Va=O("ZodUUID",(e,t)=>{d8.init(e,t),ze.init(e,t)}),mO=O("ZodURL",(e,t)=>{f8.init(e,t),ze.init(e,t)}),hO=O("ZodEmoji",(e,t)=>{m8.init(e,t),ze.init(e,t)}),gO=O("ZodNanoID",(e,t)=>{h8.init(e,t),ze.init(e,t)}),yO=O("ZodCUID",(e,t)=>{g8.init(e,t),ze.init(e,t)}),vO=O("ZodCUID2",(e,t)=>{y8.init(e,t),ze.init(e,t)}),_O=O("ZodULID",(e,t)=>{v8.init(e,t),ze.init(e,t)}),bO=O("ZodXID",(e,t)=>{_8.init(e,t),ze.init(e,t)}),wO=O("ZodKSUID",(e,t)=>{b8.init(e,t),ze.init(e,t)}),DO=O("ZodIPv4",(e,t)=>{$8.init(e,t),ze.init(e,t)}),EO=O("ZodIPv6",(e,t)=>{x8.init(e,t),ze.init(e,t)}),CO=O("ZodCIDRv4",(e,t)=>{S8.init(e,t),ze.init(e,t)}),$O=O("ZodCIDRv6",(e,t)=>{k8.init(e,t),ze.init(e,t)}),xO=O("ZodBase64",(e,t)=>{I8.init(e,t),ze.init(e,t)}),SO=O("ZodBase64URL",(e,t)=>{T8.init(e,t),ze.init(e,t)}),kO=O("ZodE164",(e,t)=>{F8.init(e,t),ze.init(e,t)}),IO=O("ZodJWT",(e,t)=>{R8.init(e,t),ze.init(e,t)}),nd=O("ZodNumber",(e,t)=>{N0.init(e,t),Pe.init(e,t),e.gt=(r,o)=>e.check(K0(r,o)),e.gte=(r,o)=>e.check(td(r,o)),e.min=(r,o)=>e.check(td(r,o)),e.lt=(r,o)=>e.check(J0(r,o)),e.lte=(r,o)=>e.check(ed(r,o)),e.max=(r,o)=>e.check(ed(r,o)),e.int=r=>e.check(r_(r)),e.safe=r=>e.check(r_(r)),e.positive=r=>e.check(K0(0,r)),e.nonnegative=r=>e.check(td(0,r)),e.negative=r=>e.check(J0(0,r)),e.nonpositive=r=>e.check(ed(0,r)),e.multipleOf=(r,o)=>e.check(Y0(r,o)),e.step=(r,o)=>e.check(Y0(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function A(e){return F3(nd,e)}i(A,"number$1");const AO=O("ZodNumberFormat",(e,t)=>{P8.init(e,t),nd.init(e,t)});function r_(e){return R3(AO,e)}i(r_,"int");const TO=O("ZodBoolean",(e,t)=>{M8.init(e,t),Pe.init(e,t)});function qe(e){return P3(TO,e)}i(qe,"boolean");const FO=O("ZodNull",(e,t)=>{N8.init(e,t),Pe.init(e,t)});function o_(e){return M3(FO,e)}i(o_,"_null");const OO=O("ZodAny",(e,t)=>{B8.init(e,t),Pe.init(e,t)});function ft(){return N3(OO)}i(ft,"any");const RO=O("ZodUnknown",(e,t)=>{j8.init(e,t),Pe.init(e,t)});function $t(){return B3(RO)}i($t,"unknown");const PO=O("ZodNever",(e,t)=>{L8.init(e,t),Pe.init(e,t)});function MO(e){return j3(PO,e)}i(MO,"never");const NO=O("ZodArray",(e,t)=>{U8.init(e,t),Pe.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Ua(n,r)),e.nonempty=n=>e.check(Ua(1,n)),e.max=(n,r)=>e.check(X0(n,r)),e.length=(n,r)=>e.check(Q0(n,r)),e.unwrap=()=>e.element});function M(e,t){return K3(NO,e,t)}i(M,"array$1");const s_=O("ZodObject",(e,t)=>{z8.init(e,t),Pe.init(e,t),Ee(e,"shape",()=>t.shape),e.keyof=()=>fe(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:$t()}),e.loose=()=>e.clone({...e._zod.def,catchall:$t()}),e.strict=()=>e.clone({...e._zod.def,catchall:MO()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>f9(e,n),e.merge=n=>m9(e,n),e.pick=n=>d9(e,n),e.omit=n=>p9(e,n),e.partial=(...n)=>h9(a_,e,n[0]),e.required=(...n)=>g9(c_,e,n[0])});function b(e,t){const n={type:"object",get shape(){return Ra(this,"shape",{...e}),this.shape},...K(t)};return new s_(n)}i(b,"object$1");function rd(e,t){return new s_({type:"object",get shape(){return Ra(this,"shape",{...e}),this.shape},catchall:$t(),...K(t)})}i(rd,"looseObject");const i_=O("ZodUnion",(e,t)=>{U0.init(e,t),Pe.init(e,t),e.options=t.options});function se(e,t){return new i_({type:"union",options:e,...K(t)})}i(se,"union");const BO=O("ZodDiscriminatedUnion",(e,t)=>{i_.init(e,t),q8.init(e,t)});function Ce(e,t,n){return new BO({type:"union",options:t,discriminator:e,...K(n)})}i(Ce,"discriminatedUnion");const jO=O("ZodIntersection",(e,t)=>{V8.init(e,t),Pe.init(e,t)});function LO(e,t){return new jO({type:"intersection",left:e,right:t})}i(LO,"intersection");const UO=O("ZodRecord",(e,t)=>{G8.init(e,t),Pe.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function Ae(e,t,n){return new UO({type:"record",keyType:e,valueType:t,...K(n)})}i(Ae,"record");const od=O("ZodEnum",(e,t)=>{Z8.init(e,t),Pe.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const a of r)if(n.has(a))s[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new od({...t,checks:[],...K(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const a of r)if(n.has(a))delete s[a];else throw new Error(`Key ${a} not found in enum`);return new od({...t,checks:[],...K(o),entries:s})}});function fe(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new od({type:"enum",entries:n,...K(t)})}i(fe,"_enum");const zO=O("ZodLiteral",(e,t)=>{W8.init(e,t),Pe.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function k(e,t){return new zO({type:"literal",values:Array.isArray(e)?e:[e],...K(t)})}i(k,"literal");const qO=O("ZodTransform",(e,t)=>{H8.init(e,t),Pe.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=s=>{if(typeof s=="string")n.issues.push(Ks(s,n.value,t));else{const a=s;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(Ks(a))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function VO(e){return new qO({type:"transform",transform:e})}i(VO,"transform");const a_=O("ZodOptional",(e,t)=>{J8.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function l_(e){return new a_({type:"optional",innerType:e})}i(l_,"optional");const GO=O("ZodNullable",(e,t)=>{K8.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function u_(e){return new GO({type:"nullable",innerType:e})}i(u_,"nullable");const ZO=O("ZodDefault",(e,t)=>{Y8.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function WO(e,t){return new ZO({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}i(WO,"_default");const HO=O("ZodPrefault",(e,t)=>{X8.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function JO(e,t){return new HO({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}i(JO,"prefault");const c_=O("ZodNonOptional",(e,t)=>{Q8.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function KO(e,t){return new c_({type:"nonoptional",innerType:e,...K(t)})}i(KO,"nonoptional");const YO=O("ZodCatch",(e,t)=>{e3.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function XO(e,t){return new YO({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}i(XO,"_catch");const QO=O("ZodPipe",(e,t)=>{t3.init(e,t),Pe.init(e,t),e.in=t.in,e.out=t.out});function d_(e,t){return new QO({type:"pipe",in:e,out:t})}i(d_,"pipe");const eR=O("ZodReadonly",(e,t)=>{n3.init(e,t),Pe.init(e,t)});function tR(e){return new eR({type:"readonly",innerType:e})}i(tR,"readonly");const nR=O("ZodLazy",(e,t)=>{r3.init(e,t),Pe.init(e,t),e.unwrap=()=>e._zod.def.getter()});function sd(e){return new nR({type:"lazy",getter:e})}i(sd,"lazy");const id=O("ZodCustom",(e,t)=>{o3.init(e,t),Pe.init(e,t)});function rR(e){const t=new Ct({check:"custom"});return t._zod.check=e,t}i(rR,"check");function oR(e,t){return Y3(id,e??(()=>!0),t)}i(oR,"custom");function sR(e,t={}){return X3(id,e,t)}i(sR,"refine");function iR(e){const t=rR(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Ks(r,n.value,t._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),n.issues.push(Ks(o))}},e(n.value,n)));return t}i(iR,"superRefine");function Ga(e,t={error:`Input not instance of ${e.name}`}){const n=new id({type:"custom",check:"custom",fn:i(r=>r instanceof e,"fn"),abort:!0,...K(t)});return n._zod.bag.Class=e,n}i(Ga,"_instanceof");function aR(e){return O3(nd,e)}i(aR,"number");var De;(function(e){e.assertEqual=o=>{};function t(o){}i(t,"assertIs"),e.assertIs=t;function n(o){throw new Error}i(n,"assertNever"),e.assertNever=n,e.arrayToEnum=o=>{const s={};for(const a of o)s[a]=a;return s},e.getValidEnumValues=o=>{const s=e.objectKeys(o).filter(l=>typeof o[o[l]]!="number"),a={};for(const l of s)a[l]=o[l];return e.objectValues(a)},e.objectValues=o=>e.objectKeys(o).map(function(s){return o[s]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const s=[];for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&s.push(a);return s},e.find=(o,s)=>{for(const a of o)if(s(a))return a},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function r(o,s=" | "){return o.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}i(r,"joinValues"),e.joinValues=r,e.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(De||(De={}));var p_;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(p_||(p_={}));const H=De.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nn=i(e=>{switch(typeof e){case"undefined":return H.undefined;case"string":return H.string;case"number":return Number.isNaN(e)?H.nan:H.number;case"boolean":return H.boolean;case"function":return H.function;case"bigint":return H.bigint;case"symbol":return H.symbol;case"object":return Array.isArray(e)?H.array:e===null?H.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?H.promise:typeof Map<"u"&&e instanceof Map?H.map:typeof Set<"u"&&e instanceof Set?H.set:typeof Date<"u"&&e instanceof Date?H.date:H.object;default:return H.unknown}},"getParsedType"),U=De.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Cl=class Cl extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(s){return s.message},r={_errors:[]},o=i(s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(o);else if(a.code==="invalid_return_type")o(a.returnTypeError);else if(a.code==="invalid_arguments")o(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let l=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(n(a))):l[c]=l[c]||{_errors:[]},l=l[c],u++}}},"processError");return o(this),r}static assert(t){if(!(t instanceof Cl))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,De.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const o of this.issues)if(o.path.length>0){const s=o.path[0];n[s]=n[s]||[],n[s].push(t(o))}else r.push(t(o));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};i(Cl,"ZodError");let Cn=Cl;Cn.create=e=>new Cn(e);const ad=i((e,t)=>{let n;switch(e.code){case U.invalid_type:e.received===H.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case U.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,De.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:n=`Unrecognized key(s) in object: ${De.joinValues(e.keys,", ")}`;break;case U.invalid_union:n="Invalid input";break;case U.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${De.joinValues(e.options)}`;break;case U.invalid_enum_value:n=`Invalid enum value. Expected ${De.joinValues(e.options)}, received '${e.received}'`;break;case U.invalid_arguments:n="Invalid function arguments";break;case U.invalid_return_type:n="Invalid function return type";break;case U.invalid_date:n="Invalid date";break;case U.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:De.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case U.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case U.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case U.custom:n="Invalid input";break;case U.invalid_intersection_types:n="Intersection results could not be merged";break;case U.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case U.not_finite:n="Number must be finite";break;default:n=t.defaultError,De.assertNever(e)}return{message:n}},"errorMap");let lR=ad;function uR(){return lR}i(uR,"getErrorMap");const cR=i(e=>{const{data:t,path:n,errorMaps:r,issueData:o}=e,s=[...n,...o.path||[]],a={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let l="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)l=c(a,{data:t,defaultError:l}).message;return{...o,path:s,message:l}},"makeIssue");function W(e,t){const n=uR(),r=cR({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===ad?void 0:ad].filter(o=>!!o)});e.common.issues.push(r)}i(W,"addIssueToContext");const $l=class $l{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const o of n){if(o.status==="aborted")return ae;o.status==="dirty"&&t.dirty(),r.push(o.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const o of n){const s=await o.key,a=await o.value;r.push({key:s,value:a})}return $l.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const o of n){const{key:s,value:a}=o;if(s.status==="aborted"||a.status==="aborted")return ae;s.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||o.alwaysSet)&&(r[s.value]=a.value)}return{status:t.value,value:r}}};i($l,"ParseStatus");let Ot=$l;const ae=Object.freeze({status:"aborted"}),Qs=i(e=>({status:"dirty",value:e}),"DIRTY"),qt=i(e=>({status:"valid",value:e}),"OK"),f_=i(e=>e.status==="aborted","isAborted"),m_=i(e=>e.status==="dirty","isDirty"),qr=i(e=>e.status==="valid","isValid"),Za=i(e=>typeof Promise<"u"&&e instanceof Promise,"isAsync");var Y;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(Y||(Y={}));const Sp=class Sp{constructor(t,n,r,o){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};i(Sp,"ParseInputLazyPath");let gn=Sp;const h_=i((e,t)=>{if(qr(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Cn(e.common.issues);return this._error=n,this._error}}},"handleResult");function me(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:o}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:i((a,l)=>{const{message:u}=e;return a.code==="invalid_enum_value"?{message:u??l.defaultError}:typeof l.data>"u"?{message:u??r??l.defaultError}:a.code!=="invalid_type"?{message:l.defaultError}:{message:u??n??l.defaultError}},"customMap"),description:o}}i(me,"processCreateParams");const kp=class kp{get description(){return this._def.description}_getType(t){return Nn(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Nn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Ot,ctx:{common:t.parent.common,data:t.data,parsedType:Nn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(Za(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nn(t)},o=this._parseSync({data:t,path:r.path,parent:r});return h_(r,o)}"~validate"(t){const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nn(t)};if(!this["~standard"].async)try{const r=this._parseSync({data:t,path:[],parent:n});return qr(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(r=>qr(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nn(t)},o=this._parse({data:t,path:r.path,parent:r}),s=await(Za(o)?o:Promise.resolve(o));return h_(r,s)}refine(t,n){const r=i(o=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(o):n,"getIssueProperties");return this._refinement((o,s)=>{const a=t(o),l=i(()=>s.addIssue({code:U.custom,...r(o)}),"setError");return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(l(),!1)):a?!0:(l(),!1)})}refinement(t,n){return this._refinement((r,o)=>t(r)?!0:(o.addIssue(typeof n=="function"?n(r,o):n),!1))}_refinement(t){return new jn({schema:this,typeName:z.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i(n=>this["~validate"](n),"validate")}}optional(){return vn.create(this,this._def)}nullable(){return Ln.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Bn.create(this)}promise(){return Wr.create(this,this._def)}or(t){return Gr.create([this,t],this._def)}and(t){return Zr.create(this,t,this._def)}transform(t){return new jn({...me(this._def),schema:this,typeName:z.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new ri({...me(this._def),innerType:this,defaultValue:n,typeName:z.ZodDefault})}brand(){return new cd({typeName:z.ZodBranded,type:this,...me(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new oi({...me(this._def),innerType:this,catchValue:n,typeName:z.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return dd.create(this,t)}readonly(){return si.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};i(kp,"ZodType");let ye=kp;const dR=/^c[^\s-]{8,}$/i,pR=/^[0-9a-z]+$/,fR=/^[0-9A-HJKMNP-TV-Z]{26}$/i,mR=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hR=/^[a-z0-9_-]{21}$/i,gR=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,yR=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,vR=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_R="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ld;const bR=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wR=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,DR=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ER=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,CR=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$R=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,g_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",xR=new RegExp(`^${g_}$`);function y_(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}i(y_,"timeRegexSource");function SR(e){return new RegExp(`^${y_(e)}$`)}i(SR,"timeRegex");function kR(e){let t=`${g_}T${y_(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}i(kR,"datetimeRegex");function IR(e,t){return!!((t==="v4"||!t)&&bR.test(e)||(t==="v6"||!t)&&DR.test(e))}i(IR,"isValidIP");function AR(e,t){if(!gR.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),o=JSON.parse(atob(r));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||t&&o.alg!==t)}catch{return!1}}i(AR,"isValidJWT");function TR(e,t){return!!((t==="v4"||!t)&&wR.test(e)||(t==="v6"||!t)&&ER.test(e))}i(TR,"isValidCidr");const Dr=class Dr extends ye{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==H.string){const s=this._getOrReturnCtx(t);return W(s,{code:U.invalid_type,expected:H.string,received:s.parsedType}),ae}const r=new Ot;let o;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(o=this._getOrReturnCtx(t,o),W(o,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")t.data.length>s.value&&(o=this._getOrReturnCtx(t,o),W(o,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const a=t.data.length>s.value,l=t.data.length<s.value;(a||l)&&(o=this._getOrReturnCtx(t,o),a?W(o,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):l&&W(o,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")vR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"email",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")ld||(ld=new RegExp(_R,"u")),ld.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"emoji",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")mR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"uuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")hR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"nanoid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")dR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"cuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")pR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"cuid2",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")fR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"ulid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{o=this._getOrReturnCtx(t,o),W(o,{validation:"url",code:U.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"regex",code:U.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?kR(s).test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?xR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?SR(s).test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{code:U.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?yR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"duration",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?IR(t.data,s.version)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"ip",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?AR(t.data,s.alg)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"jwt",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?TR(t.data,s.version)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"cidr",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?CR.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"base64",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?$R.test(t.data)||(o=this._getOrReturnCtx(t,o),W(o,{validation:"base64url",code:U.invalid_string,message:s.message}),r.dirty()):De.assertNever(s);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(o=>t.test(o),{validation:n,code:U.invalid_string,...Y.errToObj(r)})}_addCheck(t){return new Dr({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Y.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Y.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Y.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Y.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Y.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Y.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Y.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Y.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Y.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Y.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Y.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Y.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Y.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1,...Y.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...Y.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...Y.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...Y.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n?.position,...Y.errToObj(n?.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...Y.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...Y.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...Y.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...Y.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...Y.errToObj(n)})}nonempty(t){return this.min(1,Y.errToObj(t))}trim(){return new Dr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Dr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Dr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};i(Dr,"ZodString");let ei=Dr;ei.create=e=>new ei({checks:[],typeName:z.ZodString,coerce:e?.coerce??!1,...me(e)});function FR(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=Number.parseInt(e.toFixed(o).replace(".","")),a=Number.parseInt(t.toFixed(o).replace(".",""));return s%a/10**o}i(FR,"floatSafeRemainder");const wi=class wi extends ye{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==H.number){const s=this._getOrReturnCtx(t);return W(s,{code:U.invalid_type,expected:H.number,received:s.parsedType}),ae}let r;const o=new Ot;for(const s of this._def.checks)s.kind==="int"?De.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),W(r,{code:U.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?FR(t.data,s.value)!==0&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),W(r,{code:U.not_finite,message:s.message}),o.dirty()):De.assertNever(s);return{status:o.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,Y.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Y.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Y.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Y.toString(n))}setLimit(t,n,r,o){return new wi({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Y.toString(o)}]})}_addCheck(t){return new wi({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Y.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Y.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Y.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Y.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Y.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Y.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:Y.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Y.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Y.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&De.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};i(wi,"ZodNumber");let ti=wi;ti.create=e=>new ti({checks:[],typeName:z.ZodNumber,coerce:e?.coerce||!1,...me(e)});const Di=class Di extends ye{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==H.bigint)return this._getInvalidInput(t);let r;const o=new Ot;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),W(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):De.assertNever(s);return{status:o.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return W(n,{code:U.invalid_type,expected:H.bigint,received:n.parsedType}),ae}gte(t,n){return this.setLimit("min",t,!0,Y.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Y.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Y.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Y.toString(n))}setLimit(t,n,r,o){return new Di({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Y.toString(o)}]})}_addCheck(t){return new Di({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Y.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Y.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Y.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Y.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Y.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};i(Di,"ZodBigInt");let Wa=Di;Wa.create=e=>new Wa({checks:[],typeName:z.ZodBigInt,coerce:e?.coerce??!1,...me(e)});const Ip=class Ip extends ye{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==H.boolean){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.boolean,received:r.parsedType}),ae}return qt(t.data)}};i(Ip,"ZodBoolean");let Ha=Ip;Ha.create=e=>new Ha({typeName:z.ZodBoolean,coerce:e?.coerce||!1,...me(e)});const xl=class xl extends ye{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==H.date){const s=this._getOrReturnCtx(t);return W(s,{code:U.invalid_type,expected:H.date,received:s.parsedType}),ae}if(Number.isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return W(s,{code:U.invalid_date}),ae}const r=new Ot;let o;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(o=this._getOrReturnCtx(t,o),W(o,{code:U.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(o=this._getOrReturnCtx(t,o),W(o,{code:U.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):De.assertNever(s);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new xl({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:Y.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:Y.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};i(xl,"ZodDate");let Ja=xl;Ja.create=e=>new Ja({checks:[],coerce:e?.coerce||!1,typeName:z.ZodDate,...me(e)});const Ap=class Ap extends ye{_parse(t){if(this._getType(t)!==H.symbol){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.symbol,received:r.parsedType}),ae}return qt(t.data)}};i(Ap,"ZodSymbol");let Ka=Ap;Ka.create=e=>new Ka({typeName:z.ZodSymbol,...me(e)});const Tp=class Tp extends ye{_parse(t){if(this._getType(t)!==H.undefined){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.undefined,received:r.parsedType}),ae}return qt(t.data)}};i(Tp,"ZodUndefined");let Ya=Tp;Ya.create=e=>new Ya({typeName:z.ZodUndefined,...me(e)});const Fp=class Fp extends ye{_parse(t){if(this._getType(t)!==H.null){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.null,received:r.parsedType}),ae}return qt(t.data)}};i(Fp,"ZodNull");let Xa=Fp;Xa.create=e=>new Xa({typeName:z.ZodNull,...me(e)});const Op=class Op extends ye{constructor(){super(...arguments),this._any=!0}_parse(t){return qt(t.data)}};i(Op,"ZodAny");let Qa=Op;Qa.create=e=>new Qa({typeName:z.ZodAny,...me(e)});const Rp=class Rp extends ye{constructor(){super(...arguments),this._unknown=!0}_parse(t){return qt(t.data)}};i(Rp,"ZodUnknown");let el=Rp;el.create=e=>new el({typeName:z.ZodUnknown,...me(e)});const Pp=class Pp extends ye{_parse(t){const n=this._getOrReturnCtx(t);return W(n,{code:U.invalid_type,expected:H.never,received:n.parsedType}),ae}};i(Pp,"ZodNever");let yn=Pp;yn.create=e=>new yn({typeName:z.ZodNever,...me(e)});const Mp=class Mp extends ye{_parse(t){if(this._getType(t)!==H.undefined){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.void,received:r.parsedType}),ae}return qt(t.data)}};i(Mp,"ZodVoid");let tl=Mp;tl.create=e=>new tl({typeName:z.ZodVoid,...me(e)});const ro=class ro extends ye{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),o=this._def;if(n.parsedType!==H.array)return W(n,{code:U.invalid_type,expected:H.array,received:n.parsedType}),ae;if(o.exactLength!==null){const a=n.data.length>o.exactLength.value,l=n.data.length<o.exactLength.value;(a||l)&&(W(n,{code:a?U.too_big:U.too_small,minimum:l?o.exactLength.value:void 0,maximum:a?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),r.dirty())}if(o.minLength!==null&&n.data.length<o.minLength.value&&(W(n,{code:U.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),r.dirty()),o.maxLength!==null&&n.data.length>o.maxLength.value&&(W(n,{code:U.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((a,l)=>o.type._parseAsync(new gn(n,a,n.path,l)))).then(a=>Ot.mergeArray(r,a));const s=[...n.data].map((a,l)=>o.type._parseSync(new gn(n,a,n.path,l)));return Ot.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new ro({...this._def,minLength:{value:t,message:Y.toString(n)}})}max(t,n){return new ro({...this._def,maxLength:{value:t,message:Y.toString(n)}})}length(t,n){return new ro({...this._def,exactLength:{value:t,message:Y.toString(n)}})}nonempty(t){return this.min(1,t)}};i(ro,"ZodArray");let Bn=ro;Bn.create=(e,t)=>new Bn({type:e,minLength:null,maxLength:null,exactLength:null,typeName:z.ZodArray,...me(t)});function Vr(e){if(e instanceof Jt){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=vn.create(Vr(r))}return new Jt({...e._def,shape:i(()=>t,"shape")})}else return e instanceof Bn?new Bn({...e._def,type:Vr(e.element)}):e instanceof vn?vn.create(Vr(e.unwrap())):e instanceof Ln?Ln.create(Vr(e.unwrap())):e instanceof hr?hr.create(e.items.map(t=>Vr(t))):e}i(Vr,"deepPartialify");const Nt=class Nt extends ye{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=De.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==H.object){const c=this._getOrReturnCtx(t);return W(c,{code:U.invalid_type,expected:H.object,received:c.parsedType}),ae}const{status:r,ctx:o}=this._processInputParams(t),{shape:s,keys:a}=this._getCached(),l=[];if(!(this._def.catchall instanceof yn&&this._def.unknownKeys==="strip"))for(const c in o.data)a.includes(c)||l.push(c);const u=[];for(const c of a){const d=s[c],p=o.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new gn(o,p,o.path,c)),alwaysSet:c in o.data})}if(this._def.catchall instanceof yn){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of l)u.push({key:{status:"valid",value:d},value:{status:"valid",value:o.data[d]}});else if(c==="strict")l.length>0&&(W(o,{code:U.unrecognized_keys,keys:l}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of l){const p=o.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new gn(o,p,o.path,d)),alwaysSet:d in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of u){const p=await d.key,h=await d.value;c.push({key:p,value:h,alwaysSet:d.alwaysSet})}return c}).then(c=>Ot.mergeObjectSync(r,c)):Ot.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(t){return Y.errToObj,new Nt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:i((n,r)=>{const o=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:Y.errToObj(t).message??o}:{message:o}},"errorMap")}:{}})}strip(){return new Nt({...this._def,unknownKeys:"strip"})}passthrough(){return new Nt({...this._def,unknownKeys:"passthrough"})}extend(t){return new Nt({...this._def,shape:i(()=>({...this._def.shape(),...t}),"shape")})}merge(t){return new Nt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:i(()=>({...this._def.shape(),...t._def.shape()}),"shape"),typeName:z.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Nt({...this._def,catchall:t})}pick(t){const n={};for(const r of De.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Nt({...this._def,shape:i(()=>n,"shape")})}omit(t){const n={};for(const r of De.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Nt({...this._def,shape:i(()=>n,"shape")})}deepPartial(){return Vr(this)}partial(t){const n={};for(const r of De.objectKeys(this.shape)){const o=this.shape[r];t&&!t[r]?n[r]=o:n[r]=o.optional()}return new Nt({...this._def,shape:i(()=>n,"shape")})}required(t){const n={};for(const r of De.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof vn;)s=s._def.innerType;n[r]=s}return new Nt({...this._def,shape:i(()=>n,"shape")})}keyof(){return v_(De.objectKeys(this.shape))}};i(Nt,"ZodObject");let Jt=Nt;Jt.create=(e,t)=>new Jt({shape:i(()=>e,"shape"),unknownKeys:"strip",catchall:yn.create(),typeName:z.ZodObject,...me(t)}),Jt.strictCreate=(e,t)=>new Jt({shape:i(()=>e,"shape"),unknownKeys:"strict",catchall:yn.create(),typeName:z.ZodObject,...me(t)}),Jt.lazycreate=(e,t)=>new Jt({shape:e,unknownKeys:"strip",catchall:yn.create(),typeName:z.ZodObject,...me(t)});const Np=class Np extends ye{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function o(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const a=s.map(l=>new Cn(l.ctx.common.issues));return W(n,{code:U.invalid_union,unionErrors:a}),ae}if(i(o,"handleResults"),n.common.async)return Promise.all(r.map(async s=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(o);{let s;const a=[];for(const u of r){const c={...n,common:{...n.common,issues:[]},parent:null},d=u._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const l=a.map(u=>new Cn(u));return W(n,{code:U.invalid_union,unionErrors:l}),ae}}get options(){return this._def.options}};i(Np,"ZodUnion");let Gr=Np;Gr.create=(e,t)=>new Gr({options:e,typeName:z.ZodUnion,...me(t)});function ud(e,t){const n=Nn(e),r=Nn(t);if(e===t)return{valid:!0,data:e};if(n===H.object&&r===H.object){const o=De.objectKeys(t),s=De.objectKeys(e).filter(l=>o.indexOf(l)!==-1),a={...e,...t};for(const l of s){const u=ud(e[l],t[l]);if(!u.valid)return{valid:!1};a[l]=u.data}return{valid:!0,data:a}}else if(n===H.array&&r===H.array){if(e.length!==t.length)return{valid:!1};const o=[];for(let s=0;s<e.length;s++){const a=e[s],l=t[s],u=ud(a,l);if(!u.valid)return{valid:!1};o.push(u.data)}return{valid:!0,data:o}}else return n===H.date&&r===H.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}i(ud,"mergeValues");const Bp=class Bp extends ye{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),o=i((s,a)=>{if(f_(s)||f_(a))return ae;const l=ud(s.value,a.value);return l.valid?((m_(s)||m_(a))&&n.dirty(),{status:n.value,value:l.data}):(W(r,{code:U.invalid_intersection_types}),ae)},"handleParsed");return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>o(s,a)):o(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};i(Bp,"ZodIntersection");let Zr=Bp;Zr.create=(e,t,n)=>new Zr({left:e,right:t,typeName:z.ZodIntersection,...me(n)});const Sl=class Sl extends ye{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==H.array)return W(r,{code:U.invalid_type,expected:H.array,received:r.parsedType}),ae;if(r.data.length<this._def.items.length)return W(r,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ae;!this._def.rest&&r.data.length>this._def.items.length&&(W(r,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((a,l)=>{const u=this._def.items[l]||this._def.rest;return u?u._parse(new gn(r,a,r.path,l)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>Ot.mergeArray(n,a)):Ot.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new Sl({...this._def,rest:t})}};i(Sl,"ZodTuple");let hr=Sl;hr.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new hr({items:e,typeName:z.ZodTuple,rest:null,...me(t)})};const jp=class jp extends ye{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==H.map)return W(r,{code:U.invalid_type,expected:H.map,received:r.parsedType}),ae;const o=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([l,u],c)=>({key:o._parse(new gn(r,l,r.path,[c,"key"])),value:s._parse(new gn(r,u,r.path,[c,"value"]))}));if(r.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const u of a){const c=await u.key,d=await u.value;if(c.status==="aborted"||d.status==="aborted")return ae;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),l.set(c.value,d.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const u of a){const c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return ae;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),l.set(c.value,d.value)}return{status:n.value,value:l}}}};i(jp,"ZodMap");let nl=jp;nl.create=(e,t,n)=>new nl({valueType:t,keyType:e,typeName:z.ZodMap,...me(n)});const Ei=class Ei extends ye{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==H.set)return W(r,{code:U.invalid_type,expected:H.set,received:r.parsedType}),ae;const o=this._def;o.minSize!==null&&r.data.size<o.minSize.value&&(W(r,{code:U.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),n.dirty()),o.maxSize!==null&&r.data.size>o.maxSize.value&&(W(r,{code:U.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),n.dirty());const s=this._def.valueType;function a(u){const c=new Set;for(const d of u){if(d.status==="aborted")return ae;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}i(a,"finalizeSet");const l=[...r.data.values()].map((u,c)=>s._parse(new gn(r,u,r.path,c)));return r.common.async?Promise.all(l).then(u=>a(u)):a(l)}min(t,n){return new Ei({...this._def,minSize:{value:t,message:Y.toString(n)}})}max(t,n){return new Ei({...this._def,maxSize:{value:t,message:Y.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};i(Ei,"ZodSet");let rl=Ei;rl.create=(e,t)=>new rl({valueType:e,minSize:null,maxSize:null,typeName:z.ZodSet,...me(t)});const Lp=class Lp extends ye{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};i(Lp,"ZodLazy");let ol=Lp;ol.create=(e,t)=>new ol({getter:e,typeName:z.ZodLazy,...me(t)});const Up=class Up extends ye{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return W(n,{received:n.data,code:U.invalid_literal,expected:this._def.value}),ae}return{status:"valid",value:t.data}}get value(){return this._def.value}};i(Up,"ZodLiteral");let sl=Up;sl.create=(e,t)=>new sl({value:e,typeName:z.ZodLiteral,...me(t)});function v_(e,t){return new ni({values:e,typeName:z.ZodEnum,...me(t)})}i(v_,"createZodEnum");const Ci=class Ci extends ye{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return W(n,{expected:De.joinValues(r),received:n.parsedType,code:U.invalid_type}),ae}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return W(n,{received:n.data,code:U.invalid_enum_value,options:r}),ae}return qt(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return Ci.create(t,{...this._def,...n})}exclude(t,n=this._def){return Ci.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};i(Ci,"ZodEnum");let ni=Ci;ni.create=v_;const zp=class zp extends ye{_parse(t){const n=De.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==H.string&&r.parsedType!==H.number){const o=De.objectValues(n);return W(r,{expected:De.joinValues(o),received:r.parsedType,code:U.invalid_type}),ae}if(this._cache||(this._cache=new Set(De.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const o=De.objectValues(n);return W(r,{received:r.data,code:U.invalid_enum_value,options:o}),ae}return qt(t.data)}get enum(){return this._def.values}};i(zp,"ZodNativeEnum");let il=zp;il.create=(e,t)=>new il({values:e,typeName:z.ZodNativeEnum,...me(t)});const qp=class qp extends ye{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==H.promise&&n.common.async===!1)return W(n,{code:U.invalid_type,expected:H.promise,received:n.parsedType}),ae;const r=n.parsedType===H.promise?n.data:Promise.resolve(n.data);return qt(r.then(o=>this._def.type.parseAsync(o,{path:n.path,errorMap:n.common.contextualErrorMap})))}};i(qp,"ZodPromise");let Wr=qp;Wr.create=(e,t)=>new Wr({type:e,typeName:z.ZodPromise,...me(t)});const Vp=class Vp extends ye{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),o=this._def.effect||null,s={addIssue:i(a=>{W(r,a),a.fatal?n.abort():n.dirty()},"addIssue"),get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){const a=o.transform(r.data,s);if(r.common.async)return Promise.resolve(a).then(async l=>{if(n.value==="aborted")return ae;const u=await this._def.schema._parseAsync({data:l,path:r.path,parent:r});return u.status==="aborted"?ae:u.status==="dirty"||n.value==="dirty"?Qs(u.value):u});{if(n.value==="aborted")return ae;const l=this._def.schema._parseSync({data:a,path:r.path,parent:r});return l.status==="aborted"?ae:l.status==="dirty"||n.value==="dirty"?Qs(l.value):l}}if(o.type==="refinement"){const a=i(l=>{const u=o.refinement(l,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l},"executeRefinement");if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?ae:(l.status==="dirty"&&n.dirty(),a(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>l.status==="aborted"?ae:(l.status==="dirty"&&n.dirty(),a(l.value).then(()=>({status:n.value,value:l.value}))))}if(o.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!qr(a))return ae;const l=o.transform(a.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>qr(a)?Promise.resolve(o.transform(a.value,s)).then(l=>({status:n.value,value:l})):ae);De.assertNever(o)}};i(Vp,"ZodEffects");let jn=Vp;jn.create=(e,t,n)=>new jn({schema:e,typeName:z.ZodEffects,effect:t,...me(n)}),jn.createWithPreprocess=(e,t,n)=>new jn({schema:t,effect:{type:"preprocess",transform:e},typeName:z.ZodEffects,...me(n)});const Gp=class Gp extends ye{_parse(t){return this._getType(t)===H.undefined?qt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};i(Gp,"ZodOptional");let vn=Gp;vn.create=(e,t)=>new vn({innerType:e,typeName:z.ZodOptional,...me(t)});const Zp=class Zp extends ye{_parse(t){return this._getType(t)===H.null?qt(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};i(Zp,"ZodNullable");let Ln=Zp;Ln.create=(e,t)=>new Ln({innerType:e,typeName:z.ZodNullable,...me(t)});const Wp=class Wp extends ye{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===H.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};i(Wp,"ZodDefault");let ri=Wp;ri.create=(e,t)=>new ri({innerType:e,typeName:z.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...me(t)});const Hp=class Hp extends ye{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},o=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Za(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Cn(r.common.issues)},input:r.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Cn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};i(Hp,"ZodCatch");let oi=Hp;oi.create=(e,t)=>new oi({innerType:e,typeName:z.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...me(t)});const Jp=class Jp extends ye{_parse(t){if(this._getType(t)!==H.nan){const r=this._getOrReturnCtx(t);return W(r,{code:U.invalid_type,expected:H.nan,received:r.parsedType}),ae}return{status:"valid",value:t.data}}};i(Jp,"ZodNaN");let al=Jp;al.create=e=>new al({typeName:z.ZodNaN,...me(e)});const Kp=class Kp extends ye{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}};i(Kp,"ZodBranded");let cd=Kp;const kl=class kl extends ye{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return i(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ae:s.status==="dirty"?(n.dirty(),Qs(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})},"handleAsync")();{const o=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ae:o.status==="dirty"?(n.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:r.path,parent:r})}}static create(t,n){return new kl({in:t,out:n,typeName:z.ZodPipeline})}};i(kl,"ZodPipeline");let dd=kl;const Yp=class Yp extends ye{_parse(t){const n=this._def.innerType._parse(t),r=i(o=>(qr(o)&&(o.value=Object.freeze(o.value)),o),"freeze");return Za(n)?n.then(o=>r(o)):r(n)}unwrap(){return this._def.innerType}};i(Yp,"ZodReadonly");let si=Yp;si.create=(e,t)=>new si({innerType:e,typeName:z.ZodReadonly,...me(t)});var z;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(z||(z={}));const Fe=ei.create,_n=ti.create;yn.create;const Un=Bn.create,Kt=Jt.create,pd=Gr.create;Zr.create,hr.create;const ll=ni.create;Wr.create,vn.create,Ln.create;const Xp=class Xp extends Error{constructor(t,n){super(t),this.name="ParseError",this.type=n.type,this.field=n.field,this.value=n.value,this.line=n.line}};i(Xp,"ParseError");let ul=Xp;function fd(e){}i(fd,"noop");function OR(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=fd,onError:n=fd,onRetry:r=fd,onComment:o}=e;let s="",a=!0,l,u="",c="";function d(y){const v=a?y.replace(/^\xEF\xBB\xBF/,""):y,[_,w]=RR(`${s}${v}`);for(const D of _)p(D);s=w,a=!1}i(d,"feed");function p(y){if(y===""){g();return}if(y.startsWith(":")){o&&o(y.slice(y.startsWith(": ")?2:1));return}const v=y.indexOf(":");if(v!==-1){const _=y.slice(0,v),w=y[v+1]===" "?2:1,D=y.slice(v+w);h(_,D,y);return}h(y,"",y)}i(p,"parseLine");function h(y,v,_){switch(y){case"event":c=v;break;case"data":u=`${u}${v}
`;break;case"id":l=v.includes("\0")?void 0:v;break;case"retry":/^\d+$/.test(v)?r(parseInt(v,10)):n(new ul(`Invalid \`retry\` value: "${v}"`,{type:"invalid-retry",value:v,line:_}));break;default:n(new ul(`Unknown field "${y.length>20?`${y.slice(0,20)}\u2026`:y}"`,{type:"unknown-field",field:y,value:v,line:_}));break}}i(h,"processField");function g(){u.length>0&&t({id:l,event:c||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),l=void 0,u="",c=""}i(g,"dispatchEvent");function f(y={}){s&&y.consume&&p(s),a=!0,l=void 0,u="",c="",s=""}return i(f,"reset"),{feed:d,reset:f}}i(OR,"createParser");function RR(e){const t=[];let n="",r=0;for(;r<e.length;){const o=e.indexOf("\r",r),s=e.indexOf(`
`,r);let a=-1;if(o!==-1&&s!==-1?a=Math.min(o,s):o!==-1?o===e.length-1?a=-1:a=o:s!==-1&&(a=s),a===-1){n=e.slice(r);break}else{const l=e.slice(r,a);t.push(l),r=a+1,e[r-1]==="\r"&&e[r]===`
`&&r++}}return[t,n]}i(RR,"splitLines");const Qp=class Qp extends TransformStream{constructor({onError:t,onRetry:n,onComment:r}={}){let o;super({start(s){o=OR({onEvent:i(a=>{s.enqueue(a)},"onEvent"),onError(a){t==="terminate"?s.error(a):typeof t=="function"&&t(a)},onRetry:n,onComment:r})},transform(s){o.feed(s)}})}};i(Qp,"EventSourceParserStream");let md=Qp;function Ve(...e){return e.reduce((t,n)=>({...t,...n??{}}),{})}i(Ve,"combineHeaders");function PR({tools:e=[],providerToolNames:t}){const n={},r={};for(const o of e)if(o.type==="provider"&&o.id in t){const s=t[o.id];n[o.name]=s,r[s]=o.name}return{toProviderToolName:i(o=>{var s;return(s=n[o])!=null?s:o},"toProviderToolName"),toCustomToolName:i(o=>{var s;return(s=r[o])!=null?s:o},"toCustomToolName")}}i(PR,"createToolNameMapping");async function MR(e,t){if(e==null)return Promise.resolve();const n=t?.abortSignal;return new Promise((r,o)=>{if(n?.aborted){o(__());return}const s=setTimeout(()=>{a(),r()},e),a=i(()=>{clearTimeout(s),n?.removeEventListener("abort",l)},"cleanup"),l=i(()=>{a(),o(__())},"onAbort");n?.addEventListener("abort",l)})}i(MR,"delay");function __(){return new DOMException("Delay was aborted","AbortError")}i(__,"createAbortError");function Hr(e){return Object.fromEntries([...e.headers])}i(Hr,"extractResponseHeaders");var{btoa:NR,atob:BR}=globalThis;function gr(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=BR(t);return Uint8Array.from(n,r=>r.codePointAt(0))}i(gr,"convertBase64ToUint8Array");function Jr(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return NR(t)}i(Jr,"convertUint8ArrayToBase64");function $n(e){return e instanceof Uint8Array?Jr(e):e}i($n,"convertToBase64");function b_(e,t={}){const{useArrayBrackets:n=!0}=t,r=new FormData;for(const[o,s]of Object.entries(e))if(s!=null){if(Array.isArray(s)){if(s.length===1){r.append(o,s[0]);continue}const a=n?`${o}[]`:o;for(const l of s)r.append(a,l);continue}r.append(o,s)}return r}i(b_,"convertToFormData");var w_="AI_DownloadError",D_=`vercel.ai.error.${w_}`,jR=Symbol.for(D_),E_,C_,zn=(bo=class extends(C_=oe,E_=jR,C_){constructor({url:t,statusCode:n,statusText:r,cause:o,message:s=o==null?`Failed to download ${t}: ${n} ${r}`:`Failed to download ${t}: ${o}`}){super({name:w_,message:s,cause:o}),this[E_]=!0,this.url=t,this.statusCode=n,this.statusText=r}static isInstance(t){return oe.hasMarker(t,D_)}},i(bo,"DownloadError"),bo),hd=2*1024*1024*1024;async function $_({response:e,url:t,maxBytes:n=hd}){const r=e.headers.get("content-length");if(r!=null){const d=parseInt(r,10);if(!isNaN(d)&&d>n)throw new zn({url:t,message:`Download of ${t} exceeded maximum size of ${n} bytes (Content-Length: ${d}).`})}const o=e.body;if(o==null)return new Uint8Array(0);const s=o.getReader(),a=[];let l=0;try{for(;;){const{done:d,value:p}=await s.read();if(d)break;if(l+=p.length,l>n)throw new zn({url:t,message:`Download of ${t} exceeded maximum size of ${n} bytes.`});a.push(p)}}finally{try{await s.cancel()}finally{s.releaseLock()}}const u=new Uint8Array(l);let c=0;for(const d of a)u.set(d,c),c+=d.length;return u}i($_,"readResponseWithSizeLimit");async function gd(e,t){var n,r;try{const o=await fetch(e,{signal:t?.abortSignal});if(!o.ok)throw new zn({url:e,statusCode:o.status,statusText:o.statusText});const s=await $_({response:o,url:e,maxBytes:(n=t?.maxBytes)!=null?n:hd}),a=(r=o.headers.get("content-type"))!=null?r:void 0;return new Blob([s],a?{type:a}:void 0)}catch(o){throw zn.isInstance(o)?o:new zn({url:e,cause:o})}}i(gd,"downloadBlob");var ii=i(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const o=i(()=>{const s=n.length,a=new Array(t);for(let l=0;l<t;l++)a[l]=n[Math.random()*s|0];return a.join("")},"generator");if(e==null)return o;if(n.includes(r))throw new Gv({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${o()}`},"createIdGenerator"),ot=ii();function x_(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}i(x_,"getErrorMessage");function Kr(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}i(Kr,"isAbortError");var LR=["fetch failed","failed to fetch"],UR=["ConnectionRefused","ConnectionClosed","FailedToOpenSocket","ECONNRESET","ECONNREFUSED","ETIMEDOUT","EPIPE"];function zR(e){if(!(e instanceof Error))return!1;const t=e.code;return!!(typeof t=="string"&&UR.includes(t))}i(zR,"isBunNetworkError");function S_({error:e,url:t,requestBodyValues:n}){if(Kr(e))return e;if(e instanceof TypeError&&LR.includes(e.message.toLowerCase())){const r=e.cause;if(r!=null)return new Ue({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return zR(e)?new Ue({message:`Cannot connect to API: ${e.message}`,cause:e,url:t,requestBodyValues:n,isRetryable:!0}):e}i(S_,"handleFetchError");function yd(e=globalThis){var t,n,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(n=e.process)==null?void 0:n.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}i(yd,"getRuntimeEnvironmentUserAgent");function qR(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((n,r)=>{t[r.toLowerCase()]=n});else{Array.isArray(e)||(e=Object.entries(e));for(const[n,r]of e)r!=null&&(t[n.toLowerCase()]=r)}return t}i(qR,"normalizeHeaders");function yr(e,...t){const n=new Headers(qR(e)),r=n.get("user-agent")||"";return n.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}i(yr,"withUserAgentSuffix");var k_="4.0.15",VR=i(()=>globalThis.fetch,"getOriginalFetch"),I_=i(async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:o,fetch:s=VR()})=>{try{const a=await s(e,{method:"GET",headers:yr(t,`ai-sdk/provider-utils/${k_}`,yd()),signal:o}),l=Hr(a);if(!a.ok){let u;try{u=await r({response:a,url:e,requestBodyValues:{}})}catch(c){throw Kr(c)||Ue.isInstance(c)?c:new Ue({message:"Failed to process error response",cause:c,statusCode:a.status,url:e,responseHeaders:l,requestBodyValues:{}})}throw u.value}try{return await n({response:a,url:e,requestBodyValues:{}})}catch(u){throw u instanceof Error&&(Kr(u)||Ue.isInstance(u))?u:new Ue({message:"Failed to process successful response",cause:u,statusCode:a.status,url:e,responseHeaders:l,requestBodyValues:{}})}}catch(a){throw S_({error:a,url:e,requestBodyValues:{}})}},"getFromApi");function GR(e){return e!=null}i(GR,"isNonNullable");function ZR({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([r,o])=>{const s=r.toLowerCase();return s==="*"||s==="*/*"?{mediaTypePrefix:"",regexes:o}:{mediaTypePrefix:s.replace(/\*/,""),regexes:o}}).filter(({mediaTypePrefix:r})=>e.startsWith(r)).flatMap(({regexes:r})=>r).some(r=>r.test(t))}i(ZR,"isUrlSupported");function WR({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if(typeof e=="string")return e;if(e!=null)throw new Oa({message:`${r} API key must be a string.`});if(typeof process>"u")throw new Oa({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new Oa({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Oa({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}i(WR,"loadApiKey");function ai({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=process.env[t],!(e==null||typeof e!="string")))return e}i(ai,"loadOptionalSetting");function HR(e){var t;const[n,r=""]=e.toLowerCase().split("/");return(t={mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"}[r])!=null?t:r}i(HR,"mediaTypeToExtension");var JR=/"__proto__"\s*:/,KR=/"constructor"\s*:/;function A_(e){const t=JSON.parse(e);return t===null||typeof t!="object"||JR.test(e)===!1&&KR.test(e)===!1?t:YR(t)}i(A_,"_parse");function YR(e){let t=[e];for(;t.length;){const n=t;t=[];for(const r of n){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const o in r){const s=r[o];s&&typeof s=="object"&&t.push(s)}}}return e}i(YR,"filter");function vd(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return A_(e)}try{return A_(e)}finally{Error.stackTraceLimit=t}}i(vd,"secureJsonParse");function _d(e){if(e.type==="object"||Array.isArray(e.type)&&e.type.includes("object")){e.additionalProperties=!1;const{properties:n}=e;if(n!=null)for(const r of Object.keys(n))n[r]=vr(n[r])}e.items!=null&&(e.items=Array.isArray(e.items)?e.items.map(vr):vr(e.items)),e.anyOf!=null&&(e.anyOf=e.anyOf.map(vr)),e.allOf!=null&&(e.allOf=e.allOf.map(vr)),e.oneOf!=null&&(e.oneOf=e.oneOf.map(vr));const{definitions:t}=e;if(t!=null)for(const n of Object.keys(t))t[n]=vr(t[n]);return e}i(_d,"addAdditionalPropertiesToJsonSchema");function vr(e){return typeof e=="boolean"?e:_d(e)}i(vr,"visit");var XR=Symbol("Let zodToJsonSchema decide on which parser to use"),T_={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},QR=i(e=>typeof e=="string"?{...T_,name:e}:{...T_,...e},"getDefaultOptions");function Rt(){return{}}i(Rt,"parseAnyDef");function e4(e,t){var n,r,o;const s={type:"array"};return(n=e.type)!=null&&n._def&&((o=(r=e.type)==null?void 0:r._def)==null?void 0:o.typeName)!==z.ZodAny&&(s.items=ke(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(s.minItems=e.minLength.value),e.maxLength&&(s.maxItems=e.maxLength.value),e.exactLength&&(s.minItems=e.exactLength.value,s.maxItems=e.exactLength.value),s}i(e4,"parseArrayDef");function t4(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}i(t4,"parseBigintDef");function n4(){return{type:"boolean"}}i(n4,"parseBooleanDef");function F_(e,t){return ke(e.type._def,t)}i(F_,"parseBrandedDef");var r4=i((e,t)=>ke(e.innerType._def,t),"parseCatchDef");function O_(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((o,s)=>O_(e,t,o))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return o4(e)}}i(O_,"parseDateDef");var o4=i(e=>{const t={type:"integer",format:"unix-time"};for(const n of e.checks)switch(n.kind){case"min":t.minimum=n.value;break;case"max":t.maximum=n.value;break}return t},"integerDateParser");function s4(e,t){return{...ke(e.innerType._def,t),default:e.defaultValue()}}i(s4,"parseDefaultDef");function i4(e,t){return t.effectStrategy==="input"?ke(e.schema._def,t):Rt()}i(i4,"parseEffectsDef");function a4(e){return{type:"string",enum:Array.from(e.values)}}i(a4,"parseEnumDef");var l4=i(e=>"type"in e&&e.type==="string"?!1:"allOf"in e,"isJsonSchema7AllOfType");function u4(e,t){const n=[ke(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ke(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o),r=[];return n.forEach(o=>{if(l4(o))r.push(...o.allOf);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:a,...l}=o;s=l}r.push(s)}}),r.length?{allOf:r}:void 0}i(u4,"parseIntersectionDef");function c4(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}i(c4,"parseLiteralDef");var bd=void 0,Yt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:i(()=>(bd===void 0&&(bd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),bd),"emoji"),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function R_(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value;break;case"max":n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":Xt(n,"email",r.message,t);break;case"format:idn-email":Xt(n,"idn-email",r.message,t);break;case"pattern:zod":ht(n,Yt.email,r.message,t);break}break;case"url":Xt(n,"uri",r.message,t);break;case"uuid":Xt(n,"uuid",r.message,t);break;case"regex":ht(n,r.regex,r.message,t);break;case"cuid":ht(n,Yt.cuid,r.message,t);break;case"cuid2":ht(n,Yt.cuid2,r.message,t);break;case"startsWith":ht(n,RegExp(`^${wd(r.value,t)}`),r.message,t);break;case"endsWith":ht(n,RegExp(`${wd(r.value,t)}$`),r.message,t);break;case"datetime":Xt(n,"date-time",r.message,t);break;case"date":Xt(n,"date",r.message,t);break;case"time":Xt(n,"time",r.message,t);break;case"duration":Xt(n,"duration",r.message,t);break;case"length":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"includes":{ht(n,RegExp(wd(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&Xt(n,"ipv4",r.message,t),r.version!=="v4"&&Xt(n,"ipv6",r.message,t);break}case"base64url":ht(n,Yt.base64url,r.message,t);break;case"jwt":ht(n,Yt.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&ht(n,Yt.ipv4Cidr,r.message,t),r.version!=="v4"&&ht(n,Yt.ipv6Cidr,r.message,t);break}case"emoji":ht(n,Yt.emoji(),r.message,t);break;case"ulid":{ht(n,Yt.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Xt(n,"binary",r.message,t);break}case"contentEncoding:base64":{n.contentEncoding="base64";break}case"pattern:zod":{ht(n,Yt.base64,r.message,t);break}}break}case"nanoid":ht(n,Yt.nanoid,r.message,t)}return n}i(R_,"parseStringDef");function wd(e,t){return t.patternStrategy==="escape"?p4(e):e}i(wd,"escapeLiteralCheckValue");var d4=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function p4(e){let t="";for(let n=0;n<e.length;n++)d4.has(e[n])||(t+="\\"),t+=e[n];return t}i(p4,"escapeNonAlphaNumeric");function Xt(e,t,n,r){var o;e.format||(o=e.anyOf)!=null&&o.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}i(Xt,"addFormat");function ht(e,t,n,r){var o;e.pattern||(o=e.allOf)!=null&&o.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:P_(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=P_(t,r)}i(ht,"addPattern");function P_(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},o=r.i?e.source.toLowerCase():e.source;let s="",a=!1,l=!1,u=!1;for(let c=0;c<o.length;c++){if(a){s+=o[c],a=!1;continue}if(r.i){if(l){if(o[c].match(/[a-z]/)){u?(s+=o[c],s+=`${o[c-2]}-${o[c]}`.toUpperCase(),u=!1):o[c+1]==="-"&&((n=o[c+2])!=null&&n.match(/[a-z]/))?(s+=o[c],u=!0):s+=`${o[c]}${o[c].toUpperCase()}`;continue}}else if(o[c].match(/[a-z]/)){s+=`[${o[c]}${o[c].toUpperCase()}]`;continue}}if(r.m){if(o[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(o[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&o[c]==="."){s+=l?`${o[c]}\r
`:`[${o[c]}\r
]`;continue}s+=o[c],o[c]==="\\"?a=!0:l&&o[c]==="]"?l=!1:!l&&o[c]==="["&&(l=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}i(P_,"stringifyRegExpWithFlags");function M_(e,t){var n,r,o,s,a,l;const u={type:"object",additionalProperties:(n=ke(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?n:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===z.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const{type:c,...d}=R_(e.keyType._def,t);return{...u,propertyNames:d}}else{if(((s=e.keyType)==null?void 0:s._def.typeName)===z.ZodEnum)return{...u,propertyNames:{enum:e.keyType._def.values}};if(((a=e.keyType)==null?void 0:a._def.typeName)===z.ZodBranded&&e.keyType._def.type._def.typeName===z.ZodString&&((l=e.keyType._def.type._def.checks)!=null&&l.length)){const{type:c,...d}=F_(e.keyType._def,t);return{...u,propertyNames:d}}}return u}i(M_,"parseRecordDef");function f4(e,t){if(t.mapStrategy==="record")return M_(e,t);const n=ke(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Rt(),r=ke(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Rt();return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}i(f4,"parseMapDef");function m4(e){const t=e.values,r=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),o=Array.from(new Set(r.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:r}}i(m4,"parseNativeEnumDef");function h4(){return{not:Rt()}}i(h4,"parseNeverDef");function g4(){return{type:"null"}}i(g4,"parseNullDef");var Dd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function y4(e,t){const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in Dd&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((o,s)=>{const a=Dd[s._def.typeName];return a&&!o.includes(a)?[...o,a]:o},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((o,s)=>{const a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...o,a];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];case"symbol":case"undefined":case"function":default:return o}},[]);if(r.length===n.length){const o=r.filter((s,a,l)=>l.indexOf(s)===a);return{type:o.length>1?o:o[0],enum:n.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,o)=>[...r,...o._def.values.filter(s=>!r.includes(s))],[])};return v4(e,t)}i(y4,"parseUnionDef");var v4=i((e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,o)=>ke(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${o}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0},"asAnyOf");function _4(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[Dd[e.innerType._def.typeName],"null"]};const n=ke(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}i(_4,"parseNullableDef");function b4(e){const t={type:"number"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"int":t.type="integer";break;case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}i(b4,"parseNumberDef");function w4(e,t){const n={type:"object",properties:{}},r=[],o=e.shape();for(const a in o){let l=o[a];if(l===void 0||l._def===void 0)continue;const u=E4(l),c=ke(l._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});c!==void 0&&(n.properties[a]=c,u||r.push(a))}r.length&&(n.required=r);const s=D4(e,t);return s!==void 0&&(n.additionalProperties=s),n}i(w4,"parseObjectDef");function D4(e,t){if(e.catchall._def.typeName!=="ZodNever")return ke(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}i(D4,"decideAdditionalProperties");function E4(e){try{return e.isOptional()}catch{return!0}}i(E4,"safeIsOptional");var C4=i((e,t)=>{var n;if(t.currentPath.toString()===((n=t.propertyPath)==null?void 0:n.toString()))return ke(e.innerType._def,t);const r=ke(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Rt()},r]}:Rt()},"parseOptionalDef"),$4=i((e,t)=>{if(t.pipeStrategy==="input")return ke(e.in._def,t);if(t.pipeStrategy==="output")return ke(e.out._def,t);const n=ke(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=ke(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(o=>o!==void 0)}},"parsePipelineDef");function x4(e,t){return ke(e.type._def,t)}i(x4,"parsePromiseDef");function S4(e,t){const r={type:"array",uniqueItems:!0,items:ke(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}i(S4,"parseSetDef");function k4(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>ke(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:ke(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>ke(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}i(k4,"parseTupleDef");function I4(){return{not:Rt()}}i(I4,"parseUndefinedDef");function A4(){return Rt()}i(A4,"parseUnknownDef");var T4=i((e,t)=>ke(e.innerType._def,t),"parseReadonlyDef"),F4=i((e,t,n)=>{switch(t){case z.ZodString:return R_(e,n);case z.ZodNumber:return b4(e);case z.ZodObject:return w4(e,n);case z.ZodBigInt:return t4(e);case z.ZodBoolean:return n4();case z.ZodDate:return O_(e,n);case z.ZodUndefined:return I4();case z.ZodNull:return g4();case z.ZodArray:return e4(e,n);case z.ZodUnion:case z.ZodDiscriminatedUnion:return y4(e,n);case z.ZodIntersection:return u4(e,n);case z.ZodTuple:return k4(e,n);case z.ZodRecord:return M_(e,n);case z.ZodLiteral:return c4(e);case z.ZodEnum:return a4(e);case z.ZodNativeEnum:return m4(e);case z.ZodNullable:return _4(e,n);case z.ZodOptional:return C4(e,n);case z.ZodMap:return f4(e,n);case z.ZodSet:return S4(e,n);case z.ZodLazy:return()=>e.getter()._def;case z.ZodPromise:return x4(e,n);case z.ZodNaN:case z.ZodNever:return h4();case z.ZodEffects:return i4(e,n);case z.ZodAny:return Rt();case z.ZodUnknown:return A4();case z.ZodDefault:return s4(e,n);case z.ZodBranded:return F_(e,n);case z.ZodReadonly:return T4(e,n);case z.ZodCatch:return r4(e,n);case z.ZodPipeline:return $4(e,n);case z.ZodFunction:case z.ZodVoid:case z.ZodSymbol:return;default:return(r=>{})()}},"selectParser"),O4=i((e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},"getRelativePath");function ke(e,t,n=!1){var r;const o=t.seen.get(e);if(t.override){const u=(r=t.override)==null?void 0:r.call(t,e,t,o,n);if(u!==XR)return u}if(o&&!n){const u=R4(o,t);if(u!==void 0)return u}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=F4(e,e.typeName,t),l=typeof a=="function"?ke(a(),t):a;if(l&&P4(e,t,l),t.postProcess){const u=t.postProcess(l,e,t);return s.jsonSchema=l,u}return s.jsonSchema=l,l}i(ke,"parseDef");var R4=i((e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:O4(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Rt()):t.$refStrategy==="seen"?Rt():void 0}},"get$ref"),P4=i((e,t,n)=>(e.description&&(n.description=e.description),n),"addMeta"),M4=i(e=>{const t=QR(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,o])=>[o._def,{def:o._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},"getRefs"),N4=i((e,t)=>{var n;const r=M4(t);let o=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((c,[d,p])=>{var h;return{...c,[d]:(h=ke(p._def,{...r,currentPath:[...r.basePath,r.definitionPath,d]},!0))!=null?h:Rt()}},{}):void 0;const s=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,a=(n=ke(e._def,s===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1))!=null?n:Rt(),l=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;l!==void 0&&(a.title=l);const u=s===void 0?o?{...a,[r.definitionPath]:o}:a:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...o,[s]:a}};return u.$schema="http://json-schema.org/draft-07/schema#",u},"zod3ToJsonSchema"),Ed=Symbol.for("vercel.ai.schema");function ne(e){let t;return()=>(t==null&&(t=e()),t)}i(ne,"lazySchema");function cl(e,{validate:t}={}){return{[Ed]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}i(cl,"jsonSchema");function B4(e){return typeof e=="object"&&e!==null&&Ed in e&&e[Ed]===!0&&"jsonSchema"in e&&"validate"in e}i(B4,"isSchema");function Yr(e){return e==null?cl({properties:{},additionalProperties:!1}):B4(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?te(e):j4(e):e()}i(Yr,"asSchema");function j4(e){return cl(()=>_d(e["~standard"].jsonSchema.input({target:"draft-07"})),{validate:i(async t=>{const n=await e["~standard"].validate(t);return"value"in n?{success:!0,value:n.value}:{success:!1,error:new dr({value:t,cause:n.issues})}},"validate")})}i(j4,"standardSchema");function L4(e,t){var n;const r=(n=void 0)!=null?n:!1;return cl(()=>N4(e,{$refStrategy:r?"root":"none"}),{validate:i(async o=>{const s=await e.safeParseAsync(o);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}},"validate")})}i(L4,"zod3Schema");function U4(e,t){var n;const r=(n=void 0)!=null?n:!1;return cl(()=>_d(Q3(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:i(async o=>{const s=await e_(e,o);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}},"validate")})}i(U4,"zod4Schema");function z4(e){return"_zod"in e}i(z4,"isZod4Schema");function te(e,t){return z4(e)?U4(e):L4(e)}i(te,"zodSchema");async function gt({value:e,schema:t,context:n}){const r=await Qt({value:e,schema:t,context:n});if(!r.success)throw dr.wrap({value:e,cause:r.error,context:n});return r.value}i(gt,"validateTypes");async function Qt({value:e,schema:t,context:n}){const r=Yr(t);try{if(r.validate==null)return{success:!0,value:e,rawValue:e};const o=await r.validate(e);return o.success?{success:!0,value:o.value,rawValue:e}:{success:!1,error:dr.wrap({value:e,cause:o.error,context:n}),rawValue:e}}catch(o){return{success:!1,error:dr.wrap({value:e,cause:o,context:n}),rawValue:e}}}i(Qt,"safeValidateTypes");async function q4({text:e,schema:t}){try{const n=vd(e);return t==null?n:gt({value:n,schema:t})}catch(n){throw Fa.isInstance(n)||dr.isInstance(n)?n:new Fa({text:e,cause:n})}}i(q4,"parseJSON");async function en({text:e,schema:t}){try{const n=vd(e);return t==null?{success:!0,value:n,rawValue:n}:await Qt({value:n,schema:t})}catch(n){return{success:!1,error:Fa.isInstance(n)?n:new Fa({text:e,cause:n}),rawValue:void 0}}}i(en,"safeParseJSON");function dl(e){try{return vd(e),!0}catch{return!1}}i(dl,"isParsableJson");function N_({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new md).pipeThrough(new TransformStream({async transform({data:n},r){n!=="[DONE]"&&r.enqueue(await en({text:n,schema:t}))}}))}i(N_,"parseJsonEventStream");async function mt({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;const r=await Qt({value:t[e],schema:n});if(!r.success)throw new Gv({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}i(mt,"parseProviderOptions");var V4=i(()=>globalThis.fetch,"getOriginalFetch2"),Qe=i(async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a})=>B_({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a}),"postJsonToApi"),Cd=i(async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a})=>B_({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a}),"postFormDataToApi"),B_=i(async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:o,abortSignal:s,fetch:a=V4()})=>{try{const l=await a(e,{method:"POST",headers:yr(t,`ai-sdk/provider-utils/${k_}`,yd()),body:n.content,signal:s}),u=Hr(l);if(!l.ok){let c;try{c=await o({response:l,url:e,requestBodyValues:n.values})}catch(d){throw Kr(d)||Ue.isInstance(d)?d:new Ue({message:"Failed to process error response",cause:d,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw c.value}try{return await r({response:l,url:e,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(Kr(c)||Ue.isInstance(c))?c:new Ue({message:"Failed to process successful response",cause:c,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(l){throw S_({error:l,url:e,requestBodyValues:n.values})}},"postToApi");function hB(e){return e}i(hB,"tool");function tn({id:e,inputSchema:t,outputSchema:n,supportsDeferredResults:r}){return({execute:o,needsApproval:s,toModelOutput:a,onInputStart:l,onInputDelta:u,onInputAvailable:c,...d})=>({type:"provider",id:e,args:d,inputSchema:t,outputSchema:n,execute:o,needsApproval:s,toModelOutput:a,onInputStart:l,onInputDelta:u,onInputAvailable:c,supportsDeferredResults:r})}i(tn,"createProviderToolFactoryWithOutputSchema");async function xt(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}i(xt,"resolve");var Pt=i(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:o,requestBodyValues:s})=>{const a=await r.text(),l=Hr(r);if(a.trim()==="")return{responseHeaders:l,value:new Ue({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:l,responseBody:a,isRetryable:n?.(r)})};try{const u=await q4({text:a,schema:e});return{responseHeaders:l,value:new Ue({message:t(u),url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:l,responseBody:a,data:u,isRetryable:n?.(r,u)})}}catch{return{responseHeaders:l,value:new Ue({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:l,responseBody:a,isRetryable:n?.(r)})}}},"createJsonErrorResponseHandler"),Xr=i(e=>async({response:t})=>{const n=Hr(t);if(t.body==null)throw new KF({});return{responseHeaders:n,value:N_({stream:t.body,schema:e})}},"createEventSourceResponseHandler"),ut=i(e=>async({response:t,url:n,requestBodyValues:r})=>{const o=await t.text(),s=await en({text:o,schema:e}),a=Hr(t);if(!s.success)throw new Ue({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:a,responseBody:o,url:n,requestBodyValues:r});return{responseHeaders:a,value:s.value,rawValue:s.rawValue}},"createJsonResponseHandler"),G4=i(()=>async({response:e,url:t,requestBodyValues:n})=>{const r=Hr(e);if(!e.body)throw new Ue({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{const o=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(o)}}catch(o){throw new Ue({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:o})}},"createBinaryResponseHandler");function $d(e){return e?.replace(/\/$/,"")}i($d,"withoutTrailingSlash");function Z4(e){return e!=null&&typeof e[Symbol.asyncIterator]=="function"}i(Z4,"isAsyncIterable");async function*W4({execute:e,input:t,options:n}){const r=e(t,n);if(Z4(r)){let o;for await(const s of r)o=s,yield{type:"preliminary",output:s};yield{type:"final",output:o}}else yield{type:"final",output:await r}}i(W4,"executeTool");var xd,j_;function L_(){if(j_)return xd;j_=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,o=i((d,p)=>{for(var h in p)e(d,h,{get:p[h],enumerable:!0})},"__export"),s=i((d,p,h,g)=>{if(p&&typeof p=="object"||typeof p=="function")for(let f of n(p))!r.call(d,f)&&f!==h&&e(d,f,{get:i(()=>p[f],"get"),enumerable:!(g=t(p,f))||g.enumerable});return d},"__copyProps"),a=i(d=>s(e({},"__esModule",{value:!0}),d),"__toCommonJS"),l={};o(l,{SYMBOL_FOR_REQ_CONTEXT:i(()=>u,"SYMBOL_FOR_REQ_CONTEXT"),getContext:i(()=>c,"getContext")}),xd=a(l);const u=Symbol.for("@vercel/request-context");function c(){return globalThis[u]?.get?.()??{}}return i(c,"getContext"),xd}i(L_,"requireGetContext");var Sd,U_;function z_(){if(U_)return Sd;U_=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,o=i((d,p)=>{for(var h in p)e(d,h,{get:p[h],enumerable:!0})},"__export"),s=i((d,p,h,g)=>{if(p&&typeof p=="object"||typeof p=="function")for(let f of n(p))!r.call(d,f)&&f!==h&&e(d,f,{get:i(()=>p[f],"get"),enumerable:!(g=t(p,f))||g.enumerable});return d},"__copyProps"),a=i(d=>s(e({},"__esModule",{value:!0}),d),"__toCommonJS"),l={};o(l,{VercelOidcTokenError:i(()=>u,"VercelOidcTokenError")}),Sd=a(l);const c=class c extends Error{constructor(p,h){super(p),this.name="VercelOidcTokenError",this.cause=h}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}};i(c,"VercelOidcTokenError");let u=c;return Sd}i(z_,"requireTokenError");var kd,q_;function H4(){if(q_)return kd;q_=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,o=i((h,g)=>{for(var f in g)e(h,f,{get:g[f],enumerable:!0})},"__export"),s=i((h,g,f,y)=>{if(g&&typeof g=="object"||typeof g=="function")for(let v of n(g))!r.call(h,v)&&v!==f&&e(h,v,{get:i(()=>g[v],"get"),enumerable:!(y=t(g,v))||y.enumerable});return h},"__copyProps"),a=i(h=>s(e({},"__esModule",{value:!0}),h),"__toCommonJS"),l={};o(l,{getVercelOidcToken:i(()=>d,"getVercelOidcToken"),getVercelOidcTokenSync:i(()=>p,"getVercelOidcTokenSync")}),kd=a(l);var u=L_(),c=z_();async function d(){let h="",g;try{h=p()}catch(f){g=f}try{const[{getTokenPayload:f,isExpired:y},{refreshToken:v}]=await Promise.all([await import("./token-util-brHA7rXO.mjs").then(function(_){return _.t}),await import("./token-Dg4VnQIc.mjs").then(function(_){return _.t})]);(!h||y(f(h)))&&(await v(),h=p())}catch(f){let y=g instanceof Error?g.message:"";throw f instanceof Error&&(y=`${y}
${f.message}`),y?new c.VercelOidcTokenError(y):f}return h}i(d,"getVercelOidcToken");function p(){const h=(0,u.getContext)().headers?.["x-vercel-oidc-token"]??process.env.VERCEL_OIDC_TOKEN;if(!h)throw new Error("The 'x-vercel-oidc-token' header is missing from the request. Do you have the OIDC option enabled in the Vercel project settings?");return h}return i(p,"getVercelOidcTokenSync"),kd}i(H4,"requireGetVercelOidcToken");var Id,V_;function J4(){if(V_)return Id;V_=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,o=i((d,p)=>{for(var h in p)e(d,h,{get:p[h],enumerable:!0})},"__export"),s=i((d,p,h,g)=>{if(p&&typeof p=="object"||typeof p=="function")for(let f of n(p))!r.call(d,f)&&f!==h&&e(d,f,{get:i(()=>p[f],"get"),enumerable:!(g=t(p,f))||g.enumerable});return d},"__copyProps"),a=i(d=>s(e({},"__esModule",{value:!0}),d),"__toCommonJS"),l={};o(l,{getContext:i(()=>c.getContext,"getContext"),getVercelOidcToken:i(()=>u.getVercelOidcToken,"getVercelOidcToken"),getVercelOidcTokenSync:i(()=>u.getVercelOidcTokenSync,"getVercelOidcTokenSync")}),Id=a(l);var u=H4(),c=L_();return Id}i(J4,"requireDist");var G_=J4(),K4="vercel.ai.gateway.error",Ad=Symbol.for(K4),Z_,W_,yt=(Cr=class extends(W_=Error,Z_=Ad,W_){constructor({message:t,statusCode:n=500,cause:r,generationId:o}){super(o?`${t} [${o}]`:t),this[Z_]=!0,this.statusCode=n,this.cause=r,this.generationId=o}static isInstance(t){return Cr.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&Ad in t&&t[Ad]===!0}},i(Cr,"_GatewayError"),Cr),H_="GatewayAuthenticationError",Y4=`vercel.ai.gateway.error.${H_}`,J_=Symbol.for(Y4),K_,Y_,Td=($r=class extends(Y_=yt,K_=J_,Y_){constructor({message:t="Authentication failed",statusCode:n=401,cause:r,generationId:o}={}){super({message:t,statusCode:n,cause:r,generationId:o}),this[K_]=!0,this.name=H_,this.type="authentication_error"}static isInstance(t){return yt.hasMarker(t)&&J_ in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:r="Authentication failed",statusCode:o=401,cause:s,generationId:a}){let l;return t?l=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?l=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:l=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new $r({message:l,statusCode:o,cause:s,generationId:a})}},i($r,"_GatewayAuthenticationError"),$r),X_="GatewayInvalidRequestError",X4=`vercel.ai.gateway.error.${X_}`,Q_=Symbol.for(X4),eb,tb,Q4=(wo=class extends(tb=yt,eb=Q_,tb){constructor({message:t="Invalid request",statusCode:n=400,cause:r,generationId:o}={}){super({message:t,statusCode:n,cause:r,generationId:o}),this[eb]=!0,this.name=X_,this.type="invalid_request_error"}static isInstance(t){return yt.hasMarker(t)&&Q_ in t}},i(wo,"GatewayInvalidRequestError"),wo),nb="GatewayRateLimitError",e6=`vercel.ai.gateway.error.${nb}`,rb=Symbol.for(e6),ob,sb,t6=(Do=class extends(sb=yt,ob=rb,sb){constructor({message:t="Rate limit exceeded",statusCode:n=429,cause:r,generationId:o}={}){super({message:t,statusCode:n,cause:r,generationId:o}),this[ob]=!0,this.name=nb,this.type="rate_limit_exceeded"}static isInstance(t){return yt.hasMarker(t)&&rb in t}},i(Do,"GatewayRateLimitError"),Do),ib="GatewayModelNotFoundError",n6=`vercel.ai.gateway.error.${ib}`,ab=Symbol.for(n6),r6=ne(()=>te(b({modelId:m()}))),lb,ub,o6=(Eo=class extends(ub=yt,lb=ab,ub){constructor({message:t="Model not found",statusCode:n=404,modelId:r,cause:o,generationId:s}={}){super({message:t,statusCode:n,cause:o,generationId:s}),this[lb]=!0,this.name=ib,this.type="model_not_found",this.modelId=r}static isInstance(t){return yt.hasMarker(t)&&ab in t}},i(Eo,"GatewayModelNotFoundError"),Eo),cb="GatewayInternalServerError",s6=`vercel.ai.gateway.error.${cb}`,db=Symbol.for(s6),pb,fb,mb=(Co=class extends(fb=yt,pb=db,fb){constructor({message:t="Internal server error",statusCode:n=500,cause:r,generationId:o}={}){super({message:t,statusCode:n,cause:r,generationId:o}),this[pb]=!0,this.name=cb,this.type="internal_server_error"}static isInstance(t){return yt.hasMarker(t)&&db in t}},i(Co,"GatewayInternalServerError"),Co),hb="GatewayResponseError",i6=`vercel.ai.gateway.error.${hb}`,gb=Symbol.for(i6),yb,vb,a6=($o=class extends(vb=yt,yb=gb,vb){constructor({message:t="Invalid response from Gateway",statusCode:n=502,response:r,validationError:o,cause:s,generationId:a}={}){super({message:t,statusCode:n,cause:s,generationId:a}),this[yb]=!0,this.name=hb,this.type="response_error",this.response=r,this.validationError=o}static isInstance(t){return yt.hasMarker(t)&&gb in t}},i($o,"GatewayResponseError"),$o);async function _b({response:e,statusCode:t,defaultMessage:n="Gateway request failed",cause:r,authMethod:o}){var s;const a=await Qt({value:e,schema:l6});if(!a.success){const p=typeof e=="object"&&e!==null&&"generationId"in e?e.generationId:void 0;return new a6({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:a.error,cause:r,generationId:p})}const l=a.value,u=l.error.type,c=l.error.message,d=(s=l.generationId)!=null?s:void 0;switch(u){case"authentication_error":return Td.createContextualError({apiKeyProvided:o==="api-key",oidcTokenProvided:o==="oidc",statusCode:t,cause:r,generationId:d});case"invalid_request_error":return new Q4({message:c,statusCode:t,cause:r,generationId:d});case"rate_limit_exceeded":return new t6({message:c,statusCode:t,cause:r,generationId:d});case"model_not_found":{const p=await Qt({value:l.error.param,schema:r6});return new o6({message:c,statusCode:t,modelId:p.success?p.value.modelId:void 0,cause:r,generationId:d})}case"internal_server_error":return new mb({message:c,statusCode:t,cause:r,generationId:d});default:return new mb({message:c,statusCode:t,cause:r,generationId:d})}}i(_b,"createGatewayErrorFromResponse");var l6=ne(()=>te(b({error:b({message:m(),type:m().nullish(),param:$t().nullish(),code:se([m(),A()]).nullish()}),generationId:m().nullish()}))),bb="GatewayTimeoutError",u6=`vercel.ai.gateway.error.${bb}`,wb=Symbol.for(u6),Db,Eb,Cb=(xr=class extends(Eb=yt,Db=wb,Eb){constructor({message:t="Request timed out",statusCode:n=408,cause:r,generationId:o}={}){super({message:t,statusCode:n,cause:r,generationId:o}),this[Db]=!0,this.name=bb,this.type="timeout_error"}static isInstance(t){return yt.hasMarker(t)&&wb in t}static createTimeoutError({originalMessage:t,statusCode:n=408,cause:r,generationId:o}){const s=`Gateway request timed out: ${t}

    This is a client-side timeout. To resolve this, increase your timeout configuration: https://vercel.com/docs/ai-gateway/capabilities/video-generation#extending-timeouts-for-node.js`;return new xr({message:s,statusCode:n,cause:r,generationId:o})}},i(xr,"_GatewayTimeoutError"),xr);function $b(e){if(!(e instanceof Error))return!1;const t=e.code;return typeof t=="string"?["UND_ERR_HEADERS_TIMEOUT","UND_ERR_BODY_TIMEOUT","UND_ERR_CONNECT_TIMEOUT"].includes(t):!1}i($b,"isTimeoutError");async function xn(e,t){var n;return yt.isInstance(e)?e:$b(e)?Cb.createTimeoutError({originalMessage:e instanceof Error?e.message:"Unknown error",cause:e}):Ue.isInstance(e)?e.cause&&$b(e.cause)?Cb.createTimeoutError({originalMessage:e.message,cause:e}):await _b({response:c6(e),statusCode:(n=e.statusCode)!=null?n:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):await _b({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}i(xn,"asGatewayError");function c6(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}i(c6,"extractApiCallResponse");var xb="ai-gateway-auth-method";async function _r(e){const t=await Qt({value:e[xb],schema:d6});return t.success?t.value:void 0}i(_r,"parseAuthMethod");var d6=ne(()=>te(se([k("api-key"),k("oidc")]))),Sb=(xo=class{constructor(t){this.config=t}async getAvailableModels(){try{const{value:t}=await I_({url:`${this.config.baseURL}/config`,headers:await xt(this.config.headers()),successfulResponseHandler:ut(p6),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(n=>n,"errorToMessage")}),fetch:this.config.fetch});return t}catch(t){throw await xn(t)}}async getCredits(){try{const t=new URL(this.config.baseURL),{value:n}=await I_({url:`${t.origin}/v1/credits`,headers:await xt(this.config.headers()),successfulResponseHandler:ut(f6),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(r=>r,"errorToMessage")}),fetch:this.config.fetch});return n}catch(t){throw await xn(t)}}},i(xo,"GatewayFetchMetadata"),xo),p6=ne(()=>te(b({models:M(b({id:m(),name:m(),description:m().nullish(),pricing:b({input:m(),output:m(),input_cache_read:m().nullish(),input_cache_write:m().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:r})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:b({specificationVersion:k("v3"),provider:m(),modelId:m()}),modelType:fe(["embedding","image","language","video"]).nullish()}))}))),f6=ne(()=>te(b({balance:m(),total_used:m()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),m6=(So=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(t){const{abortSignal:n,...r}=t;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(t){const{args:n,warnings:r}=await this.getArgs(t),{abortSignal:o}=t,s=await xt(this.config.headers());try{const{responseHeaders:a,value:l,rawValue:u}=await Qe({url:this.getUrl(),headers:Ve(s,t.headers,this.getModelConfigHeaders(this.modelId,!1),await xt(this.config.o11yHeaders)),body:n,successfulResponseHandler:ut(ft()),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(c=>c,"errorToMessage")}),...o&&{abortSignal:o},fetch:this.config.fetch});return{...l,request:{body:n},response:{headers:a,body:u},warnings:r}}catch(a){throw await xn(a,await _r(s))}}async doStream(t){const{args:n,warnings:r}=await this.getArgs(t),{abortSignal:o}=t,s=await xt(this.config.headers());try{const{value:a,responseHeaders:l}=await Qe({url:this.getUrl(),headers:Ve(s,t.headers,this.getModelConfigHeaders(this.modelId,!0),await xt(this.config.o11yHeaders)),body:n,successfulResponseHandler:Xr(ft()),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(u=>u,"errorToMessage")}),...o&&{abortSignal:o},fetch:this.config.fetch});return{stream:a.pipeThrough(new TransformStream({start(u){r.length>0&&u.enqueue({type:"stream-start",warnings:r})},transform(u,c){if(u.success){const d=u.value;if(d.type==="raw"&&!t.includeRawChunks)return;d.type==="response-metadata"&&d.timestamp&&typeof d.timestamp=="string"&&(d.timestamp=new Date(d.timestamp)),c.enqueue(d)}else c.error(u.error)}})),request:{body:n},response:{headers:l}}}catch(a){throw await xn(a,await _r(s))}}isFilePart(t){return t&&typeof t=="object"&&"type"in t&&t.type==="file"}maybeEncodeFileParts(t){for(const n of t.prompt)for(const r of n.content)if(this.isFilePart(r)){const o=r;if(o.data instanceof Uint8Array){const s=Uint8Array.from(o.data),a=Buffer.from(s).toString("base64");o.data=new URL(`data:${o.mediaType||"application/octet-stream"};base64,${a}`)}}return t}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(t,n){return{"ai-language-model-specification-version":"3","ai-language-model-id":t,"ai-language-model-streaming":String(n)}}},i(So,"GatewayLanguageModel"),So),h6=(ko=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:t,headers:n,abortSignal:r,providerOptions:o}){var s;const a=await xt(this.config.headers());try{const{responseHeaders:l,value:u,rawValue:c}=await Qe({url:this.getUrl(),headers:Ve(a,n??{},this.getModelConfigHeaders(),await xt(this.config.o11yHeaders)),body:{values:t,...o?{providerOptions:o}:{}},successfulResponseHandler:ut(g6),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(d=>d,"errorToMessage")}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:u.embeddings,usage:(s=u.usage)!=null?s:void 0,providerMetadata:u.providerMetadata,response:{headers:l,body:c},warnings:[]}}catch(l){throw await xn(l,await _r(a))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"3","ai-model-id":this.modelId}}},i(ko,"GatewayEmbeddingModel"),ko),g6=ne(()=>te(b({embeddings:M(M(A())),usage:b({tokens:A()}).nullish(),providerMetadata:Ae(m(),Ae(m(),$t())).optional()}))),y6=(Io=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:t,n,size:r,aspectRatio:o,seed:s,files:a,mask:l,providerOptions:u,headers:c,abortSignal:d}){var p,h,g,f;const y=await xt(this.config.headers());try{const{responseHeaders:v,value:_,rawValue:w}=await Qe({url:this.getUrl(),headers:Ve(y,c??{},this.getModelConfigHeaders(),await xt(this.config.o11yHeaders)),body:{prompt:t,n,...r&&{size:r},...o&&{aspectRatio:o},...s&&{seed:s},...u&&{providerOptions:u},...a&&{files:a.map(D=>kb(D))},...l&&{mask:kb(l)}},successfulResponseHandler:ut(w6),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(D=>D,"errorToMessage")}),...d&&{abortSignal:d},fetch:this.config.fetch});return{images:_.images,warnings:(p=_.warnings)!=null?p:[],providerMetadata:_.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:v},..._.usage!=null&&{usage:{inputTokens:(h=_.usage.inputTokens)!=null?h:void 0,outputTokens:(g=_.usage.outputTokens)!=null?g:void 0,totalTokens:(f=_.usage.totalTokens)!=null?f:void 0}}}}catch(v){throw await xn(v,await _r(y))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"3","ai-model-id":this.modelId}}},i(Io,"GatewayImageModel"),Io);function kb(e){return e.type==="file"&&e.data instanceof Uint8Array?{...e,data:Jr(e.data)}:e}i(kb,"maybeEncodeImageFile");var v6=b({images:M($t()).optional()}).catchall($t()),_6=Ce("type",[b({type:k("unsupported"),feature:m(),details:m().optional()}),b({type:k("compatibility"),feature:m(),details:m().optional()}),b({type:k("other"),message:m()})]),b6=b({inputTokens:A().nullish(),outputTokens:A().nullish(),totalTokens:A().nullish()}),w6=b({images:M(m()),warnings:M(_6).optional(),providerMetadata:Ae(m(),v6).optional(),usage:b6.optional()}),D6=(Ao=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3",this.maxVideosPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:t,n,aspectRatio:r,resolution:o,duration:s,fps:a,seed:l,image:u,providerOptions:c,headers:d,abortSignal:p}){var h;const g=await xt(this.config.headers());try{const{responseHeaders:f,value:y}=await Qe({url:this.getUrl(),headers:Ve(g,d??{},this.getModelConfigHeaders(),await xt(this.config.o11yHeaders),{accept:"text/event-stream"}),body:{prompt:t,n,...r&&{aspectRatio:r},...o&&{resolution:o},...s&&{duration:s},...a&&{fps:a},...l&&{seed:l},...c&&{providerOptions:c},...u&&{image:E6(u)}},successfulResponseHandler:i(async({response:v,url:_,requestBodyValues:w})=>{if(v.body==null)throw new Ue({message:"SSE response body is empty",url:_,requestBodyValues:w,statusCode:v.status});const E=N_({stream:v.body,schema:S6}).getReader(),{done:I,value:T}=await E.read();if(E.releaseLock(),I||!T)throw new Ue({message:"SSE stream ended without a data event",url:_,requestBodyValues:w,statusCode:v.status});if(!T.success)throw new Ue({message:"Failed to parse video SSE event",cause:T.error,url:_,requestBodyValues:w,statusCode:v.status});const $=T.value;if($.type==="error")throw new Ue({message:$.message,statusCode:$.statusCode,url:_,requestBodyValues:w,responseHeaders:Object.fromEntries([...v.headers]),responseBody:JSON.stringify($),data:{error:{message:$.message,type:$.errorType,param:$.param}}});return{value:{videos:$.videos,warnings:$.warnings,providerMetadata:$.providerMetadata},responseHeaders:Object.fromEntries([...v.headers])}},"successfulResponseHandler"),failedResponseHandler:Pt({errorSchema:ft(),errorToMessage:i(v=>v,"errorToMessage")}),...p&&{abortSignal:p},fetch:this.config.fetch});return{videos:y.videos,warnings:(h=y.warnings)!=null?h:[],providerMetadata:y.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:f}}}catch(f){throw await xn(f,await _r(g))}}getUrl(){return`${this.config.baseURL}/video-model`}getModelConfigHeaders(){return{"ai-video-model-specification-version":"3","ai-model-id":this.modelId}}},i(Ao,"GatewayVideoModel"),Ao);function E6(e){return e.type==="file"&&e.data instanceof Uint8Array?{...e,data:Jr(e.data)}:e}i(E6,"maybeEncodeVideoFile");var C6=b({videos:M($t()).optional()}).catchall($t()),$6=se([b({type:k("url"),url:m(),mediaType:m()}),b({type:k("base64"),data:m(),mediaType:m()})]),x6=Ce("type",[b({type:k("unsupported"),feature:m(),details:m().optional()}),b({type:k("compatibility"),feature:m(),details:m().optional()}),b({type:k("other"),message:m()})]),S6=Ce("type",[b({type:k("result"),videos:M($6),warnings:M(x6).optional(),providerMetadata:Ae(m(),C6).optional()}),b({type:k("error"),message:m(),errorType:m(),statusCode:A(),param:$t().nullable()})]),k6=ne(()=>te(Kt({objective:Fe().describe("Natural-language description of the web research goal, including source or freshness guidance and broader context from the task. Maximum 5000 characters."),search_queries:Un(Fe()).optional().describe("Optional search queries to supplement the objective. Maximum 200 characters per query."),mode:ll(["one-shot","agentic"]).optional().describe('Mode preset: "one-shot" for comprehensive results with longer excerpts (default), "agentic" for concise, token-efficient results for multi-step workflows.'),max_results:_n().optional().describe("Maximum number of results to return (1-20). Defaults to 10 if not specified."),source_policy:Kt({include_domains:Un(Fe()).optional().describe("List of domains to include in search results."),exclude_domains:Un(Fe()).optional().describe("List of domains to exclude from search results."),after_date:Fe().optional().describe("Only include results published after this date (ISO 8601 format).")}).optional().describe("Source policy for controlling which domains to include/exclude and freshness."),excerpts:Kt({max_chars_per_result:_n().optional().describe("Maximum characters per result."),max_chars_total:_n().optional().describe("Maximum total characters across all results.")}).optional().describe("Excerpt configuration for controlling result length."),fetch_policy:Kt({max_age_seconds:_n().optional().describe("Maximum age in seconds for cached content. Set to 0 to always fetch fresh content.")}).optional().describe("Fetch policy for controlling content freshness.")}))),I6=ne(()=>te(pd([Kt({searchId:Fe(),results:Un(Kt({url:Fe(),title:Fe(),excerpt:Fe(),publishDate:Fe().nullable().optional(),relevanceScore:_n().optional()}))}),Kt({error:ll(["api_error","rate_limit","timeout","invalid_input","configuration_error","unknown"]),statusCode:_n().optional(),message:Fe()})]))),A6=tn({id:"gateway.parallel_search",inputSchema:k6,outputSchema:I6}),T6=i((e={})=>A6(e),"parallelSearch"),F6=ne(()=>te(Kt({query:pd([Fe(),Un(Fe())]).describe("Search query (string) or multiple queries (array of up to 5 strings). Multi-query searches return combined results from all queries."),max_results:_n().optional().describe("Maximum number of search results to return (1-20, default: 10)"),max_tokens_per_page:_n().optional().describe("Maximum number of tokens to extract per search result page (256-2048, default: 2048)"),max_tokens:_n().optional().describe("Maximum total tokens across all search results (default: 25000, max: 1000000)"),country:Fe().optional().describe("Two-letter ISO 3166-1 alpha-2 country code for regional search results (e.g., 'US', 'GB', 'FR')"),search_domain_filter:Un(Fe()).optional().describe("List of domains to include or exclude from search results (max 20). To include: ['nature.com', 'science.org']. To exclude: ['-example.com', '-spam.net']"),search_language_filter:Un(Fe()).optional().describe("List of ISO 639-1 language codes to filter results (max 10, lowercase). Examples: ['en', 'fr', 'de']"),search_after_date:Fe().optional().describe("Include only results published after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),search_before_date:Fe().optional().describe("Include only results published before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),last_updated_after_filter:Fe().optional().describe("Include only results last updated after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),last_updated_before_filter:Fe().optional().describe("Include only results last updated before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),search_recency_filter:ll(["day","week","month","year"]).optional().describe("Filter results by relative time period. Cannot be used with search_after_date or search_before_date.")}))),O6=ne(()=>te(pd([Kt({results:Un(Kt({title:Fe(),url:Fe(),snippet:Fe(),date:Fe().optional(),lastUpdated:Fe().optional()})),id:Fe()}),Kt({error:ll(["api_error","rate_limit","timeout","invalid_input","unknown"]),statusCode:_n().optional(),message:Fe()})]))),R6=tn({id:"gateway.perplexity_search",inputSchema:F6,outputSchema:O6}),P6=i((e={})=>R6(e),"perplexitySearch"),M6={parallelSearch:T6,perplexitySearch:P6};async function N6(){var e;return(e=G_.getContext().headers)==null?void 0:e["x-vercel-id"]}i(N6,"getVercelRequestId");var B6="3.0.53",j6="0.0.1";function L6(e={}){var t,n;let r=null,o=null;const s=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let a=0;const l=(n=$d(e.baseURL))!=null?n:"https://ai-gateway.vercel.sh/v3/ai",u=i(async()=>{try{const y=await z6(e);return yr({Authorization:`Bearer ${y.token}`,"ai-gateway-protocol-version":j6,[xb]:y.authMethod,...e.headers},`ai-sdk/gateway/${B6}`)}catch(y){throw Td.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401,cause:y})}},"getHeaders"),c=i(()=>{const y=ai({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),v=ai({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),_=ai({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const w=await N6();return{...y&&{"ai-o11y-deployment-id":y},...v&&{"ai-o11y-environment":v},..._&&{"ai-o11y-region":_},...w&&{"ai-o11y-request-id":w}}}},"createO11yHeaders"),d=i(y=>new m6(y,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:c()}),"createLanguageModel"),p=i(async()=>{var y,v,_;const w=(_=(v=(y=e._internal)==null?void 0:y.currentDate)==null?void 0:v.call(y).getTime())!=null?_:Date.now();return(!r||w-a>s)&&(a=w,r=new Sb({baseURL:l,headers:u,fetch:e.fetch}).getAvailableModels().then(D=>(o=D,D)).catch(async D=>{throw await xn(D,await _r(await u()))})),o?Promise.resolve(o):r},"getAvailableModels"),h=i(async()=>new Sb({baseURL:l,headers:u,fetch:e.fetch}).getCredits().catch(async y=>{throw await xn(y,await _r(await u()))}),"getCredits"),g=i(function(y){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return d(y)},"provider");g.specificationVersion="v3",g.getAvailableModels=p,g.getCredits=h,g.imageModel=y=>new y6(y,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:c()}),g.languageModel=d;const f=i(y=>new h6(y,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:c()}),"createEmbeddingModel");return g.embeddingModel=f,g.textEmbeddingModel=f,g.videoModel=y=>new D6(y,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:c()}),g.chat=g.languageModel,g.embedding=g.embeddingModel,g.image=g.imageModel,g.video=g.videoModel,g.tools=M6,g}i(L6,"createGatewayProvider");var U6=L6();async function z6(e){const t=ai({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});return t?{token:t,authMethod:"api-key"}:{token:await G_.getVercelOidcToken(),authMethod:"oidc"}}i(z6,"getGatewayAuthToken");var q6=typeof globalThis=="object"?globalThis:global,br="1.9.0",Ib=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function V6(e){var t=new Set([e]),n=new Set,r=e.match(Ib);if(!r)return function(){return!1};var o={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(o.prerelease!=null)return i(function(u){return u===e},"isExactmatch");function s(l){return n.add(l),!1}i(s,"_reject");function a(l){return t.add(l),!0}return i(a,"_accept"),i(function(u){if(t.has(u))return!0;if(n.has(u))return!1;var c=u.match(Ib);if(!c)return s(u);var d={major:+c[1],minor:+c[2],patch:+c[3],prerelease:c[4]};return d.prerelease!=null||o.major!==d.major?s(u):o.major===0?o.minor===d.minor&&o.patch<=d.patch?a(u):s(u):o.minor<=d.minor?a(u):s(u)},"isCompatible2")}i(V6,"_makeCompatibilityCheck");var G6=V6(br),Z6=br.split(".")[0],li=Symbol.for("opentelemetry.js.api."+Z6),ui=q6;function Fd(e,t,n,r){var o;r===void 0&&(r=!1);var s=ui[li]=(o=ui[li])!==null&&o!==void 0?o:{version:br};if(!r&&s[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(s.version!==br){var a=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+br);return n.error(a.stack||a.message),!1}return s[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+br+"."),!0}i(Fd,"registerGlobal");function ci(e){var t,n,r=(t=ui[li])===null||t===void 0?void 0:t.version;if(!(!r||!G6(r)))return(n=ui[li])===null||n===void 0?void 0:n[e]}i(ci,"getGlobal");function Od(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+br+".");var n=ui[li];n&&delete n[e]}i(Od,"unregisterGlobal");var W6=i(function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,s=[],a;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s},"__read$3"),H6=i(function(e,t,n){if(arguments.length===2)for(var r=0,o=t.length,s;r<o;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},"__spreadArray$3"),J6=(function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return i(e,"DiagComponentLogger2"),e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return di("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return di("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return di("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return di("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return di("verbose",this._namespace,t)},e})();function di(e,t,n){var r=ci("diag");if(r)return n.unshift(t),r[e].apply(r,H6([],W6(n),!1))}i(di,"logProxy");var Mt;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Mt||(Mt={}));function K6(e,t){e<Mt.NONE?e=Mt.NONE:e>Mt.ALL&&(e=Mt.ALL),t=t||{};function n(r,o){var s=t[r];return typeof s=="function"&&e>=o?s.bind(t):function(){}}return i(n,"_filterFunc"),{error:n("error",Mt.ERROR),warn:n("warn",Mt.WARN),info:n("info",Mt.INFO),debug:n("debug",Mt.DEBUG),verbose:n("verbose",Mt.VERBOSE)}}i(K6,"createLogLevelDiagLogger");var Y6=i(function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,s=[],a;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s},"__read$2"),X6=i(function(e,t,n){if(arguments.length===2)for(var r=0,o=t.length,s;r<o;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},"__spreadArray$2"),Q6="diag",pl=(function(){function e(){function t(o){return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var l=ci("diag");if(l)return l[o].apply(l,X6([],Y6(s),!1))}}i(t,"_logProxy");var n=this,r=i(function(o,s){var a,l,u;if(s===void 0&&(s={logLevel:Mt.INFO}),o===n){var c=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((a=c.stack)!==null&&a!==void 0?a:c.message),!1}typeof s=="number"&&(s={logLevel:s});var d=ci("diag"),p=K6((l=s.logLevel)!==null&&l!==void 0?l:Mt.INFO,o);if(d&&!s.suppressOverrideMessage){var h=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+h),p.warn("Current logger will overwrite one already registered from "+h)}return Fd("diag",p,n,!0)},"setLogger");n.setLogger=r,n.disable=function(){Od(Q6,n)},n.createComponentLogger=function(o){return new J6(o)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return i(e,"DiagAPI2"),e.instance=function(){return this._instance||(this._instance=new e),this._instance},e})();function e7(e){return Symbol.for(e)}i(e7,"createContextKey");var t7=(function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,o){var s=new e(n._currentContext);return s._currentContext.set(r,o),s},n.deleteValue=function(r){var o=new e(n._currentContext);return o._currentContext.delete(r),o}}return i(e,"BaseContext2"),e})(),n7=new t7,r7=i(function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,s=[],a;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s},"__read$1"),o7=i(function(e,t,n){if(arguments.length===2)for(var r=0,o=t.length,s;r<o;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},"__spreadArray$1"),s7=(function(){function e(){}return i(e,"NoopContextManager2"),e.prototype.active=function(){return n7},e.prototype.with=function(t,n,r){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return n.call.apply(n,o7([r],r7(o),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e})(),i7=i(function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,s=[],a;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s},"__read"),a7=i(function(e,t,n){if(arguments.length===2)for(var r=0,o=t.length,s;r<o;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},"__spreadArray"),Rd="context",l7=new s7,Pd=(function(){function e(){}return i(e,"ContextAPI2"),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Fd(Rd,t,pl.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var o,s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return(o=this._getContextManager()).with.apply(o,a7([t,n,r],i7(s),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return ci(Rd)||l7},e.prototype.disable=function(){this._getContextManager().disable(),Od(Rd,pl.instance())},e})(),Md;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Md||(Md={}));var Ab="0000000000000000",Tb="00000000000000000000000000000000",u7={traceId:Tb,spanId:Ab,traceFlags:Md.NONE},pi=(function(){function e(t){t===void 0&&(t=u7),this._spanContext=t}return i(e,"NonRecordingSpan2"),e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e})(),Nd=e7("OpenTelemetry Context Key SPAN");function Bd(e){return e.getValue(Nd)||void 0}i(Bd,"getSpan");function c7(){return Bd(Pd.getInstance().active())}i(c7,"getActiveSpan");function jd(e,t){return e.setValue(Nd,t)}i(jd,"setSpan");function d7(e){return e.deleteValue(Nd)}i(d7,"deleteSpan");function p7(e,t){return jd(e,new pi(t))}i(p7,"setSpanContext");function Fb(e){var t;return(t=Bd(e))===null||t===void 0?void 0:t.spanContext()}i(Fb,"getSpanContext");var f7=/^([0-9a-f]{32})$/i,m7=/^[0-9a-f]{16}$/i;function h7(e){return f7.test(e)&&e!==Tb}i(h7,"isValidTraceId");function g7(e){return m7.test(e)&&e!==Ab}i(g7,"isValidSpanId");function Ob(e){return h7(e.traceId)&&g7(e.spanId)}i(Ob,"isSpanContextValid");function y7(e){return new pi(e)}i(y7,"wrapSpanContext");var Ld=Pd.getInstance(),Rb=(function(){function e(){}return i(e,"NoopTracer2"),e.prototype.startSpan=function(t,n,r){r===void 0&&(r=Ld.active());var o=!!n?.root;if(o)return new pi;var s=r&&Fb(r);return v7(s)&&Ob(s)?new pi(s):new pi},e.prototype.startActiveSpan=function(t,n,r,o){var s,a,l;if(!(arguments.length<2)){arguments.length===2?l=n:arguments.length===3?(s=n,l=r):(s=n,a=r,l=o);var u=a??Ld.active(),c=this.startSpan(t,s,u),d=jd(u,c);return Ld.with(d,l,void 0,c)}},e})();function v7(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}i(v7,"isSpanContext");var _7=new Rb,b7=(function(){function e(t,n,r,o){this._provider=t,this.name=n,this.version=r,this.options=o}return i(e,"ProxyTracer2"),e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,o){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):_7},e})(),w7=(function(){function e(){}return i(e,"NoopTracerProvider2"),e.prototype.getTracer=function(t,n,r){return new Rb},e})(),D7=new w7,Pb=(function(){function e(){}return i(e,"ProxyTracerProvider2"),e.prototype.getTracer=function(t,n,r){var o;return(o=this.getDelegateTracer(t,n,r))!==null&&o!==void 0?o:new b7(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:D7},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var o;return(o=this._delegate)===null||o===void 0?void 0:o.getTracer(t,n,r)},e})(),fl;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(fl||(fl={}));var Mb=Pd.getInstance(),Ud="trace",E7=(function(){function e(){this._proxyTracerProvider=new Pb,this.wrapSpanContext=y7,this.isSpanContextValid=Ob,this.deleteSpan=d7,this.getSpan=Bd,this.getActiveSpan=c7,this.getSpanContext=Fb,this.setSpan=jd,this.setSpanContext=p7}return i(e,"TraceAPI2"),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=Fd(Ud,this._proxyTracerProvider,pl.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return ci(Ud)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){Od(Ud,pl.instance()),this._proxyTracerProvider=new Pb},e})(),C7=E7.getInstance(),$7=Object.defineProperty,x7=i((e,t)=>{for(var n in t)$7(e,n,{get:t[n],enumerable:!0})},"__export"),Nb="AI_InvalidArgumentError",Bb=`vercel.ai.error.${Nb}`,S7=Symbol.for(Bb),jb,Sn=(To=class extends oe{constructor({parameter:t,value:n,message:r}){super({name:Nb,message:`Invalid argument for parameter ${t}: ${r}`}),this[jb]=!0,this.parameter=t,this.value=n}static isInstance(t){return oe.hasMarker(t,Bb)}},i(To,"InvalidArgumentError"),To);jb=S7;var Lb="AI_InvalidToolApprovalError",Ub=`vercel.ai.error.${Lb}`,k7=Symbol.for(Ub),zb,I7=(Fo=class extends oe{constructor({approvalId:t}){super({name:Lb,message:`Tool approval response references unknown approvalId: "${t}". No matching tool-approval-request found in message history.`}),this[zb]=!0,this.approvalId=t}static isInstance(t){return oe.hasMarker(t,Ub)}},i(Fo,"InvalidToolApprovalError"),Fo);zb=k7;var qb="AI_InvalidToolInputError",Vb=`vercel.ai.error.${qb}`,A7=Symbol.for(Vb),Gb,zd=(Oo=class extends oe{constructor({toolInput:t,toolName:n,cause:r,message:o=`Invalid input for tool ${n}: ${Gs(r)}`}){super({name:qb,message:o,cause:r}),this[Gb]=!0,this.toolInput=t,this.toolName=n}static isInstance(t){return oe.hasMarker(t,Vb)}},i(Oo,"InvalidToolInputError"),Oo);Gb=A7;var Zb="AI_ToolCallNotFoundForApprovalError",Wb=`vercel.ai.error.${Zb}`,T7=Symbol.for(Wb),Hb,Jb=(Ro=class extends oe{constructor({toolCallId:t,approvalId:n}){super({name:Zb,message:`Tool call "${t}" not found for approval request "${n}".`}),this[Hb]=!0,this.toolCallId=t,this.approvalId=n}static isInstance(t){return oe.hasMarker(t,Wb)}},i(Ro,"ToolCallNotFoundForApprovalError"),Ro);Hb=T7;var Kb="AI_MissingToolResultsError",Yb=`vercel.ai.error.${Kb}`,F7=Symbol.for(Yb),Xb,Qb=(Po=class extends oe{constructor({toolCallIds:t}){super({name:Kb,message:`Tool result${t.length>1?"s are":" is"} missing for tool call${t.length>1?"s":""} ${t.join(", ")}.`}),this[Xb]=!0,this.toolCallIds=t}static isInstance(t){return oe.hasMarker(t,Yb)}},i(Po,"MissingToolResultsError"),Po);Xb=F7;var ew="AI_NoObjectGeneratedError",tw=`vercel.ai.error.${ew}`,O7=Symbol.for(tw),nw,qn=(Mo=class extends oe{constructor({message:t="No object generated.",cause:n,text:r,response:o,usage:s,finishReason:a}){super({name:ew,message:t,cause:n}),this[nw]=!0,this.text=r,this.response=o,this.usage=s,this.finishReason=a}static isInstance(t){return oe.hasMarker(t,tw)}},i(Mo,"NoObjectGeneratedError"),Mo);nw=O7;var rw="AI_NoOutputGeneratedError",ow=`vercel.ai.error.${rw}`,R7=Symbol.for(ow),sw,P7=(No=class extends oe{constructor({message:t="No output generated.",cause:n}={}){super({name:rw,message:t,cause:n}),this[sw]=!0}static isInstance(t){return oe.hasMarker(t,ow)}},i(No,"NoOutputGeneratedError"),No);sw=R7;var iw="AI_NoSuchToolError",aw=`vercel.ai.error.${iw}`,M7=Symbol.for(aw),lw,qd=(Bo=class extends oe{constructor({toolName:t,availableTools:n=void 0,message:r=`Model tried to call unavailable tool '${t}'. ${n===void 0?"No tools are available.":`Available tools: ${n.join(", ")}.`}`}){super({name:iw,message:r}),this[lw]=!0,this.toolName=t,this.availableTools=n}static isInstance(t){return oe.hasMarker(t,aw)}},i(Bo,"NoSuchToolError"),Bo);lw=M7;var uw="AI_ToolCallRepairError",cw=`vercel.ai.error.${uw}`,N7=Symbol.for(cw),dw,B7=(jo=class extends oe{constructor({cause:t,originalError:n,message:r=`Error repairing tool call: ${Gs(t)}`}){super({name:uw,message:r,cause:t}),this[dw]=!0,this.originalError=n}static isInstance(t){return oe.hasMarker(t,cw)}},i(jo,"ToolCallRepairError"),jo);dw=N7;var j7=(Lo=class extends oe{constructor(t){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${t.version} for provider "${t.provider}" and model "${t.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=t.version,this.provider=t.provider,this.modelId=t.modelId}},i(Lo,"UnsupportedModelVersionError"),Lo),pw="AI_InvalidMessageRoleError",fw=`vercel.ai.error.${pw}`,L7=Symbol.for(fw),mw,U7=(Uo=class extends oe{constructor({role:t,message:n=`Invalid message role: '${t}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:pw,message:n}),this[mw]=!0,this.role=t}static isInstance(t){return oe.hasMarker(t,fw)}},i(Uo,"InvalidMessageRoleError"),Uo);mw=L7;var hw="AI_RetryError",gw=`vercel.ai.error.${hw}`,z7=Symbol.for(gw),yw,vw=(zo=class extends oe{constructor({message:t,reason:n,errors:r}){super({name:hw,message:t}),this[yw]=!0,this.reason=n,this.errors=r,this.lastError=r[r.length-1]}static isInstance(t){return oe.hasMarker(t,gw)}},i(zo,"RetryError"),zo);yw=z7;function q7({warning:e,provider:t,model:n}){const r=`AI SDK Warning (${t} / ${n}):`;switch(e.type){case"unsupported":{let o=`${r} The feature "${e.feature}" is not supported.`;return e.details&&(o+=` ${e.details}`),o}case"compatibility":{let o=`${r} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(o+=` ${e.details}`),o}case"other":return`${r} ${e.message}`;default:return`${r} ${JSON.stringify(e,null,2)}`}}i(q7,"formatWarning");var V7="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",_w=!1,bw=i(e=>{if(e.warnings.length===0)return;const t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t=="function"){t(e);return}_w||(_w=!0,console.info(V7));for(const n of e.warnings)console.warn(q7({warning:n,provider:e.provider,model:e.model}))}},"logWarnings");function G7({provider:e,modelId:t}){bw({warnings:[{type:"compatibility",feature:"specificationVersion",details:"Using v2 specification compatibility mode. Some features may not be available."}],provider:e,model:t})}i(G7,"logV2CompatibilityWarning");function Z7(e){return e.specificationVersion==="v3"?e:(G7({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(t,n){switch(n){case"specificationVersion":return"v3";case"doGenerate":return async(...r)=>{const o=await t.doGenerate(...r);return{...o,finishReason:ww(o.finishReason),usage:Dw(o.usage)}};case"doStream":return async(...r)=>{const o=await t.doStream(...r);return{...o,stream:W7(o.stream)}};default:return t[n]}}}))}i(Z7,"asLanguageModelV3");function W7(e){return e.pipeThrough(new TransformStream({transform(t,n){switch(t.type){case"finish":n.enqueue({...t,finishReason:ww(t.finishReason),usage:Dw(t.usage)});break;default:n.enqueue(t);break}}}))}i(W7,"convertV2StreamToV3");function ww(e){return{unified:e==="unknown"?"other":e,raw:void 0}}i(ww,"convertV2FinishReasonToV3");function Dw(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}i(Dw,"convertV2UsageToV3");function Ew(e){if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const t=e;throw new j7({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Z7(e)}return H7().languageModel(e)}i(Ew,"resolveLanguageModel");function H7(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?e:U6}i(H7,"getGlobalProvider");function Cw(e){if(e!=null)return typeof e=="number"?e:e.totalMs}i(Cw,"getTotalTimeoutMs");function J7(e){if(!(e==null||typeof e=="number"))return e.stepMs}i(J7,"getStepTimeoutMs");var K7=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],Y7=i(e=>{const t=typeof e=="string"?gr(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)},"stripID3");function X7(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Y7(e):e}i(X7,"stripID3TagsIfPresent");function Q7({data:e,signatures:t}){const n=X7(e),r=typeof n=="string"?gr(n.substring(0,Math.min(n.length,24))):n;for(const o of t)if(r.length>=o.bytesPrefix.length&&o.bytesPrefix.every((s,a)=>s===null||r[a]===s))return o.mediaType}i(Q7,"detectMediaType");var $w="6.0.97",eP=i(async({url:e,maxBytes:t,abortSignal:n})=>{var r;const o=e.toString();try{const s=await fetch(o,{headers:yr({},`ai-sdk/${$w}`,yd()),signal:n});if(!s.ok)throw new zn({url:o,statusCode:s.status,statusText:s.statusText});return{data:await $_({response:s,url:o,maxBytes:t??hd}),mediaType:(r=s.headers.get("content-type"))!=null?r:void 0}}catch(s){throw zn.isInstance(s)?s:new zn({url:o,cause:s})}},"download"),tP=i((e=eP)=>t=>Promise.all(t.map(async n=>n.isUrlSupportedByModel?null:e(n))),"createDefaultDownloadFunction");function nP(e){try{const[t,n]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}i(nP,"splitDataUrl");var xw=se([m(),Ga(Uint8Array),Ga(ArrayBuffer),oR(e=>{var t,n;return(n=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?n:!1},{message:"Must be a Buffer"})]);function Sw(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e=="string")try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol==="data:"){const{mediaType:t,base64Content:n}=nP(e.toString());if(t==null||n==null)throw new oe({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:n,mediaType:t}}return{data:e,mediaType:void 0}}i(Sw,"convertToLanguageModelV3DataContent");function rP(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Jr(new Uint8Array(e)):Jr(e)}i(rP,"convertDataContentToBase64String");function Vd(e){return e===void 0?[]:Array.isArray(e)?e:[e]}i(Vd,"asArray");async function oP({prompt:e,supportedUrls:t,download:n=tP()}){const r=await iP(e.messages,n,t),o=new Map;for(const c of e.messages)if(c.role==="assistant"&&Array.isArray(c.content))for(const d of c.content)d.type==="tool-approval-request"&&"approvalId"in d&&"toolCallId"in d&&o.set(d.approvalId,d.toolCallId);const s=new Set;for(const c of e.messages)if(c.role==="tool"){for(const d of c.content)if(d.type==="tool-approval-response"){const p=o.get(d.approvalId);p&&s.add(p)}}const a=[...e.system!=null?typeof e.system=="string"?[{role:"system",content:e.system}]:Vd(e.system).map(c=>({role:"system",content:c.content,providerOptions:c.providerOptions})):[],...e.messages.map(c=>sP({message:c,downloadedAssets:r}))],l=[];for(const c of a){if(c.role!=="tool"){l.push(c);continue}const d=l.at(-1);d?.role==="tool"?d.content.push(...c.content):l.push(c)}const u=new Set;for(const c of l)switch(c.role){case"assistant":{for(const d of c.content)d.type==="tool-call"&&!d.providerExecuted&&u.add(d.toolCallId);break}case"tool":{for(const d of c.content)d.type==="tool-result"&&u.delete(d.toolCallId);break}case"user":case"system":for(const d of s)u.delete(d);if(u.size>0)throw new Qb({toolCallIds:Array.from(u)});break}for(const c of s)u.delete(c);if(u.size>0)throw new Qb({toolCallIds:Array.from(u)});return l.filter(c=>c.role!=="tool"||c.content.length>0)}i(oP,"convertToLanguageModelPrompt");function sP({message:e,downloadedAssets:t}){const n=e.role;switch(n){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(r=>aP(r,t)).filter(r=>r.type!=="text"||r.text!==""),providerOptions:e.providerOptions};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(r=>r.type!=="text"||r.text!==""||r.providerOptions!=null).filter(r=>r.type!=="tool-approval-request").map(r=>{const o=r.providerOptions;switch(r.type){case"file":{const{data:s,mediaType:a}=Sw(r.data);return{type:"file",data:s,filename:r.filename,mediaType:a??r.mediaType,providerOptions:o}}case"reasoning":return{type:"reasoning",text:r.text,providerOptions:o};case"text":return{type:"text",text:r.text,providerOptions:o};case"tool-call":return{type:"tool-call",toolCallId:r.toolCallId,toolName:r.toolName,input:r.input,providerExecuted:r.providerExecuted,providerOptions:o};case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:kw(r.output),providerOptions:o}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.filter(r=>r.type!=="tool-approval-response"||r.providerExecuted).map(r=>{switch(r.type){case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:kw(r.output),providerOptions:r.providerOptions};case"tool-approval-response":return{type:"tool-approval-response",approvalId:r.approvalId,approved:r.approved,reason:r.reason}}}),providerOptions:e.providerOptions};default:{const r=n;throw new U7({role:r})}}}i(sP,"convertToLanguageModelMessage");async function iP(e,t,n){const r=e.filter(s=>s.role==="user").map(s=>s.content).filter(s=>Array.isArray(s)).flat().filter(s=>s.type==="image"||s.type==="file").map(s=>{var a;const l=(a=s.mediaType)!=null?a:s.type==="image"?"image/*":void 0;let u=s.type==="image"?s.image:s.data;if(typeof u=="string")try{u=new URL(u)}catch{}return{mediaType:l,data:u}}).filter(s=>s.data instanceof URL).map(s=>({url:s.data,isUrlSupportedByModel:s.mediaType!=null&&ZR({url:s.data.toString(),mediaType:s.mediaType,supportedUrls:n})})),o=await t(r);return Object.fromEntries(o.map((s,a)=>s==null?null:[r[a].url.toString(),{data:s.data,mediaType:s.mediaType}]).filter(s=>s!=null))}i(iP,"downloadAssets");function aP(e,t){var n;if(e.type==="text")return{type:"text",text:e.text,providerOptions:e.providerOptions};let r;const o=e.type;switch(o){case"image":r=e.image;break;case"file":r=e.data;break;default:throw new Error(`Unsupported part type: ${o}`)}const{data:s,mediaType:a}=Sw(r);let l=a??e.mediaType,u=s;if(u instanceof URL){const c=t[u.toString()];c&&(u=c.data,l??(l=c.mediaType))}switch(o){case"image":return(u instanceof Uint8Array||typeof u=="string")&&(l=(n=Q7({data:u,signatures:K7}))!=null?n:l),{type:"file",mediaType:l??"image/*",filename:void 0,data:u,providerOptions:e.providerOptions};case"file":{if(l==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:l,filename:e.filename,data:u,providerOptions:e.providerOptions}}}}i(aP,"convertPartToLanguageModelPart");function kw(e){return e.type!=="content"?e:{type:"content",value:e.value.map(t=>t.type!=="media"?t:t.mediaType.startsWith("image/")?{type:"image-data",data:t.data,mediaType:t.mediaType}:{type:"file-data",data:t.data,mediaType:t.mediaType})}}i(kw,"mapToolResultOutput");async function ml({toolCallId:e,input:t,output:n,tool:r,errorMode:o}){return o==="text"?{type:"error-text",value:Gs(n)}:o==="json"?{type:"error-json",value:Iw(n)}:r?.toModelOutput?await r.toModelOutput({toolCallId:e,input:t,output:n}):typeof n=="string"?{type:"text",value:n}:{type:"json",value:Iw(n)}}i(ml,"createToolModelOutput");function Iw(e){return e===void 0?null:e}i(Iw,"toJSONValue");function Aw({maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:o,frequencyPenalty:s,seed:a,stopSequences:l}){if(e!=null){if(!Number.isInteger(e))throw new Sn({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new Sn({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new Sn({parameter:"temperature",value:t,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new Sn({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new Sn({parameter:"topK",value:r,message:"topK must be a number"});if(o!=null&&typeof o!="number")throw new Sn({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new Sn({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(a!=null&&!Number.isInteger(a))throw new Sn({parameter:"seed",value:a,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:o,frequencyPenalty:s,stopSequences:l,seed:a}}i(Aw,"prepareCallSettings");function lP(e){return e!=null&&Object.keys(e).length>0}i(lP,"isNonEmptyObject");async function uP({tools:e,toolChoice:t,activeTools:n}){if(!lP(e))return{tools:void 0,toolChoice:void 0};const r=n!=null?Object.entries(e).filter(([s])=>n.includes(s)):Object.entries(e),o=[];for(const[s,a]of r){const l=a.type;switch(l){case void 0:case"dynamic":case"function":o.push({type:"function",name:s,description:a.description,inputSchema:await Yr(a.inputSchema).jsonSchema,...a.inputExamples!=null?{inputExamples:a.inputExamples}:{},providerOptions:a.providerOptions,...a.strict!=null?{strict:a.strict}:{}});break;case"provider":o.push({type:"provider",name:s,id:a.id,args:a.args});break;default:{const u=l;throw new Error(`Unsupported tool type: ${u}`)}}}return{tools:o,toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}}i(uP,"prepareToolsAndToolChoice");var fi=sd(()=>se([o_(),m(),A(),qe(),Ae(m(),fi.optional()),M(fi)])),Ge=Ae(m(),Ae(m(),fi.optional())),Tw=b({type:k("text"),text:m(),providerOptions:Ge.optional()}),cP=b({type:k("image"),image:se([xw,Ga(URL)]),mediaType:m().optional(),providerOptions:Ge.optional()}),Fw=b({type:k("file"),data:se([xw,Ga(URL)]),filename:m().optional(),mediaType:m(),providerOptions:Ge.optional()}),dP=b({type:k("reasoning"),text:m(),providerOptions:Ge.optional()}),pP=b({type:k("tool-call"),toolCallId:m(),toolName:m(),input:$t(),providerOptions:Ge.optional(),providerExecuted:qe().optional()}),fP=Ce("type",[b({type:k("text"),value:m(),providerOptions:Ge.optional()}),b({type:k("json"),value:fi,providerOptions:Ge.optional()}),b({type:k("execution-denied"),reason:m().optional(),providerOptions:Ge.optional()}),b({type:k("error-text"),value:m(),providerOptions:Ge.optional()}),b({type:k("error-json"),value:fi,providerOptions:Ge.optional()}),b({type:k("content"),value:M(se([b({type:k("text"),text:m(),providerOptions:Ge.optional()}),b({type:k("media"),data:m(),mediaType:m()}),b({type:k("file-data"),data:m(),mediaType:m(),filename:m().optional(),providerOptions:Ge.optional()}),b({type:k("file-url"),url:m(),providerOptions:Ge.optional()}),b({type:k("file-id"),fileId:se([m(),Ae(m(),m())]),providerOptions:Ge.optional()}),b({type:k("image-data"),data:m(),mediaType:m(),providerOptions:Ge.optional()}),b({type:k("image-url"),url:m(),providerOptions:Ge.optional()}),b({type:k("image-file-id"),fileId:se([m(),Ae(m(),m())]),providerOptions:Ge.optional()}),b({type:k("custom"),providerOptions:Ge.optional()})]))})]),Ow=b({type:k("tool-result"),toolCallId:m(),toolName:m(),output:fP,providerOptions:Ge.optional()}),mP=b({type:k("tool-approval-request"),approvalId:m(),toolCallId:m()}),hP=b({type:k("tool-approval-response"),approvalId:m(),approved:qe(),reason:m().optional()}),gP=b({role:k("system"),content:m(),providerOptions:Ge.optional()}),yP=b({role:k("user"),content:se([m(),M(se([Tw,cP,Fw]))]),providerOptions:Ge.optional()}),vP=b({role:k("assistant"),content:se([m(),M(se([Tw,Fw,dP,pP,Ow,mP]))]),providerOptions:Ge.optional()}),_P=b({role:k("tool"),content:M(se([Ow,hP])),providerOptions:Ge.optional()}),bP=se([gP,yP,vP,_P]);async function wP(e){if(e.prompt==null&&e.messages==null)throw new Rn({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new Rn({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string"&&!Vd(e.system).every(r=>typeof r=="object"&&r!==null&&"role"in r&&r.role==="system"))throw new Rn({prompt:e,message:"system must be a string, SystemModelMessage, or array of SystemModelMessage"});let t;if(e.prompt!=null&&typeof e.prompt=="string")t=[{role:"user",content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new Rn({prompt:e,message:"prompt or messages must be defined"});if(t.length===0)throw new Rn({prompt:e,message:"messages must not be empty"});const n=await Qt({value:t,schema:M(bP)});if(!n.success)throw new Rn({prompt:e,message:"The messages do not match the ModelMessage[] schema.",cause:n.error});return{messages:t,system:e.system}}i(wP,"standardizePrompt");function DP(e){if(!Td.isInstance(e))return e;const t=(process==null?void 0:process.env.NODE_ENV)==="production",n="https://ai-sdk.dev/unauthenticated-ai-gateway";return t?new oe({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${n}`}):Object.assign(new Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${n}\x1B[0m

`),{name:"GatewayAuthenticationError"})}i(DP,"wrapGatewayError");function Gd({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}i(Gd,"assembleOperationName");function EP({model:e,settings:t,telemetry:n,headers:r}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((s,[a,l])=>{if(a==="timeout"){const u=Cw(l);u!=null&&(s[`ai.settings.${a}`]=u)}else s[`ai.settings.${a}`]=l;return s},{}),...Object.entries((o=n?.metadata)!=null?o:{}).reduce((s,[a,l])=>(s[`ai.telemetry.metadata.${a}`]=l,s),{}),...Object.entries(r??{}).reduce((s,[a,l])=>(l!==void 0&&(s[`ai.request.headers.${a}`]=l),s),{})}}i(EP,"getBaseTelemetryAttributes");var CP={startSpan(){return hl},startActiveSpan(e,t,n,r){if(typeof t=="function")return t(hl);if(typeof n=="function")return n(hl);if(typeof r=="function")return r(hl)}},hl={spanContext(){return $P},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},$P={traceId:"",spanId:"",traceFlags:0};function xP({isEnabled:e=!1,tracer:t}={}){return e?t||C7.getTracer("ai"):CP}i(xP,"getTracer");async function Zd({name:e,tracer:t,attributes:n,fn:r,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:await n},async s=>{const a=Mb.active();try{const l=await Mb.with(a,()=>r(s));return o&&s.end(),l}catch(l){try{Rw(s,l)}finally{s.end()}throw l}})}i(Zd,"recordSpan");function Rw(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:fl.ERROR,message:t.message})):e.setStatus({code:fl.ERROR})}i(Rw,"recordErrorOnSpan");async function Qr({telemetry:e,attributes:t}){if(e?.isEnabled!==!0)return{};const n={};for(const[r,o]of Object.entries(t))if(o!=null){if(typeof o=="object"&&"input"in o&&typeof o.input=="function"){if(e?.recordInputs===!1)continue;const s=await o.input();s!=null&&(n[r]=s);continue}if(typeof o=="object"&&"output"in o&&typeof o.output=="function"){if(e?.recordOutputs===!1)continue;const s=await o.output();s!=null&&(n[r]=s);continue}n[r]=o}return n}i(Qr,"selectTelemetryAttributes");function SP(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(n=>n.type==="file"?{...n,data:n.data instanceof Uint8Array?rP(n.data):n.data}:n)})))}i(SP,"stringifyForTelemetry");function kP(e){return{inputTokens:e.inputTokens.total,inputTokenDetails:{noCacheTokens:e.inputTokens.noCache,cacheReadTokens:e.inputTokens.cacheRead,cacheWriteTokens:e.inputTokens.cacheWrite},outputTokens:e.outputTokens.total,outputTokenDetails:{textTokens:e.outputTokens.text,reasoningTokens:e.outputTokens.reasoning},totalTokens:nn(e.inputTokens.total,e.outputTokens.total),raw:e.raw,reasoningTokens:e.outputTokens.reasoning,cachedInputTokens:e.inputTokens.cacheRead}}i(kP,"asLanguageModelUsage");function IP(e,t){var n,r,o,s,a,l,u,c,d,p;return{inputTokens:nn(e.inputTokens,t.inputTokens),inputTokenDetails:{noCacheTokens:nn((n=e.inputTokenDetails)==null?void 0:n.noCacheTokens,(r=t.inputTokenDetails)==null?void 0:r.noCacheTokens),cacheReadTokens:nn((o=e.inputTokenDetails)==null?void 0:o.cacheReadTokens,(s=t.inputTokenDetails)==null?void 0:s.cacheReadTokens),cacheWriteTokens:nn((a=e.inputTokenDetails)==null?void 0:a.cacheWriteTokens,(l=t.inputTokenDetails)==null?void 0:l.cacheWriteTokens)},outputTokens:nn(e.outputTokens,t.outputTokens),outputTokenDetails:{textTokens:nn((u=e.outputTokenDetails)==null?void 0:u.textTokens,(c=t.outputTokenDetails)==null?void 0:c.textTokens),reasoningTokens:nn((d=e.outputTokenDetails)==null?void 0:d.reasoningTokens,(p=t.outputTokenDetails)==null?void 0:p.reasoningTokens)},totalTokens:nn(e.totalTokens,t.totalTokens),reasoningTokens:nn(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:nn(e.cachedInputTokens,t.cachedInputTokens)}}i(IP,"addLanguageModelUsage");function nn(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}i(nn,"addTokenCounts");function Pw(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const n={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const o=t[r];if(o===void 0)continue;const s=r in e?e[r]:void 0,a=o!==null&&typeof o=="object"&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp),l=s!=null&&typeof s=="object"&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp);a&&l?n[r]=Pw(s,o):n[r]=o}return n}i(Pw,"mergeObjects");function AP({error:e,exponentialBackoffDelay:t}){const n=e.responseHeaders;if(!n)return t;let r;const o=n["retry-after-ms"];if(o){const a=parseFloat(o);Number.isNaN(a)||(r=a)}const s=n["retry-after"];if(s&&r===void 0){const a=parseFloat(s);Number.isNaN(a)?r=Date.parse(s)-Date.now():r=a*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}i(AP,"getRetryDelayInMs");var TP=i(({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:r}={})=>async o=>Mw(o,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:r}),"retryWithExponentialBackoffRespectingRetryHeaders");async function Mw(e,{maxRetries:t,delayInMs:n,backoffFactor:r,abortSignal:o},s=[]){try{return await e()}catch(a){if(Kr(a)||t===0)throw a;const l=x_(a),u=[...s,a],c=u.length;if(c>t)throw new vw({message:`Failed after ${c} attempts. Last error: ${l}`,reason:"maxRetriesExceeded",errors:u});if(a instanceof Error&&Ue.isInstance(a)&&a.isRetryable===!0&&c<=t)return await MR(AP({error:a,exponentialBackoffDelay:n}),{abortSignal:o}),Mw(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r,abortSignal:o},u);throw c===1?a:new vw({message:`Failed after ${c} attempts with non-retryable error: '${l}'`,reason:"errorNotRetryable",errors:u})}}i(Mw,"_retryWithExponentialBackoff");function FP({maxRetries:e,abortSignal:t}){if(!Number.isInteger(e))throw new Sn({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});const n=e;return{maxRetries:n,retry:TP({maxRetries:n,abortSignal:t})}}i(FP,"prepareRetries");function OP({messages:e}){const t=e.at(-1);if(t?.role!="tool")return{approvedToolApprovals:[],deniedToolApprovals:[]};const n={};for(const u of e)if(u.role==="assistant"&&typeof u.content!="string"){const c=u.content;for(const d of c)d.type==="tool-call"&&(n[d.toolCallId]=d)}const r={};for(const u of e)if(u.role==="assistant"&&typeof u.content!="string"){const c=u.content;for(const d of c)d.type==="tool-approval-request"&&(r[d.approvalId]=d)}const o={};for(const u of t.content)u.type==="tool-result"&&(o[u.toolCallId]=u);const s=[],a=[],l=t.content.filter(u=>u.type==="tool-approval-response");for(const u of l){const c=r[u.approvalId];if(c==null)throw new I7({approvalId:u.approvalId});if(o[c.toolCallId]!=null)continue;const d=n[c.toolCallId];if(d==null)throw new Jb({toolCallId:c.toolCallId,approvalId:c.approvalId});const p={approvalRequest:c,approvalResponse:u,toolCall:d};u.approved?s.push(p):a.push(p)}return{approvedToolApprovals:s,deniedToolApprovals:a}}i(OP,"collectToolApprovals");function Wd(){var e,t;return(t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}i(Wd,"now");async function RP({toolCall:e,tools:t,tracer:n,telemetry:r,messages:o,abortSignal:s,experimental_context:a,stepNumber:l,model:u,onPreliminaryToolResult:c,onToolCallStart:d,onToolCallFinish:p}){const{toolName:h,toolCallId:g,input:f}=e,y=t?.[h];if(y?.execute==null)return;const v={stepNumber:l,model:u,toolCall:e,messages:o,abortSignal:s,functionId:r?.functionId,metadata:r?.metadata,experimental_context:a};return Zd({name:"ai.toolCall",attributes:Qr({telemetry:r,attributes:{...Gd({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":h,"ai.toolCall.id":g,"ai.toolCall.args":{output:i(()=>JSON.stringify(f),"output")}}}),tracer:n,fn:i(async _=>{let w;try{await d?.(v)}catch{}const D=Wd();try{const I=W4({execute:y.execute.bind(y),input:f,options:{toolCallId:g,messages:o,abortSignal:s,experimental_context:a}});for await(const T of I)T.type==="preliminary"?c?.({...e,type:"tool-result",output:T.output,preliminary:!0}):w=T.output}catch(I){const T=Wd()-D;try{await p?.({...v,success:!1,error:I,durationMs:T})}catch{}return Rw(_,I),{type:"tool-error",toolCallId:g,toolName:h,input:f,error:I,dynamic:y.type==="dynamic",...e.providerMetadata!=null?{providerMetadata:e.providerMetadata}:{}}}const E=Wd()-D;try{await p?.({...v,success:!0,output:w,durationMs:E})}catch{}try{_.setAttributes(await Qr({telemetry:r,attributes:{"ai.toolCall.result":{output:i(()=>JSON.stringify(w),"output")}}}))}catch{}return{type:"tool-result",toolCallId:g,toolName:h,input:f,output:w,dynamic:y.type==="dynamic",...e.providerMetadata!=null?{providerMetadata:e.providerMetadata}:{}}},"fn")})}i(RP,"executeToolCall");function Nw(e){const t=e.filter(n=>n.type==="reasoning");return t.length===0?void 0:t.map(n=>n.text).join(`
`)}i(Nw,"extractReasoningContent");function Bw(e){const t=e.filter(n=>n.type==="text");if(t.length!==0)return t.map(n=>n.text).join("")}i(Bw,"extractTextContent");var PP=(qo=class{constructor({data:t,mediaType:n}){const r=t instanceof Uint8Array;this.base64Data=r?void 0:t,this.uint8ArrayData=r?t:void 0,this.mediaType=n}get base64(){return this.base64Data==null&&(this.base64Data=Jr(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=gr(this.base64Data)),this.uint8ArrayData}},i(qo,"DefaultGeneratedFile"),qo);async function MP({tool:e,toolCall:t,messages:n,experimental_context:r}){return e.needsApproval==null?!1:typeof e.needsApproval=="boolean"?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:n,experimental_context:r})}i(MP,"isApprovalNeeded");var NP={};x7(NP,{array:i(()=>LP,"array"),choice:i(()=>UP,"choice"),json:i(()=>zP,"json"),object:i(()=>jP,"object"),text:i(()=>jw,"text")});function BP(e){const t=["ROOT"];let n=-1,r=null;function o(u,c,d){switch(u){case'"':{n=c,t.pop(),t.push(d),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=c,r=c,t.pop(),t.push(d),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=c,t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"{":{n=c,t.pop(),t.push(d),t.push("INSIDE_OBJECT_START");break}case"[":{n=c,t.pop(),t.push(d),t.push("INSIDE_ARRAY_START");break}}}i(o,"processValueStart");function s(u,c){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=c,t.pop();break}}}i(s,"processAfterObjectValue");function a(u,c){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=c,t.pop();break}}}i(a,"processAfterArrayValue");for(let u=0;u<e.length;u++){const c=e[u];switch(t[t.length-1]){case"ROOT":o(c,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(c){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(c){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(c){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(c){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{o(c,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(c,u);break}case"INSIDE_STRING":{switch(c){case'"':{t.pop(),n=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=u}break}case"INSIDE_ARRAY_START":{switch(c){case"]":{n=u,t.pop();break}default:{n=u,o(c,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(c){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,t.pop();break}default:{n=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{o(c,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=u;break}case"INSIDE_NUMBER":{switch(c){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&a(c,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&a(c,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const p=e.substring(r,u+1);!"false".startsWith(p)&&!"true".startsWith(p)&&!"null".startsWith(p)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(c,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&a(c,u)):n=u;break}}}let l=e.slice(0,n+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{l+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{l+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{l+="]";break}case"INSIDE_LITERAL":{const d=e.substring(r,e.length);"true".startsWith(d)?l+="true".slice(d.length):"false".startsWith(d)?l+="false".slice(d.length):"null".startsWith(d)&&(l+="null".slice(d.length))}}return l}i(BP,"fixJson");async function gl(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await en({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await en({text:BP(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}i(gl,"parsePartialJson");var jw=i(()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),async parseCompleteOutput({text:e}){return e},async parsePartialOutput({text:e}){return{partial:e}},createElementStreamTransform(){}}),"text"),jP=i(({schema:e,name:t,description:n})=>{const r=Yr(e);return{name:"object",responseFormat:xt(r.jsonSchema).then(o=>({type:"json",schema:o,...t!=null&&{name:t},...n!=null&&{description:n}})),async parseCompleteOutput({text:o},s){const a=await en({text:o});if(!a.success)throw new qn({message:"No object generated: could not parse the response.",cause:a.error,text:o,response:s.response,usage:s.usage,finishReason:s.finishReason});const l=await Qt({value:a.value,schema:r});if(!l.success)throw new qn({message:"No object generated: response did not match schema.",cause:l.error,text:o,response:s.response,usage:s.usage,finishReason:s.finishReason});return l.value},async parsePartialOutput({text:o}){const s=await gl(o);switch(s.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:s.value}}},createElementStreamTransform(){}}},"object"),LP=i(({element:e,name:t,description:n})=>{const r=Yr(e);return{name:"array",responseFormat:xt(r.jsonSchema).then(o=>{const{$schema:s,...a}=o;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:a}},required:["elements"],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}}),async parseCompleteOutput({text:o},s){const a=await en({text:o});if(!a.success)throw new qn({message:"No object generated: could not parse the response.",cause:a.error,text:o,response:s.response,usage:s.usage,finishReason:s.finishReason});const l=a.value;if(l==null||typeof l!="object"||!("elements"in l)||!Array.isArray(l.elements))throw new qn({message:"No object generated: response did not match schema.",cause:new dr({value:l,cause:"response must be an object with an elements array"}),text:o,response:s.response,usage:s.usage,finishReason:s.finishReason});for(const u of l.elements){const c=await Qt({value:u,schema:r});if(!c.success)throw new qn({message:"No object generated: response did not match schema.",cause:c.error,text:o,response:s.response,usage:s.usage,finishReason:s.finishReason})}return l.elements},async parsePartialOutput({text:o}){const s=await gl(o);switch(s.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const a=s.value;if(a==null||typeof a!="object"||!("elements"in a)||!Array.isArray(a.elements))return;const l=s.state==="repaired-parse"&&a.elements.length>0?a.elements.slice(0,-1):a.elements,u=[];for(const c of l){const d=await Qt({value:c,schema:r});d.success&&u.push(d.value)}return{partial:u}}}},createElementStreamTransform(){let o=0;return new TransformStream({transform({partialOutput:s},a){if(s!=null)for(;o<s.length;o++)a.enqueue(s[o])}})}}},"array"),UP=i(({options:e,name:t,description:n})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}),async parseCompleteOutput({text:r},o){const s=await en({text:r});if(!s.success)throw new qn({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:o.response,usage:o.usage,finishReason:o.finishReason});const a=s.value;if(a==null||typeof a!="object"||!("result"in a)||typeof a.result!="string"||!e.includes(a.result))throw new qn({message:"No object generated: response did not match schema.",cause:new dr({value:a,cause:"response must be an object that contains a choice value."}),text:r,response:o.response,usage:o.usage,finishReason:o.finishReason});return a.result},async parsePartialOutput({text:r}){const o=await gl(r);switch(o.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const s=o.value;if(s==null||typeof s!="object"||!("result"in s)||typeof s.result!="string")return;const a=e.filter(l=>l.startsWith(s.result));return o.state==="successful-parse"?a.includes(s.result)?{partial:s.result}:void 0:a.length===1?{partial:a[0]}:void 0}}},createElementStreamTransform(){}}),"choice"),zP=i(({name:e,description:t}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...e!=null&&{name:e},...t!=null&&{description:t}}),async parseCompleteOutput({text:n},r){const o=await en({text:n});if(!o.success)throw new qn({message:"No object generated: could not parse the response.",cause:o.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value},async parsePartialOutput({text:n}){const r=await gl(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return r.value===void 0?void 0:{partial:r.value}}},createElementStreamTransform(){}}),"json");async function qP({toolCall:e,tools:t,repairToolCall:n,system:r,messages:o}){var s;try{if(t==null){if(e.providerExecuted&&e.dynamic)return await Lw(e);throw new qd({toolName:e.toolName})}try{return await Uw({toolCall:e,tools:t})}catch(a){if(n==null||!(qd.isInstance(a)||zd.isInstance(a)))throw a;let l=null;try{l=await n({toolCall:e,tools:t,inputSchema:i(async({toolName:u})=>{const{inputSchema:c}=t[u];return await Yr(c).jsonSchema},"inputSchema"),system:r,messages:o,error:a})}catch(u){throw new B7({cause:u,originalError:a})}if(l==null)throw a;return await Uw({toolCall:l,tools:t})}}catch(a){const l=await en({text:e.input}),u=l.success?l.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:u,dynamic:!0,invalid:!0,error:a,title:(s=t?.[e.toolName])==null?void 0:s.title,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}}i(qP,"parseToolCall");async function Lw(e){const t=e.input.trim()===""?{success:!0,value:{}}:await en({text:e.input});if(t.success===!1)throw new zd({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}i(Lw,"parseProviderExecutedDynamicToolCall");async function Uw({toolCall:e,tools:t}){const n=e.toolName,r=t[n];if(r==null){if(e.providerExecuted&&e.dynamic)return await Lw(e);throw new qd({toolName:e.toolName,availableTools:Object.keys(t)})}const o=Yr(r.inputSchema),s=e.input.trim()===""?await Qt({value:{},schema:o}):await en({text:e.input,schema:o});if(s.success===!1)throw new zd({toolName:n,toolInput:e.input,cause:s.error});return r.type==="dynamic"?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:r.title}:{type:"tool-call",toolCallId:e.toolCallId,toolName:n,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:r.title}}i(Uw,"doParseToolCall");var VP=(Vo=class{constructor({stepNumber:t,model:n,functionId:r,metadata:o,experimental_context:s,content:a,finishReason:l,rawFinishReason:u,usage:c,warnings:d,request:p,response:h,providerMetadata:g}){this.stepNumber=t,this.model=n,this.functionId=r,this.metadata=o,this.experimental_context=s,this.content=a,this.finishReason=l,this.rawFinishReason=u,this.usage=c,this.warnings=d,this.request=p,this.response=h,this.providerMetadata=g}get text(){return this.content.filter(t=>t.type==="text").map(t=>t.text).join("")}get reasoning(){return this.content.filter(t=>t.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(t=>t.text).join("")}get files(){return this.content.filter(t=>t.type==="file").map(t=>t.file)}get sources(){return this.content.filter(t=>t.type==="source")}get toolCalls(){return this.content.filter(t=>t.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(t=>t.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(t=>t.dynamic===!0)}get toolResults(){return this.content.filter(t=>t.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(t=>t.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(t=>t.dynamic===!0)}},i(Vo,"DefaultStepResult"),Vo);function GP(e){return({steps:t})=>t.length===e}i(GP,"stepCountIs");async function ZP({stopConditions:e,steps:t}){return(await Promise.all(e.map(n=>n({steps:t})))).some(n=>n)}i(ZP,"isStopConditionMet");async function WP({content:e,tools:t}){const n=[],r=[];for(const s of e)if(s.type!=="source"&&!((s.type==="tool-result"||s.type==="tool-error")&&!s.providerExecuted)&&!(s.type==="text"&&s.text.length===0))switch(s.type){case"text":r.push({type:"text",text:s.text,providerOptions:s.providerMetadata});break;case"reasoning":r.push({type:"reasoning",text:s.text,providerOptions:s.providerMetadata});break;case"file":r.push({type:"file",data:s.file.base64,mediaType:s.file.mediaType,providerOptions:s.providerMetadata});break;case"tool-call":r.push({type:"tool-call",toolCallId:s.toolCallId,toolName:s.toolName,input:s.input,providerExecuted:s.providerExecuted,providerOptions:s.providerMetadata});break;case"tool-result":{const a=await ml({toolCallId:s.toolCallId,input:s.input,tool:t?.[s.toolName],output:s.output,errorMode:"none"});r.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:a,providerOptions:s.providerMetadata});break}case"tool-error":{const a=await ml({toolCallId:s.toolCallId,input:s.input,tool:t?.[s.toolName],output:s.error,errorMode:"json"});r.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:a,providerOptions:s.providerMetadata});break}case"tool-approval-request":r.push({type:"tool-approval-request",approvalId:s.approvalId,toolCallId:s.toolCall.toolCallId});break}r.length>0&&n.push({role:"assistant",content:r});const o=[];for(const s of e){if(!(s.type==="tool-result"||s.type==="tool-error")||s.providerExecuted)continue;const a=await ml({toolCallId:s.toolCallId,input:s.input,tool:t?.[s.toolName],output:s.type==="tool-result"?s.output:s.error,errorMode:s.type==="tool-error"?"text":"none"});o.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,output:a,...s.providerMetadata!=null?{providerOptions:s.providerMetadata}:{}})}return o.length>0&&n.push({role:"tool",content:o}),n}i(WP,"toResponseMessages");function HP(...e){const t=e.filter(r=>r!=null);if(t.length===0)return;if(t.length===1)return t[0];const n=new AbortController;for(const r of t){if(r.aborted)return n.abort(r.reason),n.signal;r.addEventListener("abort",()=>{n.abort(r.reason)},{once:!0})}return n.signal}i(HP,"mergeAbortSignals");var JP=ii({prefix:"aitxt",size:24});async function eo({model:e,tools:t,toolChoice:n,system:r,prompt:o,messages:s,maxRetries:a,abortSignal:l,timeout:u,headers:c,stopWhen:d=GP(1),experimental_output:p,output:h=p,experimental_telemetry:g,providerOptions:f,experimental_activeTools:y,activeTools:v=y,experimental_prepareStep:_,prepareStep:w=_,experimental_repairToolCall:D,experimental_download:E,experimental_context:I,experimental_include:T,_internal:{generateId:$=JP}={},experimental_onStart:x,experimental_onStepStart:j,experimental_onToolCallStart:S,experimental_onToolCallFinish:Z,onStepFinish:R,onFinish:B,...P}){const L=Ew(e),N=Vd(d),J=Cw(u),ve=J7(u),re=ve!=null?new AbortController:void 0,le=HP(l,J!=null?AbortSignal.timeout(J):void 0,re?.signal),{maxRetries:_e,retry:X}=FP({maxRetries:a,abortSignal:le}),Je=Aw(P),Re=yr(c??{},`ai/${$w}`),vt=EP({model:L,telemetry:g,headers:Re,settings:{...Je,maxRetries:_e}}),Me={provider:L.provider,modelId:L.modelId},q=await wP({system:r,prompt:o,messages:s});try{await x?.({model:Me,system:r,prompt:o,messages:s,tools:t,toolChoice:n,activeTools:v,maxOutputTokens:Je.maxOutputTokens,temperature:Je.temperature,topP:Je.topP,topK:Je.topK,presencePenalty:Je.presencePenalty,frequencyPenalty:Je.frequencyPenalty,stopSequences:Je.stopSequences,seed:Je.seed,maxRetries:_e,timeout:u,headers:c,providerOptions:f,stopWhen:d,output:h,abortSignal:l,include:T,functionId:g?.functionId,metadata:g?.metadata,experimental_context:I})}catch{}const ie=xP(g);try{return await Zd({name:"ai.generateText",attributes:Qr({telemetry:g,attributes:{...Gd({operationId:"ai.generateText",telemetry:g}),...vt,"ai.model.provider":L.provider,"ai.model.id":L.modelId,"ai.prompt":{input:i(()=>JSON.stringify({system:r,prompt:o,messages:s}),"input")}}}),tracer:ie,fn:i(async st=>{var $e,rs,os,ss,is,as,ls,us,cs,C,G,Ke,_t;const Sr=q.messages,ds=[],{approvedToolApprovals:ef,deniedToolApprovals:Il}=OP({messages:Sr}),tf=ef.filter(it=>!it.toolCall.providerExecuted);if(Il.length>0||tf.length>0){const it=await zw({toolCalls:tf.map(ge=>ge.toolCall),tools:t,tracer:ie,telemetry:g,messages:Sr,abortSignal:le,experimental_context:I,stepNumber:0,model:Me,onToolCallStart:S,onToolCallFinish:Z}),kt=[];for(const ge of it){const Vt=await ml({toolCallId:ge.toolCallId,input:ge.input,tool:t?.[ge.toolName],output:ge.type==="tool-result"?ge.output:ge.error,errorMode:ge.type==="tool-error"?"json":"none"});kt.push({type:"tool-result",toolCallId:ge.toolCallId,toolName:ge.toolName,output:Vt})}for(const ge of Il)kt.push({type:"tool-result",toolCallId:ge.toolCall.toolCallId,toolName:ge.toolCall.toolName,output:{type:"execution-denied",reason:ge.approvalResponse.reason,...ge.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:ge.approvalResponse.approvalId}}}}});ds.push({role:"tool",content:kt})}const nf=[...ef,...Il].filter(it=>it.toolCall.providerExecuted);nf.length>0&&ds.push({role:"tool",content:nf.map(it=>({type:"tool-approval-response",approvalId:it.approvalResponse.approvalId,approved:it.approvalResponse.approved,reason:it.approvalResponse.reason,providerExecuted:!0}))});const W1=Aw(P);let Ze,$i=[],ps=[];const St=[],Al=new Map;do{const it=ve!=null?setTimeout(()=>re.abort(),ve):void 0;try{const kt=[...Sr,...ds],ge=await w?.({model:L,steps:St,stepNumber:St.length,messages:kt,experimental_context:I}),Vt=Ew(($e=ge?.model)!=null?$e:L),fs={provider:Vt.provider,modelId:Vt.modelId},sf=await oP({prompt:{system:(rs=ge?.system)!=null?rs:q.system,messages:(os=ge?.messages)!=null?os:kt},supportedUrls:await Vt.supportedUrls,download:E});I=(ss=ge?.experimental_context)!=null?ss:I;const af=(is=ge?.activeTools)!=null?is:v,{toolChoice:xi,tools:Tl}=await uP({tools:t,toolChoice:(as=ge?.toolChoice)!=null?as:n,activeTools:af}),H1=(ls=ge?.messages)!=null?ls:kt,J1=(us=ge?.system)!=null?us:q.system,lf=Pw(f,ge?.providerOptions);try{await j?.({stepNumber:St.length,model:fs,system:J1,messages:H1,tools:t,toolChoice:xi,activeTools:af,steps:[...St],providerOptions:lf,timeout:u,headers:c,stopWhen:d,output:h,abortSignal:l,include:T,functionId:g?.functionId,metadata:g?.metadata,experimental_context:I})}catch{}Ze=await X(()=>{var he;return Zd({name:"ai.generateText.doGenerate",attributes:Qr({telemetry:g,attributes:{...Gd({operationId:"ai.generateText.doGenerate",telemetry:g}),...vt,"ai.model.provider":Vt.provider,"ai.model.id":Vt.modelId,"ai.prompt.messages":{input:i(()=>SP(sf),"input")},"ai.prompt.tools":{input:i(()=>Tl?.map(It=>JSON.stringify(It)),"input")},"ai.prompt.toolChoice":{input:i(()=>xi!=null?JSON.stringify(xi):void 0,"input")},"gen_ai.system":Vt.provider,"gen_ai.request.model":Vt.modelId,"gen_ai.request.frequency_penalty":P.frequencyPenalty,"gen_ai.request.max_tokens":P.maxOutputTokens,"gen_ai.request.presence_penalty":P.presencePenalty,"gen_ai.request.stop_sequences":P.stopSequences,"gen_ai.request.temperature":(he=P.temperature)!=null?he:void 0,"gen_ai.request.top_k":P.topK,"gen_ai.request.top_p":P.topP}}),tracer:ie,fn:i(async It=>{var Ol,hs,df,pf,ff,mf,hf,gf;const ct=await Vt.doGenerate({...W1,tools:Tl,toolChoice:xi,responseFormat:await h?.responseFormat,prompt:sf,providerOptions:lf,abortSignal:le,headers:Re}),kr={id:(hs=(Ol=ct.response)==null?void 0:Ol.id)!=null?hs:$(),timestamp:(pf=(df=ct.response)==null?void 0:df.timestamp)!=null?pf:new Date,modelId:(mf=(ff=ct.response)==null?void 0:ff.modelId)!=null?mf:Vt.modelId,headers:(hf=ct.response)==null?void 0:hf.headers,body:(gf=ct.response)==null?void 0:gf.body};return It.setAttributes(await Qr({telemetry:g,attributes:{"ai.response.finishReason":ct.finishReason.unified,"ai.response.text":{output:i(()=>Bw(ct.content),"output")},"ai.response.reasoning":{output:i(()=>Nw(ct.content),"output")},"ai.response.toolCalls":{output:i(()=>{const yf=qw(ct.content);return yf==null?void 0:JSON.stringify(yf)},"output")},"ai.response.id":kr.id,"ai.response.model":kr.modelId,"ai.response.timestamp":kr.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ct.providerMetadata),"ai.usage.promptTokens":ct.usage.inputTokens.total,"ai.usage.completionTokens":ct.usage.outputTokens.total,"gen_ai.response.finish_reasons":[ct.finishReason.unified],"gen_ai.response.id":kr.id,"gen_ai.response.model":kr.modelId,"gen_ai.usage.input_tokens":ct.usage.inputTokens.total,"gen_ai.usage.output_tokens":ct.usage.outputTokens.total}})),{...ct,response:kr}},"fn")})});const ms=await Promise.all(Ze.content.filter(he=>he.type==="tool-call").map(he=>qP({toolCall:he,tools:t,repairToolCall:D,system:r,messages:kt}))),Fl={};for(const he of ms){if(he.invalid)continue;const It=t?.[he.toolName];It!=null&&(It?.onInputAvailable!=null&&await It.onInputAvailable({input:he.input,toolCallId:he.toolCallId,messages:kt,abortSignal:le,experimental_context:I}),await MP({tool:It,toolCall:he,messages:kt,experimental_context:I})&&(Fl[he.toolCallId]={type:"tool-approval-request",approvalId:$(),toolCall:he}))}const K1=ms.filter(he=>he.invalid&&he.dynamic);ps=[];for(const he of K1)ps.push({type:"tool-error",toolCallId:he.toolCallId,toolName:he.toolName,input:he.input,error:x_(he.error),dynamic:!0});$i=ms.filter(he=>!he.providerExecuted),t!=null&&ps.push(...await zw({toolCalls:$i.filter(he=>!he.invalid&&Fl[he.toolCallId]==null),tools:t,tracer:ie,telemetry:g,messages:kt,abortSignal:le,experimental_context:I,stepNumber:St.length,model:fs,onToolCallStart:S,onToolCallFinish:Z}));for(const he of ms){if(!he.providerExecuted)continue;const It=t?.[he.toolName];It?.type==="provider"&&It.supportsDeferredResults&&(Ze.content.some(hs=>hs.type==="tool-result"&&hs.toolCallId===he.toolCallId)||Al.set(he.toolCallId,{toolName:he.toolName}))}for(const he of Ze.content)he.type==="tool-result"&&Al.delete(he.toolCallId);const uf=YP({content:Ze.content,toolCalls:ms,toolOutputs:ps,toolApprovalRequests:Object.values(Fl),tools:t});ds.push(...await WP({content:uf,tools:t}));const Y1=(cs=T?.requestBody)==null||cs?(C=Ze.request)!=null?C:{}:{...Ze.request,body:void 0},X1={...Ze.response,messages:structuredClone(ds),body:(G=T?.responseBody)==null||G?(Ke=Ze.response)==null?void 0:Ke.body:void 0},Q1=St.length,cf=new VP({stepNumber:Q1,model:fs,functionId:g?.functionId,metadata:g?.metadata,experimental_context:I,content:uf,finishReason:Ze.finishReason.unified,rawFinishReason:Ze.finishReason.raw,usage:kP(Ze.usage),warnings:Ze.warnings,providerMetadata:Ze.providerMetadata,request:Y1,response:X1});bw({warnings:(_t=Ze.warnings)!=null?_t:[],provider:fs.provider,model:fs.modelId}),St.push(cf),await R?.(cf)}finally{it!=null&&clearTimeout(it)}}while(($i.length>0&&ps.length===$i.length||Al.size>0)&&!await ZP({stopConditions:N,steps:St}));st.setAttributes(await Qr({telemetry:g,attributes:{"ai.response.finishReason":Ze.finishReason.unified,"ai.response.text":{output:i(()=>Bw(Ze.content),"output")},"ai.response.reasoning":{output:i(()=>Nw(Ze.content),"output")},"ai.response.toolCalls":{output:i(()=>{const it=qw(Ze.content);return it==null?void 0:JSON.stringify(it)},"output")},"ai.response.providerMetadata":JSON.stringify(Ze.providerMetadata),"ai.usage.promptTokens":Ze.usage.inputTokens.total,"ai.usage.completionTokens":Ze.usage.outputTokens.total}}));const xe=St[St.length-1],rf=St.reduce((it,kt)=>IP(it,kt.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});await B?.({stepNumber:xe.stepNumber,model:xe.model,functionId:xe.functionId,metadata:xe.metadata,experimental_context:xe.experimental_context,finishReason:xe.finishReason,rawFinishReason:xe.rawFinishReason,usage:xe.usage,content:xe.content,text:xe.text,reasoningText:xe.reasoningText,reasoning:xe.reasoning,files:xe.files,sources:xe.sources,toolCalls:xe.toolCalls,staticToolCalls:xe.staticToolCalls,dynamicToolCalls:xe.dynamicToolCalls,toolResults:xe.toolResults,staticToolResults:xe.staticToolResults,dynamicToolResults:xe.dynamicToolResults,request:xe.request,response:xe.response,warnings:xe.warnings,providerMetadata:xe.providerMetadata,steps:St,totalUsage:rf});let of;return xe.finishReason==="stop"&&(of=await(h??jw()).parseCompleteOutput({text:xe.text},{response:xe.response,usage:xe.usage,finishReason:xe.finishReason})),new KP({steps:St,totalUsage:rf,output:of})},"fn")})}catch(st){throw DP(st)}}i(eo,"generateText");async function zw({toolCalls:e,tools:t,tracer:n,telemetry:r,messages:o,abortSignal:s,experimental_context:a,stepNumber:l,model:u,onToolCallStart:c,onToolCallFinish:d}){return(await Promise.all(e.map(async h=>RP({toolCall:h,tools:t,tracer:n,telemetry:r,messages:o,abortSignal:s,experimental_context:a,stepNumber:l,model:u,onToolCallStart:c,onToolCallFinish:d})))).filter(h=>h!=null)}i(zw,"executeTools");var KP=(Go=class{constructor(t){this.steps=t.steps,this._output=t.output,this.totalUsage=t.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(this._output==null)throw new P7;return this._output}},i(Go,"DefaultGenerateTextResult"),Go);function qw(e){const t=e.filter(n=>n.type==="tool-call");if(t.length!==0)return t.map(n=>({toolCallId:n.toolCallId,toolName:n.toolName,input:n.input}))}i(qw,"asToolCalls");function YP({content:e,toolCalls:t,toolOutputs:n,toolApprovalRequests:r,tools:o}){const s=[];for(const a of e)switch(a.type){case"text":case"reasoning":case"source":s.push(a);break;case"file":{s.push({type:"file",file:new PP(a),...a.providerMetadata!=null?{providerMetadata:a.providerMetadata}:{}});break}case"tool-call":{s.push(t.find(l=>l.toolCallId===a.toolCallId));break}case"tool-result":{const l=t.find(u=>u.toolCallId===a.toolCallId);if(l==null){const u=o?.[a.toolName];if(!(u?.type==="provider"&&u.supportsDeferredResults))throw new Error(`Tool call ${a.toolCallId} not found.`);a.isError?s.push({type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:void 0,error:a.result,providerExecuted:!0,dynamic:a.dynamic}):s.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,input:void 0,output:a.result,providerExecuted:!0,dynamic:a.dynamic});break}a.isError?s.push({type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:l.input,error:a.result,providerExecuted:!0,dynamic:l.dynamic}):s.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,input:l.input,output:a.result,providerExecuted:!0,dynamic:l.dynamic});break}case"tool-approval-request":{const l=t.find(u=>u.toolCallId===a.toolCallId);if(l==null)throw new Jb({toolCallId:a.toolCallId,approvalId:a.approvalId});s.push({type:"tool-approval-request",approvalId:a.approvalId,toolCall:l});break}}return[...s,...n,...r]}i(YP,"asContent"),class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},ii({prefix:"aitxt",size:24}),ii({prefix:"aiobj",size:24}),ii({prefix:"aiobj",size:24});var Hd=b({error:b({message:m(),type:m().nullish(),param:ft().nullish(),code:se([m(),A()]).nullish()})}),rn=Pt({errorSchema:Hd,errorToMessage:i(e=>e.error.message,"errorToMessage")});function Vw(e){const t=e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),n=e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini"),r=e.startsWith("o1")||e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("codex-mini")||e.startsWith("computer-use-preview")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),o=e.startsWith("gpt-5.1")||e.startsWith("gpt-5.2");return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?"developer":"system",supportsNonReasoningParameters:o}}i(Vw,"getOpenAILanguageModelCapabilities");function Gw(e){var t,n,r,o,s,a;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const l=(t=e.prompt_tokens)!=null?t:0,u=(n=e.completion_tokens)!=null?n:0,c=(o=(r=e.prompt_tokens_details)==null?void 0:r.cached_tokens)!=null?o:0,d=(a=(s=e.completion_tokens_details)==null?void 0:s.reasoning_tokens)!=null?a:0;return{inputTokens:{total:l,noCache:l-c,cacheRead:c,cacheWrite:void 0},outputTokens:{total:u,text:u-d,reasoning:d},raw:e}}i(Gw,"convertOpenAIChatUsage");function XP({prompt:e,systemMessageMode:t="system"}){var n;const r=[],o=[];for(const{role:s,content:a}of e)switch(s){case"system":{switch(t){case"system":{r.push({role:"system",content:a});break}case"developer":{r.push({role:"developer",content:a});break}case"remove":{o.push({type:"other",message:"system messages are removed for this model"});break}default:{const l=t;throw new Error(`Unsupported system message mode: ${l}`)}}break}case"user":{if(a.length===1&&a[0].type==="text"){r.push({role:"user",content:a[0].text});break}r.push({role:"user",content:a.map((l,u)=>{var c,d,p;switch(l.type){case"text":return{type:"text",text:l.text};case"file":if(l.mediaType.startsWith("image/")){const h=l.mediaType==="image/*"?"image/jpeg":l.mediaType;return{type:"image_url",image_url:{url:l.data instanceof URL?l.data.toString():`data:${h};base64,${$n(l.data)}`,detail:(d=(c=l.providerOptions)==null?void 0:c.openai)==null?void 0:d.imageDetail}}}else if(l.mediaType.startsWith("audio/")){if(l.data instanceof URL)throw new pt({functionality:"audio file parts with URLs"});switch(l.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:$n(l.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:$n(l.data),format:"mp3"}};default:throw new pt({functionality:`audio content parts with media type ${l.mediaType}`})}}else if(l.mediaType==="application/pdf"){if(l.data instanceof URL)throw new pt({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof l.data=="string"&&l.data.startsWith("file-")?{file_id:l.data}:{filename:(p=l.filename)!=null?p:`part-${u}.pdf`,file_data:`data:application/pdf;base64,${$n(l.data)}`}}}else throw new pt({functionality:`file part media type ${l.mediaType}`})}})});break}case"assistant":{let l="";const u=[];for(const c of a)switch(c.type){case"text":{l+=c.text;break}case"tool-call":{u.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.input)}});break}}r.push({role:"assistant",content:l,tool_calls:u.length>0?u:void 0});break}case"tool":{for(const l of a){if(l.type==="tool-approval-response")continue;const u=l.output;let c;switch(u.type){case"text":case"error-text":c=u.value;break;case"execution-denied":c=(n=u.reason)!=null?n:"Tool execution denied.";break;case"content":case"json":case"error-json":c=JSON.stringify(u.value);break}r.push({role:"tool",tool_call_id:l.toolCallId,content:c})}break}default:{const l=s;throw new Error(`Unsupported role: ${l}`)}}return{messages:r,warnings:o}}i(XP,"convertToOpenAIChatMessages");function Jd({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n?new Date(n*1e3):void 0}}i(Jd,"getResponseMetadata$1");function Zw(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}i(Zw,"mapOpenAIFinishReason");var QP=ne(()=>te(b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({message:b({role:k("assistant").nullish(),content:m().nullish(),tool_calls:M(b({id:m().nullish(),type:k("function"),function:b({name:m(),arguments:m()})})).nullish(),annotations:M(b({type:k("url_citation"),url_citation:b({start_index:A(),end_index:A(),url:m(),title:m()})})).nullish()}),index:A(),logprobs:b({content:M(b({token:m(),logprob:A(),top_logprobs:M(b({token:m(),logprob:A()}))})).nullish()}).nullish(),finish_reason:m().nullish()})),usage:b({prompt_tokens:A().nullish(),completion_tokens:A().nullish(),total_tokens:A().nullish(),prompt_tokens_details:b({cached_tokens:A().nullish()}).nullish(),completion_tokens_details:b({reasoning_tokens:A().nullish(),accepted_prediction_tokens:A().nullish(),rejected_prediction_tokens:A().nullish()}).nullish()}).nullish()}))),eM=ne(()=>te(se([b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({delta:b({role:fe(["assistant"]).nullish(),content:m().nullish(),tool_calls:M(b({index:A(),id:m().nullish(),type:k("function").nullish(),function:b({name:m().nullish(),arguments:m().nullish()})})).nullish(),annotations:M(b({type:k("url_citation"),url_citation:b({start_index:A(),end_index:A(),url:m(),title:m()})})).nullish()}).nullish(),logprobs:b({content:M(b({token:m(),logprob:A(),top_logprobs:M(b({token:m(),logprob:A()}))})).nullish()}).nullish(),finish_reason:m().nullish(),index:A()})),usage:b({prompt_tokens:A().nullish(),completion_tokens:A().nullish(),total_tokens:A().nullish(),prompt_tokens_details:b({cached_tokens:A().nullish()}).nullish(),completion_tokens_details:b({reasoning_tokens:A().nullish(),accepted_prediction_tokens:A().nullish(),rejected_prediction_tokens:A().nullish()}).nullish()}).nullish()}),Hd]))),tM=ne(()=>te(b({logitBias:Ae(aR(),A()).optional(),logprobs:se([qe(),A()]).optional(),parallelToolCalls:qe().optional(),user:m().optional(),reasoningEffort:fe(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:A().optional(),store:qe().optional(),metadata:Ae(m().max(64),m().max(512)).optional(),prediction:Ae(m(),ft()).optional(),serviceTier:fe(["auto","flex","priority","default"]).optional(),strictJsonSchema:qe().optional(),textVerbosity:fe(["low","medium","high"]).optional(),promptCacheKey:m().optional(),promptCacheRetention:fe(["in_memory","24h"]).optional(),safetyIdentifier:m().optional(),systemMessageMode:fe(["system","developer","remove"]).optional(),forceReasoning:qe().optional()})));function nM({tools:e,toolChoice:t}){e=e?.length?e:void 0;const n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const s of e)switch(s.type){case"function":r.push({type:"function",function:{name:s.name,description:s.description,parameters:s.inputSchema,...s.strict!=null?{strict:s.strict}:{}}});break;default:n.push({type:"unsupported",feature:`tool type: ${s.type}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const o=t.type;switch(o){case"auto":case"none":case"required":return{tools:r,toolChoice:o,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:{const s=o;throw new pt({functionality:`tool choice type: ${s}`})}}}i(nM,"prepareChatTools");var rM=(Zo=class{constructor(t,n){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=t,this.config=n}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:n,temperature:r,topP:o,topK:s,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d,tools:p,toolChoice:h,providerOptions:g}){var f,y,v,_,w;const D=[],E=(f=await mt({provider:"openai",providerOptions:g,schema:tM}))!=null?f:{},I=Vw(this.modelId),T=(y=E.forceReasoning)!=null?y:I.isReasoningModel;s!=null&&D.push({type:"unsupported",feature:"topK"});const{messages:$,warnings:x}=XP({prompt:t,systemMessageMode:(v=E.systemMessageMode)!=null?v:T?"developer":I.systemMessageMode});D.push(...x);const j=(_=E.strictJsonSchema)!=null?_:!0,S={model:this.modelId,logit_bias:E.logitBias,logprobs:E.logprobs===!0||typeof E.logprobs=="number"?!0:void 0,top_logprobs:typeof E.logprobs=="number"?E.logprobs:typeof E.logprobs=="boolean"&&E.logprobs?0:void 0,user:E.user,parallel_tool_calls:E.parallelToolCalls,max_tokens:n,temperature:r,top_p:o,frequency_penalty:a,presence_penalty:l,response_format:c?.type==="json"?c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,strict:j,name:(w=c.name)!=null?w:"response",description:c.description}}:{type:"json_object"}:void 0,stop:u,seed:d,verbosity:E.textVerbosity,max_completion_tokens:E.maxCompletionTokens,store:E.store,metadata:E.metadata,prediction:E.prediction,reasoning_effort:E.reasoningEffort,service_tier:E.serviceTier,prompt_cache_key:E.promptCacheKey,prompt_cache_retention:E.promptCacheRetention,safety_identifier:E.safetyIdentifier,messages:$};T?((E.reasoningEffort!=="none"||!I.supportsNonReasoningParameters)&&(S.temperature!=null&&(S.temperature=void 0,D.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),S.top_p!=null&&(S.top_p=void 0,D.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"})),S.logprobs!=null&&(S.logprobs=void 0,D.push({type:"other",message:"logprobs is not supported for reasoning models"}))),S.frequency_penalty!=null&&(S.frequency_penalty=void 0,D.push({type:"unsupported",feature:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),S.presence_penalty!=null&&(S.presence_penalty=void 0,D.push({type:"unsupported",feature:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),S.logit_bias!=null&&(S.logit_bias=void 0,D.push({type:"other",message:"logitBias is not supported for reasoning models"})),S.top_logprobs!=null&&(S.top_logprobs=void 0,D.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),S.max_tokens!=null&&(S.max_completion_tokens==null&&(S.max_completion_tokens=S.max_tokens),S.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&S.temperature!=null&&(S.temperature=void 0,D.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),E.serviceTier==="flex"&&!I.supportsFlexProcessing&&(D.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),S.service_tier=void 0),E.serviceTier==="priority"&&!I.supportsPriorityProcessing&&(D.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),S.service_tier=void 0);const{tools:Z,toolChoice:R,toolWarnings:B}=nM({tools:p,toolChoice:h});return{args:{...S,tools:Z,tool_choice:R},warnings:[...D,...B]}}async doGenerate(t){var n,r,o,s,a,l,u;const{args:c,warnings:d}=await this.getArgs(t),{responseHeaders:p,value:h,rawValue:g}=await Qe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:c,failedResponseHandler:rn,successfulResponseHandler:ut(QP),abortSignal:t.abortSignal,fetch:this.config.fetch}),f=h.choices[0],y=[],v=f.message.content;v!=null&&v.length>0&&y.push({type:"text",text:v});for(const D of(n=f.message.tool_calls)!=null?n:[])y.push({type:"tool-call",toolCallId:(r=D.id)!=null?r:ot(),toolName:D.function.name,input:D.function.arguments});for(const D of(o=f.message.annotations)!=null?o:[])y.push({type:"source",sourceType:"url",id:ot(),url:D.url_citation.url,title:D.url_citation.title});const _=(s=h.usage)==null?void 0:s.completion_tokens_details;(a=h.usage)==null||a.prompt_tokens_details;const w={openai:{}};return _?.accepted_prediction_tokens!=null&&(w.openai.acceptedPredictionTokens=_?.accepted_prediction_tokens),_?.rejected_prediction_tokens!=null&&(w.openai.rejectedPredictionTokens=_?.rejected_prediction_tokens),((l=f.logprobs)==null?void 0:l.content)!=null&&(w.openai.logprobs=f.logprobs.content),{content:y,finishReason:{unified:Zw(f.finish_reason),raw:(u=f.finish_reason)!=null?u:void 0},usage:Gw(h.usage),request:{body:c},response:{...Jd(h),headers:p,body:g},warnings:d,providerMetadata:w}}async doStream(t){const{args:n,warnings:r}=await this.getArgs(t),o={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:a}=await Qe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:o,failedResponseHandler:rn,successfulResponseHandler:Xr(eM),abortSignal:t.abortSignal,fetch:this.config.fetch}),l=[];let u={unified:"other",raw:void 0},c,d=!1,p=!1;const h={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(g){g.enqueue({type:"stream-start",warnings:r})},transform(g,f){var y,v,_,w,D,E,I,T,$,x,j,S,Z,R,B,P,L;if(t.includeRawChunks&&f.enqueue({type:"raw",rawValue:g.rawValue}),!g.success){u={unified:"error",raw:void 0},f.enqueue({type:"error",error:g.error});return}const N=g.value;if("error"in N){u={unified:"error",raw:void 0},f.enqueue({type:"error",error:N.error});return}if(!d){const re=Jd(N);Object.values(re).some(Boolean)&&(d=!0,f.enqueue({type:"response-metadata",...Jd(N)}))}N.usage!=null&&(c=N.usage,((y=N.usage.completion_tokens_details)==null?void 0:y.accepted_prediction_tokens)!=null&&(h.openai.acceptedPredictionTokens=(v=N.usage.completion_tokens_details)==null?void 0:v.accepted_prediction_tokens),((_=N.usage.completion_tokens_details)==null?void 0:_.rejected_prediction_tokens)!=null&&(h.openai.rejectedPredictionTokens=(w=N.usage.completion_tokens_details)==null?void 0:w.rejected_prediction_tokens));const J=N.choices[0];if(J?.finish_reason!=null&&(u={unified:Zw(J.finish_reason),raw:J.finish_reason}),((D=J?.logprobs)==null?void 0:D.content)!=null&&(h.openai.logprobs=J.logprobs.content),J?.delta==null)return;const ve=J.delta;if(ve.content!=null&&(p||(f.enqueue({type:"text-start",id:"0"}),p=!0),f.enqueue({type:"text-delta",id:"0",delta:ve.content})),ve.tool_calls!=null)for(const re of ve.tool_calls){const le=re.index;if(l[le]==null){if(re.type!=="function")throw new Zs({data:re,message:"Expected 'function' type."});if(re.id==null)throw new Zs({data:re,message:"Expected 'id' to be a string."});if(((E=re.function)==null?void 0:E.name)==null)throw new Zs({data:re,message:"Expected 'function.name' to be a string."});f.enqueue({type:"tool-input-start",id:re.id,toolName:re.function.name}),l[le]={id:re.id,type:"function",function:{name:re.function.name,arguments:(I=re.function.arguments)!=null?I:""},hasFinished:!1};const X=l[le];((T=X.function)==null?void 0:T.name)!=null&&(($=X.function)==null?void 0:$.arguments)!=null&&(X.function.arguments.length>0&&f.enqueue({type:"tool-input-delta",id:X.id,delta:X.function.arguments}),dl(X.function.arguments)&&(f.enqueue({type:"tool-input-end",id:X.id}),f.enqueue({type:"tool-call",toolCallId:(x=X.id)!=null?x:ot(),toolName:X.function.name,input:X.function.arguments}),X.hasFinished=!0));continue}const _e=l[le];_e.hasFinished||(((j=re.function)==null?void 0:j.arguments)!=null&&(_e.function.arguments+=(Z=(S=re.function)==null?void 0:S.arguments)!=null?Z:""),f.enqueue({type:"tool-input-delta",id:_e.id,delta:(R=re.function.arguments)!=null?R:""}),((B=_e.function)==null?void 0:B.name)!=null&&((P=_e.function)==null?void 0:P.arguments)!=null&&dl(_e.function.arguments)&&(f.enqueue({type:"tool-input-end",id:_e.id}),f.enqueue({type:"tool-call",toolCallId:(L=_e.id)!=null?L:ot(),toolName:_e.function.name,input:_e.function.arguments}),_e.hasFinished=!0))}if(ve.annotations!=null)for(const re of ve.annotations)f.enqueue({type:"source",sourceType:"url",id:ot(),url:re.url_citation.url,title:re.url_citation.title})},flush(g){p&&g.enqueue({type:"text-end",id:"0"}),g.enqueue({type:"finish",finishReason:u,usage:Gw(c),...h!=null?{providerMetadata:h}:{}})}})),request:{body:o},response:{headers:s}}}},i(Zo,"OpenAIChatLanguageModel"),Zo);function Ww(e){var t,n,r,o;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const s=(t=e.prompt_tokens)!=null?t:0,a=(n=e.completion_tokens)!=null?n:0;return{inputTokens:{total:(r=e.prompt_tokens)!=null?r:void 0,noCache:s,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:(o=e.completion_tokens)!=null?o:void 0,text:a,reasoning:void 0},raw:e}}i(Ww,"convertOpenAICompletionUsage");function oM({prompt:e,user:t="user",assistant:n="assistant"}){let r="";e[0].role==="system"&&(r+=`${e[0].content}

`,e=e.slice(1));for(const{role:o,content:s}of e)switch(o){case"system":throw new Rn({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const a=s.map(l=>{switch(l.type){case"text":return l.text}}).filter(Boolean).join("");r+=`${t}:
${a}

`;break}case"assistant":{const a=s.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new pt({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${a}

`;break}case"tool":throw new pt({functionality:"tool messages"});default:{const a=o;throw new Error(`Unsupported role: ${a}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}i(oM,"convertToOpenAICompletionPrompt");function Hw({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}i(Hw,"getResponseMetadata2$1");function Jw(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}i(Jw,"mapOpenAIFinishReason2");var sM=ne(()=>te(b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({text:m(),finish_reason:m(),logprobs:b({tokens:M(m()),token_logprobs:M(A()),top_logprobs:M(Ae(m(),A())).nullish()}).nullish()})),usage:b({prompt_tokens:A(),completion_tokens:A(),total_tokens:A()}).nullish()}))),iM=ne(()=>te(se([b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({text:m(),finish_reason:m().nullish(),index:A(),logprobs:b({tokens:M(m()),token_logprobs:M(A()),top_logprobs:M(Ae(m(),A())).nullish()}).nullish()})),usage:b({prompt_tokens:A(),completion_tokens:A(),total_tokens:A()}).nullish()}),Hd]))),Kw=ne(()=>te(b({echo:qe().optional(),logitBias:Ae(m(),A()).optional(),suffix:m().optional(),user:m().optional(),logprobs:se([qe(),A()]).optional()}))),aM=(Wo=class{constructor(t,n){this.specificationVersion="v3",this.supportedUrls={},this.modelId=t,this.config=n}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:n,temperature:r,topP:o,topK:s,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:c,tools:d,toolChoice:p,seed:h,providerOptions:g}){const f=[],y={...await mt({provider:"openai",providerOptions:g,schema:Kw}),...await mt({provider:this.providerOptionsName,providerOptions:g,schema:Kw})};s!=null&&f.push({type:"unsupported",feature:"topK"}),d?.length&&f.push({type:"unsupported",feature:"tools"}),p!=null&&f.push({type:"unsupported",feature:"toolChoice"}),c!=null&&c.type!=="text"&&f.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:v,stopSequences:_}=oM({prompt:t}),w=[..._??[],...u??[]];return{args:{model:this.modelId,echo:y.echo,logit_bias:y.logitBias,logprobs:y?.logprobs===!0?0:y?.logprobs===!1?void 0:y?.logprobs,suffix:y.suffix,user:y.user,max_tokens:n,temperature:r,top_p:o,frequency_penalty:a,presence_penalty:l,seed:h,prompt:v,stop:w.length>0?w:void 0},warnings:f}}async doGenerate(t){var n;const{args:r,warnings:o}=await this.getArgs(t),{responseHeaders:s,value:a,rawValue:l}=await Qe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:r,failedResponseHandler:rn,successfulResponseHandler:ut(sM),abortSignal:t.abortSignal,fetch:this.config.fetch}),u=a.choices[0],c={openai:{}};return u.logprobs!=null&&(c.openai.logprobs=u.logprobs),{content:[{type:"text",text:u.text}],usage:Ww(a.usage),finishReason:{unified:Jw(u.finish_reason),raw:(n=u.finish_reason)!=null?n:void 0},request:{body:r},response:{...Hw(a),headers:s,body:l},providerMetadata:c,warnings:o}}async doStream(t){const{args:n,warnings:r}=await this.getArgs(t),o={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:a}=await Qe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:o,failedResponseHandler:rn,successfulResponseHandler:Xr(iM),abortSignal:t.abortSignal,fetch:this.config.fetch});let l={unified:"other",raw:void 0};const u={openai:{}};let c,d=!0;return{stream:a.pipeThrough(new TransformStream({start(p){p.enqueue({type:"stream-start",warnings:r})},transform(p,h){if(t.includeRawChunks&&h.enqueue({type:"raw",rawValue:p.rawValue}),!p.success){l={unified:"error",raw:void 0},h.enqueue({type:"error",error:p.error});return}const g=p.value;if("error"in g){l={unified:"error",raw:void 0},h.enqueue({type:"error",error:g.error});return}d&&(d=!1,h.enqueue({type:"response-metadata",...Hw(g)}),h.enqueue({type:"text-start",id:"0"})),g.usage!=null&&(c=g.usage);const f=g.choices[0];f?.finish_reason!=null&&(l={unified:Jw(f.finish_reason),raw:f.finish_reason}),f?.logprobs!=null&&(u.openai.logprobs=f.logprobs),f?.text!=null&&f.text.length>0&&h.enqueue({type:"text-delta",id:"0",delta:f.text})},flush(p){d||p.enqueue({type:"text-end",id:"0"}),p.enqueue({type:"finish",finishReason:l,providerMetadata:u,usage:Ww(c)})}})),request:{body:o},response:{headers:s}}}},i(Wo,"OpenAICompletionLanguageModel"),Wo),lM=ne(()=>te(b({dimensions:A().optional(),user:m().optional()}))),uM=ne(()=>te(b({data:M(b({embedding:M(A())})),usage:b({prompt_tokens:A()}).nullish()}))),cM=(Ho=class{constructor(t,n){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=t,this.config=n}get provider(){return this.config.provider}async doEmbed({values:t,headers:n,abortSignal:r,providerOptions:o}){var s;if(t.length>this.maxEmbeddingsPerCall)throw new p0({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const a=(s=await mt({provider:"openai",providerOptions:o,schema:lM}))!=null?s:{},{responseHeaders:l,value:u,rawValue:c}=await Qe({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Ve(this.config.headers(),n),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:a.dimensions,user:a.user},failedResponseHandler:rn,successfulResponseHandler:ut(uM),abortSignal:r,fetch:this.config.fetch});return{warnings:[],embeddings:u.data.map(d=>d.embedding),usage:u.usage?{tokens:u.usage.prompt_tokens}:void 0,response:{headers:l,body:c}}}},i(Ho,"OpenAIEmbeddingModel"),Ho),Yw=ne(()=>te(b({created:A().nullish(),data:M(b({b64_json:m(),revised_prompt:m().nullish()})),background:m().nullish(),output_format:m().nullish(),size:m().nullish(),quality:m().nullish(),usage:b({input_tokens:A().nullish(),output_tokens:A().nullish(),total_tokens:A().nullish(),input_tokens_details:b({image_tokens:A().nullish(),text_tokens:A().nullish()}).nullish()}).nullish()}))),dM={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},pM=["gpt-image-1-mini","gpt-image-1.5","gpt-image-1"];function fM(e){return pM.some(t=>e.startsWith(t))}i(fM,"hasDefaultResponseFormat");var mM=(Jo=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3"}get maxImagesPerCall(){var t;return(t=dM[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:t,files:n,mask:r,n:o,size:s,aspectRatio:a,seed:l,providerOptions:u,headers:c,abortSignal:d}){var p,h,g,f,y,v,_,w,D,E,I;const T=[];a!=null&&T.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),l!=null&&T.push({type:"unsupported",feature:"seed"});const $=(g=(h=(p=this.config._internal)==null?void 0:p.currentDate)==null?void 0:h.call(p))!=null?g:new Date;if(n!=null){const{value:S,responseHeaders:Z}=await Cd({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:Ve(this.config.headers(),c),formData:b_({model:this.modelId,prompt:t,image:await Promise.all(n.map(R=>R.type==="file"?new Blob([R.data instanceof Uint8Array?new Blob([R.data],{type:R.mediaType}):new Blob([gr(R.data)],{type:R.mediaType})],{type:R.mediaType}):gd(R.url))),mask:r!=null?await hM(r):void 0,n:o,size:s,...(f=u.openai)!=null?f:{}}),failedResponseHandler:rn,successfulResponseHandler:ut(Yw),abortSignal:d,fetch:this.config.fetch});return{images:S.data.map(R=>R.b64_json),warnings:T,usage:S.usage!=null?{inputTokens:(y=S.usage.input_tokens)!=null?y:void 0,outputTokens:(v=S.usage.output_tokens)!=null?v:void 0,totalTokens:(_=S.usage.total_tokens)!=null?_:void 0}:void 0,response:{timestamp:$,modelId:this.modelId,headers:Z},providerMetadata:{openai:{images:S.data.map((R,B)=>{var P,L,N,J,ve,re;return{...R.revised_prompt?{revisedPrompt:R.revised_prompt}:{},created:(P=S.created)!=null?P:void 0,size:(L=S.size)!=null?L:void 0,quality:(N=S.quality)!=null?N:void 0,background:(J=S.background)!=null?J:void 0,outputFormat:(ve=S.output_format)!=null?ve:void 0,...Xw((re=S.usage)==null?void 0:re.input_tokens_details,B,S.data.length)}})}}}}const{value:x,responseHeaders:j}=await Qe({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Ve(this.config.headers(),c),body:{model:this.modelId,prompt:t,n:o,size:s,...(w=u.openai)!=null?w:{},...fM(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:rn,successfulResponseHandler:ut(Yw),abortSignal:d,fetch:this.config.fetch});return{images:x.data.map(S=>S.b64_json),warnings:T,usage:x.usage!=null?{inputTokens:(D=x.usage.input_tokens)!=null?D:void 0,outputTokens:(E=x.usage.output_tokens)!=null?E:void 0,totalTokens:(I=x.usage.total_tokens)!=null?I:void 0}:void 0,response:{timestamp:$,modelId:this.modelId,headers:j},providerMetadata:{openai:{images:x.data.map((S,Z)=>{var R,B,P,L,N,J;return{...S.revised_prompt?{revisedPrompt:S.revised_prompt}:{},created:(R=x.created)!=null?R:void 0,size:(B=x.size)!=null?B:void 0,quality:(P=x.quality)!=null?P:void 0,background:(L=x.background)!=null?L:void 0,outputFormat:(N=x.output_format)!=null?N:void 0,...Xw((J=x.usage)==null?void 0:J.input_tokens_details,Z,x.data.length)}})}}}}},i(Jo,"OpenAIImageModel"),Jo);function Xw(e,t,n){if(e==null)return{};const r={};if(e.image_tokens!=null){const o=Math.floor(e.image_tokens/n),s=e.image_tokens-o*(n-1);r.imageTokens=t===n-1?s:o}if(e.text_tokens!=null){const o=Math.floor(e.text_tokens/n),s=e.text_tokens-o*(n-1);r.textTokens=t===n-1?s:o}return r}i(Xw,"distributeTokenDetails");async function hM(e){if(!e)return;if(e.type==="url")return gd(e.url);const t=e.data instanceof Uint8Array?e.data:gr(e.data);return new Blob([t],{type:e.mediaType})}i(hM,"fileToBlob$1");var Qw=ne(()=>te(b({callId:m(),operation:Ce("type",[b({type:k("create_file"),path:m(),diff:m()}),b({type:k("delete_file"),path:m()}),b({type:k("update_file"),path:m(),diff:m()})])}))),e1=ne(()=>te(b({status:fe(["completed","failed"]),output:m().optional()}))),gM=tn({id:"openai.apply_patch",inputSchema:Qw,outputSchema:e1}),yM=gM,vM=ne(()=>te(b({code:m().nullish(),containerId:m()}))),_M=ne(()=>te(b({outputs:M(Ce("type",[b({type:k("logs"),logs:m()}),b({type:k("image"),url:m()})])).nullish()}))),bM=ne(()=>te(b({container:se([m(),b({fileIds:M(m()).optional()})]).optional()}))),wM=tn({id:"openai.code_interpreter",inputSchema:vM,outputSchema:_M}),DM=i((e={})=>wM(e),"codeInterpreter"),t1=b({key:m(),type:fe(["eq","ne","gt","gte","lt","lte","in","nin"]),value:se([m(),A(),qe(),M(m())])}),n1=b({type:fe(["and","or"]),filters:M(se([t1,sd(()=>n1)]))}),EM=ne(()=>te(b({vectorStoreIds:M(m()),maxNumResults:A().optional(),ranking:b({ranker:m().optional(),scoreThreshold:A().optional()}).optional(),filters:se([t1,n1]).optional()}))),CM=ne(()=>te(b({queries:M(m()),results:M(b({attributes:Ae(m(),$t()),fileId:m(),filename:m(),score:A(),text:m()})).nullable()}))),$M=tn({id:"openai.file_search",inputSchema:b({}),outputSchema:CM}),xM=ne(()=>te(b({background:fe(["auto","opaque","transparent"]).optional(),inputFidelity:fe(["low","high"]).optional(),inputImageMask:b({fileId:m().optional(),imageUrl:m().optional()}).optional(),model:m().optional(),moderation:fe(["auto"]).optional(),outputCompression:A().int().min(0).max(100).optional(),outputFormat:fe(["png","jpeg","webp"]).optional(),partialImages:A().int().min(0).max(3).optional(),quality:fe(["auto","low","medium","high"]).optional(),size:fe(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),SM=ne(()=>te(b({}))),kM=ne(()=>te(b({result:m()}))),IM=tn({id:"openai.image_generation",inputSchema:SM,outputSchema:kM}),AM=i((e={})=>IM(e),"imageGeneration"),r1=ne(()=>te(b({action:b({type:k("exec"),command:M(m()),timeoutMs:A().optional(),user:m().optional(),workingDirectory:m().optional(),env:Ae(m(),m()).optional()})}))),o1=ne(()=>te(b({output:m()}))),TM=tn({id:"openai.local_shell",inputSchema:r1,outputSchema:o1}),s1=ne(()=>te(b({action:b({commands:M(m()),timeoutMs:A().optional(),maxOutputLength:A().optional()})}))),Kd=ne(()=>te(b({output:M(b({stdout:m(),stderr:m(),outcome:Ce("type",[b({type:k("timeout")}),b({type:k("exit"),exitCode:A()})])}))}))),FM=M(Ce("type",[b({type:k("skillReference"),skillId:m(),version:m().optional()}),b({type:k("inline"),name:m(),description:m(),source:b({type:k("base64"),mediaType:k("application/zip"),data:m()})})])).optional(),OM=ne(()=>te(b({environment:se([b({type:k("containerAuto"),fileIds:M(m()).optional(),memoryLimit:fe(["1g","4g","16g","64g"]).optional(),networkPolicy:Ce("type",[b({type:k("disabled")}),b({type:k("allowlist"),allowedDomains:M(m()),domainSecrets:M(b({domain:m(),name:m(),value:m()})).optional()})]).optional(),skills:FM}),b({type:k("containerReference"),containerId:m()}),b({type:k("local").optional(),skills:M(b({name:m(),description:m(),path:m()})).optional()})]).optional()}))),RM=tn({id:"openai.shell",inputSchema:s1,outputSchema:Kd}),PM=ne(()=>te(b({externalWebAccess:qe().optional(),filters:b({allowedDomains:M(m()).optional()}).optional(),searchContextSize:fe(["low","medium","high"]).optional(),userLocation:b({type:k("approximate"),country:m().optional(),city:m().optional(),region:m().optional(),timezone:m().optional()}).optional()}))),MM=ne(()=>te(b({}))),NM=ne(()=>te(b({action:Ce("type",[b({type:k("search"),query:m().optional()}),b({type:k("openPage"),url:m().nullish()}),b({type:k("findInPage"),url:m().nullish(),pattern:m().nullish()})]),sources:M(Ce("type",[b({type:k("url"),url:m()}),b({type:k("api"),name:m()})])).optional()}))),BM=tn({id:"openai.web_search",inputSchema:MM,outputSchema:NM}),jM=i((e={})=>BM(e),"webSearch"),LM=ne(()=>te(b({searchContextSize:fe(["low","medium","high"]).optional(),userLocation:b({type:k("approximate"),country:m().optional(),city:m().optional(),region:m().optional(),timezone:m().optional()}).optional()}))),UM=ne(()=>te(b({}))),zM=ne(()=>te(b({action:Ce("type",[b({type:k("search"),query:m().optional()}),b({type:k("openPage"),url:m().nullish()}),b({type:k("findInPage"),url:m().nullish(),pattern:m().nullish()})])}))),qM=tn({id:"openai.web_search_preview",inputSchema:UM,outputSchema:zM}),Yd=sd(()=>se([m(),A(),qe(),o_(),M(Yd),Ae(m(),Yd)])),VM=ne(()=>te(b({serverLabel:m(),allowedTools:se([M(m()),b({readOnly:qe().optional(),toolNames:M(m()).optional()})]).optional(),authorization:m().optional(),connectorId:m().optional(),headers:Ae(m(),m()).optional(),requireApproval:se([fe(["always","never"]),b({never:b({toolNames:M(m()).optional()}).optional()})]).optional(),serverDescription:m().optional(),serverUrl:m().optional()}).refine(e=>e.serverUrl!=null||e.connectorId!=null,"One of serverUrl or connectorId must be provided."))),GM=ne(()=>te(b({}))),ZM=ne(()=>te(b({type:k("call"),serverLabel:m(),name:m(),arguments:m(),output:m().nullish(),error:se([m(),Yd]).optional()}))),WM=tn({id:"openai.mcp",inputSchema:GM,outputSchema:ZM}),HM=i(e=>WM(e),"mcp"),JM={applyPatch:yM,codeInterpreter:DM,fileSearch:$M,imageGeneration:AM,localShell:TM,shell:RM,webSearchPreview:qM,webSearch:jM,mcp:HM};function i1(e){var t,n,r,o;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const s=e.input_tokens,a=e.output_tokens,l=(n=(t=e.input_tokens_details)==null?void 0:t.cached_tokens)!=null?n:0,u=(o=(r=e.output_tokens_details)==null?void 0:r.reasoning_tokens)!=null?o:0;return{inputTokens:{total:s,noCache:s-l,cacheRead:l,cacheWrite:void 0},outputTokens:{total:a,text:a-u,reasoning:u},raw:e}}i(i1,"convertOpenAIResponsesUsage");function a1(e,t){return t?t.some(n=>e.startsWith(n)):!1}i(a1,"isFileId");async function KM({prompt:e,toolNameMapping:t,systemMessageMode:n,providerOptionsName:r,fileIdPrefixes:o,store:s,hasConversation:a=!1,hasLocalShellTool:l=!1,hasShellTool:u=!1,hasApplyPatchTool:c=!1}){var d,p,h,g,f,y,v,_,w,D,E,I,T;const $=[],x=[],j=new Set;for(const{role:S,content:Z}of e)switch(S){case"system":{switch(n){case"system":{$.push({role:"system",content:Z});break}case"developer":{$.push({role:"developer",content:Z});break}case"remove":{x.push({type:"other",message:"system messages are removed for this model"});break}default:{const R=n;throw new Error(`Unsupported system message mode: ${R}`)}}break}case"user":{$.push({role:"user",content:Z.map((R,B)=>{var P,L,N;switch(R.type){case"text":return{type:"input_text",text:R.text};case"file":if(R.mediaType.startsWith("image/")){const J=R.mediaType==="image/*"?"image/jpeg":R.mediaType;return{type:"input_image",...R.data instanceof URL?{image_url:R.data.toString()}:typeof R.data=="string"&&a1(R.data,o)?{file_id:R.data}:{image_url:`data:${J};base64,${$n(R.data)}`},detail:(L=(P=R.providerOptions)==null?void 0:P[r])==null?void 0:L.imageDetail}}else{if(R.mediaType==="application/pdf")return R.data instanceof URL?{type:"input_file",file_url:R.data.toString()}:{type:"input_file",...typeof R.data=="string"&&a1(R.data,o)?{file_id:R.data}:{filename:(N=R.filename)!=null?N:`part-${B}.pdf`,file_data:`data:application/pdf;base64,${$n(R.data)}`}};throw new pt({functionality:`file part media type ${R.mediaType}`})}}})});break}case"assistant":{const R={};for(const B of Z)switch(B.type){case"text":{const P=(p=(d=B.providerOptions)==null?void 0:d[r])==null?void 0:p.itemId;if(a&&P!=null)break;if(s&&P!=null){$.push({type:"item_reference",id:P});break}$.push({role:"assistant",content:[{type:"output_text",text:B.text}],id:P});break}case"tool-call":{const P=(v=(g=(h=B.providerOptions)==null?void 0:h[r])==null?void 0:g.itemId)!=null?v:(y=(f=B.providerMetadata)==null?void 0:f[r])==null?void 0:y.itemId;if(a&&P!=null)break;if(B.providerExecuted){s&&P!=null&&$.push({type:"item_reference",id:P});break}if(s&&P!=null){$.push({type:"item_reference",id:P});break}const L=t.toProviderToolName(B.toolName);if(l&&L==="local_shell"){const N=await gt({value:B.input,schema:r1});$.push({type:"local_shell_call",call_id:B.toolCallId,id:P,action:{type:"exec",command:N.action.command,timeout_ms:N.action.timeoutMs,user:N.action.user,working_directory:N.action.workingDirectory,env:N.action.env}});break}if(u&&L==="shell"){const N=await gt({value:B.input,schema:s1});$.push({type:"shell_call",call_id:B.toolCallId,id:P,status:"completed",action:{commands:N.action.commands,timeout_ms:N.action.timeoutMs,max_output_length:N.action.maxOutputLength}});break}if(c&&L==="apply_patch"){const N=await gt({value:B.input,schema:Qw});$.push({type:"apply_patch_call",call_id:N.callId,id:P,status:"completed",operation:N.operation});break}$.push({type:"function_call",call_id:B.toolCallId,name:L,arguments:JSON.stringify(B.input),id:P});break}case"tool-result":{if(B.output.type==="execution-denied"||B.output.type==="json"&&typeof B.output.value=="object"&&B.output.value!=null&&"type"in B.output.value&&B.output.value.type==="execution-denied"||a)break;const P=t.toProviderToolName(B.toolName);if(u&&P==="shell"){if(B.output.type==="json"){const L=await gt({value:B.output.value,schema:Kd});$.push({type:"shell_call_output",call_id:B.toolCallId,output:L.output.map(N=>({stdout:N.stdout,stderr:N.stderr,outcome:N.outcome.type==="timeout"?{type:"timeout"}:{type:"exit",exit_code:N.outcome.exitCode}}))})}break}if(s){const L=(D=(w=(_=B.providerOptions)==null?void 0:_[r])==null?void 0:w.itemId)!=null?D:B.toolCallId;$.push({type:"item_reference",id:L})}else x.push({type:"other",message:`Results for OpenAI tool ${B.toolName} are not sent to the API when store is false`});break}case"reasoning":{const P=await mt({provider:r,providerOptions:B.providerOptions,schema:YM}),L=P?.itemId;if(a&&L!=null)break;if(L!=null){const N=R[L];if(s)N===void 0&&($.push({type:"item_reference",id:L}),R[L]={type:"reasoning",id:L,summary:[]});else{const J=[];B.text.length>0?J.push({type:"summary_text",text:B.text}):N!==void 0&&x.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(B)}.`}),N===void 0?(R[L]={type:"reasoning",id:L,encrypted_content:P?.reasoningEncryptedContent,summary:J},$.push(R[L])):(N.summary.push(...J),P?.reasoningEncryptedContent!=null&&(N.encrypted_content=P.reasoningEncryptedContent))}}else x.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(B)}.`});break}}break}case"tool":{for(const R of Z){if(R.type==="tool-approval-response"){const N=R;if(j.has(N.approvalId))continue;j.add(N.approvalId),s&&$.push({type:"item_reference",id:N.approvalId}),$.push({type:"mcp_approval_response",approval_request_id:N.approvalId,approve:N.approved});continue}const B=R.output;if(B.type==="execution-denied"&&((I=(E=B.providerOptions)==null?void 0:E.openai)==null?void 0:I.approvalId))continue;const P=t.toProviderToolName(R.toolName);if(l&&P==="local_shell"&&B.type==="json"){const N=await gt({value:B.value,schema:o1});$.push({type:"local_shell_call_output",call_id:R.toolCallId,output:N.output});continue}if(u&&P==="shell"&&B.type==="json"){const N=await gt({value:B.value,schema:Kd});$.push({type:"shell_call_output",call_id:R.toolCallId,output:N.output.map(J=>({stdout:J.stdout,stderr:J.stderr,outcome:J.outcome.type==="timeout"?{type:"timeout"}:{type:"exit",exit_code:J.outcome.exitCode}}))});continue}if(c&&R.toolName==="apply_patch"&&B.type==="json"){const N=await gt({value:B.value,schema:e1});$.push({type:"apply_patch_call_output",call_id:R.toolCallId,status:N.status,output:N.output});continue}let L;switch(B.type){case"text":case"error-text":L=B.value;break;case"execution-denied":L=(T=B.reason)!=null?T:"Tool execution denied.";break;case"json":case"error-json":L=JSON.stringify(B.value);break;case"content":L=B.value.map(N=>{var J;switch(N.type){case"text":return{type:"input_text",text:N.text};case"image-data":return{type:"input_image",image_url:`data:${N.mediaType};base64,${N.data}`};case"image-url":return{type:"input_image",image_url:N.url};case"file-data":return{type:"input_file",filename:(J=N.filename)!=null?J:"data",file_data:`data:${N.mediaType};base64,${N.data}`};default:{x.push({type:"other",message:`unsupported tool content part type: ${N.type}`});return}}}).filter(GR);break}$.push({type:"function_call_output",call_id:R.toolCallId,output:L})}break}default:{const R=S;throw new Error(`Unsupported role: ${R}`)}}return{input:$,warnings:x}}i(KM,"convertToOpenAIResponsesInput");var YM=b({itemId:m().nullish(),reasoningEncryptedContent:m().nullish()});function l1({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"other"}}i(l1,"mapOpenAIResponseFinishReason");var XM=ne(()=>te(se([b({type:k("response.output_text.delta"),item_id:m(),delta:m(),logprobs:M(b({token:m(),logprob:A(),top_logprobs:M(b({token:m(),logprob:A()}))})).nullish()}),b({type:fe(["response.completed","response.incomplete"]),response:b({incomplete_details:b({reason:m()}).nullish(),usage:b({input_tokens:A(),input_tokens_details:b({cached_tokens:A().nullish()}).nullish(),output_tokens:A(),output_tokens_details:b({reasoning_tokens:A().nullish()}).nullish()}),service_tier:m().nullish()})}),b({type:k("response.created"),response:b({id:m(),created_at:A(),model:m(),service_tier:m().nullish()})}),b({type:k("response.output_item.added"),output_index:A(),item:Ce("type",[b({type:k("message"),id:m()}),b({type:k("reasoning"),id:m(),encrypted_content:m().nullish()}),b({type:k("function_call"),id:m(),call_id:m(),name:m(),arguments:m()}),b({type:k("web_search_call"),id:m(),status:m()}),b({type:k("computer_call"),id:m(),status:m()}),b({type:k("file_search_call"),id:m()}),b({type:k("image_generation_call"),id:m()}),b({type:k("code_interpreter_call"),id:m(),container_id:m(),code:m().nullable(),outputs:M(Ce("type",[b({type:k("logs"),logs:m()}),b({type:k("image"),url:m()})])).nullable(),status:m()}),b({type:k("mcp_call"),id:m(),status:m(),approval_request_id:m().nullish()}),b({type:k("mcp_list_tools"),id:m()}),b({type:k("mcp_approval_request"),id:m()}),b({type:k("apply_patch_call"),id:m(),call_id:m(),status:fe(["in_progress","completed"]),operation:Ce("type",[b({type:k("create_file"),path:m(),diff:m()}),b({type:k("delete_file"),path:m()}),b({type:k("update_file"),path:m(),diff:m()})])}),b({type:k("shell_call"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),action:b({commands:M(m())})}),b({type:k("shell_call_output"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),output:M(b({stdout:m(),stderr:m(),outcome:Ce("type",[b({type:k("timeout")}),b({type:k("exit"),exit_code:A()})])}))})])}),b({type:k("response.output_item.done"),output_index:A(),item:Ce("type",[b({type:k("message"),id:m()}),b({type:k("reasoning"),id:m(),encrypted_content:m().nullish()}),b({type:k("function_call"),id:m(),call_id:m(),name:m(),arguments:m(),status:k("completed")}),b({type:k("code_interpreter_call"),id:m(),code:m().nullable(),container_id:m(),outputs:M(Ce("type",[b({type:k("logs"),logs:m()}),b({type:k("image"),url:m()})])).nullable()}),b({type:k("image_generation_call"),id:m(),result:m()}),b({type:k("web_search_call"),id:m(),status:m(),action:Ce("type",[b({type:k("search"),query:m().nullish(),sources:M(Ce("type",[b({type:k("url"),url:m()}),b({type:k("api"),name:m()})])).nullish()}),b({type:k("open_page"),url:m().nullish()}),b({type:k("find_in_page"),url:m().nullish(),pattern:m().nullish()})])}),b({type:k("file_search_call"),id:m(),queries:M(m()),results:M(b({attributes:Ae(m(),se([m(),A(),qe()])),file_id:m(),filename:m(),score:A(),text:m()})).nullish()}),b({type:k("local_shell_call"),id:m(),call_id:m(),action:b({type:k("exec"),command:M(m()),timeout_ms:A().optional(),user:m().optional(),working_directory:m().optional(),env:Ae(m(),m()).optional()})}),b({type:k("computer_call"),id:m(),status:k("completed")}),b({type:k("mcp_call"),id:m(),status:m(),arguments:m(),name:m(),server_label:m(),output:m().nullish(),error:se([m(),b({type:m().optional(),code:se([A(),m()]).optional(),message:m().optional()}).loose()]).nullish(),approval_request_id:m().nullish()}),b({type:k("mcp_list_tools"),id:m(),server_label:m(),tools:M(b({name:m(),description:m().optional(),input_schema:ft(),annotations:Ae(m(),$t()).optional()})),error:se([m(),b({type:m().optional(),code:se([A(),m()]).optional(),message:m().optional()}).loose()]).optional()}),b({type:k("mcp_approval_request"),id:m(),server_label:m(),name:m(),arguments:m(),approval_request_id:m().optional()}),b({type:k("apply_patch_call"),id:m(),call_id:m(),status:fe(["in_progress","completed"]),operation:Ce("type",[b({type:k("create_file"),path:m(),diff:m()}),b({type:k("delete_file"),path:m()}),b({type:k("update_file"),path:m(),diff:m()})])}),b({type:k("shell_call"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),action:b({commands:M(m())})}),b({type:k("shell_call_output"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),output:M(b({stdout:m(),stderr:m(),outcome:Ce("type",[b({type:k("timeout")}),b({type:k("exit"),exit_code:A()})])}))})])}),b({type:k("response.function_call_arguments.delta"),item_id:m(),output_index:A(),delta:m()}),b({type:k("response.image_generation_call.partial_image"),item_id:m(),output_index:A(),partial_image_b64:m()}),b({type:k("response.code_interpreter_call_code.delta"),item_id:m(),output_index:A(),delta:m()}),b({type:k("response.code_interpreter_call_code.done"),item_id:m(),output_index:A(),code:m()}),b({type:k("response.output_text.annotation.added"),annotation:Ce("type",[b({type:k("url_citation"),start_index:A(),end_index:A(),url:m(),title:m()}),b({type:k("file_citation"),file_id:m(),filename:m(),index:A()}),b({type:k("container_file_citation"),container_id:m(),file_id:m(),filename:m(),start_index:A(),end_index:A()}),b({type:k("file_path"),file_id:m(),index:A()})])}),b({type:k("response.reasoning_summary_part.added"),item_id:m(),summary_index:A()}),b({type:k("response.reasoning_summary_text.delta"),item_id:m(),summary_index:A(),delta:m()}),b({type:k("response.reasoning_summary_part.done"),item_id:m(),summary_index:A()}),b({type:k("response.apply_patch_call_operation_diff.delta"),item_id:m(),output_index:A(),delta:m(),obfuscation:m().nullish()}),b({type:k("response.apply_patch_call_operation_diff.done"),item_id:m(),output_index:A(),diff:m()}),b({type:k("error"),sequence_number:A(),error:b({type:m(),code:m(),message:m(),param:m().nullish()})}),b({type:m()}).loose().transform(e=>({type:"unknown_chunk",message:e.type}))]))),QM=ne(()=>te(b({id:m().optional(),created_at:A().optional(),error:b({message:m(),type:m(),param:m().nullish(),code:m()}).nullish(),model:m().optional(),output:M(Ce("type",[b({type:k("message"),role:k("assistant"),id:m(),content:M(b({type:k("output_text"),text:m(),logprobs:M(b({token:m(),logprob:A(),top_logprobs:M(b({token:m(),logprob:A()}))})).nullish(),annotations:M(Ce("type",[b({type:k("url_citation"),start_index:A(),end_index:A(),url:m(),title:m()}),b({type:k("file_citation"),file_id:m(),filename:m(),index:A()}),b({type:k("container_file_citation"),container_id:m(),file_id:m(),filename:m(),start_index:A(),end_index:A()}),b({type:k("file_path"),file_id:m(),index:A()})]))}))}),b({type:k("web_search_call"),id:m(),status:m(),action:Ce("type",[b({type:k("search"),query:m().nullish(),sources:M(Ce("type",[b({type:k("url"),url:m()}),b({type:k("api"),name:m()})])).nullish()}),b({type:k("open_page"),url:m().nullish()}),b({type:k("find_in_page"),url:m().nullish(),pattern:m().nullish()})])}),b({type:k("file_search_call"),id:m(),queries:M(m()),results:M(b({attributes:Ae(m(),se([m(),A(),qe()])),file_id:m(),filename:m(),score:A(),text:m()})).nullish()}),b({type:k("code_interpreter_call"),id:m(),code:m().nullable(),container_id:m(),outputs:M(Ce("type",[b({type:k("logs"),logs:m()}),b({type:k("image"),url:m()})])).nullable()}),b({type:k("image_generation_call"),id:m(),result:m()}),b({type:k("local_shell_call"),id:m(),call_id:m(),action:b({type:k("exec"),command:M(m()),timeout_ms:A().optional(),user:m().optional(),working_directory:m().optional(),env:Ae(m(),m()).optional()})}),b({type:k("function_call"),call_id:m(),name:m(),arguments:m(),id:m()}),b({type:k("computer_call"),id:m(),status:m().optional()}),b({type:k("reasoning"),id:m(),encrypted_content:m().nullish(),summary:M(b({type:k("summary_text"),text:m()}))}),b({type:k("mcp_call"),id:m(),status:m(),arguments:m(),name:m(),server_label:m(),output:m().nullish(),error:se([m(),b({type:m().optional(),code:se([A(),m()]).optional(),message:m().optional()}).loose()]).nullish(),approval_request_id:m().nullish()}),b({type:k("mcp_list_tools"),id:m(),server_label:m(),tools:M(b({name:m(),description:m().optional(),input_schema:ft(),annotations:Ae(m(),$t()).optional()})),error:se([m(),b({type:m().optional(),code:se([A(),m()]).optional(),message:m().optional()}).loose()]).optional()}),b({type:k("mcp_approval_request"),id:m(),server_label:m(),name:m(),arguments:m(),approval_request_id:m().optional()}),b({type:k("apply_patch_call"),id:m(),call_id:m(),status:fe(["in_progress","completed"]),operation:Ce("type",[b({type:k("create_file"),path:m(),diff:m()}),b({type:k("delete_file"),path:m()}),b({type:k("update_file"),path:m(),diff:m()})])}),b({type:k("shell_call"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),action:b({commands:M(m())})}),b({type:k("shell_call_output"),id:m(),call_id:m(),status:fe(["in_progress","completed","incomplete"]),output:M(b({stdout:m(),stderr:m(),outcome:Ce("type",[b({type:k("timeout")}),b({type:k("exit"),exit_code:A()})])}))})])).optional(),service_tier:m().nullish(),incomplete_details:b({reason:m()}).nullish(),usage:b({input_tokens:A(),input_tokens_details:b({cached_tokens:A().nullish()}).nullish(),output_tokens:A(),output_tokens_details:b({reasoning_tokens:A().nullish()}).nullish()}).optional()}))),u1=20,c1=ne(()=>te(b({conversation:m().nullish(),include:M(fe(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:m().nullish(),logprobs:se([qe(),A().min(1).max(u1)]).optional(),maxToolCalls:A().nullish(),metadata:ft().nullish(),parallelToolCalls:qe().nullish(),previousResponseId:m().nullish(),promptCacheKey:m().nullish(),promptCacheRetention:fe(["in_memory","24h"]).nullish(),reasoningEffort:m().nullish(),reasoningSummary:m().nullish(),safetyIdentifier:m().nullish(),serviceTier:fe(["auto","flex","priority","default"]).nullish(),store:qe().nullish(),strictJsonSchema:qe().nullish(),textVerbosity:fe(["low","medium","high"]).nullish(),truncation:fe(["auto","disabled"]).nullish(),user:m().nullish(),systemMessageMode:fe(["system","developer","remove"]).optional(),forceReasoning:qe().optional()})));async function eN({tools:e,toolChoice:t}){e=e?.length?e:void 0;const n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const s of e)switch(s.type){case"function":r.push({type:"function",name:s.name,description:s.description,parameters:s.inputSchema,...s.strict!=null?{strict:s.strict}:{}});break;case"provider":{switch(s.id){case"openai.file_search":{const a=await gt({value:s.args,schema:EM});r.push({type:"file_search",vector_store_ids:a.vectorStoreIds,max_num_results:a.maxNumResults,ranking_options:a.ranking?{ranker:a.ranking.ranker,score_threshold:a.ranking.scoreThreshold}:void 0,filters:a.filters});break}case"openai.local_shell":{r.push({type:"local_shell"});break}case"openai.shell":{const a=await gt({value:s.args,schema:OM});r.push({type:"shell",...a.environment&&{environment:tN(a.environment)}});break}case"openai.apply_patch":{r.push({type:"apply_patch"});break}case"openai.web_search_preview":{const a=await gt({value:s.args,schema:LM});r.push({type:"web_search_preview",search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.web_search":{const a=await gt({value:s.args,schema:PM});r.push({type:"web_search",filters:a.filters!=null?{allowed_domains:a.filters.allowedDomains}:void 0,external_web_access:a.externalWebAccess,search_context_size:a.searchContextSize,user_location:a.userLocation});break}case"openai.code_interpreter":{const a=await gt({value:s.args,schema:bM});r.push({type:"code_interpreter",container:a.container==null?{type:"auto",file_ids:void 0}:typeof a.container=="string"?a.container:{type:"auto",file_ids:a.container.fileIds}});break}case"openai.image_generation":{const a=await gt({value:s.args,schema:xM});r.push({type:"image_generation",background:a.background,input_fidelity:a.inputFidelity,input_image_mask:a.inputImageMask?{file_id:a.inputImageMask.fileId,image_url:a.inputImageMask.imageUrl}:void 0,model:a.model,moderation:a.moderation,partial_images:a.partialImages,quality:a.quality,output_compression:a.outputCompression,output_format:a.outputFormat,size:a.size});break}case"openai.mcp":{const a=await gt({value:s.args,schema:VM}),l=i(d=>({tool_names:d.toolNames}),"mapApprovalFilter"),u=a.requireApproval,c=u==null?void 0:typeof u=="string"?u:u.never!=null?{never:l(u.never)}:void 0;r.push({type:"mcp",server_label:a.serverLabel,allowed_tools:Array.isArray(a.allowedTools)?a.allowedTools:a.allowedTools?{read_only:a.allowedTools.readOnly,tool_names:a.allowedTools.toolNames}:void 0,authorization:a.authorization,connector_id:a.connectorId,headers:a.headers,require_approval:c??"never",server_description:a.serverDescription,server_url:a.serverUrl});break}}break}default:n.push({type:"unsupported",feature:`function tool ${s}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const o=t.type;switch(o){case"auto":case"none":case"required":return{tools:r,toolChoice:o,toolWarnings:n};case"tool":return{tools:r,toolChoice:t.toolName==="code_interpreter"||t.toolName==="file_search"||t.toolName==="image_generation"||t.toolName==="web_search_preview"||t.toolName==="web_search"||t.toolName==="mcp"||t.toolName==="apply_patch"?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:n};default:{const s=o;throw new pt({functionality:`tool choice type: ${s}`})}}}i(eN,"prepareResponsesTools");function tN(e){if(e.type==="containerReference")return{type:"container_reference",container_id:e.containerId};if(e.type==="containerAuto"){const n=e;return{type:"container_auto",file_ids:n.fileIds,memory_limit:n.memoryLimit,network_policy:n.networkPolicy==null?void 0:n.networkPolicy.type==="disabled"?{type:"disabled"}:{type:"allowlist",allowed_domains:n.networkPolicy.allowedDomains,domain_secrets:n.networkPolicy.domainSecrets},skills:nN(n.skills)}}return{type:"local",skills:e.skills}}i(tN,"mapShellEnvironment");function nN(e){return e?.map(t=>t.type==="skillReference"?{type:"skill_reference",skill_id:t.skillId,version:t.version}:{type:"inline",name:t.name,description:t.description,source:{type:"base64",media_type:t.source.mediaType,data:t.source.data}})}i(nN,"mapShellSkills");function d1(e){var t,n;const r={};for(const o of e)if(o.role==="assistant")for(const s of o.content){if(s.type!=="tool-call")continue;const a=(n=(t=s.providerOptions)==null?void 0:t.openai)==null?void 0:n.approvalRequestId;a!=null&&(r[a]=s.toolCallId)}return r}i(d1,"extractApprovalRequestIdToToolCallIdMapping");var rN=(Ko=class{constructor(t,n){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=t,this.config=n}get provider(){return this.config.provider}async getArgs({maxOutputTokens:t,temperature:n,stopSequences:r,topP:o,topK:s,presencePenalty:a,frequencyPenalty:l,seed:u,prompt:c,providerOptions:d,tools:p,toolChoice:h,responseFormat:g}){var f,y,v,_,w,D,E,I,T;const $=[],x=Vw(this.modelId);s!=null&&$.push({type:"unsupported",feature:"topK"}),u!=null&&$.push({type:"unsupported",feature:"seed"}),a!=null&&$.push({type:"unsupported",feature:"presencePenalty"}),l!=null&&$.push({type:"unsupported",feature:"frequencyPenalty"}),r!=null&&$.push({type:"unsupported",feature:"stopSequences"});const j=this.config.provider.includes("azure")?"azure":"openai";let S=await mt({provider:j,providerOptions:d,schema:c1});S==null&&j!=="openai"&&(S=await mt({provider:"openai",providerOptions:d,schema:c1}));const Z=(f=S?.forceReasoning)!=null?f:x.isReasoningModel;S?.conversation&&S?.previousResponseId&&$.push({type:"unsupported",feature:"conversation",details:"conversation and previousResponseId cannot be used together"});const R=PR({tools:p,providerToolNames:{"openai.code_interpreter":"code_interpreter","openai.file_search":"file_search","openai.image_generation":"image_generation","openai.local_shell":"local_shell","openai.shell":"shell","openai.web_search":"web_search","openai.web_search_preview":"web_search_preview","openai.mcp":"mcp","openai.apply_patch":"apply_patch"}}),{input:B,warnings:P}=await KM({prompt:c,toolNameMapping:R,systemMessageMode:(y=S?.systemMessageMode)!=null?y:Z?"developer":x.systemMessageMode,providerOptionsName:j,fileIdPrefixes:this.config.fileIdPrefixes,store:(v=S?.store)!=null?v:!0,hasConversation:S?.conversation!=null,hasLocalShellTool:ve("openai.local_shell"),hasShellTool:ve("openai.shell"),hasApplyPatchTool:ve("openai.apply_patch")});$.push(...P);const L=(_=S?.strictJsonSchema)!=null?_:!0;let N=S?.include;function J(ie){N==null?N=[ie]:N.includes(ie)||(N=[...N,ie])}i(J,"addInclude");function ve(ie){return p?.find(st=>st.type==="provider"&&st.id===ie)!=null}i(ve,"hasOpenAITool");const re=typeof S?.logprobs=="number"?S?.logprobs:S?.logprobs===!0?u1:void 0;re&&J("message.output_text.logprobs");const le=(w=p?.find(ie=>ie.type==="provider"&&(ie.id==="openai.web_search"||ie.id==="openai.web_search_preview")))==null?void 0:w.name;le&&J("web_search_call.action.sources"),ve("openai.code_interpreter")&&J("code_interpreter_call.outputs");const _e=S?.store;_e===!1&&Z&&J("reasoning.encrypted_content");const X={model:this.modelId,input:B,temperature:n,top_p:o,max_output_tokens:t,...(g?.type==="json"||S?.textVerbosity)&&{text:{...g?.type==="json"&&{format:g.schema!=null?{type:"json_schema",strict:L,name:(D=g.name)!=null?D:"response",description:g.description,schema:g.schema}:{type:"json_object"}},...S?.textVerbosity&&{verbosity:S.textVerbosity}}},conversation:S?.conversation,max_tool_calls:S?.maxToolCalls,metadata:S?.metadata,parallel_tool_calls:S?.parallelToolCalls,previous_response_id:S?.previousResponseId,store:_e,user:S?.user,instructions:S?.instructions,service_tier:S?.serviceTier,include:N,prompt_cache_key:S?.promptCacheKey,prompt_cache_retention:S?.promptCacheRetention,safety_identifier:S?.safetyIdentifier,top_logprobs:re,truncation:S?.truncation,...Z&&(S?.reasoningEffort!=null||S?.reasoningSummary!=null)&&{reasoning:{...S?.reasoningEffort!=null&&{effort:S.reasoningEffort},...S?.reasoningSummary!=null&&{summary:S.reasoningSummary}}}};Z?S?.reasoningEffort==="none"&&x.supportsNonReasoningParameters||(X.temperature!=null&&(X.temperature=void 0,$.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),X.top_p!=null&&(X.top_p=void 0,$.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"}))):(S?.reasoningEffort!=null&&$.push({type:"unsupported",feature:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),S?.reasoningSummary!=null&&$.push({type:"unsupported",feature:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),S?.serviceTier==="flex"&&!x.supportsFlexProcessing&&($.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete X.service_tier),S?.serviceTier==="priority"&&!x.supportsPriorityProcessing&&($.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete X.service_tier);const{tools:Je,toolChoice:Re,toolWarnings:vt}=await eN({tools:p,toolChoice:h}),Me=(T=(I=(E=p?.find(ie=>ie.type==="provider"&&ie.id==="openai.shell"))==null?void 0:E.args)==null?void 0:I.environment)==null?void 0:T.type,q=Me==="containerAuto"||Me==="containerReference";return{webSearchToolName:le,args:{...X,tools:Je,tool_choice:Re},warnings:[...$,...vt],store:_e,toolNameMapping:R,providerOptionsName:j,isShellProviderExecuted:q}}async doGenerate(t){var n,r,o,s,a,l,u,c,d,p,h,g,f,y,v,_,w,D,E,I,T,$,x,j,S;const{args:Z,warnings:R,webSearchToolName:B,toolNameMapping:P,providerOptionsName:L,isShellProviderExecuted:N}=await this.getArgs(t),J=this.config.url({path:"/responses",modelId:this.modelId}),ve=d1(t.prompt),{responseHeaders:re,value:le,rawValue:_e}=await Qe({url:J,headers:Ve(this.config.headers(),t.headers),body:Z,failedResponseHandler:rn,successfulResponseHandler:ut(QM),abortSignal:t.abortSignal,fetch:this.config.fetch});if(le.error)throw new Ue({message:le.error.message,url:J,requestBodyValues:Z,statusCode:400,responseHeaders:re,responseBody:_e,isRetryable:!1});const X=[],Je=[];let Re=!1;for(const q of le.output)switch(q.type){case"reasoning":{q.summary.length===0&&q.summary.push({type:"summary_text",text:""});for(const ie of q.summary)X.push({type:"reasoning",text:ie.text,providerMetadata:{[L]:{itemId:q.id,reasoningEncryptedContent:(n=q.encrypted_content)!=null?n:null}}});break}case"image_generation_call":{X.push({type:"tool-call",toolCallId:q.id,toolName:P.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0}),X.push({type:"tool-result",toolCallId:q.id,toolName:P.toCustomToolName("image_generation"),result:{result:q.result}});break}case"local_shell_call":{X.push({type:"tool-call",toolCallId:q.call_id,toolName:P.toCustomToolName("local_shell"),input:JSON.stringify({action:q.action}),providerMetadata:{[L]:{itemId:q.id}}});break}case"shell_call":{X.push({type:"tool-call",toolCallId:q.call_id,toolName:P.toCustomToolName("shell"),input:JSON.stringify({action:{commands:q.action.commands}}),...N&&{providerExecuted:!0},providerMetadata:{[L]:{itemId:q.id}}});break}case"shell_call_output":{X.push({type:"tool-result",toolCallId:q.call_id,toolName:P.toCustomToolName("shell"),result:{output:q.output.map(ie=>({stdout:ie.stdout,stderr:ie.stderr,outcome:ie.outcome.type==="exit"?{type:"exit",exitCode:ie.outcome.exit_code}:{type:"timeout"}}))}});break}case"message":{for(const ie of q.content){(o=(r=t.providerOptions)==null?void 0:r[L])!=null&&o.logprobs&&ie.logprobs&&Je.push(ie.logprobs);const st={itemId:q.id,...ie.annotations.length>0&&{annotations:ie.annotations}};X.push({type:"text",text:ie.text,providerMetadata:{[L]:st}});for(const $e of ie.annotations)$e.type==="url_citation"?X.push({type:"source",sourceType:"url",id:(l=(a=(s=this.config).generateId)==null?void 0:a.call(s))!=null?l:ot(),url:$e.url,title:$e.title}):$e.type==="file_citation"?X.push({type:"source",sourceType:"document",id:(d=(c=(u=this.config).generateId)==null?void 0:c.call(u))!=null?d:ot(),mediaType:"text/plain",title:$e.filename,filename:$e.filename,providerMetadata:{[L]:{type:$e.type,fileId:$e.file_id,index:$e.index}}}):$e.type==="container_file_citation"?X.push({type:"source",sourceType:"document",id:(g=(h=(p=this.config).generateId)==null?void 0:h.call(p))!=null?g:ot(),mediaType:"text/plain",title:$e.filename,filename:$e.filename,providerMetadata:{[L]:{type:$e.type,fileId:$e.file_id,containerId:$e.container_id}}}):$e.type==="file_path"&&X.push({type:"source",sourceType:"document",id:(v=(y=(f=this.config).generateId)==null?void 0:y.call(f))!=null?v:ot(),mediaType:"application/octet-stream",title:$e.file_id,filename:$e.file_id,providerMetadata:{[L]:{type:$e.type,fileId:$e.file_id,index:$e.index}}})}break}case"function_call":{Re=!0,X.push({type:"tool-call",toolCallId:q.call_id,toolName:q.name,input:q.arguments,providerMetadata:{[L]:{itemId:q.id}}});break}case"web_search_call":{X.push({type:"tool-call",toolCallId:q.id,toolName:P.toCustomToolName(B??"web_search"),input:JSON.stringify({}),providerExecuted:!0}),X.push({type:"tool-result",toolCallId:q.id,toolName:P.toCustomToolName(B??"web_search"),result:f1(q.action)});break}case"mcp_call":{const ie=q.approval_request_id!=null&&(_=ve[q.approval_request_id])!=null?_:q.id,st=`mcp.${q.name}`;X.push({type:"tool-call",toolCallId:ie,toolName:st,input:q.arguments,providerExecuted:!0,dynamic:!0}),X.push({type:"tool-result",toolCallId:ie,toolName:st,result:{type:"call",serverLabel:q.server_label,name:q.name,arguments:q.arguments,...q.output!=null?{output:q.output}:{},...q.error!=null?{error:q.error}:{}},providerMetadata:{[L]:{itemId:q.id}}});break}case"mcp_list_tools":break;case"mcp_approval_request":{const ie=(w=q.approval_request_id)!=null?w:q.id,st=(I=(E=(D=this.config).generateId)==null?void 0:E.call(D))!=null?I:ot(),$e=`mcp.${q.name}`;X.push({type:"tool-call",toolCallId:st,toolName:$e,input:q.arguments,providerExecuted:!0,dynamic:!0}),X.push({type:"tool-approval-request",approvalId:ie,toolCallId:st});break}case"computer_call":{X.push({type:"tool-call",toolCallId:q.id,toolName:P.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),X.push({type:"tool-result",toolCallId:q.id,toolName:P.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:q.status||"completed"}});break}case"file_search_call":{X.push({type:"tool-call",toolCallId:q.id,toolName:P.toCustomToolName("file_search"),input:"{}",providerExecuted:!0}),X.push({type:"tool-result",toolCallId:q.id,toolName:P.toCustomToolName("file_search"),result:{queries:q.queries,results:($=(T=q.results)==null?void 0:T.map(ie=>({attributes:ie.attributes,fileId:ie.file_id,filename:ie.filename,score:ie.score,text:ie.text})))!=null?$:null}});break}case"code_interpreter_call":{X.push({type:"tool-call",toolCallId:q.id,toolName:P.toCustomToolName("code_interpreter"),input:JSON.stringify({code:q.code,containerId:q.container_id}),providerExecuted:!0}),X.push({type:"tool-result",toolCallId:q.id,toolName:P.toCustomToolName("code_interpreter"),result:{outputs:q.outputs}});break}case"apply_patch_call":{X.push({type:"tool-call",toolCallId:q.call_id,toolName:P.toCustomToolName("apply_patch"),input:JSON.stringify({callId:q.call_id,operation:q.operation}),providerMetadata:{[L]:{itemId:q.id}}});break}}const vt={[L]:{responseId:le.id,...Je.length>0?{logprobs:Je}:{},...typeof le.service_tier=="string"?{serviceTier:le.service_tier}:{}}},Me=le.usage;return{content:X,finishReason:{unified:l1({finishReason:(x=le.incomplete_details)==null?void 0:x.reason,hasFunctionCall:Re}),raw:(S=(j=le.incomplete_details)==null?void 0:j.reason)!=null?S:void 0},usage:i1(Me),request:{body:Z},response:{id:le.id,timestamp:new Date(le.created_at*1e3),modelId:le.model,headers:re,body:_e},providerMetadata:vt,warnings:R}}async doStream(t){const{args:n,warnings:r,webSearchToolName:o,toolNameMapping:s,store:a,providerOptionsName:l,isShellProviderExecuted:u}=await this.getArgs(t),{responseHeaders:c,value:d}=await Qe({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:{...n,stream:!0},failedResponseHandler:rn,successfulResponseHandler:Xr(XM),abortSignal:t.abortSignal,fetch:this.config.fetch}),p=this,h=d1(t.prompt),g=new Map;let f={unified:"other",raw:void 0},y;const v=[];let _=null;const w={},D=[];let E=!1;const I={};let T;return{stream:d.pipeThrough(new TransformStream({start($){$.enqueue({type:"stream-start",warnings:r})},transform($,x){var j,S,Z,R,B,P,L,N,J,ve,re,le,_e,X,Je,Re,vt,Me,q,ie,st,$e,rs,os,ss,is,as,ls,us,cs;if(t.includeRawChunks&&x.enqueue({type:"raw",rawValue:$.rawValue}),!$.success){f={unified:"error",raw:void 0},x.enqueue({type:"error",error:$.error});return}const C=$.value;if(p1(C)){if(C.item.type==="function_call")w[C.output_index]={toolName:C.item.name,toolCallId:C.item.call_id},x.enqueue({type:"tool-input-start",id:C.item.call_id,toolName:C.item.name});else if(C.item.type==="web_search_call")w[C.output_index]={toolName:s.toCustomToolName(o??"web_search"),toolCallId:C.item.id},x.enqueue({type:"tool-input-start",id:C.item.id,toolName:s.toCustomToolName(o??"web_search"),providerExecuted:!0}),x.enqueue({type:"tool-input-end",id:C.item.id}),x.enqueue({type:"tool-call",toolCallId:C.item.id,toolName:s.toCustomToolName(o??"web_search"),input:JSON.stringify({}),providerExecuted:!0});else if(C.item.type==="computer_call")w[C.output_index]={toolName:s.toCustomToolName("computer_use"),toolCallId:C.item.id},x.enqueue({type:"tool-input-start",id:C.item.id,toolName:s.toCustomToolName("computer_use"),providerExecuted:!0});else if(C.item.type==="code_interpreter_call")w[C.output_index]={toolName:s.toCustomToolName("code_interpreter"),toolCallId:C.item.id,codeInterpreter:{containerId:C.item.container_id}},x.enqueue({type:"tool-input-start",id:C.item.id,toolName:s.toCustomToolName("code_interpreter"),providerExecuted:!0}),x.enqueue({type:"tool-input-delta",id:C.item.id,delta:`{"containerId":"${C.item.container_id}","code":"`});else if(C.item.type==="file_search_call")x.enqueue({type:"tool-call",toolCallId:C.item.id,toolName:s.toCustomToolName("file_search"),input:"{}",providerExecuted:!0});else if(C.item.type==="image_generation_call")x.enqueue({type:"tool-call",toolCallId:C.item.id,toolName:s.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0});else if(!(C.item.type==="mcp_call"||C.item.type==="mcp_list_tools"||C.item.type==="mcp_approval_request"))if(C.item.type==="apply_patch_call"){const{call_id:G,operation:Ke}=C.item;if(w[C.output_index]={toolName:s.toCustomToolName("apply_patch"),toolCallId:G,applyPatch:{hasDiff:Ke.type==="delete_file",endEmitted:Ke.type==="delete_file"}},x.enqueue({type:"tool-input-start",id:G,toolName:s.toCustomToolName("apply_patch")}),Ke.type==="delete_file"){const _t=JSON.stringify({callId:G,operation:Ke});x.enqueue({type:"tool-input-delta",id:G,delta:_t}),x.enqueue({type:"tool-input-end",id:G})}else x.enqueue({type:"tool-input-delta",id:G,delta:`{"callId":"${wr(G)}","operation":{"type":"${wr(Ke.type)}","path":"${wr(Ke.path)}","diff":"`})}else C.item.type==="shell_call"?w[C.output_index]={toolName:s.toCustomToolName("shell"),toolCallId:C.item.call_id}:C.item.type==="shell_call_output"||(C.item.type==="message"?(D.splice(0,D.length),x.enqueue({type:"text-start",id:C.item.id,providerMetadata:{[l]:{itemId:C.item.id}}})):p1(C)&&C.item.type==="reasoning"&&(I[C.item.id]={encryptedContent:C.item.encrypted_content,summaryParts:{0:"active"}},x.enqueue({type:"reasoning-start",id:`${C.item.id}:0`,providerMetadata:{[l]:{itemId:C.item.id,reasoningEncryptedContent:(j=C.item.encrypted_content)!=null?j:null}}})))}else if(sN(C)){if(C.item.type==="message")x.enqueue({type:"text-end",id:C.item.id,providerMetadata:{[l]:{itemId:C.item.id,...D.length>0&&{annotations:D}}}});else if(C.item.type==="function_call")w[C.output_index]=void 0,E=!0,x.enqueue({type:"tool-input-end",id:C.item.call_id}),x.enqueue({type:"tool-call",toolCallId:C.item.call_id,toolName:C.item.name,input:C.item.arguments,providerMetadata:{[l]:{itemId:C.item.id}}});else if(C.item.type==="web_search_call")w[C.output_index]=void 0,x.enqueue({type:"tool-result",toolCallId:C.item.id,toolName:s.toCustomToolName(o??"web_search"),result:f1(C.item.action)});else if(C.item.type==="computer_call")w[C.output_index]=void 0,x.enqueue({type:"tool-input-end",id:C.item.id}),x.enqueue({type:"tool-call",toolCallId:C.item.id,toolName:s.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),x.enqueue({type:"tool-result",toolCallId:C.item.id,toolName:s.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:C.item.status||"completed"}});else if(C.item.type==="file_search_call")w[C.output_index]=void 0,x.enqueue({type:"tool-result",toolCallId:C.item.id,toolName:s.toCustomToolName("file_search"),result:{queries:C.item.queries,results:(Z=(S=C.item.results)==null?void 0:S.map(G=>({attributes:G.attributes,fileId:G.file_id,filename:G.filename,score:G.score,text:G.text})))!=null?Z:null}});else if(C.item.type==="code_interpreter_call")w[C.output_index]=void 0,x.enqueue({type:"tool-result",toolCallId:C.item.id,toolName:s.toCustomToolName("code_interpreter"),result:{outputs:C.item.outputs}});else if(C.item.type==="image_generation_call")x.enqueue({type:"tool-result",toolCallId:C.item.id,toolName:s.toCustomToolName("image_generation"),result:{result:C.item.result}});else if(C.item.type==="mcp_call"){w[C.output_index]=void 0;const G=(R=C.item.approval_request_id)!=null?R:void 0,Ke=G!=null&&(P=(B=g.get(G))!=null?B:h[G])!=null?P:C.item.id,_t=`mcp.${C.item.name}`;x.enqueue({type:"tool-call",toolCallId:Ke,toolName:_t,input:C.item.arguments,providerExecuted:!0,dynamic:!0}),x.enqueue({type:"tool-result",toolCallId:Ke,toolName:_t,result:{type:"call",serverLabel:C.item.server_label,name:C.item.name,arguments:C.item.arguments,...C.item.output!=null?{output:C.item.output}:{},...C.item.error!=null?{error:C.item.error}:{}},providerMetadata:{[l]:{itemId:C.item.id}}})}else if(C.item.type==="mcp_list_tools")w[C.output_index]=void 0;else if(C.item.type==="apply_patch_call"){const G=w[C.output_index];G?.applyPatch&&!G.applyPatch.endEmitted&&C.item.operation.type!=="delete_file"&&(G.applyPatch.hasDiff||x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:wr(C.item.operation.diff)}),x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}}'}),x.enqueue({type:"tool-input-end",id:G.toolCallId}),G.applyPatch.endEmitted=!0),G&&C.item.status==="completed"&&x.enqueue({type:"tool-call",toolCallId:G.toolCallId,toolName:s.toCustomToolName("apply_patch"),input:JSON.stringify({callId:C.item.call_id,operation:C.item.operation}),providerMetadata:{[l]:{itemId:C.item.id}}}),w[C.output_index]=void 0}else if(C.item.type==="mcp_approval_request"){w[C.output_index]=void 0;const G=(J=(N=(L=p.config).generateId)==null?void 0:N.call(L))!=null?J:ot(),Ke=(ve=C.item.approval_request_id)!=null?ve:C.item.id;g.set(Ke,G);const _t=`mcp.${C.item.name}`;x.enqueue({type:"tool-call",toolCallId:G,toolName:_t,input:C.item.arguments,providerExecuted:!0,dynamic:!0}),x.enqueue({type:"tool-approval-request",approvalId:Ke,toolCallId:G})}else if(C.item.type==="local_shell_call")w[C.output_index]=void 0,x.enqueue({type:"tool-call",toolCallId:C.item.call_id,toolName:s.toCustomToolName("local_shell"),input:JSON.stringify({action:{type:"exec",command:C.item.action.command,timeoutMs:C.item.action.timeout_ms,user:C.item.action.user,workingDirectory:C.item.action.working_directory,env:C.item.action.env}}),providerMetadata:{[l]:{itemId:C.item.id}}});else if(C.item.type==="shell_call")w[C.output_index]=void 0,x.enqueue({type:"tool-call",toolCallId:C.item.call_id,toolName:s.toCustomToolName("shell"),input:JSON.stringify({action:{commands:C.item.action.commands}}),...u&&{providerExecuted:!0},providerMetadata:{[l]:{itemId:C.item.id}}});else if(C.item.type==="shell_call_output")x.enqueue({type:"tool-result",toolCallId:C.item.call_id,toolName:s.toCustomToolName("shell"),result:{output:C.item.output.map(G=>({stdout:G.stdout,stderr:G.stderr,outcome:G.outcome.type==="exit"?{type:"exit",exitCode:G.outcome.exit_code}:{type:"timeout"}}))}});else if(C.item.type==="reasoning"){const G=I[C.item.id],Ke=Object.entries(G.summaryParts).filter(([_t,Sr])=>Sr==="active"||Sr==="can-conclude").map(([_t])=>_t);for(const _t of Ke)x.enqueue({type:"reasoning-end",id:`${C.item.id}:${_t}`,providerMetadata:{[l]:{itemId:C.item.id,reasoningEncryptedContent:(re=C.item.encrypted_content)!=null?re:null}}});delete I[C.item.id]}}else if(lN(C)){const G=w[C.output_index];G!=null&&x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:C.delta})}else if(pN(C)){const G=w[C.output_index];G?.applyPatch&&(x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:wr(C.delta)}),G.applyPatch.hasDiff=!0)}else if(fN(C)){const G=w[C.output_index];G?.applyPatch&&!G.applyPatch.endEmitted&&(G.applyPatch.hasDiff||(x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:wr(C.diff)}),G.applyPatch.hasDiff=!0),x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}}'}),x.enqueue({type:"tool-input-end",id:G.toolCallId}),G.applyPatch.endEmitted=!0)}else if(uN(C))x.enqueue({type:"tool-result",toolCallId:C.item_id,toolName:s.toCustomToolName("image_generation"),result:{result:C.partial_image_b64},preliminary:!0});else if(cN(C)){const G=w[C.output_index];G!=null&&x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:wr(C.delta)})}else if(dN(C)){const G=w[C.output_index];G!=null&&(x.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}'}),x.enqueue({type:"tool-input-end",id:G.toolCallId}),x.enqueue({type:"tool-call",toolCallId:G.toolCallId,toolName:s.toCustomToolName("code_interpreter"),input:JSON.stringify({code:C.code,containerId:G.codeInterpreter.containerId}),providerExecuted:!0}))}else if(aN(C))_=C.response.id,x.enqueue({type:"response-metadata",id:C.response.id,timestamp:new Date(C.response.created_at*1e3),modelId:C.response.model});else if(oN(C))x.enqueue({type:"text-delta",id:C.item_id,delta:C.delta}),(_e=(le=t.providerOptions)==null?void 0:le[l])!=null&&_e.logprobs&&C.logprobs&&v.push(C.logprobs);else if(C.type==="response.reasoning_summary_part.added"){if(C.summary_index>0){const G=I[C.item_id];G.summaryParts[C.summary_index]="active";for(const Ke of Object.keys(G.summaryParts))G.summaryParts[Ke]==="can-conclude"&&(x.enqueue({type:"reasoning-end",id:`${C.item_id}:${Ke}`,providerMetadata:{[l]:{itemId:C.item_id}}}),G.summaryParts[Ke]="concluded");x.enqueue({type:"reasoning-start",id:`${C.item_id}:${C.summary_index}`,providerMetadata:{[l]:{itemId:C.item_id,reasoningEncryptedContent:(Je=(X=I[C.item_id])==null?void 0:X.encryptedContent)!=null?Je:null}}})}}else C.type==="response.reasoning_summary_text.delta"?x.enqueue({type:"reasoning-delta",id:`${C.item_id}:${C.summary_index}`,delta:C.delta,providerMetadata:{[l]:{itemId:C.item_id}}}):C.type==="response.reasoning_summary_part.done"?a?(x.enqueue({type:"reasoning-end",id:`${C.item_id}:${C.summary_index}`,providerMetadata:{[l]:{itemId:C.item_id}}}),I[C.item_id].summaryParts[C.summary_index]="concluded"):I[C.item_id].summaryParts[C.summary_index]="can-conclude":iN(C)?(f={unified:l1({finishReason:(Re=C.response.incomplete_details)==null?void 0:Re.reason,hasFunctionCall:E}),raw:(Me=(vt=C.response.incomplete_details)==null?void 0:vt.reason)!=null?Me:void 0},y=C.response.usage,typeof C.response.service_tier=="string"&&(T=C.response.service_tier)):mN(C)?(D.push(C.annotation),C.annotation.type==="url_citation"?x.enqueue({type:"source",sourceType:"url",id:(st=(ie=(q=p.config).generateId)==null?void 0:ie.call(q))!=null?st:ot(),url:C.annotation.url,title:C.annotation.title}):C.annotation.type==="file_citation"?x.enqueue({type:"source",sourceType:"document",id:(os=(rs=($e=p.config).generateId)==null?void 0:rs.call($e))!=null?os:ot(),mediaType:"text/plain",title:C.annotation.filename,filename:C.annotation.filename,providerMetadata:{[l]:{type:C.annotation.type,fileId:C.annotation.file_id,index:C.annotation.index}}}):C.annotation.type==="container_file_citation"?x.enqueue({type:"source",sourceType:"document",id:(as=(is=(ss=p.config).generateId)==null?void 0:is.call(ss))!=null?as:ot(),mediaType:"text/plain",title:C.annotation.filename,filename:C.annotation.filename,providerMetadata:{[l]:{type:C.annotation.type,fileId:C.annotation.file_id,containerId:C.annotation.container_id}}}):C.annotation.type==="file_path"&&x.enqueue({type:"source",sourceType:"document",id:(cs=(us=(ls=p.config).generateId)==null?void 0:us.call(ls))!=null?cs:ot(),mediaType:"application/octet-stream",title:C.annotation.file_id,filename:C.annotation.file_id,providerMetadata:{[l]:{type:C.annotation.type,fileId:C.annotation.file_id,index:C.annotation.index}}})):hN(C)&&x.enqueue({type:"error",error:C})},flush($){const x={[l]:{responseId:_,...v.length>0?{logprobs:v}:{},...T!==void 0?{serviceTier:T}:{}}};$.enqueue({type:"finish",finishReason:f,usage:i1(y),providerMetadata:x})}})),request:{body:n},response:{headers:c}}}},i(Ko,"OpenAIResponsesLanguageModel"),Ko);function oN(e){return e.type==="response.output_text.delta"}i(oN,"isTextDeltaChunk");function sN(e){return e.type==="response.output_item.done"}i(sN,"isResponseOutputItemDoneChunk");function iN(e){return e.type==="response.completed"||e.type==="response.incomplete"}i(iN,"isResponseFinishedChunk");function aN(e){return e.type==="response.created"}i(aN,"isResponseCreatedChunk");function lN(e){return e.type==="response.function_call_arguments.delta"}i(lN,"isResponseFunctionCallArgumentsDeltaChunk");function uN(e){return e.type==="response.image_generation_call.partial_image"}i(uN,"isResponseImageGenerationCallPartialImageChunk");function cN(e){return e.type==="response.code_interpreter_call_code.delta"}i(cN,"isResponseCodeInterpreterCallCodeDeltaChunk");function dN(e){return e.type==="response.code_interpreter_call_code.done"}i(dN,"isResponseCodeInterpreterCallCodeDoneChunk");function pN(e){return e.type==="response.apply_patch_call_operation_diff.delta"}i(pN,"isResponseApplyPatchCallOperationDiffDeltaChunk");function fN(e){return e.type==="response.apply_patch_call_operation_diff.done"}i(fN,"isResponseApplyPatchCallOperationDiffDoneChunk");function p1(e){return e.type==="response.output_item.added"}i(p1,"isResponseOutputItemAddedChunk");function mN(e){return e.type==="response.output_text.annotation.added"}i(mN,"isResponseAnnotationAddedChunk");function hN(e){return e.type==="error"}i(hN,"isErrorChunk");function f1(e){var t;switch(e.type){case"search":return{action:{type:"search",query:(t=e.query)!=null?t:void 0},...e.sources!=null&&{sources:e.sources}};case"open_page":return{action:{type:"openPage",url:e.url}};case"find_in_page":return{action:{type:"findInPage",url:e.url,pattern:e.pattern}}}}i(f1,"mapWebSearchOutput");function wr(e){return JSON.stringify(e).slice(1,-1)}i(wr,"escapeJSONDelta");var gN=ne(()=>te(b({instructions:m().nullish(),speed:A().min(.25).max(4).default(1).nullish()}))),yN=(Yo=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({text:t,voice:n="alloy",outputFormat:r="mp3",speed:o,instructions:s,language:a,providerOptions:l}){const u=[],c=await mt({provider:"openai",providerOptions:l,schema:gN}),d={model:this.modelId,input:t,voice:n,response_format:"mp3",speed:o,instructions:s};if(r&&(["mp3","opus","aac","flac","wav","pcm"].includes(r)?d.response_format=r:u.push({type:"unsupported",feature:"outputFormat",details:`Unsupported output format: ${r}. Using mp3 instead.`})),c){const p={};for(const h in p){const g=p[h];g!==void 0&&(d[h]=g)}}return a&&u.push({type:"unsupported",feature:"language",details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:d,warnings:u}}async doGenerate(t){var n,r,o;const s=(o=(r=(n=this.config._internal)==null?void 0:n.currentDate)==null?void 0:r.call(n))!=null?o:new Date,{requestBody:a,warnings:l}=await this.getArgs(t),{value:u,responseHeaders:c,rawValue:d}=await Qe({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:a,failedResponseHandler:rn,successfulResponseHandler:G4(),abortSignal:t.abortSignal,fetch:this.config.fetch});return{audio:u,warnings:l,request:{body:JSON.stringify(a)},response:{timestamp:s,modelId:this.modelId,headers:c,body:d}}}},i(Yo,"OpenAISpeechModel"),Yo),vN=ne(()=>te(b({text:m(),language:m().nullish(),duration:A().nullish(),words:M(b({word:m(),start:A(),end:A()})).nullish(),segments:M(b({id:A(),seek:A(),start:A(),end:A(),text:m(),tokens:M(A()),temperature:A(),avg_logprob:A(),compression_ratio:A(),no_speech_prob:A()})).nullish()}))),_N=ne(()=>te(b({include:M(m()).optional(),language:m().optional(),prompt:m().optional(),temperature:A().min(0).max(1).default(0).optional(),timestampGranularities:M(fe(["word","segment"])).default(["segment"]).optional()}))),m1={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},bN=(Xo=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({audio:t,mediaType:n,providerOptions:r}){const o=[],s=await mt({provider:"openai",providerOptions:r,schema:_N}),a=new FormData,l=t instanceof Uint8Array?new Blob([t]):new Blob([gr(t)]);a.append("model",this.modelId);const u=HR(n);if(a.append("file",new File([l],"audio",{type:n}),`audio.${u}`),s){const c={include:s.include,language:s.language,prompt:s.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:s.temperature,timestamp_granularities:s.timestampGranularities};for(const[d,p]of Object.entries(c))if(p!=null)if(Array.isArray(p))for(const h of p)a.append(`${d}[]`,String(h));else a.append(d,String(p))}return{formData:a,warnings:o}}async doGenerate(t){var n,r,o,s,a,l,u,c;const d=(o=(r=(n=this.config._internal)==null?void 0:n.currentDate)==null?void 0:r.call(n))!=null?o:new Date,{formData:p,warnings:h}=await this.getArgs(t),{value:g,responseHeaders:f,rawValue:y}=await Cd({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),formData:p,failedResponseHandler:rn,successfulResponseHandler:ut(vN),abortSignal:t.abortSignal,fetch:this.config.fetch}),v=g.language!=null&&g.language in m1?m1[g.language]:void 0;return{text:g.text,segments:(u=(l=(s=g.segments)==null?void 0:s.map(_=>({text:_.text,startSecond:_.start,endSecond:_.end})))!=null?l:(a=g.words)==null?void 0:a.map(_=>({text:_.word,startSecond:_.start,endSecond:_.end})))!=null?u:[],language:v,durationInSeconds:(c=g.duration)!=null?c:void 0,warnings:h,response:{timestamp:d,modelId:this.modelId,headers:f,body:y}}}},i(Xo,"OpenAITranscriptionModel"),Xo),wN="3.0.30";function mi(e={}){var t,n;const r=(t=$d(ai({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))!=null?t:"https://api.openai.com/v1",o=(n=e.name)!=null?n:"openai",s=i(()=>yr({Authorization:`Bearer ${WR({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},`ai-sdk/openai/${wN}`),"getHeaders"),a=i(y=>new rM(y,{provider:`${o}.chat`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createChatModel"),l=i(y=>new aM(y,{provider:`${o}.completion`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createCompletionModel"),u=i(y=>new cM(y,{provider:`${o}.embedding`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createEmbeddingModel"),c=i(y=>new mM(y,{provider:`${o}.image`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createImageModel"),d=i(y=>new bN(y,{provider:`${o}.transcription`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createTranscriptionModel"),p=i(y=>new yN(y,{provider:`${o}.speech`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch}),"createSpeechModel"),h=i(y=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return g(y)},"createLanguageModel"),g=i(y=>new rN(y,{provider:`${o}.responses`,url:i(({path:v})=>`${r}${v}`,"url"),headers:s,fetch:e.fetch,fileIdPrefixes:["file-"]}),"createResponsesModel"),f=i(function(y){return h(y)},"provider");return f.specificationVersion="v3",f.languageModel=h,f.chat=a,f.completion=l,f.responses=g,f.embedding=u,f.embeddingModel=u,f.textEmbedding=u,f.textEmbeddingModel=u,f.image=c,f.imageModel=c,f.transcription=d,f.transcriptionModel=d,f.speech=p,f.speechModel=p,f.tools=JM,f}i(mi,"createOpenAI"),mi();var DN=b({error:b({message:m(),type:m().nullish(),param:ft().nullish(),code:se([m(),A()]).nullish()})}),hi={errorSchema:DN,errorToMessage:i(e=>e.error.message,"errorToMessage")};function h1(e){var t,n,r,o,s,a;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const l=(t=e.prompt_tokens)!=null?t:0,u=(n=e.completion_tokens)!=null?n:0,c=(o=(r=e.prompt_tokens_details)==null?void 0:r.cached_tokens)!=null?o:0,d=(a=(s=e.completion_tokens_details)==null?void 0:s.reasoning_tokens)!=null?a:0;return{inputTokens:{total:l,noCache:l-c,cacheRead:c,cacheWrite:void 0},outputTokens:{total:u,text:u-d,reasoning:d},raw:e}}i(h1,"convertOpenAICompatibleChatUsage");function gi(e){var t,n;return(n=(t=e?.providerOptions)==null?void 0:t.openaiCompatible)!=null?n:{}}i(gi,"getOpenAIMetadata");function EN(e){switch(e){case"audio/wav":return"wav";case"audio/mp3":case"audio/mpeg":return"mp3";default:return null}}i(EN,"getAudioFormat");function CN(e){var t,n,r;const o=[];for(const{role:s,content:a,...l}of e){const u=gi({...l});switch(s){case"system":{o.push({role:"system",content:a,...u});break}case"user":{if(a.length===1&&a[0].type==="text"){o.push({role:"user",content:a[0].text,...gi(a[0])});break}o.push({role:"user",content:a.map(c=>{var d;const p=gi(c);switch(c.type){case"text":return{type:"text",text:c.text,...p};case"file":{if(c.mediaType.startsWith("image/")){const h=c.mediaType==="image/*"?"image/jpeg":c.mediaType;return{type:"image_url",image_url:{url:c.data instanceof URL?c.data.toString():`data:${h};base64,${$n(c.data)}`},...p}}if(c.mediaType.startsWith("audio/")){if(c.data instanceof URL)throw new pt({functionality:"audio file parts with URLs"});const h=EN(c.mediaType);if(h===null)throw new pt({functionality:`audio media type ${c.mediaType}`});return{type:"input_audio",input_audio:{data:$n(c.data),format:h},...p}}if(c.mediaType==="application/pdf"){if(c.data instanceof URL)throw new pt({functionality:"PDF file parts with URLs"});return{type:"file",file:{filename:(d=c.filename)!=null?d:"document.pdf",file_data:`data:application/pdf;base64,${$n(c.data)}`},...p}}if(c.mediaType.startsWith("text/"))return{type:"text",text:c.data instanceof URL?c.data.toString():typeof c.data=="string"?c.data:new TextDecoder().decode(c.data),...p};throw new pt({functionality:`file part media type ${c.mediaType}`})}}}),...u});break}case"assistant":{let c="",d="";const p=[];for(const h of a){const g=gi(h);switch(h.type){case"text":{c+=h.text;break}case"reasoning":{d+=h.text;break}case"tool-call":{const f=(n=(t=h.providerOptions)==null?void 0:t.google)==null?void 0:n.thoughtSignature;p.push({id:h.toolCallId,type:"function",function:{name:h.toolName,arguments:JSON.stringify(h.input)},...g,...f?{extra_content:{google:{thought_signature:String(f)}}}:{}});break}}}o.push({role:"assistant",content:c,...d.length>0?{reasoning_content:d}:{},tool_calls:p.length>0?p:void 0,...u});break}case"tool":{for(const c of a){if(c.type==="tool-approval-response")continue;const d=c.output;let p;switch(d.type){case"text":case"error-text":p=d.value;break;case"execution-denied":p=(r=d.reason)!=null?r:"Tool execution denied.";break;case"content":case"json":case"error-json":p=JSON.stringify(d.value);break}const h=gi(c);o.push({role:"tool",tool_call_id:c.toolCallId,content:p,...h})}break}default:{const c=s;throw new Error(`Unsupported role: ${c}`)}}}return o}i(CN,"convertToOpenAICompatibleChatMessages");function g1({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}i(g1,"getResponseMetadata");function y1(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}i(y1,"mapOpenAICompatibleFinishReason");var yl=b({user:m().optional(),reasoningEffort:m().optional(),textVerbosity:m().optional(),strictJsonSchema:qe().optional()});function $N({tools:e,toolChoice:t}){e=e?.length?e:void 0;const n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const s of e)s.type==="provider"?n.push({type:"unsupported",feature:`provider-defined tool ${s.id}`}):r.push({type:"function",function:{name:s.name,description:s.description,parameters:s.inputSchema,...s.strict!=null?{strict:s.strict}:{}}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const o=t.type;switch(o){case"auto":case"none":case"required":return{tools:r,toolChoice:o,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:{const s=o;throw new pt({functionality:`tool choice type: ${s}`})}}}i($N,"prepareTools");var xN=(Qo=class{constructor(t,n){this.specificationVersion="v3";var r,o;this.modelId=t,this.config=n;const s=(r=n.errorStructure)!=null?r:hi;this.chunkSchema=IN(s.errorSchema),this.failedResponseHandler=Pt(s),this.supportsStructuredOutputs=(o=n.supportsStructuredOutputs)!=null?o:!1}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var t,n,r;return(r=(n=(t=this.config).supportedUrls)==null?void 0:n.call(t))!=null?r:{}}transformRequestBody(t){var n,r,o;return(o=(r=(n=this.config).transformRequestBody)==null?void 0:r.call(n,t))!=null?o:t}async getArgs({prompt:t,maxOutputTokens:n,temperature:r,topP:o,topK:s,frequencyPenalty:a,presencePenalty:l,providerOptions:u,stopSequences:c,responseFormat:d,seed:p,toolChoice:h,tools:g}){var f,y,v,_,w;const D=[],E=await mt({provider:"openai-compatible",providerOptions:u,schema:yl});E!=null&&D.push({type:"other",message:"The 'openai-compatible' key in providerOptions is deprecated. Use 'openaiCompatible' instead."});const I=Object.assign(E??{},(f=await mt({provider:"openaiCompatible",providerOptions:u,schema:yl}))!=null?f:{},(y=await mt({provider:this.providerOptionsName,providerOptions:u,schema:yl}))!=null?y:{}),T=(v=I?.strictJsonSchema)!=null?v:!0;s!=null&&D.push({type:"unsupported",feature:"topK"}),d?.type==="json"&&d.schema!=null&&!this.supportsStructuredOutputs&&D.push({type:"unsupported",feature:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{tools:$,toolChoice:x,toolWarnings:j}=$N({tools:g,toolChoice:h});return{args:{model:this.modelId,user:I.user,max_tokens:n,temperature:r,top_p:o,frequency_penalty:a,presence_penalty:l,response_format:d?.type==="json"?this.supportsStructuredOutputs===!0&&d.schema!=null?{type:"json_schema",json_schema:{schema:d.schema,strict:T,name:(_=d.name)!=null?_:"response",description:d.description}}:{type:"json_object"}:void 0,stop:c,seed:p,...Object.fromEntries(Object.entries((w=u?.[this.providerOptionsName])!=null?w:{}).filter(([S])=>!Object.keys(yl.shape).includes(S))),reasoning_effort:I.reasoningEffort,verbosity:I.textVerbosity,messages:CN(t),tools:$,tool_choice:x},warnings:[...D,...j]}}async doGenerate(t){var n,r,o,s,a,l,u,c;const{args:d,warnings:p}=await this.getArgs({...t}),h=this.transformRequestBody(d),g=JSON.stringify(h),{responseHeaders:f,value:y,rawValue:v}=await Qe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:h,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:ut(SN),abortSignal:t.abortSignal,fetch:this.config.fetch}),_=y.choices[0],w=[],D=_.message.content;D!=null&&D.length>0&&w.push({type:"text",text:D});const E=(n=_.message.reasoning_content)!=null?n:_.message.reasoning;if(E!=null&&E.length>0&&w.push({type:"reasoning",text:E}),_.message.tool_calls!=null)for(const $ of _.message.tool_calls){const x=(o=(r=$.extra_content)==null?void 0:r.google)==null?void 0:o.thought_signature;w.push({type:"tool-call",toolCallId:(s=$.id)!=null?s:ot(),toolName:$.function.name,input:$.function.arguments,...x?{providerMetadata:{[this.providerOptionsName]:{thoughtSignature:x}}}:{}})}const I={[this.providerOptionsName]:{},...await((l=(a=this.config.metadataExtractor)==null?void 0:a.extractMetadata)==null?void 0:l.call(a,{parsedBody:v}))},T=(u=y.usage)==null?void 0:u.completion_tokens_details;return T?.accepted_prediction_tokens!=null&&(I[this.providerOptionsName].acceptedPredictionTokens=T?.accepted_prediction_tokens),T?.rejected_prediction_tokens!=null&&(I[this.providerOptionsName].rejectedPredictionTokens=T?.rejected_prediction_tokens),{content:w,finishReason:{unified:y1(_.finish_reason),raw:(c=_.finish_reason)!=null?c:void 0},usage:h1(y.usage),providerMetadata:I,request:{body:g},response:{...g1(y),headers:f,body:v},warnings:p}}async doStream(t){var n;const{args:r,warnings:o}=await this.getArgs({...t}),s=this.transformRequestBody({...r,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0}),a=(n=this.config.metadataExtractor)==null?void 0:n.createStreamExtractor(),{responseHeaders:l,value:u}=await Qe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:s,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:Xr(this.chunkSchema),abortSignal:t.abortSignal,fetch:this.config.fetch}),c=[];let d={unified:"other",raw:void 0},p,h=!0;const g=this.providerOptionsName;let f=!1,y=!1;return{stream:u.pipeThrough(new TransformStream({start(v){v.enqueue({type:"stream-start",warnings:o})},transform(v,_){var w,D,E,I,T,$,x,j,S,Z,R,B,P,L,N,J,ve,re;if(t.includeRawChunks&&_.enqueue({type:"raw",rawValue:v.rawValue}),!v.success){d={unified:"error",raw:void 0},_.enqueue({type:"error",error:v.error});return}if(a?.processChunk(v.rawValue),"error"in v.value){d={unified:"error",raw:void 0},_.enqueue({type:"error",error:v.value.error.message});return}const le=v.value;h&&(h=!1,_.enqueue({type:"response-metadata",...g1(le)})),le.usage!=null&&(p=le.usage);const _e=le.choices[0];if(_e?.finish_reason!=null&&(d={unified:y1(_e.finish_reason),raw:(w=_e.finish_reason)!=null?w:void 0}),_e?.delta==null)return;const X=_e.delta,Je=(D=X.reasoning_content)!=null?D:X.reasoning;if(Je&&(f||(_.enqueue({type:"reasoning-start",id:"reasoning-0"}),f=!0),_.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:Je})),X.content&&(f&&(_.enqueue({type:"reasoning-end",id:"reasoning-0"}),f=!1),y||(_.enqueue({type:"text-start",id:"txt-0"}),y=!0),_.enqueue({type:"text-delta",id:"txt-0",delta:X.content})),X.tool_calls!=null){f&&(_.enqueue({type:"reasoning-end",id:"reasoning-0"}),f=!1);for(const Re of X.tool_calls){const vt=(E=Re.index)!=null?E:c.length;if(c[vt]==null){if(Re.id==null)throw new Zs({data:Re,message:"Expected 'id' to be a string."});if(((I=Re.function)==null?void 0:I.name)==null)throw new Zs({data:Re,message:"Expected 'function.name' to be a string."});_.enqueue({type:"tool-input-start",id:Re.id,toolName:Re.function.name}),c[vt]={id:Re.id,type:"function",function:{name:Re.function.name,arguments:(T=Re.function.arguments)!=null?T:""},hasFinished:!1,thoughtSignature:(j=(x=($=Re.extra_content)==null?void 0:$.google)==null?void 0:x.thought_signature)!=null?j:void 0};const q=c[vt];((S=q.function)==null?void 0:S.name)!=null&&((Z=q.function)==null?void 0:Z.arguments)!=null&&(q.function.arguments.length>0&&_.enqueue({type:"tool-input-delta",id:q.id,delta:q.function.arguments}),dl(q.function.arguments)&&(_.enqueue({type:"tool-input-end",id:q.id}),_.enqueue({type:"tool-call",toolCallId:(R=q.id)!=null?R:ot(),toolName:q.function.name,input:q.function.arguments,...q.thoughtSignature?{providerMetadata:{[g]:{thoughtSignature:q.thoughtSignature}}}:{}}),q.hasFinished=!0));continue}const Me=c[vt];Me.hasFinished||(((B=Re.function)==null?void 0:B.arguments)!=null&&(Me.function.arguments+=(L=(P=Re.function)==null?void 0:P.arguments)!=null?L:""),_.enqueue({type:"tool-input-delta",id:Me.id,delta:(N=Re.function.arguments)!=null?N:""}),((J=Me.function)==null?void 0:J.name)!=null&&((ve=Me.function)==null?void 0:ve.arguments)!=null&&dl(Me.function.arguments)&&(_.enqueue({type:"tool-input-end",id:Me.id}),_.enqueue({type:"tool-call",toolCallId:(re=Me.id)!=null?re:ot(),toolName:Me.function.name,input:Me.function.arguments,...Me.thoughtSignature?{providerMetadata:{[g]:{thoughtSignature:Me.thoughtSignature}}}:{}}),Me.hasFinished=!0))}}},flush(v){var _,w,D,E,I;f&&v.enqueue({type:"reasoning-end",id:"reasoning-0"}),y&&v.enqueue({type:"text-end",id:"txt-0"});for(const $ of c.filter(x=>!x.hasFinished))v.enqueue({type:"tool-input-end",id:$.id}),v.enqueue({type:"tool-call",toolCallId:(_=$.id)!=null?_:ot(),toolName:$.function.name,input:$.function.arguments,...$.thoughtSignature?{providerMetadata:{[g]:{thoughtSignature:$.thoughtSignature}}}:{}});const T={[g]:{},...a?.buildMetadata()};((w=p?.completion_tokens_details)==null?void 0:w.accepted_prediction_tokens)!=null&&(T[g].acceptedPredictionTokens=(D=p?.completion_tokens_details)==null?void 0:D.accepted_prediction_tokens),((E=p?.completion_tokens_details)==null?void 0:E.rejected_prediction_tokens)!=null&&(T[g].rejectedPredictionTokens=(I=p?.completion_tokens_details)==null?void 0:I.rejected_prediction_tokens),v.enqueue({type:"finish",finishReason:d,usage:h1(p),providerMetadata:T})}})),request:{body:s},response:{headers:l}}}},i(Qo,"OpenAICompatibleChatLanguageModel"),Qo),v1=rd({prompt_tokens:A().nullish(),completion_tokens:A().nullish(),total_tokens:A().nullish(),prompt_tokens_details:b({cached_tokens:A().nullish()}).nullish(),completion_tokens_details:b({reasoning_tokens:A().nullish(),accepted_prediction_tokens:A().nullish(),rejected_prediction_tokens:A().nullish()}).nullish()}).nullish(),SN=rd({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({message:b({role:k("assistant").nullish(),content:m().nullish(),reasoning_content:m().nullish(),reasoning:m().nullish(),tool_calls:M(b({id:m().nullish(),function:b({name:m(),arguments:m()}),extra_content:b({google:b({thought_signature:m().nullish()}).nullish()}).nullish()})).nullish()}),finish_reason:m().nullish()})),usage:v1}),kN=rd({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({delta:b({role:fe(["assistant"]).nullish(),content:m().nullish(),reasoning_content:m().nullish(),reasoning:m().nullish(),tool_calls:M(b({index:A().nullish(),id:m().nullish(),function:b({name:m().nullish(),arguments:m().nullish()}),extra_content:b({google:b({thought_signature:m().nullish()}).nullish()}).nullish()})).nullish()}).nullish(),finish_reason:m().nullish()})),usage:v1}),IN=i(e=>se([kN,e]),"createOpenAICompatibleChatChunkSchema");function _1(e){var t,n;if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const r=(t=e.prompt_tokens)!=null?t:0,o=(n=e.completion_tokens)!=null?n:0;return{inputTokens:{total:r,noCache:r,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:o,text:o,reasoning:void 0},raw:e}}i(_1,"convertOpenAICompatibleCompletionUsage");function AN({prompt:e,user:t="user",assistant:n="assistant"}){let r="";e[0].role==="system"&&(r+=`${e[0].content}

`,e=e.slice(1));for(const{role:o,content:s}of e)switch(o){case"system":throw new Rn({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const a=s.map(l=>{switch(l.type){case"text":return l.text}}).filter(Boolean).join("");r+=`${t}:
${a}

`;break}case"assistant":{const a=s.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new pt({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${a}

`;break}case"tool":throw new pt({functionality:"tool messages"});default:{const a=o;throw new Error(`Unsupported role: ${a}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}i(AN,"convertToOpenAICompatibleCompletionPrompt");function b1({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}i(b1,"getResponseMetadata2");function w1(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}i(w1,"mapOpenAICompatibleFinishReason2");var TN=b({echo:qe().optional(),logitBias:Ae(m(),A()).optional(),suffix:m().optional(),user:m().optional()}),FN=(es=class{constructor(t,n){this.specificationVersion="v3";var r;this.modelId=t,this.config=n;const o=(r=n.errorStructure)!=null?r:hi;this.chunkSchema=RN(o.errorSchema),this.failedResponseHandler=Pt(o)}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var t,n,r;return(r=(n=(t=this.config).supportedUrls)==null?void 0:n.call(t))!=null?r:{}}async getArgs({prompt:t,maxOutputTokens:n,temperature:r,topP:o,topK:s,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d,providerOptions:p,tools:h,toolChoice:g}){var f;const y=[],v=(f=await mt({provider:this.providerOptionsName,providerOptions:p,schema:TN}))!=null?f:{};s!=null&&y.push({type:"unsupported",feature:"topK"}),h?.length&&y.push({type:"unsupported",feature:"tools"}),g!=null&&y.push({type:"unsupported",feature:"toolChoice"}),c!=null&&c.type!=="text"&&y.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:_,stopSequences:w}=AN({prompt:t}),D=[...w??[],...u??[]];return{args:{model:this.modelId,echo:v.echo,logit_bias:v.logitBias,suffix:v.suffix,user:v.user,max_tokens:n,temperature:r,top_p:o,frequency_penalty:a,presence_penalty:l,seed:d,...p?.[this.providerOptionsName],prompt:_,stop:D.length>0?D:void 0},warnings:y}}async doGenerate(t){const{args:n,warnings:r}=await this.getArgs(t),{responseHeaders:o,value:s,rawValue:a}=await Qe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:n,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:ut(ON),abortSignal:t.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u=[];return l.text!=null&&l.text.length>0&&u.push({type:"text",text:l.text}),{content:u,usage:_1(s.usage),finishReason:{unified:w1(l.finish_reason),raw:l.finish_reason},request:{body:n},response:{...b1(s),headers:o,body:a},warnings:r}}async doStream(t){const{args:n,warnings:r}=await this.getArgs(t),o={...n,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await Qe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ve(this.config.headers(),t.headers),body:o,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:Xr(this.chunkSchema),abortSignal:t.abortSignal,fetch:this.config.fetch});let l={unified:"other",raw:void 0},u,c=!0;return{stream:a.pipeThrough(new TransformStream({start(d){d.enqueue({type:"stream-start",warnings:r})},transform(d,p){var h;if(t.includeRawChunks&&p.enqueue({type:"raw",rawValue:d.rawValue}),!d.success){l={unified:"error",raw:void 0},p.enqueue({type:"error",error:d.error});return}const g=d.value;if("error"in g){l={unified:"error",raw:void 0},p.enqueue({type:"error",error:g.error});return}c&&(c=!1,p.enqueue({type:"response-metadata",...b1(g)}),p.enqueue({type:"text-start",id:"0"})),g.usage!=null&&(u=g.usage);const f=g.choices[0];f?.finish_reason!=null&&(l={unified:w1(f.finish_reason),raw:(h=f.finish_reason)!=null?h:void 0}),f?.text!=null&&p.enqueue({type:"text-delta",id:"0",delta:f.text})},flush(d){c||d.enqueue({type:"text-end",id:"0"}),d.enqueue({type:"finish",finishReason:l,usage:_1(u)})}})),request:{body:o},response:{headers:s}}}},i(es,"OpenAICompatibleCompletionLanguageModel"),es),D1=b({prompt_tokens:A(),completion_tokens:A(),total_tokens:A()}),ON=b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({text:m(),finish_reason:m()})),usage:D1.nullish()}),RN=i(e=>se([b({id:m().nullish(),created:A().nullish(),model:m().nullish(),choices:M(b({text:m(),finish_reason:m().nullish(),index:A()})),usage:D1.nullish()}),e]),"createOpenAICompatibleCompletionChunkSchema"),Xd=b({dimensions:A().optional(),user:m().optional()}),PN=(ts=class{constructor(t,n){this.specificationVersion="v3",this.modelId=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var t;return(t=this.config.maxEmbeddingsPerCall)!=null?t:2048}get supportsParallelCalls(){var t;return(t=this.config.supportsParallelCalls)!=null?t:!0}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async doEmbed({values:t,headers:n,abortSignal:r,providerOptions:o}){var s,a,l;const u=[],c=await mt({provider:"openai-compatible",providerOptions:o,schema:Xd});c!=null&&u.push({type:"other",message:"The 'openai-compatible' key in providerOptions is deprecated. Use 'openaiCompatible' instead."});const d=Object.assign(c??{},(s=await mt({provider:"openaiCompatible",providerOptions:o,schema:Xd}))!=null?s:{},(a=await mt({provider:this.providerOptionsName,providerOptions:o,schema:Xd}))!=null?a:{});if(t.length>this.maxEmbeddingsPerCall)throw new p0({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:p,value:h,rawValue:g}=await Qe({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Ve(this.config.headers(),n),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:d.dimensions,user:d.user},failedResponseHandler:Pt((l=this.config.errorStructure)!=null?l:hi),successfulResponseHandler:ut(MN),abortSignal:r,fetch:this.config.fetch});return{warnings:u,embeddings:h.data.map(f=>f.embedding),usage:h.usage?{tokens:h.usage.prompt_tokens}:void 0,providerMetadata:h.providerMetadata,response:{headers:p,body:g}}}},i(ts,"OpenAICompatibleEmbeddingModel"),ts),MN=b({data:M(b({embedding:M(A())})),usage:b({prompt_tokens:A()}).nullish(),providerMetadata:Ae(m(),Ae(m(),ft())).optional()}),NN=(ns=class{constructor(t,n){this.modelId=t,this.config=n,this.specificationVersion="v3",this.maxImagesPerCall=10}get provider(){return this.config.provider}get providerOptionsKey(){return this.config.provider.split(".")[0].trim()}getArgs(t){return{...t[this.providerOptionsKey],...t[BN(this.providerOptionsKey)]}}async doGenerate({prompt:t,n,size:r,aspectRatio:o,seed:s,providerOptions:a,headers:l,abortSignal:u,files:c,mask:d}){var p,h,g,f,y;const v=[];o!=null&&v.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),s!=null&&v.push({type:"unsupported",feature:"seed"});const _=(g=(h=(p=this.config._internal)==null?void 0:p.currentDate)==null?void 0:h.call(p))!=null?g:new Date,w=this.getArgs(a);if(c!=null&&c.length>0){const{value:I,responseHeaders:T}=await Cd({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:Ve(this.config.headers(),l),formData:b_({model:this.modelId,prompt:t,image:await Promise.all(c.map($=>C1($))),mask:d!=null?await C1(d):void 0,n,size:r,...w}),failedResponseHandler:Pt((f=this.config.errorStructure)!=null?f:hi),successfulResponseHandler:ut(E1),abortSignal:u,fetch:this.config.fetch});return{images:I.data.map($=>$.b64_json),warnings:v,response:{timestamp:_,modelId:this.modelId,headers:T}}}const{value:D,responseHeaders:E}=await Qe({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Ve(this.config.headers(),l),body:{model:this.modelId,prompt:t,n,size:r,...w,response_format:"b64_json"},failedResponseHandler:Pt((y=this.config.errorStructure)!=null?y:hi),successfulResponseHandler:ut(E1),abortSignal:u,fetch:this.config.fetch});return{images:D.data.map(I=>I.b64_json),warnings:v,response:{timestamp:_,modelId:this.modelId,headers:E}}}},i(ns,"OpenAICompatibleImageModel"),ns),E1=b({data:M(b({b64_json:m()}))});async function C1(e){if(e.type==="url")return gd(e.url);const t=e.data instanceof Uint8Array?e.data:gr(e.data);return new Blob([t],{type:e.mediaType})}i(C1,"fileToBlob");function BN(e){return e.replace(/[_-]([a-z])/g,t=>t[1].toUpperCase())}i(BN,"toCamelCase");var jN="2.0.30";function vl(e){const t=$d(e.baseURL),n=e.name,r={...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`},...e.headers},o=i(()=>yr(r,`ai-sdk/openai-compatible/${jN}`),"getHeaders"),s=i(h=>({provider:`${n}.${h}`,url:i(({path:g})=>{const f=new URL(`${t}${g}`);return e.queryParams&&(f.search=new URLSearchParams(e.queryParams).toString()),f.toString()},"url"),headers:o,fetch:e.fetch}),"getCommonModelConfig"),a=i(h=>l(h),"createLanguageModel"),l=i(h=>new xN(h,{...s("chat"),includeUsage:e.includeUsage,supportsStructuredOutputs:e.supportsStructuredOutputs,transformRequestBody:e.transformRequestBody,metadataExtractor:e.metadataExtractor}),"createChatModel"),u=i(h=>new FN(h,{...s("completion"),includeUsage:e.includeUsage}),"createCompletionModel"),c=i(h=>new PN(h,{...s("embedding")}),"createEmbeddingModel"),d=i(h=>new NN(h,s("image")),"createImageModel"),p=i(h=>a(h),"provider");return p.specificationVersion="v3",p.languageModel=a,p.chatModel=l,p.completionModel=u,p.embeddingModel=c,p.textEmbeddingModel=c,p.imageModel=d,p}i(vl,"createOpenAICompatible");const LN={plain:"<commit message>",conventional:`<type>[optional (<scope>)]: <commit message>
The commit message subject must start with a lowercase letter`,gitmoji:":emoji: <commit message>"},UN=i(e=>`The output response must be in format:
${LN[e]}`,"specifyCommitFormat"),zN={plain:"",conventional:`Choose a type from the type-to-description JSON below that best describes the git diff. IMPORTANT: The type MUST be lowercase (e.g., "feat", not "Feat" or "FEAT"):
${JSON.stringify({docs:"Documentation only changes",style:"Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)",refactor:"A code change that improves code structure without changing functionality (renaming, restructuring classes/methods, extracting functions, etc)",perf:"A code change that improves performance",test:"Adding missing tests or correcting existing tests",build:"Changes that affect the build system or external dependencies",ci:"Changes to our CI configuration files and scripts",chore:"Other changes that don't modify src or test files",revert:"Reverts a previous commit",feat:"A new feature",fix:"A bug fix"},null,2)}`,gitmoji:`Choose an emoji from the emoji-to-description JSON below that best describes the git diff:
${JSON.stringify({"\u{1F3A8}":"Improve structure / format of the code","\u26A1":"Improve performance","\u{1F525}":"Remove code or files","\u{1F41B}":"Fix a bug","\u{1F691}":"Critical hotfix","\u2728":"Introduce new features","\u{1F4DD}":"Add or update documentation","\u{1F680}":"Deploy stuff","\u{1F484}":"Add or update the UI and style files","\u{1F389}":"Begin a project","\u2705":"Add, update, or pass tests","\u{1F512}":"Fix security or privacy issues","\u{1F510}":"Add or update secrets","\u{1F516}":"Release / Version tags","\u{1F6A8}":"Fix compiler / linter warnings","\u{1F6A7}":"Work in progress","\u{1F49A}":"Fix CI Build","\u2B07\uFE0F":"Downgrade dependencies","\u2B06\uFE0F":"Upgrade dependencies","\u{1F4CC}":"Pin dependencies to specific versions","\u{1F477}":"Add or update CI build system","\u{1F4C8}":"Add or update analytics or track code","\u267B\uFE0F":"Refactor code","\u2795":"Add a dependency","\u2796":"Remove a dependency","\u{1F527}":"Add or update configuration files","\u{1F528}":"Add or update development scripts","\u{1F310}":"Internationalization and localization","\u270F\uFE0F":"Fix typos","\u{1F4A9}":"Write bad code that needs to be improved","\u23EA":"Revert changes","\u{1F500}":"Merge branches","\u{1F4E6}":"Add or update compiled files or packages","\u{1F47D}":"Update code due to external API changes","\u{1F69A}":"Move or rename resources (e.g.: files, paths, routes)","\u{1F4C4}":"Add or update license","\u{1F4A5}":"Introduce breaking changes","\u{1F371}":"Add or update assets","\u267F":"Improve accessibility","\u{1F4A1}":"Add or update comments in source code","\u{1F37B}":"Write code drunkenly","\u{1F4AC}":"Add or update text and literals","\u{1F5C3}":"Perform database related changes","\u{1F50A}":"Add or update logs","\u{1F507}":"Remove logs","\u{1F465}":"Add or update contributor(s)","\u{1F6B8}":"Improve user experience / usability","\u{1F3D7}":"Make architectural changes","\u{1F4F1}":"Work on responsive design","\u{1F921}":"Mock things","\u{1F95A}":"Add or update an easter egg","\u{1F648}":"Add or update a .gitignore file","\u{1F4F8}":"Add or update snapshots","\u2697":"Perform experiments","\u{1F50D}":"Improve SEO","\u{1F3F7}":"Add or update types","\u{1F331}":"Add or update seed files","\u{1F6A9}":"Add, update, or remove feature flags","\u{1F945}":"Catch errors","\u{1F4AB}":"Add or update animations and transitions","\u{1F5D1}":"Deprecate code that needs to be cleaned up","\u{1F6C2}":"Work on code related to authorization, roles and permissions","\u{1FA79}":"Simple fix for a non-critical issue","\u{1F9D0}":"Data exploration/inspection","\u26B0":"Remove dead code","\u{1F9EA}":"Add a failing test","\u{1F454}":"Add or update business logic","\u{1FA7A}":"Add or update healthcheck","\u{1F9F1}":"Infrastructure related changes","\u{1F9D1}\u200D\u{1F4BB}":"Improve developer experience","\u{1F4B8}":"Add sponsorships or money related infrastructure","\u{1F9F5}":"Add or update code related to multithreading or concurrency","\u{1F9BA}":"Add or update code related to validation"},null,2)}`},qN=i((e,t,n,r)=>["Generate a concise git commit message title in present tense that precisely describes the key changes in the following code diff. Focus on what was changed, not just file names. Provide only the title, no description or body.",`Message language: ${e}`,`Commit message must be a maximum of ${t} characters.`,"Exclude anything unnecessary such as translation. Your entire response will be passed directly into git commit.",`IMPORTANT: Do not include any explanations, introductions, or additional text. Do not wrap the commit message in quotes or any other formatting. The commit message must not exceed ${t} characters. Respond with ONLY the commit message text.`,"Be specific: include concrete details (package names, versions, functionality) rather than generic statements.",r,zN[n],UN(n)].filter(Boolean).join(`
`),"generatePrompt"),$1=i(e=>{const t=/<think>[\s\S]*?<\/think>/gi;let n=e.replace(t,"");return n=n.trim(),n},"extractResponseFromReasoning"),Qd=i(e=>$1(e).trim().split(`
`)[0].replace(/(\w)\.$/,"$1").replace(/^["'`]|["'`]$/g,"").replace(/^<[^>]*>\s*/,""),"sanitizeMessage"),x1=i(e=>Array.from(new Set(e)),"deduplicateMessages"),S1=i(async(e,t,n,r,o)=>{const s=new AbortController,a=setTimeout(()=>s.abort(),o);try{const l=await eo({model:e(t),system:`You are a tool that shortens git commit messages. Given a commit message, make it shorter while preserving the key information and format. The shortened message must be ${r} characters or less. Respond with ONLY the shortened commit message.`,prompt:n,temperature:.2,maxRetries:2,maxOutputTokens:500});return clearTimeout(a),Qd(l.text)}catch(l){throw clearTimeout(a),l}},"shortenCommitMessage"),ep=i(async(e,t,n,r,o,s,a,l,u,c)=>{process.env.DEBUG&&(console.log("Diff being sent to AI:"),console.log(o));try{const d=e==="https://api.openai.com/v1"?mi({apiKey:t}):vl({name:"custom",apiKey:t,baseURL:e}),p=new AbortController,h=setTimeout(()=>p.abort(),u),g=Array.from({length:s},()=>eo({model:d(n),system:qN(r,a,l,c),prompt:o,temperature:.4,maxRetries:2,maxOutputTokens:2e3}).finally(()=>clearTimeout(h))),f=await Promise.all(g);let y=f.map(D=>D.text),v=x1(y.map(D=>Qd(D)));const _=3;for(let D=0;D<_;D++){let E=!1;const I=await Promise.all(v.map(async T=>{if(T.length<=a)return T;E=!0;try{return await S1(d,n,T,a,u)}catch{return T}}));if(v=x1(I),!E)break}const w={prompt_tokens:f.reduce((D,E)=>D+(E.usage.promptTokens||0),0),completion_tokens:f.reduce((D,E)=>D+(E.usage.completionTokens||0),0),total_tokens:f.reduce((D,E)=>D+(E.usage.totalTokens||0),0)};return{messages:v,usage:w}}catch(d){const p=d;if(console.log(p),p.code==="ENOTFOUND")throw new pe(`Error connecting to ${p.hostname} (${p.syscall}). Are you connected to the internet?`);if(p.status===429){const h=p.headers?.get("x-ratelimit-reset");let g="Rate limit exceeded";if(h){const f=parseInt(h),y=Date.now(),v=f-y,_=Math.ceil(v/1e3);if(_>0){let w;if(_<60)w=`${_} second${_===1?"":"s"}`;else if(_<3600){const D=Math.ceil(_/60);w=`${D} minute${D===1?"":"s"}`}else{const D=Math.ceil(_/3600);w=`${D} hour${D===1?"":"s"}`}g+=`. Retry in ${w}.`}}throw new pe(g)}throw p}},"generateCommitMessage"),VN=i(async(e,t,n,r,o,s)=>{try{const a=t==="https://api.openai.com/v1"?mi({apiKey:n}):vl({name:"custom",apiKey:n,baseURL:t}),l=new AbortController,u=setTimeout(()=>l.abort(),s),d=await eo({model:a(r),system:`You are a tool that generates git commit messages. Your task is to combine multiple commit messages into one.

Input: Several commit messages separated by newlines.
Output: A single commit message starting with type like 'feat:' or 'fix:'.

Do not add thanks, explanations, or any text outside the commit message.`,prompt:e.join(`
`),temperature:.4,maxRetries:2,maxOutputTokens:2e3});clearTimeout(u);let p=Qd(d.text);if(p.length>o)try{p=await S1(a,r,p,o,s)}catch{}return{messages:[p],usage:d.usage}}catch(a){const l=a;throw console.log(l),l}},"combineCommitMessages"),tp=i(async(e,t,n,r,o,s,a,l,u,c)=>{try{const d=e==="https://api.openai.com/v1"?mi({apiKey:t}):vl({name:"custom",apiKey:t,baseURL:e}),p=new AbortController,h=setTimeout(()=>p.abort(),u),f=`You group git file changes into logical atomic commits. Each group is one coherent change.

Rules:
- Every file must appear in exactly one group.
- Group by logical purpose (feature, bugfix, refactor, config, etc.).
- Related test files go with their implementation files.
- Config/dependency changes get their own group.
- Maximum ${a} groups. Fewer is better if changes are related.
- ${l==="conventional"?"Use conventional commit format (feat:, fix:, chore:, refactor:, docs:, test:, etc.).":l==="gitmoji"?"Use gitmoji format (\u{1F41B}, \u2728, \u{1F527}, etc.).":"Use a plain descriptive format."}
${c?`- Additional instructions: ${c}`:""}
- Write messages in language: ${r}.

Return ONLY a JSON array, no other text:
[{"message": "commit message here", "files": ["path/to/file"]}]`,y=3e4;let v=s;s.length>y&&(v=s.substring(0,y)+`

[Diff truncated]`);const _=`Files changed:
${o.join(`
`)}

Diff:
${v}`,w=await eo({model:d(n),system:f,prompt:_,temperature:.3,maxRetries:2,maxOutputTokens:4e3});clearTimeout(h);let D=$1(w.text).trim();const E=D.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/)||D.match(/(\[[\s\S]*\])/);E&&(D=E[1].trim());const I=JSON.parse(D),T=new Set(I.flatMap(S=>S.files)),$=new Set(o),x=o.filter(S=>!T.has(S));x.length>0&&I[I.length-1].files.push(...x);for(const S of I)S.files=S.files.filter(Z=>$.has(Z));return{groups:I.filter(S=>S.files.length>0),usage:w.usage}}catch{return{groups:[{message:"chore: update files",files:o}],usage:null}}},"groupChangesWithAI"),GN=6500;async function ZN(e,t){const{files:n}=e,r=t?_v:vv,o=t?fF:cF;if(n.length<=30){const a=await r(n);return a.length<=3e4?a:a.substring(0,3e4)+`

[Diff truncated]`}if(n.length<=100){const a=await o(n),l=await r(n.slice(0,20)),u=`Diff stat:
${a}

Partial diff (first 20 files):
${l}`;return u.length>3e4?u.substring(0,3e4)+`

[Truncated]`:u}const s=await o(n);return`Diff stat (${n.length} files):
${s}`}i(ZN,"getBoundaryDiff");const WN=i(async(e,t,n,r,o,s,a,l,u,c,d)=>{const p=[];let h={promptTokens:0,completionTokens:0,totalTokens:0};for(let g=0;g<o.length;g++){const f=o[g];if(f.autoGroup){p.push(f.autoGroup);continue}c?.(f.name,g,o.length);const y=await ZN(f,d),v=`Project boundary: "${f.name}" (${f.type}). ${f.files.length} files.`,_=await tp(e,t,n,r,f.files,y,s,a,l,u?`${v} ${u}`:v);p.push(..._.groups),_.usage&&(h.promptTokens+=_.usage.promptTokens||0,h.completionTokens+=_.usage.completionTokens||0,h.totalTokens+=_.usage.totalTokens||0),g<o.length-1&&!o[g+1]?.autoGroup&&await new Promise(w=>setTimeout(w,GN))}return{groups:p,usage:h}},"groupBoundariesWithAI"),HN=[{indicator:"Cargo.toml",type:{name:"Rust (cargo)",buildCommand:"cargo build --release",sourceDir:"src"}},{indicator:"go.mod",type:{name:"Go",buildCommand:"go build ./...",sourceDir:"."}},{indicator:"justfile",type:{name:"Just",buildCommand:"just build",sourceDir:"src"}},{indicator:"Taskfile.yml",type:{name:"Task",buildCommand:"task build",sourceDir:"src"}},{indicator:"Makefile",type:{name:"Make",buildCommand:"make",sourceDir:"src"}},{indicator:"CMakeLists.txt",type:{name:"C/C++ (CMake)",buildCommand:"cmake --build build",sourceDir:"src"}},{indicator:"pnpm-lock.yaml",type:{name:"Node.js (pnpm)",buildCommand:"pnpm run build",sourceDir:"src"}},{indicator:["bun.lock","bun.lockb"],type:{name:"Node.js (bun)",buildCommand:"bun run build",sourceDir:"src"}},{indicator:"yarn.lock",type:{name:"Node.js (yarn)",buildCommand:"yarn build",sourceDir:"src"}},{indicator:"package-lock.json",type:{name:"Node.js (npm)",buildCommand:"npm run build",sourceDir:"src"}},{indicator:"pyproject.toml",type:{name:"Python",buildCommand:"python -m build",sourceDir:"src"}},{indicator:"setup.py",type:{name:"Python (legacy)",buildCommand:"python setup.py build",sourceDir:"."}},{indicator:"package.json",type:{name:"Node.js (npm)",buildCommand:"npm run build",sourceDir:"src"}}];function _l(e,t){try{return bt(`git ${e}`,{encoding:"utf8",cwd:t,stdio:["pipe","pipe","pipe"]}).trim()}catch{return null}}i(_l,"git");function JN(e,t){try{return bt(`find ${t} -name "*.ts" -type f -print0 | sort -z | xargs -0 shasum | shasum`,{encoding:"utf8",cwd:e,stdio:["pipe","pipe","pipe"]}).trim().split(/\s/)[0]||null}catch{return null}}i(JN,"getSourceFingerprint");function to(){const e=Fi(import.meta.url);let t=on(e);for(let n=0;n<5;n++){if(Le(je(t,"package.json")))return t;t=on(t)}return on(e)}i(to,"getProjectRoot");function yi(e){for(const t of HN)if((Array.isArray(t.indicator)?t.indicator:[t.indicator]).some(r=>Le(je(e,r))))return{...t.type};return null}i(yi,"detectProjectType");function np(){const e=to(),t=je(e,"dist",".build-meta.json");try{const n=Gn(t,"utf8");return JSON.parse(n)}catch{return null}}i(np,"readBuildMeta");function k1(e){const t=to(),n=np(),r=yi(t),o=e||r?.sourceDir||"src";if(!_l("rev-parse --is-inside-work-tree",t))return{fresh:!0,meta:n,currentHash:null,projectType:r,reason:"Not in a git repo"};const a=_l(`rev-parse HEAD:${o}`,t);if(!a)return{fresh:!0,meta:n,currentHash:null,projectType:r,reason:`No git tree for ${o}/`};if(!n)return{fresh:!1,meta:null,currentHash:a,projectType:r,reason:"No .build-meta.json found (never built or first run)"};if(n.srcTreeHash===a){if(n.srcFingerprint){const c=JN(t,o);if(c&&c!==n.srcFingerprint)return{fresh:!1,meta:n,currentHash:a,projectType:r,reason:"Build is stale \u2014 uncommitted source changes detected"}}return{fresh:!0,meta:n,currentHash:a,projectType:r,reason:"Build is up to date"}}const l=_l(`rev-list --count ${n.gitCommitFull}..HEAD -- ${o}`,t),u=l?`${l} commit(s) with src changes`:"source changed";return{fresh:!1,meta:n,currentHash:a,projectType:r,reason:`Build is stale \u2014 ${u}`}}i(k1,"checkBuildFreshness");function rp(){return to()}i(rp,"getProjectRootPath");function KN(e){const t=to(),n=yi(t),r=e||n?.sourceDir||"src";try{return bt(`git diff --name-only HEAD~1..HEAD -- ${r}`,{encoding:"utf8",cwd:t,stdio:["pipe","pipe","pipe"]}).trim().length>0}catch{return!0}}i(KN,"didCommitChangeSource");function I1(){const e=to();return _l("rev-parse --abbrev-ref HEAD",e)}i(I1,"getCurrentBranch");function YN(){const e=to();try{const t=bt("git tag --points-at HEAD",{encoding:"utf8",cwd:e,stdio:["pipe","pipe","pipe"]}).trim();return t?t.split(`
`).map(n=>n.trim()).filter(Boolean):[]}catch{return[]}}i(YN,"getHeadTags");function A1(e,t){const n=t.replace(/\*\*/g,"{{GLOBSTAR}}").replace(/\*/g,"[^/]*").replace(/\?/g,".").replace(/\{\{GLOBSTAR\}\}/g,".*");return new RegExp(`^${n}$`).test(e)}i(A1,"matchesGlobPattern");const op=["aicommits","aic"];function vi(){return op}i(vi,"getBinaryNames");function no(e){const t=Hn(),n=process.env.HOME||process.env.USERPROFILE||"";if(t==="win32"){const r=process.env.LOCALAPPDATA||je(n,"AppData","Local");return e==="user"?je(r,"Programs","aicommits"):je(process.env.ProgramFiles||"C:\\Program Files","aicommits")}return e==="user"?je(n,".local","bin"):"/usr/local/bin"}i(no,"getDefaultInstallDir");function sp(e){const t=(process.env.PATH||"").split(":"),n=sn(e);return t.some(r=>sn(r)===n)}i(sp,"isInPath");function _i(e){try{return hD(e,gD.W_OK),!0}catch{return!1}}i(_i,"checkWriteable");function bl(){const e=Fi(import.meta.url);let t=on(e);for(let n=0;n<5;n++){const r=je(t,"dist","cli.mjs");if(Le(r))return r;t=on(t)}return je(on(on(Fi(import.meta.url))),"..","dist","cli.mjs")}i(bl,"getProjectEntrypoint");function T1(){return process.execPath}i(T1,"getNodePath");function F1(e,t){return Hn()==="win32"?["@echo off",`"${e}" "${t}" %*`,""].join(`\r
`):["#!/usr/bin/env sh",`exec "${e}" "${t}" "$@"`,""].join(`
`)}i(F1,"getShellWrapper");function O1(e){if(sp(e))return null;if(Hn()==="win32")return`Add to PATH: setx PATH "%PATH%;${e}"`;const r=(process.env.SHELL||"/bin/sh").split("/").pop(),o=`export PATH="${e}:$PATH"`;switch(r){case"zsh":return`Add to ~/.zshrc:
  ${o}`;case"bash":return`Add to ~/.bashrc:
  ${o}`;case"fish":return`Add to ~/.config/fish/config.fish:
  fish_add_path ${e}`;default:return`Add to your shell profile:
  ${o}`}}i(O1,"getPathHint");function R1(){const e=process.env.HOME||process.env.USERPROFILE||"",t=[{dir:je(e,".local","bin"),scope:"user"},{dir:"/usr/local/bin",scope:"system"}];if(Hn()==="win32"){const r=process.env.LOCALAPPDATA||je(e,"AppData","Local");t.unshift({dir:je(r,"Programs","aicommits"),scope:"user"})}const n=[];for(const{dir:r,scope:o}of t)for(const s of op){const a=je(r,s);Le(a)&&n.push({name:s,path:a,scope:o})}return n}i(R1,"findInstalledBinaries");function XN(e){try{const t=Gn(e,"utf8");if(t.includes("pnpm"))return"pnpm global";if(t.includes("npm"))return"npm global";if(t.includes("dist/cli.mjs"))return"aicommits install";if(t.includes("yarn"))return"yarn global";if(t.includes("bun"))return"bun global"}catch{}try{const t=Sf(e);if(t.includes(".pnpm")||t.includes("pnpm"))return"pnpm global";if(t.includes(".npm")||t.includes("npm"))return"npm global";if(t.includes(".yarn")||t.includes("yarn"))return"yarn global";if(t.includes(".bun")||t.includes("bun"))return"bun global";if(t.includes("homebrew")||t.includes("Cellar"))return"homebrew"}catch{}return"unknown"}i(XN,"classifyBinarySource");function P1(){const e=new Map,t=(process.env.PATH||"").split(":").filter(Boolean);for(const n of op){const r=[],o=new Set;for(const s of t){const a=je(s,n);if(!Le(a))continue;let l,u=!1;try{l=Sf(a),u=l!==sn(a)}catch{l=sn(a)}o.has(l)||(o.add(l),r.push({name:n,path:a,realPath:l,isSymlink:u,isActive:r.length===0,source:XN(a)}))}r.length>0&&e.set(n,r)}return e}i(P1,"findAllBinariesInPath");function M1(){const e=P1();for(const[,t]of e)if(t.length>1)return!0;return!1}i(M1,"hasPathConflicts");function QN(e,t){const n=t.split(",").map(r=>r.trim()).filter(Boolean);return n.length===0?!0:n.some(r=>A1(e,r))}i(QN,"matchesBranchFilter");function e5(e,t){return t?e.some(n=>A1(n,t)):!0}i(e5,"matchesTagFilter");const bi=i(async(e,t)=>{const n=e["post-commit"],r=e["post-commit-rebuild"]||"off",o=e["post-commit-install"]||!1,s=e["post-commit-branches"],a=e["post-commit-tag-pattern"],l=r!=="off",u=n&&n.trim().length>0;if(!l&&!o&&!u)return;if(s){const p=I1();if(p&&!QN(p,s)){console.log(V(`  Skipped post-commit: branch "${p}" doesn't match "${s}"`));return}}if(a){const p=YN();if(p.length===0||!e5(p,a)){console.log(V(`  Skipped post-commit: HEAD not tagged (filter: "${a}")`));return}}console.log(""),console.log(Ie("\u2699 Post-commit pipeline:"));const c=I1();c&&s&&console.log(`  ${Q("\u2713")} Branch: ${c} ${V(`(matches ${s})`)}`);let d=!1;l&&(d=await t5(r,e,t)),o&&d&&await n5(),u&&await r5(n,t),console.log("")},"runPostCommit");async function t5(e,t,n){const r=t["rebuild-source-dir"];if(e==="smart"){if(!KN(r))return console.log(`  ${V("\u25CB")} Rebuild: skipped ${V("(no source changes in commit)")}`),!1;console.log(`  ${Q("\u2713")} Source changed in commit`)}const o=rp(),s=yi(o),a=t["rebuild-command"]||s?.buildCommand||"npm run build";if(n&&e==="always"){const u=await fn({message:`Rebuild? ${V(`(${a})`)}`});if(lt(u)||!u)return console.log(`  ${V("\u25CB")} Rebuild: skipped by user`),!1}const l=He();l.start(`Rebuilding (${a})...`);try{return bt(a,{cwd:o,stdio:"pipe",encoding:"utf8"}),l.stop(`  ${Q("\u2713")} Rebuilt successfully`),!0}catch(u){const c=u instanceof Error?u.message:String(u);return l.stop(`  ${Oe("\u26A0")} Rebuild failed`),console.log(`    ${V(c.split(`
`)[0])}`),!1}}i(t5,"runRebuildStep");async function n5(){const e=He();e.start("Installing binary...");try{const t=no("user"),n=bl(),r=T1(),o=F1(r,n),s=Hn()==="win32";if(Le(t)||Si(t,{recursive:!0,mode:493}),!_i(t)){e.stop(`  ${Oe("\u26A0")} Install: ${t} not writeable`);return}for(const u of vi()){const c=je(t,s?`${u}.cmd`:u);Pl(c,o,{mode:493}),s||kf(c,493)}const a=[...vi()].join(" + "),l=sp(t)?"":V(` (\u26A0 ${t} not in PATH)`);e.stop(`  ${Q("\u2713")} Installed ${a} \u2192 ${V(t)}${l}`)}catch(t){const n=t instanceof Error?t.message:String(t);e.stop(`  ${Oe("\u26A0")} Install failed: ${V(n)}`)}}i(n5,"runInstallStep");async function r5(e,t){const n=e.split(";").map(r=>r.trim()).filter(Boolean);if(n.length!==0){if(t){const r=await fn({message:`Run post-commit: ${V(e)}`});if(lt(r)||!r)return}for(const r of n){const o=He();o.start(`Running: ${r}`);try{await we(r,{shell:!0,stdio:"pipe"}),o.stop(`  ${Q("\u2713")} ${r}`)}catch(s){const a=s instanceof Error?s.message:String(s);o.stop(`  ${Oe("\u26A0")} Failed: ${r}`),console.log(`    ${V(a)}`)}}}}i(r5,"runCommandsStep");const o5=i(async(e,t)=>{const{select:n,confirm:r,isCancel:o}=await Promise.resolve().then(function(){return zs}),{dim:s}=await Promise.resolve().then(function(){return yT}),a=process.stdout.isTTY&&!process.env.CI;if(e.length===1){const[u]=e;if(t)return u;if(!a)throw new pe("Interactive terminal required for commit message confirmation. Use --yes flag to skip confirmation.");console.log(`
\x1B[1m${u}\x1B[0m
`);const c=await r({message:"Use this commit message?"});return c&&!o(c)?u:null}if(t)return e[0];if(!a)throw new pe("Interactive terminal required for commit message selection. Use --yes flag to skip selection and use the first message.");const l=await n({message:`Pick a commit message to use: ${s("(Ctrl+c to exit)")}`,options:e.map(u=>({label:u,value:u}))});return o(l)?null:l},"getCommitMessage");var s5=i(async(e,t,n,r,o,s,a,l,u,c)=>(async()=>{mn(Ps(Rs(" aicommits "))),await $a();const d=He();n&&await we("git",["add","--update"]),d.start("Detecting staged files");const p=await jc(t);if(!p)throw d.stop("Detecting staged files"),new pe("No staged changes found. Stage your changes manually, or automatically stage all changes with the `--all` flag.");p.files.length<=10?d.stop(`\u{1F4C1} ${yv(p.files)}:
${p.files.map(j=>`     ${j}`).join(`
`)}`):d.stop(`\u{1F4C1} ${yv(p.files)}`);const h=await En({generate:e?.toString(),type:r?.toString()}),g=cr(h);if(!g)if(process.stdout.isTTY&&!process.env.CI){console.log("Welcome to aicommits! Let's set up your AI provider."),console.log("Run `aicommits setup` to configure your provider."),ee("Setup required. Please run: aicommits setup");return}else throw new pe("No configuration found. Run `aicommits setup` in an interactive terminal, or set environment variables (OPENAI_API_KEY, etc.)");const f=h.timeout||(g.name==="ollama"?3e4:1e4),y=g.validateConfig();if(!y.valid)throw new pe(`Provider configuration issues: ${y.errors.join(", ")}. Run \`aicommits setup\` to reconfigure.`);h.model=h.OPENAI_MODEL||g.getDefaultModel();const v=50,_=50,w=6500;let D=!1;p.files.length>v&&(D=!0);const E=He();E.start(`\u{1F50D} Analyzing changes in ${p.files.length} file${p.files.length===1?"":"s"}`);const I=Date.now();let T,$;try{const j=g.getBaseUrl(),S=g.getApiKey()||"";if(D){const Z=[];for(let L=0;L<p.files.length;L+=_)Z.push(p.files.slice(L,L+_));const R=[];let B={promptTokens:0,completionTokens:0,totalTokens:0};for(let L=0;L<Z.length;L++){const N=Z[L],J=await lF(N,t);if(J&&J.diff){let re=J.diff;re.length>3e4&&(re=re.substring(re.length-3e4)+`

[Diff truncated due to size]`);const le=await ep(j,S,h.model,h.locale,re,h.generate,h["max-length"],h.type,f,u);R.push(...le.messages),le.usage&&(B.promptTokens+=le.usage.promptTokens||0,B.completionTokens+=le.usage.completionTokens||0,B.totalTokens+=le.usage.totalTokens||0)}L<Z.length-1&&await new Promise(ve=>setTimeout(ve,w))}const P=await VN(R,j,S,h.model,h["max-length"],f);T=P.messages,P.usage&&(B.promptTokens+=P.usage.promptTokens||0,B.completionTokens+=P.usage.completionTokens||0,B.totalTokens+=P.usage.totalTokens||0),$=B}else{let R=p.diff;R.length>3e4&&(R=R.substring(R.length-3e4)+`

[Diff truncated due to size]`);const B=await ep(j,S,h.model,h.locale,R,h.generate,h["max-length"],h.type,f,u);T=B.messages,$=B.usage}}finally{const j=Date.now()-I;let S="";if($?.total_tokens){const Z=$.total_tokens,R=Z>=1e3?`${(Z/1e3).toFixed(0)}k`:Z.toString(),B=Math.round(Z/(j/1e3));S=`, ${R} tokens (${B} tokens/s)`}E.stop(`\u2705 Changes analyzed in ${(j/1e3).toFixed(1)}s${S}`)}if(T.length===0)throw new pe("No commit messages were generated. Try again.");const x=await o5(T,o);if(!x){ee("Commit cancelled");return}if(s){await By(x)&&ee(`${Q("\u2714")} Message copied to clipboard`);return}try{const j=["-m",x];a&&j.push("--no-verify"),await we("git",["commit",...j,...c],{stdio:"inherit",cleanup:!0,timeout:1e4}),ee(`${Q("\u2714")} Successfully committed!`),l||await bi(h,!o)}catch(j){if(j.timedOut){const S=await By(x);ee(S?`${Oe("\u26A0")} Commit timed out after 10 seconds. Message copied to clipboard.`:`${Oe("\u26A0")} Commit timed out after 10 seconds. Could not copy to clipboard.`);return}throw j}})().catch(zr),"aicommits");const[wl,i5]=process.argv.slice(2);var a5=i(()=>(async()=>{if(!wl)throw new pe('Commit message file path is missing. This file should be called from the "prepare-commit-msg" git hook');if(i5)return;const e=await jc();if(!e)return;mn(Ps(Rs(" aicommits ")));const t=await En({}),n=cr(t);if(!n)throw new pe("Invalid provider configuration. Run `aicommits setup` to reconfigure.");const r=n.validateConfig();if(!r.valid)throw new pe(`Provider configuration issues: ${r.errors.join(", ")}. Run \`aicommits setup\` to reconfigure.`);const o=n.getBaseUrl(),s=n.getApiKey()||"",a=t.timeout||(n.name==="ollama"?3e4:1e4);let l=t.OPENAI_MODEL||n.getDefaultModel();const u=He();u.start("The AI is analyzing your changes");let c;try{c=(await ep(o,s,l,t.locale,e.diff,t.generate,t["max-length"],t.type,a)).messages}finally{u.stop("Changes analyzed")}const p=await et.readFile(wl,"utf8")!=="",h=c.length>1;let g="";p&&(g=`# \u{1F916} AI generated commit${h?"s":""}
`),h?(p&&(g+=`# Select one of the following messages by uncommenting:
`),g+=`
${c.map(v=>`# ${v}`).join(`
`)}`):(p&&(g+=`# Edit the message below and commit:
`),g+=`
${c[0]}
`);const f=await et.readFile(wl,"utf8"),y=g+`
`+f;await et.writeFile(wl,y),ee(`${Q("\u2714")} Saved commit message!`)})().catch(zr),"prepareCommitMessageHook"),l5=Bt({name:"config",description:"View or modify configuration settings",help:{description:`View or modify configuration settings

Modes:
  (none)   Show active config summary
  edit     Interactive config editor (TUI wizard)
  open     Open config file in $VISUAL / $EDITOR / system default
  get      Get a config value:   aicommits config get OPENAI_API_KEY
  set      Set a config value:   aicommits config set OPENAI_MODEL=gpt-4o
  info     Show all config sources and precedence
  migrate  Move legacy ~/.aicommits to XDG path (~/.config/aicommits/config)
  path     Print the resolved config file path

Common config keys:
  OPENAI_API_KEY          Your provider API key
  OPENAI_BASE_URL         Provider base URL (auto-set by setup)
  OPENAI_MODEL            Model to use (e.g. gpt-4o, openai/gpt-4.1)
  type                    Default commit format: plain | conventional | gitmoji
  locale                  Language for commit messages (e.g. en, de, fr)
  max-length              Max commit message length (default: 72)
  post-commit             Command to run after commit (e.g. "git push")
  post-commit-rebuild     Rebuild binary after commit: smart | always | off
  post-commit-install     Auto-install rebuilt binary: true | false
  post-commit-branches    Only rebuild on matching branches (glob, e.g. "main,release/*")
  auto-rebuild            Dev rebuild mode: prompt | auto | off`},parameters:["[mode]","[key=value...]"]},e=>{(async()=>{const[t,...n]=e._;if(!t){const r=await En({},{},!0),o=Ht();console.log(Ie("Active config")+V(` (${o})`)),console.log(""),r.provider&&console.log(`  Provider:              ${r.provider}`),r.OPENAI_API_KEY&&console.log(`  API Key:               ${r.OPENAI_API_KEY.substring(0,4)}****`),r.OPENAI_BASE_URL&&console.log(`  Base URL:              ${r.OPENAI_BASE_URL}`),r.OPENAI_MODEL&&console.log(`  Model:                 ${r.OPENAI_MODEL}`),r.type&&console.log(`  Commit type:           ${r.type}`),r.locale&&console.log(`  Locale:                ${r.locale}`),r["max-length"]&&console.log(`  Max length:            ${r["max-length"]}`),r["post-commit"]&&console.log(`  Post-commit:           ${r["post-commit"]}`),r["post-commit-rebuild"]&&console.log(`  Post-commit rebuild:   ${r["post-commit-rebuild"]}`),r["post-commit-install"]!==void 0&&console.log(`  Post-commit install:   ${r["post-commit-install"]}`),r["post-commit-branches"]&&console.log(`  Post-commit branches:  ${r["post-commit-branches"]}`),r["post-commit-tag-pattern"]&&console.log(`  Post-commit tag:       ${r["post-commit-tag-pattern"]}`),r["auto-rebuild"]&&console.log(`  Auto-rebuild:          ${r["auto-rebuild"]}`),r["rebuild-command"]&&console.log(`  Rebuild command:       ${r["rebuild-command"]}`),r["rebuild-source-dir"]&&console.log(`  Rebuild source dir:    ${r["rebuild-source-dir"]}`),process.stdout.isTTY&&(console.log(""),console.log(V(`  Run ${Ie("aicommits config edit")} to edit interactively`)));return}if(t==="get"){const r=await En({},{},!0),o=["OPENAI_API_KEY","TOGETHER_API_KEY","api-key"];for(const s of n)if(zc(r,s)){const a=r[s],l=o.includes(s)?`${String(a).substring(0,4)}****`:String(a);console.log(`${s}=${l}`)}return}if(t==="set"){await Ta(n.map(r=>{const o=r.indexOf("=");return o===-1?[r,""]:[r.slice(0,o),r.slice(o+1)]}));return}if(t==="info"){const r=Ht(),o=Vc(),s=Aa(),a=Ev(),l=wv(),u=Dv();console.log(Ie("Configuration sources (highest precedence first):")),console.log(`  1. CLI flags          ${V("(active)")}`);const c=process.env.AICOMMITS_CONFIG;console.log(`  2. AICOMMITS_CONFIG   ${c||V("not set")}`),console.log(`  3. Project config     ${a?Q(a):V("not found")}`);const d=dt.existsSync(o);console.log(`  4. User config (XDG)  ${d?Q(o):V(o+" (not found)")}`),dt.existsSync(s)&&console.log(`     Legacy fallback    ${Oe(s+' (active \u2014 run "aicommits config migrate")')}`);const h=l.find(g=>dt.existsSync(g));console.log(`  5. System config      ${h?Q(h):V(l[0]+" (not found)")}`),console.log(""),console.log(`Active config:  ${Ie(r)}`),console.log(`Cache dir:      ${u}`);return}if(t==="migrate"){const r=Aa(),o=Vc(),s=qc();if(!dt.existsSync(r)){dt.existsSync(o)?console.log(`${Q("\u2713")} Already using XDG config at ${o}`):console.log(`No config file found. New config will be created at ${o}`);return}if(dt.existsSync(o)){console.log(`${Oe("\u26A0")} Both legacy (${r}) and XDG (${o}) configs exist.`),console.log("  XDG config takes precedence. Remove the legacy file manually if desired.");return}console.log(`Moving config from ${r} to ${o}...`),dt.existsSync(s)||(dt.mkdirSync(s,{recursive:!0}),console.log(`  ${Q("\u2713")} Created ${s}/`)),dt.copyFileSync(r,o),console.log(`  ${Q("\u2713")} Copied config file`),dt.unlinkSync(r),console.log(`  ${Q("\u2713")} Removed legacy file`),console.log(`
${Q("\u2713")} Migration complete! Config now at ${o}`);return}if(t==="path"){console.log(Ht());return}if(t==="open"){const r=Ht();if(!dt.existsSync(r)){const s=qc();dt.mkdirSync(s,{recursive:!0}),dt.writeFileSync(r,"","utf8")}const o=process.env.VISUAL||process.env.EDITOR||(process.platform==="darwin"?"open -t":process.platform==="win32"?"notepad":"xdg-open");console.log(V(`Opening ${r} with ${o}...`));try{bt(`${o} "${r}"`,{stdio:"inherit",...process.stdin.isTTY?{}:{stdio:"pipe"}})}catch{throw new pe(`Failed to open editor "${o}". Set $VISUAL or $EDITOR to your preferred editor.
  Example: export EDITOR=nano`)}return}if(t==="edit"){if(!process.stdout.isTTY)throw new pe('Interactive mode requires a terminal. Use "aicommits config set key=value" instead.');const r=await En({},{},!0),o=Ht();mn(Ie("aicommits config")),Ur(`Config file: ${o}
Provider settings \u2192 use ${Ie("aicommits setup")}
Model selection  \u2192 use ${Ie("aicommits model")}`);const s=[],a=i(_=>(lt(_)&&(ee(V("No changes made.")),process.exit(0)),!1),"cancelled");Ut.step(Ie("Commit Format"));const l=await Dn({message:"Commit message format",options:[{value:"conventional",label:"conventional",hint:"feat:, fix:, chore:, etc."},{value:"plain",label:"plain",hint:"Simple freeform messages"},{value:"gitmoji",label:"gitmoji",hint:"\u{1F389} \u{1F41B} \u2728 etc."}],initialValue:String(r.type||"conventional")});a(l),l!==r.type&&s.push(["type",l]);const u=await hn({message:"Commit message locale",placeholder:"en",initialValue:String(r.locale||"en")});a(u),u!==(r.locale||"en")&&s.push(["locale",u]);const c=await hn({message:"Max commit message length",placeholder:"72",initialValue:String(r["max-length"]||72),validate:i(_=>{if(!_||!/^\d+$/.test(_))return"Must be a number";if(Number(_)<20)return"Must be at least 20"},"validate")});a(c),String(c)!==String(r["max-length"]||72)&&s.push(["max-length",c]),Ut.step(Ie("Post-Commit Actions"));const d=!!r["post-commit"],p=await fn({message:"Run a command after each commit?",initialValue:d});if(a(p),p){const _=await hn({message:"Command to run after commit",placeholder:"git push",initialValue:String(r["post-commit"]||"")});a(_),_!==(r["post-commit"]||"")&&s.push(["post-commit",_])}else d&&s.push(["post-commit",""]);Ut.step(Ie("Build Pipeline"));const h=await Dn({message:"Auto-rebuild after commit",options:[{value:"smart",label:"smart",hint:"Only when source files changed"},{value:"always",label:"always",hint:"Rebuild on every commit"},{value:"off",label:"off",hint:"Never auto-rebuild"}],initialValue:String(r["post-commit-rebuild"]||"off")});if(a(h),h!==(r["post-commit-rebuild"]||"off")&&s.push(["post-commit-rebuild",h]),h!=="off"){const _=await fn({message:"Auto-install binary after rebuild?",initialValue:r["post-commit-install"]===!0||String(r["post-commit-install"])==="true"});a(_);const w=_?"true":"false";w!==String(r["post-commit-install"]||"false")&&s.push(["post-commit-install",w]);const D=await hn({message:"Limit rebuild to branches (glob, comma-separated)",placeholder:"all branches",initialValue:String(r["post-commit-branches"]||"")});a(D),D!==(r["post-commit-branches"]||"")&&s.push(["post-commit-branches",D]);const E=await hn({message:"Limit rebuild to tags (glob pattern)",placeholder:"all tags",initialValue:String(r["post-commit-tag-pattern"]||"")});a(E),E!==(r["post-commit-tag-pattern"]||"")&&s.push(["post-commit-tag-pattern",E])}Ut.step(Ie("Developer"));const g=await Dn({message:"Dev auto-rebuild on stale binary",options:[{value:"prompt",label:"prompt",hint:"Ask before rebuilding"},{value:"auto",label:"auto",hint:"Rebuild silently"},{value:"off",label:"off",hint:"Just warn, don't rebuild"}],initialValue:String(r["auto-rebuild"]||"prompt")});a(g),g!==(r["auto-rebuild"]||"prompt")&&s.push(["auto-rebuild",g]);const f=await hn({message:"Custom rebuild command",placeholder:"auto-detect",initialValue:String(r["rebuild-command"]||"")});a(f),f!==(r["rebuild-command"]||"")&&s.push(["rebuild-command",f]);const y=await hn({message:"Source directory to watch for changes",placeholder:"auto-detect",initialValue:String(r["rebuild-source-dir"]||"")});if(a(y),y!==(r["rebuild-source-dir"]||"")&&s.push(["rebuild-source-dir",y]),s.length===0){ee(V("No changes made."));return}console.log(""),Ut.step(Ie("Changes"));for(const[_,w]of s)console.log(w===""?`  ${Oe("\u2212")} ${_} ${V("(removed)")}`:`  ${Q("+")} ${_} = ${Ie(w)}`);console.log("");const v=await fn({message:`Save ${s.length} change${s.length>1?"s":""}?`,initialValue:!0});a(v),v?(await Ta(s),ee(`${Q("\u2713")} Config saved to ${o}`)):ee(V("Discarded."));return}throw new pe(`Invalid mode: ${t}`)})().catch(zr)}),u5=Bt({name:"setup",description:"Configure your AI provider and settings",help:{description:`Configure your AI provider and settings interactively.
Walks you through selecting a provider (OpenAI, Copilot, Ollama, etc.)
and saving your API key.

Examples:
  aicommits setup                  Start interactive provider configuration`}},()=>{(async()=>{let e=await En();const t=GF(),n=await Dn({message:"Choose your AI provider:",options:t,initialValue:e.provider});if(lt(n)){ee("Setup cancelled");return}const r=n;let o="";if(r==="custom"){const h=await hn({message:"Enter your custom API endpoint:",validate:i(g=>{if(!g)return"Endpoint is required";try{new URL(g)}catch{return"Invalid URL format"}},"validate")});if(lt(h)){ee("Setup cancelled");return}o=h}let s=o||ZF(r);e.OPENAI_BASE_URL=s,e.OPENAI_API_KEY="",e.OPENAI_MODEL="";let a=cr({...e,provider:r});if(!a){ee("Invalid provider selected");return}try{const h=await a.setup();for(const[g,f]of h)e[g]=f}catch(h){if(h instanceof Error&&h.message==="Setup cancelled"){ee("Setup cancelled");return}throw h}if(a=cr({...e,provider:r}),!a){ee("Invalid provider selected");return}const l=a.validateConfig();if(!l.valid){ee(`Setup cancelled: ${l.errors.join(", ")}`);return}const{selectModel:u}=await Promise.resolve().then(function(){return VF}),c=await u(a.getBaseUrl(),a.getApiKey()||"",void 0,a.getDefinition());if(c)e.OPENAI_MODEL=c,console.log(`Model selected: ${c}`);else{ee("Model selection cancelled.");return}const d=await Dn({message:"Choose commit message format:",options:[{value:"plain",label:"Plain - Simple format without structure"},{value:"conventional",label:"Conventional - Standard conventional commits"},{value:"gitmoji",label:"Gitmoji - Using emojis for commit types"}],initialValue:"plain"});if(lt(d)){ee("Setup cancelled");return}e.type=d;const p=Object.entries(e).filter(([h,g])=>h!=="provider"&&h!=="model"&&g!==void 0&&g!==""&&typeof g=="string");await Ta(p),ee(`\u2705 Setup complete! You're now using ${a.displayName}.`)})().catch(e=>{console.error(`\u274C Setup failed: ${e.message}`),process.exit(1)})}),c5=Bt({name:"model",description:"Select or change your AI model",help:{description:`Select or change the AI model for commit generation.
Fetches available models from the configured provider and lets you pick one.

Examples:
  aicommits model                  Browse and select from available models`},alias:["-m","models"]},()=>{(async()=>{const e=await En();if(!e.provider){ee("No provider configured. Run `aicommits setup` first.");return}const t=cr(e);if(!t){ee("Invalid provider configured. Run `aicommits setup` to reconfigure.");return}const n=e.OPENAI_MODEL,r=t.validateConfig();if(!r.valid){ee(`Configuration issues: ${r.errors.join(", ")}. Run \`aicommits setup\` to reconfigure.`);return}const o=await Iv(t.getBaseUrl(),t.getApiKey()||"",n,t.getDefinition(),t.displayName);o?(await Ta([["OPENAI_MODEL",o]]),ee(`\u2705 Model updated to: ${o}`)):ee("Model selection cancelled")})().catch(e=>{console.error(`\u274C Model selection failed: ${e.message}`),process.exit(1)})});const N1="prepare-commit-msg",B1=`.git/hooks/${N1}`,Dl=Fi(new URL("cli.mjs",import.meta.url)),j1=process.argv[1].replace(/\\/g,"/").endsWith(`/${B1}`),L1=process.platform==="win32",U1=`
#!/usr/bin/env node
import(${JSON.stringify(ID(Dl))})
`.trim();var d5=Bt({name:"hook",description:"Install or uninstall the Git hook for automatic commit messages",help:{description:`Install or uninstall the Git hook for automatic commit messages

Examples:
  aicommits hook install               Add prepare-commit-msg hook to current repo
  aicommits hook uninstall             Remove the hook from current repo`},parameters:["<install/uninstall>"]},e=>{(async()=>{const t=await $a(),{installUninstall:n}=e._,r=Xe.join(t,B1),o=await ka(r);if(n==="install"){if(o){if(await et.realpath(r).catch(()=>{})===Dl){console.warn("The hook is already installed");return}throw new pe(`A different ${N1} hook seems to be installed. Please remove it before installing aicommits.`)}await et.mkdir(Xe.dirname(r),{recursive:!0}),L1?await et.writeFile(r,U1):(await et.symlink(Dl,r,"file"),await et.chmod(r,493)),console.log(`${Q("\u2714")} Hook installed`);return}if(n==="uninstall"){if(!o){console.warn("Hook is not installed");return}if(L1){if(await et.readFile(r,"utf8")!==U1){console.warn("Hook is not installed");return}}else if(await et.realpath(r)!==Dl){console.warn("Hook is not installed");return}await et.rm(r),console.log(`${Q("\u2714")} Hook uninstalled`);return}throw new pe(`Invalid mode: ${n}`)})().catch(t=>{console.error(`${dn("\u2716")} ${t.message}`),mv(t),process.exit(1)})});function p5(e){const t=e.match(/github\.com[\/:]([^\/]+)\/([^\/\.]+)/);if(t)return{provider:"github",owner:t[1],repo:t[2]};const n=e.match(/gitlab\.com[\/:]([^\/]+)\/([^\/\.]+)/);if(n)return{provider:"gitlab",owner:n[1],repo:n[2]};const r=e.match(/bitbucket\.org[\/:]([^\/]+)\/([^\/\.]+)/);if(r)return{provider:"bitbucket",owner:r[1],repo:r[2]};const o=e.match(/dev\.azure\.com[\/:]([^\/]+)\/([^\/\.]+)|vs-internal\.visualstudio\.com[\/:]([^\/]+)\/([^\/\.]+)/);if(o)return{provider:"azure",owner:o[1]||o[3],repo:o[2]||o[4]};throw new pe(`Unsupported git provider. Supported: GitHub, GitLab, Bitbucket, Azure DevOps.
Remote URL: ${e}`)}i(p5,"parseRemoteUrl");function f5(e,t,n,r,o,s,a){const l=encodeURIComponent(s),u=encodeURIComponent(a);switch(e){case"github":return`https://github.com/${t}/${n}/compare/${r}...${o}?expand=1&title=${l}&body=${u}`;case"gitlab":return`https://gitlab.com/${t}/${n}/-/merge_requests/new?merge_request[source_branch]=${encodeURIComponent(o)}&merge_request[target_branch]=${encodeURIComponent(r)}&merge_request[title]=${l}&merge_request[description]=${u}`;case"bitbucket":return`https://bitbucket.org/${t}/${n}/pull-requests/new?source=${encodeURIComponent(o)}&dest=${encodeURIComponent(r)}&title=${l}&description=${u}`;case"azure":return`https://dev.azure.com/${t}/${n}/_git/${n}/pullrequestcreate?sourceRef=${encodeURIComponent(o)}&targetRef=${encodeURIComponent(r)}&title=${l}&description=${u}`}}i(f5,"getPrUrl");var m5=Bt({name:"pr",description:"[beta \u{1F6A7}] Generate and create a PR (GitHub/GitLab/Bitbucket/Azure) based on branch diff",help:{description:`[beta \u{1F6A7}] Generate and create a PR (GitHub/GitLab/Bitbucket/Azure) based on branch diff.
Uses AI to write a PR title and description from the commits on your branch.

Examples:
  aicommits pr                     Generate a PR for the current branch`}},()=>{(async()=>{mn(Ps(Rs(" aicommits pr "))),await $a();const{stdout:e}=await we("git",["branch","--show-current"]);if(!e.trim())throw new pe("Not on a branch");const{stdout:t}=await we("git",["remote","get-url","origin"]),n=p5(t),{provider:r,owner:o,repo:s}=n;let a="main";try{const{stdout:R}=await we("git",["symbolic-ref","refs/remotes/origin/HEAD"]);a=R.trim().replace("refs/remotes/origin/","")}catch{}if(e.trim()===a)throw new pe("PR creation requires being on a feature branch, not the default branch. Please switch to a feature branch with changes.");let l;try{const{stdout:R}=await we("git",["diff",`origin/${a}..HEAD`]);l=R}catch{throw new pe(`Could not get diff from origin/${a}`)}if(!l)throw new pe("No changes to create PR from");const u=l.split(`
`).filter(R=>R.startsWith("diff --git")).length,c=3e4;l.length>c&&(l=l.substring(0,c)+`

[Diff truncated due to size]`);const d=await En(),p=await cr(d);if(!p)throw new pe("No provider configured");let h=p.getBaseUrl();if(!h||h==="")throw new pe("Base URL not configured. Please run `aicommits setup` to configure your provider.");h.endsWith("/v1")||(h+="/v1");const g=p.getApiKey();if(!g)throw new pe("API key not configured. Please run `aicommits setup` to configure your provider.");const f=h==="https://api.openai.com/v1"?mi({apiKey:g}):vl({name:"custom",apiKey:g,baseURL:h}),y=He();y.start(`Generating PR title and description (${u} files changed)`);const v=Date.now(),w=(await eo({model:f(d.model),system:"Generate a concise PR title based on the following git diff. The title should be under 72 characters.",prompt:l,maxRetries:2})).text,E=(await eo({model:f(d.model),system:"Generate a concise PR description based on the following git diff. Format using Markdown with headings like ### Summary, ### Changes, ### Review Notes. Provide a high-level summary of the changes, what was implemented or fixed, and any specific details reviewers should consider. Avoid listing individual files.",prompt:l,maxRetries:2})).text,I=Date.now(),T=Math.round((I-v)/1e3);y.stop(`Generated PR content for ${u} files in ${T}s`),console.log(`${Q("Title:")} ${w.replace(/\n/g," ")}`),console.log(`${Q("Body:")} ${E.length>100?E.substring(0,100)+"...":E}`);const{text:$}=await Promise.resolve().then(function(){return zs}),x=await $({message:"Press Enter to push and open PR creation in browser, or Ctrl+C to cancel",placeholder:"Press Enter"});if(lt(x)){ee("PR creation cancelled");return}const j=He();j.start(`Pushing branch to ${r}`);try{await we("git",["push","-u","origin",e.trim()]),j.stop(`Branch pushed to ${r}`)}catch(R){throw j.stop("Failed to push branch"),new pe(`Failed to push branch: ${R instanceof Error?R.message:String(R)}`)}const S=f5(r,o,s,a,e.trim(),w,E),Z=He();Z.start("Opening PR creation page in browser");try{const R=process.platform==="darwin"?"open":process.platform==="win32"?"start":"xdg-open";await we(R,[S]),Z.stop("PR creation page opened in browser"),ee(Q("PR creation page opened! Please review and submit the PR."))}catch{Z.stop("Failed to open browser"),ee(`${Q("PR URL:")} ${S}`),ee("Please open the URL above in your browser to create the PR.")}})().catch(e=>{zr(e)})});const h5=[{file:"package.json",type:"node"},{file:"pyproject.toml",type:"python"},{file:"setup.py",type:"python"},{file:"Cargo.toml",type:"rust"},{file:"go.mod",type:"go"},{file:"pom.xml",type:"java"},{file:"build.gradle",type:"java"},{file:"Gemfile",type:"ruby"},{file:"Chart.yaml",type:"helm"},{file:"helmfile.yaml",type:"helm"}],g5=[{file:"docker-compose.yml",type:"docker"},{file:"docker-compose.yaml",type:"docker"},{file:"ansible.cfg",type:"ansible"},{file:"Justfile",type:"taskrunner"},{file:"justfile",type:"taskrunner"},{file:"Makefile",type:"taskrunner"}],y5=1,z1=8,v5=3,_5=[".obsolete","deprecated","archive","old","backup"];function b5(e){const t=e.toLowerCase();return _5.some(n=>t.includes(n))}i(b5,"isCleanupDir");async function w5(){try{const{stdout:e}=await we("git",["config","--file",".gitmodules","--get-regexp","path"]);return e.split(`
`).filter(Boolean).map(t=>t.split(/\s+/)[1]).filter(Boolean)}catch{return[]}}i(w5,"getSubmodulePaths");function D5(e,t){const n=e==="."?0:e.split("/").length;for(const r of h5)if(Le(je(t,e,r.file)))return r.type;if(n<=y5){for(const r of g5)if(Le(je(t,e,r.file)))return r.type}return null}i(D5,"findMarkerType");async function q1(e,t){const n=await w5(),r=new Set;for(const c of e){let d=on(c);for(;d&&d!==".";)r.add(d),d=on(d);r.add(".")}const o=new Map;for(const c of r){const d=D5(c,t);d&&o.set(c,d)}for(const c of n)o.has(c)||o.set(c,"submodule");const s=[...o.entries()].sort((c,d)=>d[0].split("/").length-c[0].split("/").length),a=new Map,l=new Set;for(const c of e){let d=null,p=null;for(const[h,g]of s)if(h==="."||c.startsWith(h+"/")){if(h==="."&&!d)d=h,p=g;else if(h!=="."){d=h,p=g;break}}(!d||d===".")&&(d=c.includes("/")?c.split("/")[0]:".",p=p||"misc"),a.has(d)||a.set(d,{type:p,files:[]}),a.get(d).files.push(c),l.add(c)}const u=[];for(const[c,{type:d,files:p}]of a){const h={name:c==="."?"root":c,type:d,files:p};b5(c)&&(h.autoGroup={message:`chore: clean up ${c}`,files:p}),u.push(h)}return u.sort((c,d)=>c.autoGroup&&!d.autoGroup?1:!c.autoGroup&&d.autoGroup?-1:d.files.length-c.files.length),u.length>z1?E5(u,z1):u}i(q1,"detectProjectBoundaries");function E5(e,t){const n=e.filter(l=>l.autoGroup);let r=e.filter(l=>!l.autoGroup);const o=[],s=[];for(const l of r)l.files.length<v5?s.push(...l.files):o.push(l);s.length>0&&o.push({name:"misc",type:"misc",files:s}),r=o;const a=t-n.length;if(r.length>a){const l=new Map;for(const u of r){const c=u.name.includes("/")?u.name.split("/")[0]:u.name;l.has(c)?l.get(c).files.push(...u.files):l.set(c,{name:c,type:u.type,files:[...u.files]})}r=[...l.values()]}return r.sort((l,u)=>u.files.length-l.files.length),[...r,...n]}i(E5,"consolidateBoundaries");function V1(e){const n=[`\u{1F4C1} Detected ${e.reduce((r,o)=>r+o.files.length,0)} changes across ${e.length} project boundaries:`];for(const r of e){const o=r.autoGroup?" (auto-grouped)":"",s=r.name.padEnd(25);n.push(`     ${s} (${r.files.length} files, ${r.type})${o}`)}return n.join(`
`)}i(V1,"formatBoundarySummary");const C5={node:"\u{1F4E6}",python:"\u{1F40D}",rust:"\u{1F980}",go:"\u{1F439}",java:"\u2615",ruby:"\u{1F48E}",helm:"\u2388",docker:"\u{1F433}",ansible:"\u{1F527}",taskrunner:"\u2699\uFE0F",submodule:"\u{1F4CE}",misc:"\u{1F4C2}"};function $5(e){const t=e.reduce((s,a)=>s+a.files.length,0),n=30,r=Math.max(...e.map(s=>s.files.length)),o=[];for(const s of e){const a=C5[s.type]||"\u{1F4C1}",l=t>0?Math.round(s.files.length/t*100):0,u=r>0?Math.max(1,Math.round(s.files.length/r*n)):1,c="\u2588".repeat(u),d=s.autoGroup?" [auto]":"",p=`${s.files.length}`.padStart(4);o.push(`  ${a} ${s.name}`),o.push(`     ${c} ${p} files (${l}%) \xB7 ${s.type}${d}`);const h=s.files.slice(0,3);for(const g of h)o.push(`     \xB7 ${g}`);s.files.length>3&&o.push(`     \xB7 \u2026 ${s.files.length-3} more`),o.push("")}return o.push(`  Total: ${t} files across ${e.length} boundaries`),o.join(`
`)}i($5,"formatBoundaryDetails");const ip=50;var x5=Bt({name:"split",alias:"stage",description:"AI-powered commit splitting \u2014 group changes into logical atomic commits",help:{description:`Analyze changes, group them into logical atomic commits using AI, then commit each group.

Examples:
  aicommits split                  Auto-group unstaged changes and commit each
  aicommits split -d               Dry run \u2014 preview groups without committing
  aicommits split -y               Auto-commit all groups without confirmation
  aicommits split -S               Re-group already-staged files into atomic commits
  aicommits split -a               Include untracked files in grouping
  aicommits split --scan           Show detected project boundaries (no AI)
  aicommits split --flat           Skip boundary detection, group all changes freely
  aicommits split -t conventional  Use conventional commit format for all messages`},flags:{all:{type:Boolean,description:"Include untracked files (default: tracked only)",alias:"a",default:!1},staged:{type:Boolean,description:"Group already-staged files into multiple commits",alias:"S",default:!1},yes:{type:Boolean,description:"Auto-commit all groups without confirmation",alias:"y",default:!1},dryRun:{type:Boolean,description:"Show groups without committing",alias:"d",default:!1},maxGroups:{type:Number,description:"Maximum number of groups per boundary (default: 3)",alias:"m"},scope:{type:String,description:"Only process changes in a specific directory/boundary",alias:"s"},scan:{type:Boolean,description:"Show detected project boundaries and exit (no AI calls)",default:!1},flat:{type:Boolean,description:"Skip boundary detection \u2014 let AI group all changes freely",alias:"F",default:!1},prompt:{type:String,description:"Custom prompt to guide grouping behavior",alias:"p"},type:{type:String,description:"Commit message format (plain, conventional, gitmoji)",alias:"t"},noPostCommit:{type:Boolean,description:"Skip post-commit actions for this invocation",default:!1}}},e=>{(async()=>{mn(Ps(Rs(" aicommits \xB7 split ")));const t=await $a(),n=e.flags.staged;if(n&&e.flags.all)throw new pe("--staged and --all are mutually exclusive. --all includes untracked files (unstaged mode only).");const r=He();let o,s;if(n){r.start("Detecting staged changes");const v=await jc();if(!v)throw r.stop("No staged changes detected"),new pe("No staged changes found. Stage some files with `git add` first, or omit `--staged` to work with unstaged changes.");if(o=v.files,s=v.diff,e.flags.scope){const w=e.flags.scope.replace(/\/$/,"");if(o=o.filter(D=>D.startsWith(w+"/")||D===w),o.length===0)throw r.stop("No staged changes in scope"),new pe(`No staged changes found in scope: ${w}`)}let _=`\u{1F4E6} Detected ${o.length} staged file${o.length===1?"":"s"}`;if(o.length<=15&&(_+=`:
${o.map(w=>`     ${w}`).join(`
`)}`),r.stop(_),!e.flags.dryRun&&!e.flags.scan){const D=(await dF()).filter(E=>o.includes(E));if(D.length>0){console.log(""),console.log(`  ${Oe("\u26A0")}  ${Oe(`${D.length} file${D.length===1?" is":"s are"} partially staged:`)}`);const E=D.slice(0,5);for(const I of E)console.log(`     ${V("\xB7")} ${I}`);if(D.length>5&&console.log(`     ${V(`\u2026 and ${D.length-5} more`)}`),console.log(`  ${V("Proceeding will stage ALL changes for these files (partial staging will be lost).")}`),console.log(""),!e.flags.yes){const I=await fn({message:"Continue anyway?"});if(lt(I)||!I){ee("Cancelled");return}}}}}else{r.start("Detecting unstaged changes");const v=await uF(e.flags.all);if(!v)throw r.stop("No changes detected"),new pe("No unstaged changes found. Make some changes first, or use `--all` to include untracked files.");let{files:_,modifiedFiles:w,untrackedFiles:D,diff:E}=v;if(o=_,s=E,e.flags.scope){const T=e.flags.scope.replace(/\/$/,"");if(o=o.filter($=>$.startsWith(T+"/")||$===T),o.length===0)throw r.stop("No changes in scope"),new pe(`No unstaged changes found in scope: ${T}`)}let I=`\u{1F4C1} Detected ${o.length} changed file${o.length===1?"":"s"}`;D.length>0&&(I+=` (${w.length} modified, ${D.length} untracked)`),o.length<=15&&(I+=`:
${o.map(T=>`     ${T}`).join(`
`)}`),r.stop(I)}if(e.flags.scan){if(e.flags.flat){ee(V(`Flat mode \u2014 ${o.length} file${o.length===1?"":"s"} will be grouped freely by AI (no boundary detection).`));return}const v=He();v.start("\u{1F50D} Detecting project boundaries...");const _=await q1(o,t);v.stop(V1(_)),console.log(""),console.log($5(_)),ee(V(`Use ${Q("aicommits split")} to group and commit, or ${Q("--scope <dir>")} to focus on one boundary.`));return}const a=await En({type:e.flags.type?.toString()}),l=cr(a);if(!l)throw new pe("No AI provider configured. Run `aicommits setup` first.");const u=l.validateConfig();if(!u.valid)throw new pe(`Provider configuration issues: ${u.errors.join(", ")}. Run \`aicommits setup\` to reconfigure.`);a.model=a.OPENAI_MODEL||l.getDefaultModel();const c=a.timeout||(l.name==="ollama"?3e4:1e4),d=e.flags.maxGroups||3,p=l.getBaseUrl(),h=l.getApiKey()||"";let g;const f=i(async()=>{const v=n?_v:vv,_=[];for(let $=0;$<o.length;$+=ip)_.push(o.slice($,$+ip));const w=He(),D=_.length;w.start(D>1?`\u{1F916} Analyzing ${o.length} files in ${D} chunks (flat mode)...`:"\u{1F916} Analyzing changes to suggest commit groups...");const E=Date.now(),I=[];for(let $=0;$<_.length;$++){D>1&&w.message(`\u{1F916} [${$+1}/${D}] Analyzing chunk ${$+1}...`);const x=await v(_[$]),j=await tp(p,h,a.model,a.locale,_[$],x,d*2,a.type,c,e.flags.prompt);I.push(...j.groups)}const T=Date.now()-E;return w.stop(`\u2705 Grouped into ${I.length} commit${I.length===1?"":"s"} in ${(T/1e3).toFixed(1)}s`),I},"runFlatGrouping");if(e.flags.flat)g=await f();else if(o.length>ip){const v=He();v.start("\u{1F50D} Detecting project boundaries...");const _=await q1(o,t);v.stop(V1(_));let w=_,D=!1;if(!e.flags.yes&&!e.flags.scope&&!e.flags.dryRun&&_.length>1){const E=await Dn({message:`Process all ${_.length} boundaries, or select specific ones?`,options:[{value:"all",label:`Process all ${_.length} boundaries`},{value:"select",label:"Select which boundaries to process"},{value:"flat",label:"Group without boundaries (flat \u2014 AI decides freely)"},{value:"cancel",label:"Cancel"}]});if(lt(E)||E==="cancel"){ee("Cancelled");return}if(E==="flat")D=!0;else if(E==="select"){const I=await Ea({message:"Select boundaries to process:",options:_.map((T,$)=>({value:$,label:`${T.name} (${T.files.length} files, ${T.type})${T.autoGroup?" [auto]":""}`})),required:!0});if(lt(I)){ee("Cancelled");return}w=I.map(T=>_[T])}}if(D)g=await f();else{const E=He();E.start(`\u{1F916} Analyzing ${w.length} boundaries...`);const I=Date.now();g=(await WN(p,h,a.model,a.locale,w,d,a.type,c,e.flags.prompt,(x,j,S)=>{E.message(`\u{1F916} [${j+1}/${S}] Analyzing ${x}...`)},n)).groups;const $=Date.now()-I;E.stop(`\u2705 Grouped into ${g.length} commit${g.length===1?"":"s"} in ${($/1e3).toFixed(1)}s`)}}else{const v=He();v.start("\u{1F916} Analyzing changes to suggest commit groups...");const _=Date.now();g=(await tp(p,h,a.model,a.locale,o,s,d*2,a.type,c,e.flags.prompt)).groups;const D=Date.now()-_;v.stop(`\u2705 Grouped into ${g.length} commit${g.length===1?"":"s"} in ${(D/1e3).toFixed(1)}s`)}console.log("");for(let v=0;v<g.length;v++){const _=g[v];console.log(`  ${Q(`Group ${v+1}:`)} ${_.message}`);const w=10,D=_.files.length>w?_.files.slice(0,w):_.files;for(let E=0;E<D.length;E++){const T=E===D.length-1&&_.files.length<=w?"\u2514":"\u251C";console.log(`    ${V(T)} ${D[E]}`)}_.files.length>w&&console.log(`    ${V("\u2514")} ${V(`... and ${_.files.length-w} more files`)}`),console.log("")}if(e.flags.dryRun)if(!e.flags.yes&&process.stdout.isTTY){const v=await fn({message:"Would you like to proceed and commit these groups?"});if(!(!lt(v)&&v)){ee(`${V("Dry run \u2014 no changes were made")}`);return}}else{ee(`${V("Dry run \u2014 no changes were made")}`);return}if(e.flags.yes){await El(g,n,o),ee(`${Q("\u2714")} All ${g.length} group${g.length===1?"":"s"} committed!`),e.flags.noPostCommit||await bi(a,!1);return}const y=await Dn({message:"What would you like to do?",options:[{value:"all",label:`Commit all ${g.length} groups`},{value:"select",label:"Select which groups to commit"},{value:"edit",label:"Edit commit messages before committing"},{value:"cancel",label:"Cancel"}]});if(lt(y)||y==="cancel"){ee("Cancelled");return}if(y==="all"){await El(g,n,o),ee(`${Q("\u2714")} All ${g.length} group${g.length===1?"":"s"} committed!`),e.flags.noPostCommit||await bi(a,!0);return}if(y==="select"){const v=await Ea({message:"Select groups to commit:",options:g.map((w,D)=>({value:D,label:w.message,hint:`${w.files.length} file${w.files.length===1?"":"s"}`})),required:!0});if(lt(v)){ee("Cancelled");return}const _=v.map(w=>g[w]);await El(_,n,o),ee(`${Q("\u2714")} ${_.length} group${_.length===1?"":"s"} committed!`),e.flags.noPostCommit||await bi(a,!0);return}if(y==="edit"){const v=[];for(const _ of g){const w=await hn({message:`Edit message for ${_.files.length} file${_.files.length===1?"":"s"}:`,defaultValue:_.message,initialValue:_.message});if(lt(w)){ee("Cancelled");return}v.push({..._,message:w})}await El(v,n,o),ee(`${Q("\u2714")} All ${v.length} group${v.length===1?"":"s"} committed!`),e.flags.noPostCommit||await bi(a,!0);return}})().catch(zr)});async function El(e,t,n){if(t&&n){const r=new Set;for(let o=0;o<e.length;o++){const s=e[o],a=He();a.start(`[${o+1}/${e.length}] Committing: ${V(s.message)}`);const l=n.filter(c=>!r.has(c)&&!s.files.includes(c));await pF(l),await Lc(s.files),await we("git",["commit","-m",s.message]);for(const c of s.files)r.add(c);const u=n.filter(c=>!r.has(c));u.length>0&&await Lc(u),a.stop(`${Q("\u2714")} [${o+1}/${e.length}] ${s.message}`)}}else for(let r=0;r<e.length;r++){const o=e[r],s=He();s.start(`[${r+1}/${e.length}] Staging & committing: ${V(o.message)}`),await Lc(o.files),await we("git",["commit","-m",o.message]),s.stop(`${Q("\u2714")} [${r+1}/${e.length}] ${o.message}`)}}i(El,"commitGroups");var S5=Bt({name:"rebuild",description:"Rebuild the project from source (detects project type automatically)",help:{description:`Rebuild the project from source (detects project type automatically)

Examples:
  aicommits rebuild                    Rebuild if source has changed
  aicommits rebuild --clean            Clean dist/ and rebuild from scratch
  aicommits rebuild --info             Show build metadata and freshness`},parameters:[],flags:{info:{type:Boolean,description:"Show build metadata and freshness status",default:!1},clean:{type:Boolean,description:"Clean dist/ and rebuild fresh",default:!1}}},e=>{(async()=>{const t=rp(),n=yi(t);if(e.flags.info){const s=np(),a=k1();console.log(Ie("Build info:")),console.log(`  Status:      ${a.fresh?Q("\u2713 Fresh"):Oe("\u26A0 Stale")}`),n&&console.log(`  Project:     ${n.name}`),s?(console.log(`  Built at:    ${s.builtAt}`),console.log(`  Git commit:  ${s.gitCommit}`),console.log(`  Src hash:    ${s.srcTreeHash}`)):console.log(`  ${V("No .build-meta.json found (never built)")}`),a.currentHash&&console.log(`  Current:     ${a.currentHash.slice(0,12)}...`),a.fresh||console.log(`  ${Oe(a.reason)}`);const l=n?.buildCommand||"npm run build";console.log(`  Build cmd:   ${V(l)}`),console.log(`  Source dir:  ${V(n?.sourceDir||"src")}`);return}const r=n?.buildCommand||"npm run build",o=He();o.start(`Rebuilding (${r})...`);try{bt(r,{cwd:t,stdio:"pipe",encoding:"utf8"}),o.stop(`${Q("\u2713")} Rebuilt successfully`);const s=np();s&&console.log(V(`  commit: ${s.gitCommit} | src: ${s.srcTreeHash.slice(0,8)}...`))}catch(s){const a=s instanceof Error?s.message:String(s);o.stop(`${Oe("\u2717")} Rebuild failed`),console.error(V(a)),process.exitCode=1}})()});function k5(e){const t=new Map;for(const n of vi()){const r=je(e,n);if(Le(r))try{const o=Gn(r,"utf8");t.set(n,o)}catch{t.set(n,null)}}return t}i(k5,"detectExistingInstall");var I5=Bt({name:"install",description:"Install aicommits binary to system PATH (~/.local/bin or /usr/local/bin)",help:{description:`Install aicommits binary to system PATH (~/.local/bin or /usr/local/bin)

Examples:
  aicommits install                    Install to ~/.local/bin (user scope)
  aicommits install --scope system     Install to /usr/local/bin (needs sudo)
  aicommits install --bin-dir ~/bin    Install to a custom directory
  aicommits install --binary           Compile a standalone native binary via Bun
  aicommits install --info             Show current installation details`},parameters:[],flags:{scope:{type:String,description:'Install scope: "user" (~/.local/bin) or "system" (/usr/local/bin)'},binDir:{type:String,description:"Custom directory to install binaries to"},info:{type:Boolean,description:"Show current installation details",default:!1},force:{type:Boolean,description:"Overwrite existing binaries without prompting",alias:"f",default:!1},binary:{type:Boolean,description:"Compile a standalone native binary via Bun instead of a shell wrapper",default:!1}}},e=>{(async()=>{if(e.flags.info){A5();return}if(e.flags.binary){const{execSync:g}=await import("child_process"),f=["compile","--install"];e.flags.scope&&f.push("--scope",e.flags.scope);try{g(`node ${sn(bl())} ${f.join(" ")}`,{stdio:"inherit",cwd:process.cwd()})}catch{process.exit(1)}return}mn(Ie("aicommits install"));let t;if(e.flags.scope)e.flags.scope!=="user"&&e.flags.scope!=="system"&&(Ft(`Invalid scope "${e.flags.scope}". Use "user" or "system".`),process.exit(1)),t=e.flags.scope;else if(e.flags.binDir)t="user";else{const g=no("user"),f=no("system"),y=await Dn({message:"Install scope",options:[{value:"user",label:`User \u2014 ${V(g)}`,hint:"no sudo required"},{value:"system",label:`System \u2014 ${V(f)}`,hint:"requires sudo"}]});typeof y!="string"&&(Ft("Installation cancelled."),process.exit(0)),t=y}const n=e.flags.binDir?sn(e.flags.binDir):no(t);if(!Le(n))try{Si(n,{recursive:!0,mode:493}),console.log(V(`  Created ${n}`))}catch{_i(je(n,".."))||(Ft(`Cannot create ${n} \u2014 permission denied. Try with sudo or use --scope user.`),process.exit(1))}const r=_i(n);!r&&t==="system"&&(console.log(Oe(`
  \u26A0 ${n} requires elevated permissions.`)),console.log(V(`  Re-run with: sudo aicommits install --scope system
`)),process.exit(1)),r||(Ft(`Cannot write to ${n}. Check permissions or use --bin-dir.`),process.exit(1));const o=sn(bl()),s=T1();Le(o)||(Ft(`Entry point not found: ${o}
Run 'pnpm build' first.`),process.exit(1));const a=k5(n);if(a.size>0&&!e.flags.force){const g=[...a.keys()].join(", ");await fn({message:`${g} already exist in ${n}. Overwrite?`})!==!0&&(Ft("Installation cancelled."),process.exit(0))}const l=He();l.start(`Installing to ${n}...`);const u=F1(s,o),c=Hn()==="win32",d=[];for(const g of vi()){const f=je(n,c?`${g}.cmd`:g);Pl(f,u,{mode:493}),c||kf(f,493),d.push(f)}l.stop(Q("\u2713 Installation complete"));const p=d.map(g=>`  ${Q("\u2713")} ${g} ${V("(755)")}`),h=O1(n);h?(p.push(""),p.push(`  ${Oe("\u26A0")} ${n} is not in your PATH`),p.push(`  ${V(h)}`)):p.push(`  ${Q("\u2713")} ${n} is in PATH`),p.push(""),p.push(V(`  Points to: ${o}`)),Ur(p.join(`
`),"Installed"),M1()&&(console.log(`  ${Oe("\u26A0")} Multiple aicommits binaries detected in PATH.`),console.log(V(`    Run ${lr("aicommits doctor --fix")} to resolve conflicts.
`))),ee(`Run ${lr("aicommits --version")} to verify.`)})()});function A5(){const e=R1();if(console.log(Ie(`
Installation info:`)),e.length===0){console.log(V("  No aicommits binaries found in standard locations.")),console.log(V("  Checked: ~/.local/bin, /usr/local/bin")),console.log("");return}for(const{name:t,path:n,scope:r}of e){console.log(`  ${Q("\u25CF")} ${Ie(t)}`),console.log(`    Path:   ${n}`),console.log(`    Scope:  ${r}`);try{const a=`0${(If(n).mode&511).toString(8)}`;console.log(`    Perms:  ${a}`)}catch{}try{const a=Gn(n,"utf8").match(/exec\s+"[^"]*"\s+"([^"]+)"/);a&&console.log(`    Target: ${V(a[1])}`)}catch{}const o=n.replace(/\/[^/]+$/,"");console.log(`    In PATH: ${sp(o)?Q("yes"):dn("no")}`),console.log("")}}i(A5,"showInstallInfo");var T5=Bt({name:"uninstall",description:"Remove installed aicommits binaries",help:{description:`Remove installed aicommits binaries from PATH.

Examples:
  aicommits uninstall              Interactively confirm removal
  aicommits uninstall -y           Remove without confirmation prompt`},parameters:[],flags:{yes:{type:Boolean,description:"Skip confirmation prompt",alias:"y",default:!1}}},e=>{(async()=>{mn(Ie("aicommits uninstall"));const t=R1();if(t.length===0){console.log(V("  No aicommits binaries found in standard locations.")),console.log(V("  Checked: ~/.local/bin, /usr/local/bin")),ee("Nothing to uninstall.");return}console.log(`  Found installed binaries:
`);for(const{name:o,path:s,scope:a}of t)console.log(`  ${Ie(o)} \u2014 ${s} ${V(`(${a})`)}`);console.log(""),e.flags.yes||await fn({message:`Remove ${t.length} binary file(s)?`})!==!0&&(Ft("Uninstall cancelled."),process.exit(0));let n=0,r=0;for(const{path:o}of t)try{Le(o)&&(ki(o),console.log(`  ${Q("\u2713")} Removed ${o}`),n++)}catch(s){const a=s instanceof Error?s.message:String(s);a.includes("EACCES")||a.includes("permission")?console.log(`  ${dn("\u2717")} ${o} \u2014 permission denied (try with sudo)`):console.log(`  ${dn("\u2717")} ${o} \u2014 ${a}`),r++}console.log(""),r>0?ee(Oe(`Removed ${n}, failed ${r}. Re-run with sudo for system binaries.`)):ee(Q(`Removed ${n} binary file(s).`))})()}),F5=Bt({name:"doctor",description:"Diagnose installation issues and detect PATH conflicts",help:{description:`Diagnose installation issues and detect PATH conflicts

Examples:
  aicommits doctor                     Check for duplicate binaries in PATH
  aicommits doctor --fix               Interactively remove shadowed duplicates`},parameters:[],flags:{fix:{type:Boolean,description:"Interactively remove duplicate binaries",default:!1}}},e=>{(async()=>{mn(Ie("aicommits doctor"));const t=P1();let n=!1;if(t.size===0){console.log(`  ${dn("\u2717")} No aicommits binaries found in PATH`),console.log(V("    Run: aicommits install")),ee("");return}for(const[r,o]of t){const s=o.length>1;s?(n=!0,console.log(`
  ${Oe("\u26A0")} ${Ie(r)} \u2014 ${Oe(`${o.length} copies found`)}`)):console.log(`
  ${Q("\u2713")} ${Ie(r)} \u2014 ${Q("no conflicts")}`);for(const a of o){const l=a.isActive?Q("\u25CF active"):V("\u25CB shadowed"),u=V(`(${a.source})`),c=a.isSymlink?V(" \u2192 "+a.realPath):"";console.log(`    ${l}  ${a.path}${c}  ${u}`)}if(s){const a=o.find(u=>u.isActive),l=o.filter(u=>!u.isActive);console.log(""),console.log(V(`    The active binary is: ${a?.path}`)),console.log(V(`    ${l.length} shadowed cop${l.length===1?"y":"ies"} will never run`))}}console.log(""),n&&e.flags.fix?await O5(t):n&&Ur(`Run ${lr("aicommits doctor --fix")} to interactively remove duplicates.`,"Tip"),ee(n?"":Q("No issues found."))})()});async function O5(e){const t=[];for(const[,o]of e)if(!(o.length<=1))for(const s of o)s.isActive||t.push(s);if(t.length===0)return;const n=await Ea({message:"Select binaries to remove",options:t.map(o=>({value:o.path,label:`${o.name} \u2014 ${o.path}`,hint:`${o.source}, shadowed`}))});if(lt(n)||n.length===0){console.log(V("  No binaries removed."));return}let r=0;for(const o of n){const s=o,a=s.replace(/\/[^/]+$/,"");if(!_i(a)){console.log(`  ${dn("\u2717")} ${s} \u2014 permission denied (try with sudo)`);continue}try{Le(s)&&(ki(s),console.log(`  ${Q("\u2713")} Removed ${s}`),r++)}catch(l){const u=l instanceof Error?l.message:String(l);console.log(`  ${dn("\u2717")} ${s} \u2014 ${u}`)}}r>0&&console.log(`
  ${Q("\u2713")} Removed ${r} duplicate${r===1?"":"s"}.`)}i(O5,"offerCleanup");const ap=[{value:"bun-darwin-arm64",label:"macOS Apple Silicon (arm64)"},{value:"bun-darwin-x64",label:"macOS Intel (x64)"},{value:"bun-linux-x64",label:"Linux x64 (glibc)"},{value:"bun-linux-arm64",label:"Linux ARM64 (glibc)"},{value:"bun-linux-x64-musl",label:"Linux x64 (musl/Alpine)"},{value:"bun-linux-arm64-musl",label:"Linux ARM64 (musl)"},{value:"bun-windows-x64",label:"Windows x64"}];function lp(){const e=Hn(),t=SD();return e==="darwin"?t==="arm64"?"bun-darwin-arm64":"bun-darwin-x64":e==="win32"?"bun-windows-x64":t==="arm64"?"bun-linux-arm64":"bun-linux-x64"}i(lp,"detectCurrentTarget");function R5(){try{return bt("which bun",{encoding:"utf8"}).trim()}catch{return null}}i(R5,"getBunPath");function P5(){try{return bt("bun --version",{encoding:"utf8"}).trim()}catch{return null}}i(P5,"getBunVersion");function M5(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}i(M5,"formatSize");var N5=Bt({name:"compile",description:"Compile a standalone native binary using Bun",help:{description:`Compile a standalone native binary using Bun

Produces a self-contained executable with no Node.js dependency.
Requires Bun to be installed on the build machine (not on the target).

Examples:
  aicommits compile                          Compile for current platform
  aicommits compile --target bun-linux-x64   Cross-compile for Linux x64
  aicommits compile --outfile ./my-binary    Custom output path
  aicommits compile --install                Compile + install to ~/.local/bin
  aicommits compile --install --scope system Compile + install to /usr/local/bin
  aicommits compile --list-targets           Show all cross-compile targets
  aicommits compile --no-minify              Skip minification
  aicommits compile --no-bytecode            Skip bytecode pre-compilation`},parameters:[],flags:{target:{type:String,description:"Cross-compile target (e.g. bun-linux-x64). Use --list-targets to see all."},outfile:{type:String,alias:"o",description:"Output file path (default: ./aicommits or platform-appropriate name)"},install:{type:Boolean,description:"Install the compiled binary to PATH after compilation",default:!1},scope:{type:String,description:'Install scope when --install is used: "user" or "system"'},minify:{type:Boolean,description:"Minify the bundle (default: true)",default:!0},bytecode:{type:Boolean,description:"Pre-compile to bytecode for faster startup (default: true)",default:!0},listTargets:{type:Boolean,description:"List all available cross-compile targets",default:!1}}},e=>{(async()=>{if(e.flags.listTargets){const v=lp();console.log(Ie(`
Available cross-compile targets:
`));for(const _ of ap){const w=_.value===v?Q(" \u2190 current"):"";console.log(`  ${lr(_.value.padEnd(24))} ${_.label}${w}`)}console.log(V(`
  Usage: aicommits compile --target <target>
`));return}mn(Ie("aicommits compile"));const t=R5();t||(Ft(`Bun is required for binary compilation but was not found.
  Install: curl -fsSL https://bun.sh/install | bash`),process.exit(1));const n=P5();console.log(V(`  Using Bun ${n} (${t})`));const r=e.flags.target;r&&(ap.some(_=>_.value===r)||(Ft(`Unknown target "${r}". Run ${lr("aicommits compile --list-targets")} to see options.`),process.exit(1)));const o=r||lp(),s=ap.find(v=>v.value===o),a=o.includes("windows"),l=r&&r!==lp();let u;if(e.flags.install){const v=e.flags.scope||"user";v!=="user"&&v!=="system"&&(Ft(`Invalid scope "${v}". Use "user" or "system".`),process.exit(1));const _=no(v);if(!Le(_)){const{mkdirSync:w}=await import("fs");w(_,{recursive:!0,mode:493})}_i(_)||(Ft(`Cannot write to ${_}. ${v==="system"?"Try with sudo.":"Check permissions."}`),process.exit(1)),u=je(Mf(),`aicommits-compile-${Date.now()}`)}else e.flags.outfile?u=sn(e.flags.outfile):u=sn(a?"aicommits.exe":"aicommits");const c=sn(bl());Le(c)||(Ft(`Entry point not found: ${c}
Run 'pnpm build' first.`),process.exit(1));const d=["build",c,"--compile"];r&&d.push(`--target=${r}`),e.flags.minify&&d.push("--minify"),e.flags.bytecode&&d.push("--bytecode"),d.push("--outfile",u);const p=He(),h=l?`Compiling for ${s?.label||r}...`:"Compiling native binary...";p.start(h);const g=Date.now();try{bt(`${t} ${d.join(" ")}`,{stdio:"pipe",encoding:"utf8"})}catch(v){p.stop(dn("\u2717 Compilation failed"));const _=v instanceof Error?v.stderr||v.message:String(v);console.error(V(_)),process.exit(1)}const f=Date.now()-g;let y="";try{const v=If(u);y=M5(v.size)}catch{}if(p.stop(Q(`\u2713 Compiled in ${f}ms`)),e.flags.install){const v=e.flags.scope||"user",_=no(v),w=vi(),D=[];for(const T of w){const $=je(_,a?`${T}.exe`:T);try{Le($)&&ki($),yD(u,$)}catch{const{copyFileSync:j}=await import("fs");j(u,$);try{ki(u)}catch{}}const{chmodSync:x}=await import("fs");if(x($,493),D.push($),w.indexOf(T)<w.length-1){const j=je(Mf(),`aicommits-compile-${Date.now()}`);try{bt(`${t} ${d.filter(S=>!S.startsWith("--outfile")).join(" ")} --outfile ${j}`,{stdio:"pipe"})}catch{break}Object.defineProperty(d,"outfile",{value:j})}}const E=D.map(T=>`  ${Q("\u2713")} ${T} ${V(`(${y})`)}`),I=O1(_);I?(E.push(""),E.push(`  ${Oe("\u26A0")} ${_} is not in your PATH`),E.push(`  ${V(I)}`)):E.push(`  ${Q("\u2713")} ${_} is in PATH`),Ur(E.join(`
`),"Installed"),M1()&&(console.log(`  ${Oe("\u26A0")} Multiple aicommits binaries detected.`),console.log(V(`    Run ${lr("aicommits doctor --fix")} to resolve.
`)))}else{const v=[`  Binary:   ${Ie(u)}`,`  Size:     ${y}`,`  Target:   ${o}${l?V(" (cross-compiled)"):""}`,`  Minified: ${e.flags.minify?Q("yes"):V("no")}`,`  Bytecode: ${e.flags.bytecode?Q("yes"):V("no")}`];Ur(v.join(`
`),"Compiled")}ee(`${Q("\u2713")} Done`)})().catch(zr)});AD(mD);function B5(){try{const e=Ht();if(!Le(e))return"prompt";const n=Gn(e,"utf8").match(/^auto-rebuild\s*=\s*(.+)$/m);if(!n)return"prompt";const r=n[1].trim().toLowerCase();return r==="auto"||r==="off"?r:"prompt"}catch{return"prompt"}}i(B5,"loadAutoRebuildConfig");function j5(){try{const e=Ht();if(!Le(e))return{};const t=Gn(e,"utf8"),n=t.match(/^rebuild-command\s*=\s*(.+)$/m),r=t.match(/^rebuild-source-dir\s*=\s*(.+)$/m);return{buildCommand:n?.[1]?.trim()||void 0,sourceDir:r?.[1]?.trim()||void 0}}catch{return{}}}i(j5,"loadConfigOverrides");function L5(e={}){if(process.env.CI||process.env.VITEST||process.env.NODE_ENV==="test")return;const{force:t=!1}=e,n=j5(),r=k1(n.sourceDir);if(r.fresh&&!t)return;const o=B5();if(o==="off"&&!t){console.log(`${Oe("\u26A0")} ${r.reason}`);return}const s=rp(),a=yi(s),l=n.buildCommand||a?.buildCommand||"npm run build";if(console.log(`${Oe("\u26A0")} ${Ie(r.reason)}`),a&&console.log(`  ${V(`Project: ${a.name}`)}`),r.meta&&console.log(`  ${V(`Built: ${r.meta.gitCommit} (${r.meta.builtAt})`)}`),o==="auto"||t){up(l,s);return}if(process.stdout.isTTY&&process.stdin.isTTY)try{const u=bt('printf "? Rebuild now? [Y/n/a(lways)] " >&2 && read -r answer && echo "$answer"',{encoding:"utf8",stdio:["inherit","pipe","inherit"]}).trim().toLowerCase();if(u==="a"||u==="always"){try{const c=Ht(),d=on(c);Le(d)||Si(d,{recursive:!0});let p="";try{p=Gn(c,"utf8")}catch{}p.match(/^auto-rebuild\s*=/m)?p=p.replace(/^auto-rebuild\s*=.*/m,"auto-rebuild=auto"):p+=`
auto-rebuild=auto`,Pl(c,p),console.log(V(`  Set auto-rebuild=auto in ${c}`))}catch{}up(l,s)}else u===""||u==="y"||u==="yes"?up(l,s):console.log(V("  Continuing with stale build..."))}catch{console.log(V("  Continuing with stale build..."))}else console.log(V("  Run `aicommits rebuild` to rebuild"))}i(L5,"checkAndRebuildIfStale");function up(e,t){console.log(V(`  Running: ${e}`));try{bt(e,{cwd:t,stdio:"pipe",encoding:"utf8"}),console.log(`${Q("\u2713")} Rebuilt successfully`);const n=process.argv.slice(1);bt(`"${process.execPath}" ${n.map(r=>`"${r}"`).join(" ")}`,{stdio:"inherit",cwd:process.cwd()}),process.exit(0)}catch(n){const r=n instanceof Error?n.message:String(n);console.log(`${Oe("\u26A0")} Rebuild failed \u2014 continuing with stale build`),(process.env.DEBUG||process.env.AICOMMITS_DEBUG)&&console.error(V(r))}}i(up,"rebuild"),globalThis.AI_SDK_LOG_WARNINGS=!1;const{description:U5,version:G1}=Em;if(!j1&&G1==="0.0.0-semantic-release"){const e=process.argv.slice(2),t=e[0]==="rebuild",n=e[0]==="install"||e[0]==="uninstall"||e[0]==="compile",r=e.includes("--rebuild");!e.includes("--no-rebuild")&&!t&&!n&&(e.includes("-h")||e.includes("--help")||e.includes("-v")||e.includes("--version")||L5({force:r}))}const Z1=process.argv.slice(2);Dm({name:"aicommits",flags:{generate:{type:Number,description:"Number of messages to generate (Warning: generating multiple costs more) (default: 1)",alias:"g"},exclude:{type:[String],description:"Files to exclude from AI analysis",alias:"x"},all:{type:Boolean,description:"Automatically stage changes in tracked files for the commit",alias:"a",default:!1},type:{type:String,description:"Git commit message format (default: plain). Supports plain, conventional, and gitmoji",alias:"t"},yes:{type:Boolean,description:"Skip confirmation when committing after message generation (default: false)",alias:"y",default:!1},clipboard:{type:Boolean,description:"Copy the selected message to the clipboard instead of committing (default: false)",alias:"c",default:!1},noVerify:{type:Boolean,description:"Bypass pre-commit hooks while committing (default: false)",alias:"n",default:!1},noPostCommit:{type:Boolean,description:"Skip post-commit actions for this invocation (default: false)",default:!1},prompt:{type:String,description:"Custom prompt to guide the LLM behavior (e.g., specific language, style instructions)",alias:"p"},version:{type:Boolean,description:"Show version number",alias:"v"}},commands:[l5,u5,c5,d5,m5,x5,S5,I5,T5,F5,N5],help:{description:`${U5}

Examples:
  # Core usage
  aicommits                          Generate a commit message for staged changes
  aicommits -y                       Generate and commit without confirmation
  aicommits -a -y                    Stage all tracked changes, generate, and commit
  aicommits -g 3                     Pick from 3 generated message options

  # Customize output
  aicommits -t conventional          Use conventional commit format (feat:, fix:, etc.)
  aicommits -t gitmoji               Use gitmoji commit format (\u{1F389}, \u{1F41B}, etc.)
  aicommits -p "write in German"     Guide the AI with a custom instruction
  aicommits -c                       Copy generated message to clipboard (don't commit)
  aicommits -x package-lock.json     Exclude a file from AI analysis

  # Atomic commits with AI
  aicommits split                    Split changes into logical atomic commits with AI
  aicommits split -d                 Preview commit groups without committing (dry run)
  aicommits split -S                 Re-group already-staged files into multiple commits

  # Configuration
  aicommits setup                    Interactive provider/API key setup
  aicommits model                    Switch AI model
  aicommits config info              Show all config sources and active settings
  aicommits config set type=conventional          Set default commit format
  aicommits config set post-commit="git push"     Auto-push after every commit
  aicommits config set post-commit-rebuild=smart  Auto-rebuild binary after commits

  # Installation & maintenance
  aicommits hook install             Auto-generate messages on every git commit
  aicommits install                  Install binary to ~/.local/bin
  aicommits compile                  Compile standalone native binary (via Bun)
  aicommits doctor                   Check for PATH conflicts`},ignoreArgv:i(e=>e==="unknown-flag"||e==="argument","ignoreArgv")},e=>{e.flags.version&&(console.log(G1),process.exit(0)),j1?a5():s5(e.flags.generate,e.flags.exclude,e.flags.all,e.flags.type,e.flags.yes,e.flags.clipboard,e.flags.noVerify,e.flags.noPostCommit,e.flags.prompt,Z1)},Z1);export{Bi as g,z_ as r};
